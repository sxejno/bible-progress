<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bible Progress</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #0f172a; -webkit-font-smoothing: antialiased; }
        .tab-active { background: #4f46e5; color: white; border-color: #4f46e5; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.2); }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); }
        
        /* Subtle hover lift for books */
        .book-card { transition: all 0.2s ease-out; }
        .book-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px -3px rgba(0, 0, 0, 0.1); }
        
        /* Animation */
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Hide scrollbar for the stats/legend bar but allow scrolling */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Profile color dot animation */
        .profile-dot { transition: all 0.3s ease; }
        .profile-dot:hover { transform: scale(1.2); }
    </style>
</head>
<body class="pb-24">

    <div id="auth-modal" class="hidden fixed inset-0 z-[100] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-6 w-full max-w-sm shadow-2xl animate-in border border-white/50">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-black text-slate-900 tracking-tight">Sync Progress</h2>
                <button onclick="window.toggleAuthModal(false)" class="p-2 bg-slate-50 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-600">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="space-y-3 mb-4">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1">Email</label>
                    <input type="email" id="email-input" placeholder="you@example.com" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder-slate-300">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1">Password</label>
                    <input type="password" id="pass-input" placeholder="••••••••" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder-slate-300">
                </div>
                <div id="auth-error" class="text-xs font-bold text-red-500 bg-red-50 p-2 rounded-lg hidden"></div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="window.handleEmailAuth('LOGIN')" id="btn-login-email" class="bg-indigo-600 text-white py-3 rounded-xl text-xs font-black uppercase tracking-wide hover:bg-indigo-700 hover:shadow-lg hover:shadow-indigo-200 transition-all">Log In</button>
                <button onclick="window.handleEmailAuth('REGISTER')" id="btn-signup-email" class="bg-white border border-slate-200 text-slate-600 py-3 rounded-xl text-xs font-black uppercase tracking-wide hover:bg-slate-50 hover:border-slate-300 transition-all">Sign Up</button>
            </div>

            <div class="relative flex py-2 items-center mb-6">
                <div class="flex-grow border-t border-slate-100"></div>
                <span class="flex-shrink-0 mx-4 text-[9px] font-black text-slate-300 uppercase tracking-widest">Or continue with</span>
                <div class="flex-grow border-t border-slate-100"></div>
            </div>

            <button onclick="window.handleGoogleLogin()" class="w-full flex items-center justify-center gap-3 bg-white border border-slate-200 text-slate-700 py-3.5 rounded-xl text-sm font-bold hover:bg-slate-50 transition-all hover:border-slate-300 group">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5 group-hover:scale-110 transition-transform">
                Google
            </button>
        </div>
    </div>

    <div id="intro-modal" class="hidden fixed inset-0 z-[100] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-8 w-full max-w-2xl shadow-2xl animate-in border border-white/50 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h2 class="text-3xl font-black text-indigo-950 tracking-tight mb-2">Welcome to Bible Progress!</h2>
                    <p class="text-sm text-slate-500 font-medium">Track your Bible reading journey with precision</p>
                </div>
                <button onclick="window.closeIntroModal()" class="p-2 bg-slate-50 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-600 flex-shrink-0">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <div class="space-y-6">
                <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                    <h3 class="text-lg font-black text-indigo-900 mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/></svg>
                        Word-Weighted Tracking
                    </h3>
                    <p class="text-sm text-slate-700 leading-relaxed">Unlike traditional chapter-based trackers, Bible Progress tracks your reading by <strong class="text-indigo-900">word count</strong>. Psalm 117 (33 words) is weighted differently than Psalm 119 (2,423 words), giving you mathematically accurate progress!</p>
                </div>

                <div class="bg-emerald-50 p-6 rounded-2xl border border-emerald-100">
                    <h3 class="text-lg font-black text-emerald-900 mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/></svg>
                        How to Use
                    </h3>
                    <ul class="space-y-2 text-sm text-slate-700">
                        <li class="flex items-start gap-2">
                            <span class="text-emerald-600 font-bold mt-0.5">•</span>
                            <span><strong class="text-emerald-900">Click books</strong> to expand and view chapters</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-emerald-600 font-bold mt-0.5">•</span>
                            <span><strong class="text-emerald-900">Check chapters</strong> as you read them - your progress updates instantly</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-emerald-600 font-bold mt-0.5">•</span>
                            <span><strong class="text-emerald-900">Switch tabs</strong> to view Old Testament, New Testament, Stats, or your Daily Plan</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-emerald-600 font-bold mt-0.5">•</span>
                            <span><strong class="text-emerald-900">Create profiles</strong> to track multiple people or reading plans separately</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-amber-50 p-6 rounded-2xl border border-amber-100">
                    <h3 class="text-lg font-black text-amber-900 mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clip-rule="evenodd"/></svg>
                        Reading Plans
                    </h3>
                    <p class="text-sm text-slate-700 leading-relaxed mb-3">Choose from three built-in reading plans in the <strong class="text-amber-900">Daily Plan</strong> tab:</p>
                    <ul class="space-y-1.5 text-sm text-slate-700">
                        <li class="flex items-start gap-2">
                            <span class="text-amber-600 font-bold">→</span>
                            <span><strong class="text-amber-900">Canonical:</strong> Genesis to Revelation order</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-amber-600 font-bold">→</span>
                            <span><strong class="text-amber-900">M'Cheyne:</strong> Read the entire Bible in one year</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-amber-600 font-bold">→</span>
                            <span><strong class="text-amber-900">Prof. Horner:</strong> Read from 10 different lists daily</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                    <h3 class="text-lg font-black text-slate-900 mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/></svg>
                        Your Data is Safe
                    </h3>
                    <p class="text-sm text-slate-700 leading-relaxed">All progress is saved <strong class="text-slate-900">automatically in your browser</strong>. Click <strong class="text-slate-900">"Sync"</strong> to create an account and back up your data to the cloud for access across devices.</p>
                </div>
            </div>

            <div class="mt-8 flex justify-center">
                <button onclick="window.closeIntroModal()" class="bg-indigo-600 text-white px-8 py-4 rounded-xl text-sm font-black uppercase tracking-wide hover:bg-indigo-700 hover:shadow-lg hover:shadow-indigo-200 transition-all">
                    Let's Get Started!
                </button>
            </div>
        </div>
    </div>

    <header class="sticky top-0 z-50 glass border-b border-indigo-100 shadow-sm">
        <div class="max-w-5xl mx-auto px-4 py-4 sm:px-6">
            <div class="flex flex-col gap-5">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-2xl font-black text-indigo-950 tracking-tighter">BIBLE PROGRESS</h1>
                            <p id="books-completed-stat" class="text-xs font-bold text-slate-500 uppercase tracking-widest mt-1">0 OF 66 BOOKS READ</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 self-end sm:self-auto">
                        <button onclick="window.showIntroModal()" class="p-2 bg-slate-100 hover:bg-slate-200 rounded-full transition-colors text-slate-600 hover:text-indigo-600 border border-slate-200" title="Help & Introduction">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </button>

                        <div class="relative group">
                            <button id="profile-menu-btn" onclick="window.toggleProfileMenu()" class="flex items-center gap-2 bg-slate-100 text-slate-700 px-4 py-2 rounded-full text-sm font-bold hover:bg-slate-200 transition-colors border border-slate-200">
                                <div id="current-profile-dot" class="w-3 h-3 rounded-full profile-dot"></div>
                                <span id="current-profile-name">Default</span>
                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            
                            <div id="profile-menu" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-2xl shadow-xl border border-slate-100 p-2 z-50 animate-in ring-1 ring-black/5">
                                <div id="profile-list" class="flex flex-col gap-1 mb-2 border-b border-slate-100 pb-2"></div>
                                <button onclick="window.createNewProfile()" class="w-full text-left px-3 py-3 text-sm font-bold text-indigo-600 hover:bg-indigo-50 rounded-xl flex items-center gap-2 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                    New Profile
                                </button>
                            </div>
                        </div>

                        <button id="login-btn" onclick="window.toggleAuthModal(true)" class="flex items-center gap-2 bg-indigo-600 text-white px-5 py-2 rounded-full text-sm font-bold hover:bg-indigo-700 transition-colors shadow-md shadow-indigo-200">
                            <span id="login-text">Sync</span>
                        </button>
                        <div id="user-profile" class="hidden flex items-center gap-3">
                            <img id="user-photo" src="" alt="User" class="w-9 h-9 rounded-full border-2 border-indigo-200">
                            <button id="logout-btn" class="text-xs font-bold text-slate-400 hover:text-red-500 uppercase tracking-wide">Logout</button>
                        </div>
                    </div>
                </div>

                <div class="space-y-1">
                    <div class="w-full bg-slate-200 rounded-full h-3 overflow-hidden">
                        <div id="total-progress-bar" class="bg-indigo-600 h-full transition-all duration-1000 ease-out" style="width: 0%"></div>
                    </div>

                    <div class="flex justify-between items-end px-1">
                         <div class="text-left">
                            <span id="total-percent" class="text-4xl font-black text-indigo-600 leading-none">0.00%</span>
                            <div class="text-xs font-bold text-slate-500 uppercase tracking-tight mt-1">Total Words Read</div>
                        </div>
                        <div id="sync-status" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 bg-slate-100 px-2 py-1 rounded-full">Local Only</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white/60 p-3 rounded-2xl border border-indigo-50/50">
                        <div class="flex justify-between text-[11px] font-bold text-slate-500 uppercase mb-2">
                            <span>Old Testament</span>
                            <span id="ot-percent" class="text-indigo-900 font-black">0.00%</span>
                        </div>
                        <div class="w-full bg-slate-200 rounded-full h-2 overflow-hidden">
                            <div id="ot-progress-bar" class="bg-amber-500 h-full transition-all duration-700" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="bg-white/60 p-3 rounded-2xl border border-indigo-50/50">
                        <div class="flex justify-between text-[11px] font-bold text-slate-500 uppercase mb-2">
                            <span>New Testament</span>
                            <span id="nt-percent" class="text-indigo-900 font-black">0.00%</span>
                        </div>
                        <div class="w-full bg-slate-200 rounded-full h-2 overflow-hidden">
                            <div id="nt-progress-bar" class="bg-emerald-500 h-full transition-all duration-700" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 mt-8">
        
        <div class="overflow-x-auto no-scrollbar pb-2 -mx-4 px-4 sm:mx-0 sm:px-0">
            <div class="flex gap-2 mb-6 p-1.5 bg-slate-200/50 rounded-2xl w-max sm:w-fit">
                <button onclick="window.setTab('ALL')" id="tab-all" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all tab-active whitespace-nowrap">All Books</button>
                <button onclick="window.setTab('OT')" id="tab-ot" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap">OT Books</button>
                <button onclick="window.setTab('NT')" id="tab-nt" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap">NT Books</button>
                <button onclick="window.setTab('PLAN')" id="tab-plan" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap">Daily Plan</button>
                <button onclick="window.setTab('STATS')" id="tab-stats" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap">Stats</button>
                <button onclick="window.setTab('ABOUT')" id="tab-about" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap">About</button>
            </div>
        </div>

        <div id="view-books" class="animate-in">
            <div class="mb-6">
                <div class="relative">
                    <input type="text" id="book-search" onkeyup="window.handleSearch()" placeholder="Search books..." class="w-full pl-12 pr-4 py-4 rounded-2xl border-none bg-white shadow-sm text-base font-medium text-slate-700 focus:ring-2 focus:ring-indigo-500 placeholder-slate-400 outline-none transition-all">
                    <svg class="w-6 h-6 absolute left-4 top-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </div>
            <div id="subdivision-bar" class="flex gap-3 overflow-x-auto no-scrollbar mb-8 pb-2"></div>
            <div id="book-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        </div>

        <div id="view-plan" class="hidden animate-in">
            <div class="bg-indigo-600 rounded-[2.5rem] p-8 shadow-xl shadow-indigo-200 mb-8 text-white relative overflow-hidden">
                <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
                
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-4 relative z-10">
                    <div>
                        <h2 class="text-3xl font-black tracking-tight mb-2">Today's Reading</h2>
                        <p class="text-indigo-100 text-sm font-medium">Your customized daily chapters.</p>
                    </div>
                    <select id="plan-selector" onchange="window.changePlan()" class="bg-white/20 text-white border border-white/30 rounded-xl text-sm font-bold uppercase tracking-wide py-3 px-5 outline-none focus:bg-white/30 focus:ring-2 focus:ring-white/50 cursor-pointer w-full md:w-auto">
                        <option value="SEQUENTIAL" class="text-slate-900">Canonical (Default)</option>
                        <option value="MCHEYNE" class="text-slate-900">M'Cheyne (1 Year)</option>
                        <option value="HORNER" class="text-slate-900">Prof. Horner (10 Lists)</option>
                    </select>
                </div>
                
                <div id="plan-description-box" class="relative z-10 mb-8 mt-4 p-4 bg-white/10 rounded-2xl border border-white/10 text-sm text-indigo-50 leading-relaxed hidden">
                    </div>

                <div id="daily-plan-list" class="flex flex-col gap-3 relative z-10"></div>
                <p id="plan-footer-msg" class="text-center text-xs font-bold text-indigo-200 mt-6 uppercase tracking-widest relative z-10 opacity-70"></p>
            </div>

            <div class="bg-white rounded-[2.5rem] p-8 border border-slate-100 shadow-sm">
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Manual Backup & Restore</h3>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="window.backupData()" class="flex-1 flex items-center justify-center gap-2 px-6 py-4 rounded-xl bg-slate-50 border border-slate-200 text-slate-600 font-bold hover:bg-slate-100 transition-colors text-sm uppercase tracking-wide">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download Data
                    </button>
                    <label class="flex-1 cursor-pointer flex items-center justify-center gap-2 px-6 py-4 rounded-xl bg-slate-50 border border-slate-200 text-slate-600 font-bold hover:bg-slate-100 transition-colors text-sm uppercase tracking-wide">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m-4-4v12"></path></svg>
                        Restore File
                        <input type="file" id="restore-input" class="hidden" accept=".json" onchange="window.restoreData(this)">
                    </label>
                </div>
                <p id="restore-msg" class="text-center text-sm font-bold text-emerald-600 mt-4 hidden bg-emerald-50 py-2 rounded-lg"></p>
            </div>
        </div>

        <div id="view-stats" class="hidden animate-in">
            <div class="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50 mb-8 flex flex-col lg:flex-row items-center gap-8 lg:gap-12">
                <div class="w-full lg:w-5/12 relative min-h-[300px] flex items-center justify-center">
                    <canvas id="mainDonutChart"></canvas>
                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Total Read</span>
                        <span id="stats-page-total-percent" class="text-4xl font-black text-indigo-900">0%</span>
                    </div>
                </div>
                <div class="w-full lg:w-7/12 text-center lg:text-left">
                    <h2 class="text-3xl font-black text-slate-900 tracking-tight mb-2">Bible Completion</h2>
                    <p class="text-base text-slate-500 mb-8 max-w-md mx-auto lg:mx-0 leading-relaxed">Your reading progress across all categories of the Bible, weighted by word count.</p>
                    <div id="legend-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3 text-left"></div>
                </div>
            </div>
            <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6 px-2">Category Breakdown</h3>
            <div id="category-stats-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        </div>
        
        <div id="view-about" class="hidden animate-in">
             <div class="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50 mb-8">
                <h2 class="text-3xl font-black text-slate-900 tracking-tight mb-8">About</h2>
                
                <div class="mb-10">
                    <div class="bg-indigo-50 p-8 rounded-3xl border border-indigo-100">
                        <p class="text-slate-900 font-bold mb-2 text-lg">Who made this website?</p>
                        <p id="person" class="text-2xl font-black text-indigo-900 mb-4 cursor-default">
							  a friend!
						</p>

						<script>
						  const person = document.getElementById("person");
						  person.addEventListener("mouseover", () => {
							const tag = document.createElement("span");
							tag.textContent = " .....(Shane did it)";
							tag.id = "hoverTag";
                            tag.className = "text-indigo-400 ml-2 text-lg font-bold transition-all";
							person.appendChild(tag);
						  });
						  person.addEventListener("mouseout", () => {
							const tag = document.getElementById("hoverTag");
							if (tag) tag.remove();
						  });
						</script>
							
                        <p class="text-sm text-slate-600 leading-relaxed">I just wanted a simple way of keeping track of Bible reading progress. I found something that let me mark chapters done, but it considered all chapters equal. Psalm 117 is not equal to Psalm 119 in word count! It seems fair to "give credit" for progress according to word count. Thus, this tool tracks Bible reading progress by chapter, weighted according to word count.</p>
                    
						<div class="mt-6 pt-6 border-t border-indigo-200/50 flex flex-col items-center">
							<p class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-3">Enjoying the app?</p>
							<a href="https://www.buymeacoffee.com/bibleprogress" target="_blank" class="group relative inline-flex items-center justify-center gap-2 px-8 py-3 bg-[#FFDD00] text-black font-[Cookie] text-xl rounded-full shadow-md hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200">
								<svg class="w-5 h-5 text-black opacity-80 group-hover:rotate-12 transition-transform" viewBox="0 0 20 20" fill="currentColor">
									<path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
									<path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd" />
								</svg>
								<span class="font-sans font-bold text-sm text-slate-900">Buy me a coffee</span>
							</a>
						</div>
					
					</div>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6">How the Plans Work</h3>
                    
                    <div class="space-y-6">
                        <div class="border border-slate-100 rounded-3xl p-6 hover:border-indigo-100 transition-colors">
                            <div class="font-bold text-slate-900 mb-2 text-lg">Canonical (Sequential)</div>
                            <p class="text-sm text-slate-500 leading-relaxed">The default method. This tracker simply looks for the first unread chapter starting from Genesis 1 and moving forward to Revelation.</p>
                        </div>

                        <div class="border border-slate-100 rounded-3xl p-6 hover:border-indigo-100 transition-colors">
                            <div class="font-bold text-slate-900 mb-2 text-lg">Robert Murray M'Cheyne (1 Year)</div>
                            <p class="text-sm text-slate-500 leading-relaxed mb-3">A widely used system that takes you through the New Testament and Psalms twice a year, and the rest of the Bible once. It consists of 4 daily readings:</p>
                            <ul class="list-disc list-inside text-sm text-slate-600 font-medium space-y-1 ml-2">
                                <li><strong>Family:</strong> 2 chapters (Usually 1 OT, 1 NT)</li>
                                <li><strong>Secret:</strong> 2 chapters (Usually 1 OT, 1 NT/Psalms)</li>
                            </ul>
                        </div>

                        <div class="border border-slate-100 rounded-3xl p-6 hover:border-indigo-100 transition-colors">
                            <div class="font-bold text-slate-900 mb-2 text-lg">Professor Grant Horner's System</div>
                            <p class="text-sm text-slate-500 leading-relaxed mb-3">An intensive reading system designed for immersion. You read <strong>10 chapters per day</strong>, one from each of 10 distinct lists (e.g., Gospels, Pentateuch, Epistles, Wisdom, etc.).</p>
                            <p class="text-sm text-slate-500 leading-relaxed">The goal is not to "finish" but to cycle through the lists constantly. Because the lists vary in length, you will never read the same set of 10 chapters twice.</p>
                        </div>
                    </div>
                </div>

             </div>
        </div>

        <div id="view-chapters" class="hidden animate-in">
            <div class="flex items-center justify-between mb-8">
                <button onclick="window.showBooks()" class="flex items-center text-indigo-600 font-bold text-sm hover:-translate-x-1 transition-transform bg-indigo-50 px-4 py-2 rounded-full">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                    Back to Library
                </button>
                <div id="book-label" class="bg-indigo-100 text-indigo-700 text-xs font-black px-4 py-2 rounded-full uppercase tracking-widest shadow-sm">Testament</div>
            </div>
            
            <div class="bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50">
                <div class="mb-10 text-center">
                    <h2 id="active-book-title" class="text-4xl sm:text-5xl font-black text-slate-900 tracking-tighter mb-4">Genesis</h2>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                        <div class="w-full sm:w-64 bg-slate-100 h-3 rounded-full overflow-hidden">
                            <div id="book-inner-bar" class="bg-indigo-500 h-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <span id="book-stat-detail" class="text-xs font-black text-indigo-600 uppercase tracking-widest">0/50 Chapters</span>
                    </div>
                </div>
                
                <div id="chapter-grid" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-3 sm:gap-4"></div>

                <div class="mt-12 pt-8 border-t border-slate-100 flex flex-col sm:flex-row justify-center gap-4">
                    <button onclick="window.toggleAllInBook(true)" class="text-xs font-black text-emerald-600 uppercase tracking-widest hover:bg-emerald-50 px-6 py-3 rounded-full transition-colors border border-transparent hover:border-emerald-100">Mark Book Finished</button>
                    <button onclick="window.toggleAllInBook(false)" class="text-xs font-black text-slate-400 uppercase tracking-widest hover:bg-slate-50 px-6 py-3 rounded-full transition-colors border border-transparent hover:border-slate-200">Reset Book</button>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";

        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBkQc0Hyw6zFu9s8QQz1KfEz-5lEkpPVd0",
            authDomain: "bibleprogress-48cfd.firebaseapp.com",
            projectId: "bibleprogress-48cfd",
            storageBucket: "bibleprogress-48cfd.firebasestorage.app",
            messagingSenderId: "400605616220",
            appId: "1:400605616220:web:ce3c6f7b3048c90b636e99",
            measurementId: "G-94H40H1FCR"
        };

        // --- INITIALIZE FIREBASE ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);
        const provider = new GoogleAuthProvider();

        // --- GLOBAL ERROR HANDLER ---
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Error: ', msg, url, lineNo, columnNo, error);
            return false;
        };

        // --- HASH-BASED COLOR GENERATOR ---
        function stringToColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            const hue = Math.abs(hash % 360);
            return {
                bg: `hsl(${hue}, 70%, 92%)`,
                border: `hsl(${hue}, 50%, 70%)`,
                text: `hsl(${hue}, 60%, 35%)`,
                solid: `hsl(${hue}, 65%, 55%)`
            };
        }

        // --- SANITIZE PROFILE NAME (ALPHANUMERIC ONLY, MAX 20 CHARS) ---
        function sanitizeProfileName(name) {
            const cleaned = name.replace(/[^a-zA-Z0-9]/g, '').substring(0, 20);
            return cleaned;
        }

        // --- VALIDATE URL (MUST BE HTTPS) ---
        function isValidHttpsUrl(urlString) {
            try {
                const url = new URL(urlString);
                return url.protocol === 'https:';
            } catch (e) {
                return false;
            }
        }

        // --- VALIDATE APP DATA ---
        function validateAppData(data) {
            if(!data || typeof data !== 'object') return false;
            if(!data.profiles || typeof data.profiles !== 'object') return false;
            if(!data.activeProfileId || typeof data.activeProfileId !== 'string') return false;
            if(!data.profiles[data.activeProfileId]) return false;
            return true;
        }

        // --- APP STATE & MIGRATION ---
        let savedData = null;
        try {
            const rawData = localStorage.getItem('kjv_v6_data');
            if (rawData) {
                savedData = JSON.parse(rawData);
                if(savedData && !validateAppData(savedData)) {
                    console.warn('Invalid saved data, resetting to defaults');
                    savedData = null;
                }
            }
        } catch (e) {
            console.error('Failed to parse saved data:', e);
            savedData = null;
        }

        let oldProgress = null;
        try {
            const rawProgress = localStorage.getItem('kjv_v6_progress');
            if (rawProgress) {
                oldProgress = JSON.parse(rawProgress);
            }
        } catch (e) {
            console.error('Failed to parse old progress:', e);
            oldProgress = null;
        }
        let oldPlan = localStorage.getItem('kjv_v6_active_plan') || 'SEQUENTIAL';

        let appData = savedData || { 
            profiles: { "Default": oldProgress || {} },
            activeProfileId: "Default",
            profilePlans: { "Default": oldPlan }
        };

        // Ensure data structure is valid
        if(!appData.profiles || Object.keys(appData.profiles).length === 0) {
            appData.profiles = { "Default": {} };
            appData.activeProfileId = "Default";
        }

        // Migrate existing users to have profilePlans
        if(!appData.profilePlans) {
            appData.profilePlans = {};
            Object.keys(appData.profiles).forEach(name => {
                appData.profilePlans[name] = oldPlan;
            });
        }

        // Ensure active profile exists
        if(!appData.profiles[appData.activeProfileId]) {
            appData.activeProfileId = Object.keys(appData.profiles)[0];
        }

        // Ensure all profiles have a plan
        Object.keys(appData.profiles).forEach(name => {
            if(!appData.profilePlans[name]) {
                appData.profilePlans[name] = 'SEQUENTIAL';
            }
        });

        let activePlan = appData.profilePlans[appData.activeProfileId] || 'SEQUENTIAL';
        let currentUser = null;
        let unsubscribe = null;
        let saveTimeout = null;
        let userIsEditing = false; // NEW: Prevent cloud sync during edits

        // --- UI ELEMENTS ---
        const logoutBtn = document.getElementById('logout-btn');
        const userProfile = document.getElementById('user-profile');
        const userPhoto = document.getElementById('user-photo');
        const syncStatus = document.getElementById('sync-status');
        const currentProfileName = document.getElementById('current-profile-name');
        const currentProfileDot = document.getElementById('current-profile-dot');

        const planSelector = document.getElementById('plan-selector');
        if(planSelector) planSelector.value = activePlan;

        // --- UPDATE PROFILE COLOR ---
        function updateProfileColor() {
            const color = stringToColor(appData.activeProfileId);
            if(currentProfileDot) {
                currentProfileDot.style.backgroundColor = color.solid;
            }
        }

        // --- HELPER FOR CURRENT PROGRESS ---
        function getProgress() {
            return appData.profiles[appData.activeProfileId] || {};
        }
        function setProgress(newProg) {
            appData.profiles[appData.activeProfileId] = newProg;
        }

        // --- AUTH LOGIC ---
        window.toggleAuthModal = (show) => {
            const modal = document.getElementById('auth-modal');
            const errBox = document.getElementById('auth-error');
            if(show) {
                modal.classList.remove('hidden');
                errBox.classList.add('hidden');
            } else {
                modal.classList.add('hidden');
            }
        };

        // --- INTRO MODAL LOGIC ---
        window.showIntroModal = () => {
            const modal = document.getElementById('intro-modal');
            modal.classList.remove('hidden');
        };

        window.closeIntroModal = () => {
            const modal = document.getElementById('intro-modal');
            modal.classList.add('hidden');
            // Mark that user has seen the intro
            localStorage.setItem('kjv_intro_seen', 'true');
        };

        // Check if this is the user's first visit
        function checkFirstVisit() {
            const hasSeenIntro = localStorage.getItem('kjv_intro_seen');
            if (!hasSeenIntro) {
                // Show intro modal after a short delay for better UX
                setTimeout(() => {
                    window.showIntroModal();
                }, 500);
            }
        }

        window.handleGoogleLogin = () => {
            signInWithPopup(auth, provider)
                .then((result) => { window.toggleAuthModal(false); })
                .catch((error) => {
                    alert("Google Login Failed: " + error.message);
                });
        };

        window.handleEmailAuth = async (mode) => {
            const email = document.getElementById('email-input').value;
            const pass = document.getElementById('pass-input').value;
            const errBox = document.getElementById('auth-error');
            
            if (!email || !pass) {
                errBox.innerText = "Please enter both email and password.";
                errBox.classList.remove('hidden');
                return;
            }

            try {
                if (mode === 'REGISTER') {
                    await createUserWithEmailAndPassword(auth, email, pass);
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                }
                window.toggleAuthModal(false);
            } catch (error) {
                let msg = error.message;
                if (error.code === 'auth/invalid-credential') msg = "Incorrect email or password.";
                if (error.code === 'auth/email-already-in-use') msg = "That email is already registered.";
                if (error.code === 'auth/weak-password') msg = "Password should be at least 6 characters.";
                errBox.innerText = msg;
                errBox.classList.remove('hidden');
            }
        };

        logoutBtn.addEventListener('click', () => {
            signOut(auth).then(() => window.location.reload());
        });

        onAuthStateChanged(auth, (user) => {
            const loginBtn = document.getElementById('login-btn');
            if (user) {
                currentUser = user;
                loginBtn.classList.add('hidden');
                userProfile.classList.remove('hidden');
                // Validate photoURL is HTTPS before using it (prevent XSS/open redirect)
                if (user.photoURL && isValidHttpsUrl(user.photoURL)) {
                    userPhoto.src = user.photoURL;
                } else {
                    userPhoto.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.email)}&background=e0e7ff&color=4f46e5`;
                }
                
                syncStatus.textContent = "Cloud Synced";
                syncStatus.className = "text-[10px] font-bold uppercase tracking-widest mb-1 bg-emerald-50 text-emerald-600 px-2 py-1 rounded-full border border-emerald-100";
                initCloudSync(user.uid);
            } else {
                currentUser = null;
                loginBtn.classList.remove('hidden');
                userProfile.classList.add('hidden');
                syncStatus.textContent = "Local Only";
                syncStatus.className = "text-[10px] font-bold uppercase tracking-widest mb-1 bg-slate-100 text-slate-400 px-2 py-1 rounded-full";
                if(unsubscribe) unsubscribe(); 
            }
        });

        async function initCloudSync(uid) {
            const userDocRef = doc(db, "users", uid);
            unsubscribe = onSnapshot(userDocRef, (docSnap) => {
                // Skip sync if user is actively editing
                if(userIsEditing) {
                    console.log('⏸️ Skipping sync - user editing');
                    return;
                }
                
                if (docSnap.exists()) {
                    const cloudData = docSnap.data().appData || {};
                    if (Object.keys(cloudData).length > 0 && validateAppData(cloudData)) {
                        appData = cloudData;
                        
                        // Ensure data integrity
                        if(!appData.profilePlans) {
                            appData.profilePlans = {};
                            Object.keys(appData.profiles).forEach(name => {
                                appData.profilePlans[name] = 'SEQUENTIAL';
                            });
                        }
                        
                        // Ensure active profile exists
                        if(!appData.profiles[appData.activeProfileId]) {
                            appData.activeProfileId = Object.keys(appData.profiles)[0];
                        }
                        
                        localStorage.setItem('kjv_v6_data', JSON.stringify(appData));
                        refreshUI();
                    } else {
                        setDoc(userDocRef, { appData: appData }, { merge: true });
                    }
                } else {
                    setDoc(userDocRef, { appData: appData }, { merge: true });
                }
            });
        }

        function refreshUI() {
            currentProfileName.innerText = appData.activeProfileId;
            updateProfileColor();
            
            // Update active plan for current profile
            activePlan = appData.profilePlans[appData.activeProfileId] || 'SEQUENTIAL';
            const planSelector = document.getElementById('plan-selector');
            if(planSelector) planSelector.value = activePlan;
            
            if(window.activeTab === 'STATS') window.renderStatsPage();
            else if(window.activeTab === 'PLAN') window.renderDailyPlan();
            else if(window.activeTab === 'ABOUT') { }
            else { window.renderBookGrid(); window.renderSubdivisionStats(); }
            window.updateStats();
        }

        // --- GLOBAL FUNCTIONS ---
        window.saveProgress = (immediate = false) => {
			// Always save to localStorage first (never fails)
			localStorage.setItem('kjv_v6_data', JSON.stringify(appData));
			localStorage.setItem('kjv_v6_progress', JSON.stringify(getProgress())); 
			
			// Try to save to Firebase if user is logged in
			if (currentUser) {
				if(immediate) {
					// Immediate save for plan changes - no debounce
					const userDocRef = doc(db, "users", currentUser.uid);
					setDoc(userDocRef, { appData: appData }, { merge: true })
						.then(() => {
							console.log('✅ Saved immediately to Firebase');
						})
						.catch(err => {
							console.warn('⚠️ Firebase save failed (data saved locally):', err.message);
							// Update sync status to show warning
							if(syncStatus) {
								syncStatus.textContent = "⚠️ Sync Issue";
								syncStatus.className = "text-[10px] font-bold uppercase tracking-widest mb-1 bg-amber-50 text-amber-600 px-2 py-1 rounded-full border border-amber-100";
							}
						});
				} else {
					// Debounced save for chapter toggles
					clearTimeout(saveTimeout);
					saveTimeout = setTimeout(() => {
						const userDocRef = doc(db, "users", currentUser.uid);
						setDoc(userDocRef, { appData: appData }, { merge: true })
							.then(() => {
								console.log('✅ Saved to Firebase');
								if(syncStatus) {
									syncStatus.textContent = "Cloud Synced";
									syncStatus.className = "text-[10px] font-bold uppercase tracking-widest mb-1 bg-emerald-50 text-emerald-600 px-2 py-1 rounded-full border border-emerald-100";
								}
							})
							.catch(err => {
								console.warn('⚠️ Firebase save failed (data saved locally):', err.message);
								if(syncStatus) {
									syncStatus.textContent = "⚠️ Sync Issue";
									syncStatus.className = "text-[10px] font-bold uppercase tracking-widest mb-1 bg-amber-50 text-amber-600 px-2 py-1 rounded-full border border-amber-100";
								}
							});
					}, 1000);
				}
			}
			refreshUI();
		};

        // --- PROFILE MANAGEMENT ---
        window.toggleProfileMenu = () => {
            const menu = document.getElementById('profile-menu');
            menu.classList.toggle('hidden');
            if(!menu.classList.contains('hidden')) renderProfileList();
        };

        function renderProfileList() {
            const list = document.getElementById('profile-list');
            list.innerHTML = '';
            
            Object.keys(appData.profiles).forEach(name => {
                const isActive = name === appData.activeProfileId;
                const color = stringToColor(name);
                
                const itemDiv = document.createElement('div');
                itemDiv.className = `flex items-center justify-between group/item px-3 py-2 rounded-xl hover:bg-slate-50 transition-colors ${isActive ? 'bg-indigo-50/50' : ''}`;
                
                const btn = document.createElement('button');
                btn.className = `text-left flex-1 text-sm font-bold ${isActive ? 'text-indigo-600' : 'text-slate-600'} flex items-center gap-2`;
                btn.onclick = () => window.switchProfile(name);
                
                const dot = document.createElement('div');
                dot.className = 'w-3 h-3 rounded-full profile-dot flex-shrink-0';
                dot.style.backgroundColor = color.solid;
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'truncate';
                nameSpan.textContent = name;
                
                btn.appendChild(dot);
                btn.appendChild(nameSpan);
                
                if(isActive) {
                    const badge = document.createElement('span');
                    badge.className = 'ml-2 text-[10px] text-indigo-500 bg-indigo-100 px-2 py-0.5 rounded-full uppercase tracking-wider flex-shrink-0';
                    badge.textContent = 'Active';
                    btn.appendChild(badge);
                }
                
                itemDiv.appendChild(btn);
                
                if(name !== 'Default' && !isActive) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'text-slate-300 hover:text-red-500 p-1 ml-2';
                    deleteBtn.onclick = () => window.deleteProfile(name);
                    deleteBtn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>';
                    itemDiv.appendChild(deleteBtn);
                }
                
                list.appendChild(itemDiv);
            });
        }

        window.switchProfile = (name) => {
            userIsEditing = true;
            appData.activeProfileId = name;
            window.saveProgress(true); // Immediate save
            document.getElementById('profile-menu').classList.add('hidden');

            // Re-render current view to show new profile's data
            const viewChapters = document.getElementById('view-chapters');
            const viewBooks = document.getElementById('view-books');
            const viewStats = document.getElementById('view-stats');
            const viewPlan = document.getElementById('view-plan');

            if (!viewChapters.classList.contains('hidden')) {
                // In chapter view - update chapter checkboxes
                window.renderChapterGrid();
            } else if (!viewBooks.classList.contains('hidden')) {
                // In book grid view - update book grid and stats
                window.renderBookGrid();
                window.renderSubdivisionStats();
            } else if (!viewStats.classList.contains('hidden')) {
                // In stats view - update stats
                window.renderStatsPage();
            } else if (!viewPlan.classList.contains('hidden')) {
                // In plan view - update plan
                window.renderDailyPlan();
            }

            setTimeout(() => { userIsEditing = false; }, 2000);
        };

        window.createNewProfile = () => {
            const rawName = prompt("Enter new profile name (alphanumeric only, max 20 characters):\nExamples: Family, Kids, Personal2024");
            if(!rawName || rawName.trim() === "") return;
            
            const sanitized = sanitizeProfileName(rawName);
            
            if(sanitized === "") {
                alert("Profile name must contain at least one alphanumeric character.");
                return;
            }
            
            if(appData.profiles[sanitized]) { 
                alert(`Profile "${sanitized}" already exists!`); 
                return; 
            }
            
            if(Object.keys(appData.profiles).length >= 10) {
                alert("Maximum 10 profiles allowed.");
                return;
            }
            
            appData.profiles[sanitized] = {};
            appData.profilePlans[sanitized] = 'SEQUENTIAL';
            window.switchProfile(sanitized);
        };

        window.deleteProfile = (name) => {
            if(name === appData.activeProfileId) {
                alert("⚠️ Cannot delete the active profile.\n\nPlease switch to another profile first.");
                return;
            }
            
            if(Object.keys(appData.profiles).length <= 1) {
                alert("⚠️ Cannot delete the last profile.\n\nYou must have at least one profile.");
                return;
            }
            
            const confirmMsg = `⚠️ DELETE PROFILE: "${name}"?\n\nThis will permanently delete:\n• All reading progress\n• Reading plan settings\n\nThis action CANNOT be undone.\n\nType the profile name to confirm:`;
            const userInput = prompt(confirmMsg);
            
            if(userInput === name) {
                delete appData.profiles[name];
                delete appData.profilePlans[name];
                window.saveProgress(true); // Immediate save
                alert(`✅ Profile "${name}" has been deleted.`);
            } else if(userInput !== null) {
                alert("❌ Profile name did not match. Deletion cancelled.");
            }
        };

        document.addEventListener('click', (e) => {
            const menu = document.getElementById('profile-menu');
            const btn = document.getElementById('profile-menu-btn');
            if (menu && btn && !menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        window.changePlan = () => {
			userIsEditing = true; // Block cloud sync during edit
			
			// Get the NEW selected value from dropdown
			activePlan = document.getElementById('plan-selector').value;
			
			// Save it to appData immediately
			appData.profilePlans[appData.activeProfileId] = activePlan;
			
			console.log('📝 Plan changed to:', activePlan);
			
			// Save immediately (no debounce)
			window.saveProgress(true);
			
			// Re-render the daily plan
			window.renderDailyPlan();
			
			// Unblock cloud sync after 2 seconds
			setTimeout(() => {
				userIsEditing = false;
				console.log('✅ Edit complete');
			}, 2000);
		};

        // --- CORE DATA ---
        const bible = [{"name":"Genesis","testament":"OT","ch":[797,632,695,632,505,579,584,586,658,496,606,536,457,607,471,412,679,867,1108,498,775,629,539,1816,706,889,1262,621,829,1022,1417,794,508,790,664,845,942,819,613,563,1024,760,1018,937,735,786,735,618,1022,680]},{"name":"Exodus","testament":"OT","ch":[655,642,650,930,582,770,690,878,977,787,281,1374,560,804,755,989,444,750,753,761,959,882,853,582,1042,915,613,1073,1221,986,496,894,465,856,1137,1083,754,919,1152,964]},{"name":"Leviticus","testament":"OT","ch":[538,411,478,881,574,633,852,871,597,513,1073,237,1512,1317,855,876,446,705,831,626,618,816,1163,575,1227,1159,847]},{"name":"Numbers","testament":"OT","ch":[1161,835,1243,1289,785,801,1926,610,630,866,854,381,824,1095,950,1218,415,811,558,645,839,889,747,650,481,1445,591,797,842,439,1163,1156,1381,672,846,404]},{"name":"Deuteronomy","testament":"OT","ch":[1213,919,790,1236,922,657,684,502,795,613,862,907,507,707,614,644,580,578,659,569,701,820,683,532,531,545,782,1729,767,580,824,1222,762,360]},{"name":"Joshua","testament":"OT","ch":[516,665,472,646,414,689,751,897,760,1137,590,538,773,404,1144,252,452,681,1098,222,873,1007,433,855]},{"name":"Judges","testament":"OT","ch":[867,559,882,635,748,1004,653,946,1317,437,989,440,682,587,586,895,365,780,882,1192,610]},{"name":"Ruth","testament":"OT","ch":[604,619,529,734]},{"name":"1 Samuel","testament":"OT","ch":[725,860,529,552,335,568,442,543,672,700,396,632,538,1163,804,597,1361,757,597,1058,411,573,735,549,1094,674,334,645,335,755,339]},{"name":"2 Samuel","testament":"OT","ch":[650,770,930,333,626,565,681,412,330,480,715,917,850,831,934,667,747,875,1046,638,591,1085,881,608]},{"name":"1 Kings","testament":"OT","ch":[1174,1032,725,764,502,856,1233,1494,663,660,1024,820,858,793,758,788,570,1094,536,1039,664,1109]},{"name":"2 Kings","testament":"OT","ch":[512,635,626,1030,694,811,555,429,908,937,532,529,611,713,977,497,1046,955,939,458,643,494,875,508,751]},{"name":"1 Chronicles","testament":"OT","ch":[1085,971,514,891,642,1500,874,860,929,419,1146,887,344,401,712,887,625,419,441,237,738,470,722,675,655,787,819,534,760]},{"name":"2 Chronicles","testament":"OT","ch":[447,439,396,512,321,1044,554,430,743,463,531,381,551,383,491,346,452,804,303,913,461,313,504,655,643,505,335,651,914,623,510,828,612,615,813,610]},{"name":"Ezra","testament":"OT","ch":[335,1184,339,604,387,549,663,857,410,1034]},{"name":"Nehemiah","testament":"OT","ch":[318,584,879,551,504,456,1261,519,1099,1026,796,1113,824]},{"name":"Esther","testament":"OT","ch":[542,600,398,412,342,331,276,526,811,139]},{"name":"Job","testament":"OT","ch":[545,332,491,419,514,541,471,434,651,451,375,469,536,402,638,442,372,387,532,515,637,516,413,528,149,290,489,509,552,669,740,522,670,731,335,637,432,706,610,511,574,362]},{"name":"Psalms","testament":"OT","ch":[114,198,125,127,172,140,245,146,323,239,102,124,91,119,83,169,227,850,195,150,177,332,116,140,260,185,219,125,154,211,310,305,355,303,388,151,587,309,197,267,199,195,124,376,214,161,146,252,291,354,287,237,119,124,346,203,148,185,272,182,143,210,191,176,193,306,215,482,535,271,348,305,416,377,130,165,300,1073,209,233,250,110,270,226,211,259,117,321,608,192,167,216,95,275,155,177,149,137,182,122,109,419,231,521,749,725,622,273,246,105,176,199,157,121,269,136,33,465,2423,88,154,115,134,103,165,103,101,89,144,136,260,192,164,109,136,110,126,165,133,102,170,132,246,200,183,178,136,105]},{"name":"Proverbs","testament":"OT","ch":[604,395,638,484,435,642,452,605,303,537,497,461,460,574,497,474,510,429,453,442,451,450,537,502,531,545,528,513,495,663,563]},{"name":"Ecclesiastes","testament":"OT","ch":[346,522,349,296,394,206,560,319,400,351,215,315]},{"name":"Song of Songs","testament":"OT","ch":[270,275,157,246,251,178,213,226]},{"name":"Isaiah","testament":"OT","ch":[619,451,423,125,617,296,516,520,509,735,419,149,479,650,196,265,270,180,528,152,417,482,381,537,232,503,295,781,457,796,206,427,512,445,234,467,853,565,246,731,621,562,622,664,575,335,341,550,681,681,597,449,390,507,434,394,528,385,488,629,362,356,451,314,565,696]},{"name":"Jeremiah","testament":"OT","ch":[530,960,770,936,843,769,866,566,689,631,541,419,631,608,521,548,771,534,394,469,413,725,960,254,959,660,578,485,723,620,1024,1121,573,549,526,921,545,687,544,456,488,560,345,933,142,672,171,1145,876,1238,1530,891]},{"name":"Lamentations","testament":"OT","ch":[496,591,542,474,283]},{"name":"Ezekiel","testament":"OT","ch":[645,258,653,401,376,367,635,444,275,460,607,722,584,515,177,1610,602,755,454,1030,689,715,1289,448,433,497,876,555,487,529,440,836,810,786,393,908,773,617,760,1130,631,519,642,762,779,567,589,835]},{"name":"Daniel","testament":"OT","ch":[587,1251,882,934,915,727,766,737,764,594,1184,350]},{"name":"Hosea","testament":"OT","ch":[259,538,129,480,358,259,342,296,357,348,269,319,314,227]},{"name":"Joel","testament":"OT","ch":[447,722,453]},{"name":"Amos","testament":"OT","ch":[343,395,345,329,613,313,410,320,381]},{"name":"Obadiah","testament":"OT","ch":[670]},{"name":"Jonah","testament":"OT","ch":[464,266,237,280]},{"name":"Micah","testament":"OT","ch":[390,323,274,397,364,435,462]},{"name":"Nahum","testament":"OT","ch":[355,303,382]},{"name":"Habakkuk","testament":"OT","ch":[414,468,433]},{"name":"Zephaniah","testament":"OT","ch":[435,359,382]},{"name":"Haggai","testament":"OT","ch":[354,502]},{"name":"Zechariah","testament":"OT","ch":[435,347,236,331,268,386,311,574,420,319,357,423,259,549]},{"name":"Malachi","testament":"OT","ch":[394,427,432,142]},{"name":"Matthew","testament":"NT","ch":[465,442,318,511,914,691,563,678,755,878,622,1017,1097,747,752,576,569,788,629,715,963,911,872,1058,1032,1515,1373,441]},{"name":"Mark","testament":"NT","ch":[864,532,631,743,856,1104,765,758,1024,1021,663,891,712,1391,962,459]},{"name":"Luke","testament":"NT","ch":[1511,961,799,871,786,999,1031,1133,1184,888,1102,1111,735,719,650,617,738,868,930,936,758,1406,1042,1058]},{"name":"John","testament":"NT","ch":[907,447,770,1020,848,1342,920,1021,745,807,1041,1014,638,608,477,565,547,859,858,616,584]},{"name":"Acts","testament":"NT","ch":[555,966,564,725,843,315,1198,777,890,856,518,502,1019,555,804,775,711,529,810,778,840,560,615,542,524,730,982,604]},{"name":"Romans","testament":"NT","ch":[689,580,541,483,459,420,532,831,663,411,664,381,319,449,666,424]},{"name":"1 Corinthians","testament":"NT","ch":[566,312,445,417,303,439,786,271,581,652,650,551,269,771,1040,414]},{"name":"2 Corinthians","testament":"NT","ch":[499,300,363,355,419,321,332,459,318,412,679,474,276]},{"name":"Galatians","testament":"NT","ch":[469,461,595,558,440,316]},{"name":"Ephesians","testament":"NT","ch":[458,413,396,617,564,470]},{"name":"Philippians","testament":"NT","ch":[632,601,483,467]},{"name":"Colossians","testament":"NT","ch":[656,503,457,363]},{"name":"1 Thessalonians","testament":"NT","ch":[253,479,295,396,414]},{"name":"2 Thessalonians","testament":"NT","ch":[291,381,350]},{"name":"1 Timothy","testament":"NT","ch":[432,247,324,310,470,461]},{"name":"2 Timothy","testament":"NT","ch":[438,506,297,425]},{"name":"Titus","testament":"NT","ch":[337,265,294]},{"name":"Philemon","testament":"NT","ch":[430]},{"name":"Hebrews","testament":"NT","ch":[338,472,362,404,299,447,574,332,735,786,856,674,616]},{"name":"James","testament":"NT","ch":[531,513,393,359,488]},{"name":"1 Peter","testament":"NT","ch":[564,532,497,418,428]},{"name":"2 Peter","testament":"NT","ch":[453,509,496]},{"name":"1 John","testament":"NT","ch":[238,603,483,440,440]},{"name":"2 John","testament":"NT","ch":[298]},{"name":"3 John","testament":"NT","ch":[294]},{"name":"Jude","testament":"NT","ch":[610]},{"name":"Revelation","testament":"NT","ch":[447,725,533,269,364,422,396,310,454,287,443,431,447,495,237,515,486,616,520,395,664,518]}];

        // --- READING PLANS ---
        const PLAN_HORNER = [
            ["Matthew", "Mark", "Luke", "John"],
            ["Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy"],
            ["Romans", "1 Corinthians", "2 Corinthians", "Galatians", "Ephesians", "Philippians", "Colossians", "Hebrews"],
            ["1 Thessalonians", "2 Thessalonians", "1 Timothy", "2 Timothy", "Titus", "Philemon", "James", "1 Peter", "2 Peter", "1 John", "2 John", "3 John", "Jude", "Revelation"],
            ["Job", "Ecclesiastes", "Song of Songs"],
            ["Psalms"],
            ["Proverbs"],
            ["Joshua", "Judges", "Ruth", "1 Samuel", "2 Samuel", "1 Kings", "2 Kings", "1 Chronicles", "2 Chronicles", "Ezra", "Nehemiah", "Esther"],
            ["Isaiah", "Jeremiah", "Lamentations", "Ezekiel", "Daniel", "Hosea", "Joel", "Amos", "Obadiah", "Jonah", "Micah", "Nahum", "Habakkuk", "Zephaniah", "Haggai", "Zechariah", "Malachi"],
            ["Acts"]
        ];

        // M'Cheyne Data (Minified)
        const PLAN_MCHEYNE=[{d:1,r:["Genesis 1","Matthew 1","Ezra 1","Acts 1"]},{d:2,r:["Genesis 2","Matthew 2","Ezra 2","Acts 2"]},{d:3,r:["Genesis 3","Matthew 3","Ezra 3","Acts 3"]},{d:4,r:["Genesis 4","Matthew 4","Ezra 4","Acts 4"]},{d:5,r:["Genesis 5","Matthew 5","Ezra 5","Acts 5"]},{d:6,r:["Genesis 6","Matthew 6","Ezra 6","Acts 6"]},{d:7,r:["Genesis 7","Matthew 7","Ezra 7","Acts 7"]},{d:8,r:["Genesis 8","Matthew 8","Ezra 8","Acts 8"]},{d:9,r:["Genesis 9-10","Matthew 9","Ezra 9","Acts 9"]},{d:10,r:["Genesis 11","Matthew 10","Ezra 10","Acts 10"]},{d:11,r:["Genesis 12","Matthew 11","Nehemiah 1","Acts 11"]},{d:12,r:["Genesis 13","Matthew 12","Nehemiah 2","Acts 12"]},{d:13,r:["Genesis 14","Matthew 13","Nehemiah 3","Acts 13"]},{d:14,r:["Genesis 15","Matthew 14","Nehemiah 4","Acts 14"]},{d:15,r:["Genesis 16","Matthew 15","Nehemiah 5","Acts 15"]},{d:16,r:["Genesis 17","Matthew 16","Nehemiah 6","Acts 16"]},{d:17,r:["Genesis 18","Matthew 17","Nehemiah 7","Acts 17"]},{d:18,r:["Genesis 19","Matthew 18","Nehemiah 8","Acts 18"]},{d:19,r:["Genesis 20","Matthew 19","Nehemiah 9","Acts 19"]},{d:20,r:["Genesis 21","Matthew 20","Nehemiah 10","Acts 20"]},{d:21,r:["Genesis 22","Matthew 21","Nehemiah 11","Acts 21"]},{d:22,r:["Genesis 23","Matthew 22","Nehemiah 12","Acts 22"]},{d:23,r:["Genesis 24","Matthew 23","Nehemiah 13","Acts 23"]},{d:24,r:["Genesis 25","Matthew 24","Esther 1","Acts 24"]},{d:25,r:["Genesis 26","Matthew 25","Esther 2","Acts 25"]},{d:26,r:["Genesis 27","Matthew 26","Esther 3","Acts 26"]},{d:27,r:["Genesis 28","Matthew 27","Esther 4","Acts 27"]},{d:28,r:["Genesis 29","Matthew 28","Esther 5","Acts 28"]},{d:29,r:["Genesis 30","Mark 1","Esther 6","Romans 1"]},{d:30,r:["Genesis 31","Mark 2","Esther 7","Romans 2"]},{d:31,r:["Genesis 32","Mark 3","Esther 8","Romans 3"]},{d:32,r:["Genesis 33","Mark 4","Esther 9-10","Romans 4"]},{d:33,r:["Genesis 34","Mark 5","Job 1","Romans 5"]},{d:34,r:["Genesis 35-36","Mark 6","Job 2","Romans 6"]},{d:35,r:["Genesis 37","Mark 7","Job 3","Romans 7"]},{d:36,r:["Genesis 38","Mark 8","Job 4","Romans 8"]},{d:37,r:["Genesis 39","Mark 9","Job 5","Romans 9"]},{d:38,r:["Genesis 40","Mark 10","Job 6","Romans 10"]},{d:39,r:["Genesis 41","Mark 11","Job 7","Romans 11"]},{d:40,r:["Genesis 42","Mark 12","Job 8","Romans 12"]},{d:41,r:["Genesis 43","Mark 13","Job 9","Romans 13"]},{d:42,r:["Genesis 44","Mark 14","Job 10","Romans 14"]},{d:43,r:["Genesis 45","Mark 15","Job 11","Romans 15"]},{d:44,r:["Genesis 46","Mark 16","Job 12","Romans 16"]},{d:45,r:["Genesis 47","Luke 1:1-38","Job 13","1Corinthians 1"]},{d:46,r:["Genesis 48","Luke 1:39-80","Job 14","1Corinthians 2"]},{d:47,r:["Genesis 49","Luke 2","Job 15","1Corinthians 3"]},{d:48,r:["Genesis 50","Luke 3","Job 16-17","1Corinthians 4"]},{d:49,r:["Exodus 1","Luke 4","Job 18","1Corinthians 5"]},{d:50,r:["Exodus 2","Luke 5","Job 19","1Corinthians 6"]},{d:51,r:["Exodus 3","Luke 6","Job 20","1Corinthians 7"]},{d:52,r:["Exodus 4","Luke 7","Job 21","1Corinthians 8"]},{d:53,r:["Exodus 5","Luke 8","Job 22","1Corinthians 9"]},{d:54,r:["Exodus 6","Luke 9","Job 23","1Corinthians 10"]},{d:55,r:["Exodus 7","Luke 10","Job 24","1Corinthians 11"]},{d:56,r:["Exodus 8","Luke 11","Job 25-26","1Corinthians 12"]},{d:57,r:["Exodus 9","Luke 12","Job 27","1Corinthians 13"]},{d:58,r:["Exodus 10","Luke 13","Job 28","1Corinthians 14"]},{d:59,r:["Exodus 11","Luke 14","Job 29","1Corinthians 15"]},{d:60,r:["Exodus 12","Luke 15","Job 30","1Corinthians 16"]},{d:61,r:["Exodus 13","Luke 16","Job 31","2Corinthians 1"]},{d:62,r:["Exodus 14","Luke 17","Job 32","2Corinthians 2"]},{d:63,r:["Exodus 15","Luke 18","Job 33","2Corinthians 3"]},{d:64,r:["Exodus 16","Luke 19","Job 34","2Corinthians 4"]},{d:65,r:["Exodus 17","Luke 20","Job 35","2Corinthians 5"]},{d:66,r:["Exodus 18","Luke 21","Job 36","2Corinthians 6"]},{d:67,r:["Exodus 19","Luke 22","Job 37","2Corinthians 7"]},{d:68,r:["Exodus 20","Luke 23","Job 38","2Corinthians 8"]},{d:69,r:["Exodus 21","Luke 24","Job 39","2Corinthians 9"]},{d:70,r:["Exodus 22","John 1","Job 40","2Corinthians 10"]},{d:71,r:["Exodus 23","John 2","Job 41","2Corinthians 11"]},{d:72,r:["Exodus 24","John 3","Job 42","2Corinthians 12"]},{d:73,r:["Exodus 25","John 4","Proverbs 1","2Corinthians 13"]},{d:74,r:["Exodus 26","John 5","Proverbs 2","Galatians 1"]},{d:75,r:["Exodus 27","John 6","Proverbs 3","Galatians 2"]},{d:76,r:["Exodus 28","John 7","Proverbs 4","Galatians 3"]},{d:77,r:["Exodus 29","John 8","Proverbs 5","Galatians 4"]},{d:78,r:["Exodus 30","John 9","Proverbs 6","Galatians 5"]},{d:79,r:["Exodus 31","John 10","Proverbs 7","Galatians 6"]},{d:80,r:["Exodus 32","John 11","Proverbs 8","Ephesians 1"]},{d:81,r:["Exodus 33","John 12","Proverbs 9","Ephesians 2"]},{d:82,r:["Exodus 34","John 13","Proverbs 10","Ephesians 3"]},{d:83,r:["Exodus 35","John 14","Proverbs 11","Ephesians 4"]},{d:84,r:["Exodus 36","John 15","Proverbs 12","Ephesians 5"]},{d:85,r:["Exodus 37","John 16","Proverbs 13","Ephesians 6"]},{d:86,r:["Exodus 38","John 17","Proverbs 14","Philippians 1"]},{d:87,r:["Exodus 39","John 18","Proverbs 15","Philippians 2"]},{d:88,r:["Exodus 40","John 19","Proverbs 16","Philippians 3"]},{d:89,r:["Leviticus 1","John 20","Proverbs 17","Philippians 4"]},{d:90,r:["Leviticus 2-3","John 21","Proverbs 18","Colossians 1"]},{d:91,r:["Leviticus 4","Psalm 1-2","Proverbs 19","Colossians 2"]},{d:92,r:["Leviticus 5","Psalm 3-4","Proverbs 20","Colossians 3"]},{d:93,r:["Leviticus 6","Psalm 5-6","Proverbs 21","Colossians 4"]},{d:94,r:["Leviticus 7","Psalm 7-8","Proverbs 22","1Thessalonians 1"]},{d:95,r:["Leviticus 8","Psalm 9","Proverbs 23","1Thessalonians 2"]},{d:96,r:["Leviticus 9","Psalm 10","Proverbs 24","1Thessalonians 3"]},{d:97,r:["Leviticus 10","Psalm 11-12","Proverbs 25","1Thessalonians 4"]},{d:98,r:["Leviticus 11-12","Psalm 13-14","Proverbs 26","1Thessalonians 5"]},{d:99,r:["Leviticus 13","Psalm 15-16","Proverbs 27","2Thessalonians 1"]},{d:100,r:["Leviticus 14","Psalm 17","Proverbs 28","2Thessalonians 2"]},{d:101,r:["Leviticus 15","Psalm 18","Proverbs 29","2Thessalonians 3"]},{d:102,r:["Leviticus 16","Psalm 19","Proverbs 30","1Timothy 1"]},{d:103,r:["Leviticus 17","Psalm 20-21","Proverbs 31","1Timothy 2"]},{d:104,r:["Leviticus 18","Psalm 22","Ecclesiastes 1","1Timothy 3"]},{d:105,r:["Leviticus 19","Psalm 23-24","Ecclesiastes 2","1Timothy 4"]},{d:106,r:["Leviticus 20","Psalm 25","Ecclesiastes 3","1Timothy 5"]},{d:107,r:["Leviticus 21","Psalm 26-27","Ecclesiastes 4","1Timothy 6"]},{d:108,r:["Leviticus 22","Psalm 28-29","Ecclesiastes 5","2Timothy 1"]},{d:109,r:["Leviticus 23","Psalm 30","Ecclesiastes 6","2Timothy 2"]},{d:110,r:["Leviticus 24","Psalm 31","Ecclesiastes 7","2Timothy 3"]},{d:111,r:["Leviticus 25","Psalm 32","Ecclesiastes 8","2Timothy 4"]},{d:112,r:["Leviticus 26","Psalm 33","Ecclesiastes 9","Titus 1"]},{d:113,r:["Leviticus 27","Psalm 34","Ecclesiastes 10","Titus 2"]},{d:114,r:["Numbers 1","Psalm 35","Ecclesiastes 11","Titus 3"]},{d:115,r:["Numbers 2","Psalm 36","Ecclesiastes 12","Philemon 1"]},{d:116,r:["Numbers 3","Psalm 37","SongOfSongs 1","Hebrews 1"]},{d:117,r:["Numbers 4","Psalm 38","SongOfSongs 2","Hebrews 2"]},{d:118,r:["Numbers 5","Psalm 39","SongOfSongs 3","Hebrews 3"]},{d:119,r:["Numbers 6","Psalm 40-41","SongOfSongs 4","Hebrews 4"]},{d:120,r:["Numbers 7","Psalm 42-43","SongOfSongs 5","Hebrews 5"]},{d:121,r:["Numbers 8","Psalm 44","SongOfSongs 6","Hebrews 6"]},{d:122,r:["Numbers 9","Psalm 45","SongOfSongs 7","Hebrews 7"]},{d:123,r:["Numbers 10","Psalm 46-47","SongOfSongs 8","Hebrews 8"]},{d:124,r:["Numbers 11","Psalm 48","Isaiah 1","Hebrews 9"]},{d:125,r:["Numbers 12-13","Psalm 49","Isaiah 2","Hebrews 10"]},{d:126,r:["Numbers 14","Psalm 50","Isaiah 3-4","Hebrews 11"]},{d:127,r:["Numbers 15","Psalm 51","Isaiah 5","Hebrews 12"]},{d:128,r:["Numbers 16","Psalm 52-54","Isaiah 6","Hebrews 13"]},{d:129,r:["Numbers 17-18","Psalm 55","Isaiah 7","James 1"]},{d:130,r:["Numbers 19","Psalm 56-57","Isaiah 8","James 2"]},{d:131,r:["Numbers 20","Psalm 58-59","Isaiah 9","James 3"]},{d:132,r:["Numbers 21","Psalm 60-61","Isaiah 10","James 4"]},{d:133,r:["Numbers 22","Psalm 62-63","Isaiah 11-12","James 5"]},{d:134,r:["Numbers 23","Psalm 64-65","Isaiah 13","1Peter 1"]},{d:135,r:["Numbers 24","Psalm 66-67","Isaiah 14","1Peter 2"]},{d:136,r:["Numbers 25","Psalm 68","Isaiah 15","1Peter 3"]},{d:137,r:["Numbers 26","Psalm 69","Isaiah 16","1Peter 4"]},{d:138,r:["Numbers 27","Psalm 70-71","Isaiah 17-18","1Peter 5"]},{d:139,r:["Numbers 28","Psalm 72","Isaiah 19-20","2Peter 1"]},{d:140,r:["Numbers 29","Psalm 73","Isaiah 21","2Peter 2"]},{d:141,r:["Numbers 30","Psalm 74","Isaiah 22","2Peter 3"]},{d:142,r:["Numbers 31","Psalm 75-76","Isaiah 23","1John 1"]},{d:143,r:["Numbers 32","Psalm 77","Isaiah 24","1John 2"]},{d:144,r:["Numbers 33","Psalm 78:1-39","Isaiah 25","1John 3"]},{d:145,r:["Numbers 34","Psalm 78:40-72","Isaiah 26","1John 4"]},{d:146,r:["Numbers 35","Psalm 79","Isaiah 27","1John 5"]},{d:147,r:["Numbers 36","Psalm 80","Isaiah 28","2John 1"]},{d:148,r:["Deuteronomy 1","Psalm 81-82","Isaiah 29","3John 1"]},{d:149,r:["Deuteronomy 2","Psalm 83-84","Isaiah 30","Jude 1"]},{d:150,r:["Deuteronomy 3","Psalm 85","Isaiah 31","Revelation 1"]},{d:151,r:["Deuteronomy 4","Psalm 86-87","Isaiah 32","Revelation 2"]},{d:152,r:["Deuteronomy 5","Psalm 88","Isaiah 33","Revelation 3"]},{d:153,r:["Deuteronomy 6","Psalm 89","Isaiah 34","Revelation 4"]},{d:154,r:["Deuteronomy 7","Psalm 90","Isaiah 35","Revelation 5"]},{d:155,r:["Deuteronomy 8","Psalm 91","Isaiah 36","Revelation 6"]},{d:156,r:["Deuteronomy 9","Psalm 92-93","Isaiah 37","Revelation 7"]},{d:157,r:["Deuteronomy 10","Psalm 94","Isaiah 38","Revelation 8"]},{d:158,r:["Deuteronomy 11","Psalm 95-96","Isaiah 39","Revelation 9"]},{d:159,r:["Deuteronomy 12","Psalm 97-98","Isaiah 40","Revelation 10"]},{d:160,r:["Deuteronomy 13-14","Psalm 99-101","Isaiah 41","Revelation 11"]},{d:161,r:["Deuteronomy 15","Psalm 102","Isaiah 42","Revelation 12"]},{d:162,r:["Deuteronomy 16","Psalm 103","Isaiah 43","Revelation 13"]},{d:163,r:["Deuteronomy 17","Psalm 104","Isaiah 44","Revelation 14"]},{d:164,r:["Deuteronomy 18","Psalm 105","Isaiah 45","Revelation 15"]},{d:165,r:["Deuteronomy 19","Psalm 106","Isaiah 46","Revelation 16"]},{d:166,r:["Deuteronomy 20","Psalm 107","Isaiah 47","Revelation 17"]},{d:167,r:["Deuteronomy 21","Psalm 108-109","Isaiah 48","Revelation 18"]},{d:168,r:["Deuteronomy 22","Psalm 110-111","Isaiah 49","Revelation 19"]},{d:169,r:["Deuteronomy 23","Psalm 112-113","Isaiah 50","Revelation 20"]},{d:170,r:["Deuteronomy 24","Psalm 114-115","Isaiah 51","Revelation 21"]},{d:171,r:["Deuteronomy 25","Psalm 116","Isaiah 52","Revelation 22"]},{d:172,r:["Deuteronomy 26","Psalm 117-118","Isaiah 53","Matthew 1"]},{d:173,r:["Deuteronomy 27","Psalm 119:1-24","Isaiah 54","Matthew 2"]},{d:174,r:["Deuteronomy 28","Psalm 119:25-48","Isaiah 55","Matthew 3"]},{d:175,r:["Deuteronomy 29","Psalm 119:49-72","Isaiah 56","Matthew 4"]},{d:176,r:["Deuteronomy 30","Psalm 119:73-96","Isaiah 57","Matthew 5"]},{d:177,r:["Deuteronomy 31","Psalm 119:97-120","Isaiah 58","Matthew 6"]},{d:178,r:["Deuteronomy 32","Psalm 119:121-144","Isaiah 59","Matthew 7"]},{d:179,r:["Deuteronomy 33-34","Psalm 119:145-176","Isaiah 60","Matthew 8"]},{d:180,r:["Joshua 1","Psalm 120-122","Isaiah 61","Matthew 9"]},{d:181,r:["Joshua 2","Psalm 123-125","Isaiah 62","Matthew 10"]},{d:182,r:["Joshua 3","Psalm 126-128","Isaiah 63","Matthew 11"]},{d:183,r:["Joshua 4","Psalm 129-131","Isaiah 64","Matthew 12"]},{d:184,r:["Joshua 5","Psalm 132-134","Isaiah 65","Matthew 13"]},{d:185,r:["Joshua 6","Psalm 135-136","Isaiah 66","Matthew 14"]},{d:186,r:["Joshua 7","Psalm 137-138","Jeremiah 1","Matthew 15"]},{d:187,r:["Joshua 8","Psalm 139","Jeremiah 2","Matthew 16"]},{d:188,r:["Joshua 9","Psalm 140-141","Jeremiah 3","Matthew 17"]},{d:189,r:["Joshua 10","Psalm 142-143","Jeremiah 4","Matthew 18"]},{d:190,r:["Joshua 11","Psalm 144","Jeremiah 5","Matthew 19"]},{d:191,r:["Joshua 12-13","Psalm 145","Jeremiah 6","Matthew 20"]},{d:192,r:["Joshua 14-15","Psalm 146-147","Jeremiah 7","Matthew 21"]},{d:193,r:["Joshua 16-17","Psalm 148","Jeremiah 8","Matthew 22"]},{d:194,r:["Joshua 18-19","Psalm 149-150","Jeremiah 9","Matthew 23"]},{d:195,r:["Joshua 20-21","Acts 1","Jeremiah 10","Matthew 24"]},{d:196,r:["Joshua 22","Acts 2","Jeremiah 11","Matthew 25"]},{d:197,r:["Joshua 23","Acts 3","Jeremiah 12","Matthew 26"]},{d:198,r:["Joshua 24","Acts 4","Jeremiah 13","Matthew 27"]},{d:199,r:["Judges 1","Acts 5","Jeremiah 14","Matthew 28"]},{d:200,r:["Judges 2","Acts 6","Jeremiah 15","Mark 1"]},{d:201,r:["Judges 3","Acts 7","Jeremiah 16","Mark 2"]},{d:202,r:["Judges 4","Acts 8","Jeremiah 17","Mark 3"]},{d:203,r:["Judges 5","Acts 9","Jeremiah 18","Mark 4"]},{d:204,r:["Judges 6","Acts 10","Jeremiah 19","Mark 5"]},{d:205,r:["Judges 7","Acts 11","Jeremiah 20","Mark 6"]},{d:206,r:["Judges 8","Acts 12","Jeremiah 21","Mark 7"]},{d:207,r:["Judges 9","Acts 13","Jeremiah 22","Mark 8"]},{d:208,r:["Judges 10","Acts 14","Jeremiah 23","Mark 9"]},{d:209,r:["Judges 11","Acts 15","Jeremiah 24","Mark 10"]},{d:210,r:["Judges 12","Acts 16","Jeremiah 25","Mark 11"]},{d:211,r:["Judges 13","Acts 17","Jeremiah 26","Mark 12"]},{d:212,r:["Judges 14","Acts 18","Jeremiah 27","Mark 13"]},{d:213,r:["Judges 15","Acts 19","Jeremiah 28","Mark 14"]},{d:214,r:["Judges 16","Acts 20","Jeremiah 29","Mark 15"]},{d:215,r:["Judges 17","Acts 21","Jeremiah 30-31","Mark 16"]},{d:216,r:["Judges 18","Acts 22","Jeremiah 32","Luke 1"]},{d:217,r:["Judges 19","Acts 23","Jeremiah 33","Luke 2"]},{d:218,r:["Judges 20","Acts 24","Jeremiah 34","Luke 3"]},{d:219,r:["Judges 21","Acts 25","Jeremiah 35","Luke 4"]},{d:220,r:["Ruth 1","Acts 26","Jeremiah 36","Luke 5"]},{d:221,r:["Ruth 2","Acts 27","Jeremiah 37","Luke 6"]},{d:222,r:["Ruth 3-4","Acts 28","Jeremiah 38","Luke 7"]},{d:223,r:["1Samuel 1","Romans 1","Jeremiah 39","Luke 8"]},{d:224,r:["1Samuel 2","Romans 2","Jeremiah 40","Luke 9"]},{d:225,r:["1Samuel 3","Romans 3","Jeremiah 41","Luke 10"]},{d:226,r:["1Samuel 4","Romans 4","Jeremiah 42","Luke 11"]},{d:227,r:["1Samuel 5-6","Romans 5","Jeremiah 43","Luke 12"]},{d:228,r:["1Samuel 7-8","Romans 6","Jeremiah 44-45","Luke 13"]},{d:229,r:["1Samuel 9","Romans 7","Jeremiah 46","Luke 14"]},{d:230,r:["1Samuel 10","Romans 8","Jeremiah 47","Luke 15"]},{d:231,r:["1Samuel 11","Romans 9","Jeremiah 48","Luke 16"]},{d:232,r:["1Samuel 12","Romans 10","Jeremiah 49","Luke 17"]},{d:233,r:["1Samuel 13","Romans 11","Jeremiah 50","Luke 18"]},{d:234,r:["1Samuel 14","Romans 12","Jeremiah 51","Luke 19"]},{d:235,r:["1Samuel 15","Romans 13","Jeremiah 52","Luke 20"]},{d:236,r:["1Samuel 16","Romans 14","Lamentations 1","Luke 21"]},{d:237,r:["1Samuel 17","Romans 15","Lamentations 2","Luke 22"]},{d:238,r:["1Samuel 18","Romans 16","Lamentations 3","Luke 23"]},{d:239,r:["1Samuel 19","1Corinthians 1","Lamentations 4","Luke 24"]},{d:240,r:["1Samuel 20","1Corinthians 2","Lamentations 5","John 1"]},{d:241,r:["1Samuel 21-22","1Corinthians 3","Ezekiel 1","John 2"]},{d:242,r:["1Samuel 23","1Corinthians 4","Ezekiel 2","John 3"]},{d:243,r:["1Samuel 24","1Corinthians 5","Ezekiel 3","John 4"]},{d:244,r:["1Samuel 25","1Corinthians 6","Ezekiel 4","John 5"]},{d:245,r:["1Samuel 26","1Corinthians 7","Ezekiel 5","John 6"]},{d:246,r:["1Samuel 27","1Corinthians 8","Ezekiel 6","John 7"]},{d:247,r:["1Samuel 28","1Corinthians 9","Ezekiel 7","John 8"]},{d:248,r:["1Samuel 29-30","1Corinthians 10","Ezekiel 8","John 9"]},{d:249,r:["1Samuel 31","1Corinthians 11","Ezekiel 9","John 10"]},{d:250,r:["2Samuel 1","1Corinthians 12","Ezekiel 10","John 11"]},{d:251,r:["2Samuel 2","1Corinthians 13","Ezekiel 11","John 12"]},{d:252,r:["2Samuel 3","1Corinthians 14","Ezekiel 12","John 13"]},{d:253,r:["2Samuel 4-5","1Corinthians 15","Ezekiel 13","John 14"]},{d:254,r:["2Samuel 6","1Corinthians 16","Ezekiel 14","John 15"]},{d:255,r:["2Samuel 7","2Corinthians 1","Ezekiel 15","John 16"]},{d:256,r:["2Samuel 8-9","2Corinthians 2","Ezekiel 16","John 17"]},{d:257,r:["2Samuel 10","2Corinthians 3","Ezekiel 17","John 18"]},{d:258,r:["2Samuel 11","2Corinthians 4","Ezekiel 18","John 19"]},{d:259,r:["2Samuel 12","2Corinthians 5","Ezekiel 19","John 20"]},{d:260,r:["2Samuel 13","2Corinthians 6","Ezekiel 20","John 21"]},{d:261,r:["2Samuel 14","2Corinthians 7","Ezekiel 21","Psalm 1-2"]},{d:262,r:["2Samuel 15","2Corinthians 8","Ezekiel 22","Psalm 3-4"]},{d:263,r:["2Samuel 16","2Corinthians 9","Ezekiel 23","Psalm 5-6"]},{d:264,r:["2Samuel 17","2Corinthians 10","Ezekiel 24","Psalm 7-8"]},{d:265,r:["2Samuel 18","2Corinthians 11","Ezekiel 25","Psalm 9"]},{d:266,r:["2Samuel 19","2Corinthians 12","Ezekiel 26","Psalm 10"]},{d:267,r:["2Samuel 20","2Corinthians 13","Ezekiel 27","Psalm 11-12"]},{d:268,r:["2Samuel 21","Galatians 1","Ezekiel 28","Psalm 13-14"]},{d:269,r:["2Samuel 22","Galatians 2","Ezekiel 29","Psalm 15-16"]},{d:270,r:["2Samuel 23","Galatians 3","Ezekiel 30","Psalm 17"]},{d:271,r:["2Samuel 24","Galatians 4","Ezekiel 31","Psalm 18"]},{d:272,r:["1Kings 1","Galatians 5","Ezekiel 32","Psalm 19"]},{d:273,r:["1Kings 2","Galatians 6","Ezekiel 33","Psalm 20-21"]},{d:274,r:["1Kings 3","Ephesians 1","Ezekiel 34","Psalm 22"]},{d:275,r:["1Kings 4-5","Ephesians 2","Ezekiel 35","Psalm 23-24"]},{d:276,r:["1Kings 6","Ephesians 3","Ezekiel 36","Psalm 25"]},{d:277,r:["1Kings 7","Ephesians 4","Ezekiel 37","Psalm 26-27"]},{d:278,r:["1Kings 8","Ephesians 5","Ezekiel 38","Psalm 28-29"]},{d:279,r:["1Kings 9","Ephesians 6","Ezekiel 39","Psalm 30"]},{d:280,r:["1Kings 10","Philippians 1","Ezekiel 40","Psalm 31"]},{d:281,r:["1Kings 11","Philippians 2","Ezekiel 41","Psalm 32"]},{d:282,r:["1Kings 12","Philippians 3","Ezekiel 42","Psalm 33"]},{d:283,r:["1Kings 13","Philippians 4","Ezekiel 43","Psalm 34"]},{d:284,r:["1Kings 14","Colossians 1","Ezekiel 44","Psalm 35"]},{d:285,r:["1Kings 15","Colossians 2","Ezekiel 45","Psalm 36"]},{d:286,r:["1Kings 16","Colossians 3","Ezekiel 46","Psalm 37"]},{d:287,r:["1Kings 17","Colossians 4","Ezekiel 47","Psalm 38"]},{d:288,r:["1Kings 18","1Thessalonians 1","Ezekiel 48","Psalm 39"]},{d:289,r:["1Kings 19","1Thessalonians 2","Daniel 1","Psalm 40-41"]},{d:290,r:["1Kings 20","1Thessalonians 3","Daniel 2","Psalm 42-43"]},{d:291,r:["1Kings 21","1Thessalonians 4","Daniel 3","Psalm 44"]},{d:292,r:["1Kings 22","1Thessalonians 5","Daniel 4","Psalm 45"]},{d:293,r:["2Kings 1","2Thessalonians 1","Daniel 5","Psalm 46-47"]},{d:294,r:["2Kings 2","2Thessalonians 2","Daniel 6","Psalm 48"]},{d:295,r:["2Kings 3","2Thessalonians 3","Daniel 7","Psalm 49"]},{d:296,r:["2Kings 4","1Timothy 1","Daniel 8","Psalm 50"]},{d:297,r:["2Kings 5","1Timothy 2","Daniel 9","Psalm 51"]},{d:298,r:["2Kings 6","1Timothy 3","Daniel 10","Psalm 52-54"]},{d:299,r:["2Kings 7","1Timothy 4","Daniel 11","Psalm 55"]},{d:300,r:["2Kings 8","1Timothy 5","Daniel 12","Psalm 56-57"]},{d:301,r:["2Kings 9","1Timothy 6","Hosea 1","Psalm 58-59"]},{d:302,r:["2Kings 10-11","2Timothy 1","Hosea 2","Psalm 60-61"]},{d:303,r:["2Kings 12","2Timothy 2","Hosea 3-4","Psalm 62-63"]},{d:304,r:["2Kings 13","2Timothy 3","Hosea 5-6","Psalm 64-65"]},{d:305,r:["2Kings 14","2Timothy 4","Hosea 7","Psalm 66-67"]},{d:306,r:["2Kings 15","Titus 1","Hosea 8","Psalm 68"]},{d:307,r:["2Kings 16","Titus 2","Hosea 9","Psalm 69"]},{d:308,r:["2Kings 17","Titus 3","Hosea 10","Psalm 70-71"]},{d:309,r:["2Kings 18","Philemon 1","Hosea 11","Psalm 72"]},{d:310,r:["2Kings 19","Hebrews 1","Hosea 12","Psalm 73"]},{d:311,r:["2Kings 20","Hebrews 2","Hosea 13","Psalm 74"]},{d:312,r:["2Kings 21","Hebrews 3","Hosea 14","Psalm 75-76"]},{d:313,r:["2Kings 22","Hebrews 4","Joel 1","Psalm 77"]},{d:314,r:["2Kings 23","Hebrews 5","Joel 2","Psalm 78"]},{d:315,r:["2Kings 24","Hebrews 6","Joel 3","Psalm 79"]},{d:316,r:["2Kings 25","Hebrews 7","Amos 1","Psalm 80"]},{d:317,r:["1Chronicles 1-2","Hebrews 8","Amos 2","Psalm 81-82"]},{d:318,r:["1Chronicles 3-4","Hebrews 9","Amos 3","Psalm 83-84"]},{d:319,r:["1Chronicles 5-6","Hebrews 10","Amos 4","Psalm 85"]},{d:320,r:["1Chronicles 7-8","Hebrews 11","Amos 5","Psalm 86"]},{d:321,r:["1Chronicles 9-10","Hebrews 12","Amos 6","Psalm 87-88"]},{d:322,r:["1Chronicles 11-12","Hebrews 13","Amos 7","Psalm 89"]},{d:323,r:["1Chronicles 13-14","James 1","Amos 8","Psalm 90"]},{d:324,r:["1Chronicles 15","James 2","Amos 9","Psalm 91"]},{d:325,r:["1Chronicles 16","James 3","Obadiah 1","Psalm 92-93"]},{d:326,r:["1Chronicles 17","James 4","Jonah 1","Psalm 94"]},{d:327,r:["1Chronicles 18","James 5","Jonah 2","Psalm 95-96"]},{d:328,r:["1Chronicles 19-20","1Peter 1","Jonah 3","Psalm 97-98"]},{d:329,r:["1Chronicles 21","1Peter 2","Jonah 4","Psalm 99-101"]},{d:330,r:["1Chronicles 22","1Peter 3","Micah 1","Psalm 102"]},{d:331,r:["1Chronicles 23","1Peter 4","Micah 2","Psalm 103"]},{d:332,r:["1Chronicles 24-25","1Peter 5","Micah 3","Psalm 104"]},{d:333,r:["1Chronicles 26-27","2Peter 1","Micah 4","Psalm 105"]},{d:334,r:["1Chronicles 28","2Peter 2","Micah 5","Psalm 106"]},{d:335,r:["1Chronicles 29","2Peter 3","Micah 6","Psalm 107"]},{d:336,r:["2Chronicles 1","1John 1","Micah 7","Psalm 108-109"]},{d:337,r:["2Chronicles 2","1John 2","Nahum 1","Psalm 110-111"]},{d:338,r:["2Chronicles 3-4","1John 3","Nahum 2","Psalm 112-113"]},{d:339,r:["2Chronicles 5","1John 4","Nahum 3","Psalm 114-115"]},{d:340,r:["2Chronicles 6","1John 5","Habakkuk 1","Psalm 116"]},{d:341,r:["2Chronicles 7","2John 1","Habakkuk 2","Psalm 117-118"]},{d:342,r:["2Chronicles 8","3John 1","Habakkuk 3","Psalm 119:1-24"]},{d:343,r:["2Chronicles 9","Jude 1","Zephaniah 1","Psalm 119:25-48"]},{d:344,r:["2Chronicles 10","Revelation 1","Zephaniah 2","Psalm 119:49-72"]},{d:345,r:["2Chronicles 11-12","Revelation 2","Zephaniah 3","Psalm 119:73-96"]},{d:346,r:["2Chronicles 13","Revelation 3","Haggai 1","Psalm 119:97-120"]},{d:347,r:["2Chronicles 14-15","Revelation 4","Haggai 2","Psalm 119:121-144"]},{d:348,r:["2Chronicles 16","Revelation 5","Zechariah 1","Psalm 119:145-176"]},{d:349,r:["2Chronicles 17","Revelation 6","Zechariah 2","Psalm 120-122"]},{d:350,r:["2Chronicles 18","Revelation 7","Zechariah 3","Psalm 123-125"]},{d:351,r:["2Chronicles 19-20","Revelation 8","Zechariah 4","Psalm 126-128"]},{d:352,r:["2Chronicles 21","Revelation 9","Zechariah 5","Psalm 129-131"]},{d:353,r:["2Chronicles 22-23","Revelation 10","Zechariah 6","Psalm 132-134"]},{d:354,r:["2Chronicles 24","Revelation 11","Zechariah 7","Psalm 135-136"]},{d:355,r:["2Chronicles 25","Revelation 12","Zechariah 8","Psalm 137-138"]},{d:356,r:["2Chronicles 26","Revelation 13","Zechariah 9","Psalm 139"]},{d:357,r:["2Chronicles 27-28","Revelation 14","Zechariah 10","Psalm 140-141"]},{d:358,r:["2Chronicles 29","Revelation 15","Zechariah 11","Psalm 142"]},{d:359,r:["2Chronicles 30","Revelation 16","Zechariah 12","Psalm 143"]},{d:360,r:["2Chronicles 31","Revelation 17","Zechariah 13","Psalm 144"]},{d:361,r:["2Chronicles 32","Revelation 18","Zechariah 14","Psalm 145"]},{d:362,r:["2Chronicles 33","Revelation 19","Malachi 1","Psalm 146-147"]},{d:363,r:["2Chronicles 34","Revelation 20","Malachi 2","Psalm 148"]},{d:364,r:["2Chronicles 35","Revelation 21","Malachi 3","Psalm 149"]},{d:365,r:["2Chronicles 36","Revelation 22","Malachi 4","Psalm 150"]}];

        const WORD_TOTALS = { GLOBAL: 789634, OT: 609252, NT: 180382 };
        let activeTab = 'ALL';
        let activeBookIdx = null;
        let searchQuery = "";
        let mainChart = null;
        let miniCharts = [];

        const OT_CATS = [
            { name: "Pentateuch", count: 5, style: "bg-green-100 border-green-200 text-green-900", chartColor: "#16a34a" },
            { name: "History (OT)", count: 12, style: "bg-orange-100 border-orange-200 text-orange-900", chartColor: "#ea580c" },
            { name: "Wisdom", count: 5, style: "bg-indigo-100 border-indigo-200 text-indigo-900", chartColor: "#4f46e5" },
            { name: "Major Prophets", count: 5, style: "bg-red-100 border-red-200 text-red-900", chartColor: "#dc2626" },
            { name: "Minor Prophets", count: 12, style: "bg-cyan-100 border-cyan-200 text-cyan-900", chartColor: "#0891b2" }
        ];

        const NT_CATS = [
            { name: "Gospels", count: 4, style: "bg-emerald-100 border-emerald-200 text-emerald-900", chartColor: "#059669" },
            { name: "History (NT)", count: 1, style: "bg-amber-100 border-amber-200 text-amber-900", chartColor: "#d97706" },
            { name: "Pauline Epistles", count: 13, style: "bg-blue-100 border-blue-200 text-blue-900", chartColor: "#2563eb" },
            { name: "General Epistles", count: 8, style: "bg-teal-100 border-teal-200 text-teal-900", chartColor: "#0d9488" },
            { name: "Prophecy", count: 1, style: "bg-purple-100 border-purple-200 text-purple-900", chartColor: "#a855f7" }
        ];

        function assignCategories() {
            let i = 0;
            OT_CATS.forEach(cat => { for(let j=0; j<cat.count; j++) { if(bible[i]) { bible[i].cat = cat.name; bible[i].style = cat.style; bible[i].chartColor = cat.chartColor; i++; } } });
            NT_CATS.forEach(cat => { for(let j=0; j<cat.count; j++) { if(bible[i]) { bible[i].cat = cat.name; bible[i].style = cat.style; bible[i].chartColor = cat.chartColor; i++; } } });
        }

        // --- GLOBAL EXPORTS ---
        window.setTab = (t) => {
            activeTab = t;
            window.activeTab = t;
            ['ALL', 'OT', 'NT', 'PLAN', 'STATS', 'ABOUT'].forEach(tab => {
                const el = document.getElementById(`tab-${tab.toLowerCase()}`);
                if(el) el.className = (tab === t) ? "px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all tab-active whitespace-nowrap" : "px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 hover:text-indigo-600 whitespace-nowrap";
            });
            ['view-books', 'view-stats', 'view-plan', 'view-chapters', 'view-about'].forEach(v => document.getElementById(v).classList.add('hidden'));
            
            if (t === 'STATS') { document.getElementById('view-stats').classList.remove('hidden'); window.renderStatsPage(); }
            else if (t === 'PLAN') { document.getElementById('view-plan').classList.remove('hidden'); window.renderDailyPlan(); }
            else if (t === 'ABOUT') { document.getElementById('view-about').classList.remove('hidden'); }
            else { document.getElementById('view-books').classList.remove('hidden'); window.renderBookGrid(); window.renderSubdivisionStats(); }
        };

        window.handleSearch = () => {
            searchQuery = document.getElementById('book-search').value.toLowerCase();
            window.renderBookGrid();
        };

        window.openBook = (idx) => {
            activeBookIdx = idx;
            const book = bible[idx];
            ['view-books', 'view-stats', 'view-plan', 'view-about'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('view-chapters').classList.remove('hidden');
            document.getElementById('active-book-title').innerText = book.name;
            document.getElementById('book-label').innerText = book.cat;
            window.renderChapterGrid();
            window.scrollTo(0,0);
        };

        window.showBooks = () => window.setTab(activeTab === 'STATS' || activeTab === 'PLAN' || activeTab === 'ABOUT' ? 'ALL' : activeTab);

        window.toggleChapter = (id) => {
            const prog = getProgress();
            prog[id] = !prog[id];
            setProgress(prog);
            window.saveProgress();
            window.renderChapterGrid();
        };

        window.toggleAllInBook = (val) => {
            const book = bible[activeBookIdx];
            const prog = getProgress();
            book.ch.forEach((_, i) => prog[`${book.name}-${i+1}`] = val);
            setProgress(prog);
            window.saveProgress();
            window.renderChapterGrid();
        };

        window.backupData = () => {
            const dataStr = JSON.stringify(appData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'kjv_tracker_backup.json');
            linkElement.click();
        };

        window.restoreData = (input) => {
            const file = input.files[0];
            if (!file) return;

            // Security: Validate file type
            if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                alert("Invalid file type. Please upload a .json file.");
                input.value = ''; // Clear the input
                return;
            }

            // Security: Validate file size (max 5MB)
            const maxSize = 5 * 1024 * 1024; // 5MB in bytes
            if (file.size > maxSize) {
                alert("File too large. Maximum size is 5MB.");
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (typeof data === 'object' && data !== null) {
                        if(data.profiles && validateAppData(data)) {
                            appData = data;
                        } else if (typeof data === 'object') {
                            // Legacy format: single profile data
                            appData.profiles[appData.activeProfileId] = data;
                        } else {
                            throw new Error("Invalid data structure");
                        }
                        window.saveProgress();
                        const msg = document.getElementById('restore-msg');
                        msg.innerText = "Success! Progress restored.";
                        msg.classList.remove('hidden');
                        setTimeout(() => msg.classList.add('hidden'), 3000);
                        window.updateStats();
                        window.location.reload();
                    } else {
                        throw new Error("Invalid JSON structure");
                    }
                } catch(err) {
                    console.error("Restore error:", err);
                    alert("Invalid backup file. Please check the file format.");
                }
                input.value = ''; // Clear input after processing
            };
            reader.readAsText(file);
        };

        // --- RENDER FUNCTIONS ---
        function normalizeBookName(name) {
            let base = name.split(':')[0];
            const parts = base.split(' ');
            const last = parts[parts.length-1];
            let chapterStr = null;
            if (!isNaN(last) && !last.includes('-')) {
                chapterStr = parts.pop();
            } else if (last.includes('-')) {
                chapterStr = parts.pop();
            }
            let bookName = parts.join(' ');
            if(bookName === "SongOfSongs") bookName = "Song of Songs";
            if(bookName === "Psalm") bookName = "Psalms";
            bookName = bookName.replace(/(\d)([A-Za-z])/g, '$1 $2');
            return { bookName, chapterStr };
        }

        function getChaptersFromStr(str) {
            if(!str) return [];
            if(str.includes('-')) {
                const [start, end] = str.split('-').map(Number);
                const arr = [];
                for(let i=start; i<=end; i++) arr.push(i);
                return arr;
            }
            return [parseInt(str)];
        }

        window.renderDailyPlan = () => {
            const list = document.getElementById('daily-plan-list');
            const footerMsg = document.getElementById('plan-footer-msg');
            const descBox = document.getElementById('plan-description-box');
            const currentProg = getProgress();
            
            list.innerHTML = '';
            footerMsg.innerText = '';
            
            let nextChapters = [];
            let descText = "";

            if (activePlan === 'SEQUENTIAL') {
                descText = "<strong>Canonical Order:</strong> Reading straight through from Genesis to Revelation. The next 3 unread chapters are shown.";
                let found = 0; const target = 3;
                for (let b = 0; b < bible.length; b++) {
                    const book = bible[b];
                    for (let c = 0; c < book.ch.length; c++) {
                        if (!currentProg[`${book.name}-${c+1}`]) {
                            nextChapters.push({ book: book.name, chapter: c + 1, words: book.ch[c], label: `${book.name} ${c+1}` });
                            found++;
                            if (found >= target) break;
                        }
                    }
                    if (found >= target) break;
                }
                if (nextChapters.length === 0) { list.innerHTML = `<div class="text-center p-8 bg-white/10 rounded-2xl font-bold text-lg">🎉 You have finished the entire Bible!</div>`; return; }
            } 
            
            else if (activePlan === 'MCHEYNE') {
                descText = "<strong>M'Cheyne Plan:</strong> 4 chapters daily (Family/Secret) covering NT/Psalms twice and OT once per year.";
                let currentDay = null;
                
                for(let i=0; i<PLAN_MCHEYNE.length; i++) {
                    const day = PLAN_MCHEYNE[i];
                    let allRead = true;
                    for(let r of day.r) {
                        const { bookName, chapterStr } = normalizeBookName(r);
                        const appBook = bible.find(b => b.name === bookName);
                        if(!appBook) continue;
                        const chs = getChaptersFromStr(chapterStr);
                        for(let c of chs) {
                            if(!currentProg[`${appBook.name}-${c}`]) {
                                allRead = false;
                                break;
                            }
                        }
                        if(!allRead) break;
                    }
                    if(!allRead) {
                        currentDay = day;
                        break;
                    }
                }

                if(!currentDay) { list.innerHTML = `<div class="text-center p-8 bg-white/10 rounded-2xl font-bold text-lg">🎉 M'Cheyne Plan Completed!</div>`; return; }
                
                footerMsg.innerText = `M'Cheyne Day ${currentDay.d} of 365`;
                
                currentDay.r.forEach((refStr, idx) => {
                     const { bookName, chapterStr } = normalizeBookName(refStr);
                     const appBook = bible.find(b => b.name === bookName);
                     if(appBook) {
                         const chs = getChaptersFromStr(chapterStr);
                         const firstCh = chs[0];
                         let isRead = true;
                         chs.forEach(c => { if(!currentProg[`${appBook.name}-${c}`]) isRead = false; });
                         
                         const type = idx < 2 ? "Family" : "Secret";
                         
                         nextChapters.push({ 
                             book: appBook.name, 
                             chapter: firstCh, 
                             words: appBook.ch[firstCh-1] * chs.length, 
                             label: refStr,
                             badge: type,
                             isComplete: isRead
                         });
                     }
                });
            }

            else if (activePlan === 'HORNER') {
                descText = "<strong>Prof. Horner's System:</strong> Reading 1 chapter from each of 10 lists daily for maximum immersion.";
                PLAN_HORNER.forEach((listBooks, listIdx) => {
                    let foundForList = false;
                    for(let bName of listBooks) {
                        const appBook = bible.find(b => b.name === bName);
                        if(!appBook) continue;
                        for(let c=0; c<appBook.ch.length; c++) {
                            if(!currentProg[`${appBook.name}-${c+1}`]) {
                                nextChapters.push({
                                    book: appBook.name,
                                    chapter: c+1,
                                    words: appBook.ch[c],
                                    label: `${appBook.name} ${c+1}`,
                                    badge: `List ${listIdx+1}`
                                });
                                foundForList = true;
                                break;
                            }
                        }
                        if(foundForList) break;
                    }
                });
                footerMsg.innerText = "Professor Horner's System (10 Chapters / Day)";
            }

            if(descBox) {
                descBox.innerHTML = descText;
                descBox.classList.remove('hidden');
            }

            list.innerHTML = nextChapters.map(item => {
                const nameMap = { "Song of Songs": "Song of Solomon" };
                const cleanName = nameMap[item.book] || item.book;
                const blbUrl = `https://www.blueletterbible.org/kjv/${encodeURIComponent(cleanName)}/${item.chapter}/`;
                const badgeHtml = item.badge ? `<span class="bg-indigo-500 text-white text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wider ml-2 opacity-90">${item.badge}</span>` : '';
                
                const opacityClass = item.isComplete ? "opacity-60 grayscale" : "";
                const strikeClass = item.isComplete ? "line-through text-slate-400 decoration-slate-300" : "text-slate-800";
                const checkMark = item.isComplete ? `<span class="text-emerald-500 mr-2 font-black">✓</span>` : '';
                const bgClass = item.isComplete ? "bg-slate-50" : "bg-white hover:bg-indigo-50 hover:border-indigo-200 hover:scale-[1.01] hover:shadow-md";

                return `<a href="${blbUrl}" target="_blank" class="block ${bgClass} text-slate-800 p-5 rounded-2xl flex items-center justify-between transition-all duration-200 border border-slate-100 shadow-sm ${opacityClass}">
                    <div>
                        <div class="text-[10px] font-black text-indigo-500 uppercase tracking-widest mb-1">Read Now${badgeHtml}</div>
                        <div class="font-bold text-xl leading-tight ${strikeClass}">${checkMark}${item.label}</div>
                    </div>
                    <div class="text-right flex flex-col items-end">
                        <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">~${item.words} words</div>
                        ${!item.isComplete ? `
                        <div class="flex items-center gap-1 mt-2">
                            <span class="text-xs font-bold text-indigo-500">Go</span>
                            <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                        </div>` : ''}
                    </div>
                </a>`;
            }).join('');
        }

        window.renderBookGrid = () => {
            const grid = document.getElementById('book-grid');
            const currentProg = getProgress();
            const books = bible.filter(b => (activeTab === 'ALL' || b.testament === activeTab) && b.name.toLowerCase().includes(searchQuery));
            if (books.length === 0) { grid.innerHTML = `<div class="col-span-full text-center text-slate-400 font-bold py-12 bg-white/50 rounded-3xl border border-dashed border-slate-300">No books found.</div>`; return; }
            grid.innerHTML = books.map((book) => {
                const bookIdx = bible.indexOf(book);
                const readChapters = book.ch.filter((_, cIdx) => currentProg[`${book.name}-${cIdx + 1}`]).length;
                const readWords = book.ch.reduce((sum, words, cIdx) => {
                    return sum + (currentProg[`${book.name}-${cIdx + 1}`] ? words : 0);
                }, 0);
                const totalWords = book.ch.reduce((sum, words) => sum + words, 0);
                const progressPercent = (readWords / totalWords) * 100;
                const isComplete = readChapters === book.ch.length;
                const ringColor = isComplete ? 'ring-2 ring-emerald-400' : 'ring-1 ring-slate-100 hover:ring-indigo-300';
                return `<div onclick="window.openBook(${bookIdx})" class="book-card ${book.style} p-6 rounded-[1.5rem] cursor-pointer ${ringColor} bg-opacity-60 backdrop-blur-sm relative overflow-hidden">
                    <div class="flex justify-between items-start mb-4 relative z-10">
                        <h3 class="font-black text-sm uppercase tracking-tight leading-tight">${book.name}</h3>
                        ${isComplete ? '<span class="text-sm bg-white/80 rounded-full px-1.5 py-0.5 shadow-sm">✅</span>' : ''}
                    </div>
                    <div class="flex flex-col gap-2 relative z-10">
                         <span class="text-[10px] font-black opacity-60 uppercase tracking-wider">${readChapters} / ${book.ch.length} Ch</span>
                        <div class="w-full bg-white/60 h-2 rounded-full overflow-hidden">
                            <div class="h-full transition-all duration-700 ${isComplete ? 'bg-emerald-500' : 'bg-current opacity-60'}" style="width: ${progressPercent}%"></div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        window.renderChapterGrid = () => {
            const book = bible[activeBookIdx];
            const grid = document.getElementById('chapter-grid');
            const currentProg = getProgress();
            let readInBook = 0;
            let readWordsInBook = 0;
            grid.innerHTML = book.ch.map((words, cIdx) => {
                const id = `${book.name}-${cIdx + 1}`;
                const isRead = currentProg[id];
                if (isRead) {
                    readInBook++;
                    readWordsInBook += words;
                }
                const nameMap = { "Song of Songs": "Song of Solomon" };
                const cleanName = nameMap[book.name] || book.name;
                const blbUrl = `https://www.blueletterbible.org/kjv/${encodeURIComponent(cleanName)}/${cIdx+1}/`;
                return `<div class="relative group">
                    <button onclick="window.toggleChapter('${id}')" class="h-20 w-full rounded-2xl border-2 transition-all flex flex-col items-center justify-center gap-1 ${isRead ? 'bg-indigo-600 text-white border-indigo-600 shadow-md shadow-indigo-200 scale-95' : 'bg-white text-slate-300 border-slate-100 hover:border-indigo-300 hover:text-indigo-600 hover:shadow-lg hover:-translate-y-1'}">
                        <span class="text-xl sm:text-2xl font-black ${isRead ? 'text-white' : 'text-slate-700 group-hover:text-indigo-600'}">${cIdx + 1}</span>
                        <span class="text-[9px] font-bold uppercase tracking-wider ${isRead ? 'text-indigo-200' : 'text-slate-400'}">${words}w</span>
                    </button>
                    <a href="${blbUrl}" target="_blank" onclick="event.stopPropagation()" title="Read on Blue Letter Bible" class="absolute top-2 right-2 p-1.5 rounded-full bg-white/80 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all shadow-sm md:opacity-0 md:group-hover:opacity-100 z-10">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                    </a>
                </div>`;
            }).join('');
            const totalWordsInBook = book.ch.reduce((sum, words) => sum + words, 0);
            document.getElementById('book-inner-bar').style.width = (readWordsInBook / totalWordsInBook) * 100 + '%';
            document.getElementById('book-stat-detail').innerText = `${readInBook} of ${book.ch.length} Chapters`;
            window.updateStats();
        }

        window.updateStats = () => {
            let totalRead = 0; let otRead = 0; let ntRead = 0; let finishedBooks = 0;
            const currentProg = getProgress();
            bible.forEach(book => {
                let bookChaptersRead = 0;
                book.ch.forEach((words, cIdx) => {
                    if (currentProg[`${book.name}-${cIdx+1}`]) {
                        totalRead += words;
                        if(book.testament === 'OT') otRead += words; else ntRead += words;
                        bookChaptersRead++;
                    }
                });
                if (bookChaptersRead === book.ch.length) finishedBooks++;
            });
            const getPerc = (val, max) => ((val / max) * 100).toFixed(4);
            document.getElementById('total-progress-bar').style.width = (totalRead / WORD_TOTALS.GLOBAL * 100) + '%';
            document.getElementById('total-percent').innerText = getPerc(totalRead, WORD_TOTALS.GLOBAL) + '%';
            document.getElementById('ot-percent').innerText = getPerc(otRead, WORD_TOTALS.OT) + '%';
            document.getElementById('ot-progress-bar').style.width = (otRead / WORD_TOTALS.OT * 100) + '%';
            document.getElementById('nt-percent').innerText = getPerc(ntRead, WORD_TOTALS.NT) + '%';
            document.getElementById('nt-progress-bar').style.width = (ntRead / WORD_TOTALS.NT * 100) + '%';
            document.getElementById('books-completed-stat').innerText = `${finishedBooks} OF 66 BOOKS READ`;
        }

        window.renderSubdivisionStats = () => {
            const cats = activeTab === 'ALL' ? [...OT_CATS, ...NT_CATS] : (activeTab === 'OT' ? OT_CATS : NT_CATS);
            const container = document.getElementById('subdivision-bar');
            const currentProg = getProgress();
            let catStats = cats.map(c => {
                let totalW = 0, readW = 0;
                bible.filter(b => b.cat === c.name).forEach(b => {
                    b.ch.forEach((w, idx) => { totalW += w; if(currentProg[`${b.name}-${idx+1}`]) readW += w; });
                });
                return { ...c, percent: (readW/totalW*100).toFixed(1) };
            });
            container.innerHTML = catStats.map(c => `<div class="flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full border text-xs font-bold uppercase tracking-wide ${c.style}"><span class="opacity-70">${c.name}</span><span>${c.percent}%</span></div>`).join('');
        }

        window.renderStatsPage = () => {
            const allCats = [...OT_CATS, ...NT_CATS];
            const dataset = []; const labels = []; const colors = []; let chartTotalRead = 0;
            const currentProg = getProgress();
            miniCharts.forEach(c => c.destroy()); miniCharts = [];
            allCats.forEach(cat => {
                let catRead = 0; let catTotal = 0;
                bible.filter(b => b.cat === cat.name).forEach(b => {
                    b.ch.forEach((w, idx) => { catTotal += w; if (currentProg[`${b.name}-${idx+1}`]) catRead += w; });
                });
                dataset.push(catRead); labels.push(cat.name); colors.push(cat.chartColor); chartTotalRead += catRead;
                cat.stats = { read: catRead, total: catTotal, pct: (catTotal > 0 ? (catRead/catTotal*100).toFixed(1) : 0) };
            });
            const unreadWords = WORD_TOTALS.GLOBAL - chartTotalRead;
            dataset.push(unreadWords); labels.push("Unread"); colors.push("#cbd5e1");
            if (mainChart) mainChart.destroy();
            const ctx = document.getElementById('mainDonutChart').getContext('2d');
            mainChart = new Chart(ctx, { type: 'doughnut', data: { labels: labels, datasets: [{ data: dataset, backgroundColor: colors, borderWidth: 0, hoverOffset: 4 }] }, options: { cutout: '75%', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
            document.getElementById('stats-page-total-percent').innerText = ((chartTotalRead / WORD_TOTALS.GLOBAL) * 100).toFixed(4) + '%';
            document.getElementById('legend-grid').innerHTML = allCats.map(cat => `<div class="flex items-center gap-3 text-sm p-2 bg-slate-50 rounded-lg"><div class="w-4 h-4 rounded-full flex-shrink-0 shadow-sm" style="background-color: ${cat.chartColor}"></div><span class="text-slate-700 font-bold truncate">${cat.name}</span></div>`).join('');
            document.getElementById('category-stats-grid').innerHTML = allCats.map((cat, i) => `<div class="bg-white p-5 rounded-3xl border border-slate-100 flex flex-col items-center justify-center relative shadow-sm"><div class="h-24 w-24 relative mb-3"><canvas id="miniChart-${i}"></canvas><div class="absolute inset-0 flex items-center justify-center text-xs font-black text-slate-400">${cat.stats.pct}%</div></div><span class="text-[10px] font-black uppercase text-center ${cat.style.split(' ')[2]}">${cat.name}</span></div>`).join('');
            allCats.forEach((cat, i) => {
                const miniCtx = document.getElementById(`miniChart-${i}`).getContext('2d');
                miniCharts.push(new Chart(miniCtx, { type: 'doughnut', data: { labels: ["Read", "Remaining"], datasets: [{ data: [cat.stats.read, cat.stats.total - cat.stats.read], backgroundColor: [cat.chartColor, "#cbd5e1"], borderWidth: 0 }] }, options: { cutout: '70%', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { enabled: false } }, events: [] } }));
            });
        }

        assignCategories();
        window.setTab('ALL');
        window.updateStats();
        updateProfileColor();
        checkFirstVisit();

		// ============================================
		// 🥚 EASTER EGGS - Add fun secrets to discover!
		// ============================================

		// --- EASTER EGG 1: Konami Code Achievement ---
		let konamiCode = [];
		const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];

		document.addEventListener('keydown', (e) => {
			konamiCode.push(e.key);
			konamiCode = konamiCode.slice(-10);
			
			if(JSON.stringify(konamiCode) === JSON.stringify(konamiSequence)) {
				unlockSecretAchievement();
			}
		});

		function unlockSecretAchievement() {
			const modal = document.createElement('div');
			modal.className = 'fixed inset-0 z-[200] bg-gradient-to-br from-purple-900/95 to-indigo-900/95 flex items-center justify-center p-4 animate-in';
			modal.innerHTML = `
				<div class="bg-white rounded-3xl p-8 max-w-md text-center shadow-2xl">
					<div class="text-6xl mb-4">🏆</div>
					<h2 class="text-2xl font-black text-indigo-900 mb-2">SECRET UNLOCKED!</h2>
					<p class="text-slate-600 mb-4">"For nothing is secret, that shall not be made manifest" - Luke 8:17</p>
					<p class="text-sm text-indigo-600 font-bold">You've discovered the Konami Code blessing!</p>
					<button onclick="this.parentElement.parentElement.remove()" class="mt-6 px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700">Amen! ✨</button>
				</div>
			`;
			document.body.appendChild(modal);
		}

		// --- EASTER EGG 2: Rainbow Mode (Click profile dot 7 times) ---
		let profileDotClicks = 0;
		let clickTimeout;

		if(currentProfileDot) {
			currentProfileDot.addEventListener('click', (e) => {
				e.stopPropagation();
				profileDotClicks++;
				
				clearTimeout(clickTimeout);
				clickTimeout = setTimeout(() => profileDotClicks = 0, 2000);
				
				if(profileDotClicks === 7) {
					activateRainbowMode();
					profileDotClicks = 0;
				}
			});
		}

		function activateRainbowMode() {
			document.body.style.animation = 'rainbow 10s linear infinite';
			const style = document.createElement('style');
			style.textContent = `
				@keyframes rainbow {
					0% { filter: hue-rotate(0deg); }
					100% { filter: hue-rotate(360deg); }
				}
			`;
			document.head.appendChild(style);
			
			const modal = document.createElement('div');
			modal.className = 'fixed top-4 right-4 z-[200] bg-white rounded-2xl p-4 shadow-2xl border-2 border-indigo-400 animate-in';
			modal.innerHTML = `
				<div class="text-center">
					<div class="text-4xl mb-2">🌈</div>
					<p class="text-sm font-bold text-indigo-900">Rainbow Mode Activated!</p>
					<p class="text-xs text-slate-600 mt-1">"I do set my bow in the cloud" - Genesis 9:13</p>
				</div>
			`;
			document.body.appendChild(modal);
			
			setTimeout(() => {
				document.body.style.animation = '';
				style.remove();
				modal.remove();
			}, 10000);
		}

		// --- EASTER EGG 3: Psalm 119 Achievement ---
		const originalToggleChapter = window.toggleChapter;
		window.toggleChapter = (id) => {
			const prog = getProgress();
			const wasRead = prog[id];
			
			originalToggleChapter(id);
			
			// Check if just completed Psalm 119
			if(id === 'Psalms-119' && !wasRead && getProgress()[id]) {
				setTimeout(() => showPsalm119Achievement(), 500);
			}
		};

		function showPsalm119Achievement() {
			const modal = document.createElement('div');
			modal.className = 'fixed inset-0 z-[200] bg-black/80 flex items-center justify-center p-4';
			modal.innerHTML = `
				<div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-3xl p-8 max-w-lg text-center shadow-2xl border-4 border-amber-400 animate-in">
					<div class="text-7xl mb-4">📜</div>
					<h2 class="text-3xl font-black text-amber-900 mb-3">MIGHTY ACHIEVEMENT!</h2>
					<p class="text-lg font-bold text-amber-800 mb-4">You've conquered Psalm 119!</p>
					<p class="text-sm text-slate-600 leading-relaxed mb-2">The longest chapter in the Bible with 2,423 words across 176 verses.</p>
					<p class="text-xs text-amber-600 italic">"Thy word is a lamp unto my feet, and a light unto my path" - Psalm 119:105</p>
					<button onclick="this.parentElement.parentElement.remove()" class="mt-6 px-8 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 shadow-lg">Glory to God! 🙏</button>
				</div>
			`;
			document.body.appendChild(modal);
		}

		// --- EASTER EGG 4: Bible Completion Celebration ---
		const originalUpdateStats = window.updateStats;
		window.updateStats = () => {
			originalUpdateStats();
			
			// Check for Bible completion
			const currentProg = getProgress();
			let finishedBooks = 0;
			bible.forEach(book => {
				let bookChaptersRead = 0;
				book.ch.forEach((words, cIdx) => {
					if (currentProg[`${book.name}-${cIdx+1}`]) bookChaptersRead++;
				});
				if (bookChaptersRead === book.ch.length) finishedBooks++;
			});
			
			if(finishedBooks === 66 && !localStorage.getItem(`bibleCompleted_${appData.activeProfileId}`)) {
				localStorage.setItem(`bibleCompleted_${appData.activeProfileId}`, 'true');
				setTimeout(() => celebrateBibleCompletion(), 1000);
			}
		};

		function celebrateBibleCompletion() {
			// Confetti effect
			const confetti = document.createElement('div');
			confetti.className = 'fixed inset-0 z-[300] pointer-events-none';
			let confettiHTML = '';
			for(let i = 0; i < 50; i++) {
				const emoji = ['🎉','✨','📖','✝️','🙏'][Math.floor(Math.random()*5)];
				confettiHTML += `<div style="position:absolute;left:${Math.random()*100}%;top:-50px;font-size:${20+Math.random()*30}px;animation:fall ${3+Math.random()*2}s linear forwards;animation-delay:${Math.random()}s">${emoji}</div>`;
			}
			confetti.innerHTML = confettiHTML;
			
			const style = document.createElement('style');
			style.textContent = `@keyframes fall { to { top: 110vh; transform: rotate(${Math.random()*360}deg); } }`;
			document.head.appendChild(style);
			document.body.appendChild(confetti);
			
			setTimeout(() => {
				const modal = document.createElement('div');
				modal.className = 'fixed inset-0 z-[400] bg-gradient-to-br from-indigo-900/98 to-purple-900/98 flex items-center justify-center p-4';
				modal.innerHTML = `
					<div class="bg-white rounded-[3rem] p-12 max-w-2xl text-center shadow-2xl animate-in">
						<div class="text-8xl mb-6">✨📖✨</div>
						<h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-4">BIBLE COMPLETE!</h1>
						<p class="text-2xl font-bold text-slate-700 mb-6">All 66 books. 789,634 words. One amazing journey!</p>
						<p class="text-lg text-slate-600 mb-4">"Study to shew thyself approved unto God, a workman that needeth not to be ashamed, rightly dividing the word of truth."</p>
						<p class="text-sm font-bold text-indigo-600 mb-8">- 2 Timothy 2:15</p>
						<button onclick="this.parentElement.parentElement.remove()" class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-bold hover:shadow-lg text-lg">Continue in the Word 📖</button>
					</div>
				`;
				document.body.appendChild(modal);
			}, 500);
			
			setTimeout(() => confetti.remove(), 6000);
		}

		// --- EASTER EGG 5: Type a creator name for Creator Message ---
		const creator_profiles = {
		  SHANE: {
			headline: 'Hey there!',
			body: 'Thanks for using Bible Progress!',
			verse: '"Thy word have I hid in mine heart, that I might not sin against thee." - Psalm 119:11',
			signoff: '- Shane',
			button: 'God bless! ✨'
		  },
		  MEGAN: {
			headline: 'Hey Megan!',
			body: 'Thanks for using Bible Progress! Keep going — one chapter at a time adds up fast.',
			verse: '"Trust in the LORD with all thine heart; and lean not unto thine own understanding." - Proverbs 3:5',
			signoff: '- Shane',
			button: 'I love you! 💞'
		  },
		  DOM: {
			headline: 'Hey Dom!',
			body: 'This Bible stuff is actually pretty important...',
			verse: '"Iron sharpeneth iron; so a man sharpeneth the countenance of his friend." - Proverbs 27:17',
			signoff: '- Shane',
			button: '0/Time! ⌛'
		  },
		  DAVID: {
			headline: 'Hey David!',
			body: 'My favorite uncle!',
			verse: '"Delight thyself also in the LORD; and he shall give thee the desires of thine heart." - Psalm 37:4',
			signoff: '- Shane',
			button: 'God bless! ✨'
		  }
		};

		const creator_triggers = Object.keys(creator_profiles);
		const max_trigger_len = Math.max(...creator_triggers.map((s) => s.length));

		let typed_sequence = '';

		document.addEventListener('keydown', (e) => {
		  const tag = e.target?.tagName;
		  if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

		  const key = String(e.key || '').toUpperCase();

		  // Ignore non-letters so Shift/Arrow/etc don't pollute the sequence
		  if (!/^[A-Z]$/.test(key)) return;

		  typed_sequence += key;
		  typed_sequence = typed_sequence.slice(-max_trigger_len);

		  for (const name of creator_triggers) {
			if (typed_sequence.endsWith(name)) {
			  showCreatorMessage(name);
			  typed_sequence = '';
			  break;
			}
		  }
		});

		function showCreatorMessage(name) {
		  const p = creator_profiles[name] ?? {
			headline: `Hey ${name}!`,
			body: 'Thanks for using Bible Progress!',
			verse: '"Thy word is a lamp unto my feet, and a light unto my path." - Psalm 119:105',
			signoff: `- ${name}`,
			button: 'God bless! ✨'
		  };

		  const modal = document.createElement('div');
		  modal.className = 'fixed inset-0 z-[200] bg-slate-900/90 flex items-center justify-center p-4';

		  modal.innerHTML = `
			<div class="bg-white rounded-3xl p-8 max-w-md text-center shadow-2xl animate-in">
			  <div class="text-6xl mb-4">👋</div>
			  <h2 class="text-2xl font-black text-indigo-900 mb-3">${escapeHtml(p.headline)}</h2>
			  <p class="text-slate-600 mb-4">${escapeHtml(p.body)}</p>
			  <p class="text-sm text-slate-500 italic mb-6">${escapeHtml(p.verse)}</p>
			  <p class="text-xs text-slate-400 mb-6">${escapeHtml(p.signoff)}</p>
			  <button class="creator-close px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700">${escapeHtml(p.button)}</button>
			</div>
		  `;

		  // Close on button click or backdrop click
		  modal.querySelector('.creator-close')?.addEventListener('click', () => modal.remove());
		  modal.addEventListener('click', (ev) => {
			if (ev.target === modal) modal.remove();
		  });

		  document.body.appendChild(modal);
		}

		function escapeHtml(s) {
		  return String(s).replace(/[&<>"']/g, (c) => ({
			'&': '&amp;',
			'<': '&lt;',
			'>': '&gt;',
			'"': '&quot;',
			"'": '&#39;'
		  }[c]));
		}


		// --- EASTER EGG 6: Christmas/Easter Greetings ---
		const originalSetTab = window.setTab;
		window.setTab = (t) => {
			// Check for holidays BEFORE calling original
			const today = new Date();
			const month = today.getMonth() + 1;
			const day = today.getDate();
			const shouldShowChristmas = (t === 'ABOUT' && month === 12 && day === 25 && !sessionStorage.getItem('christmasShown'));
			const shouldShowEaster = (t === 'ABOUT' && isEaster(today) && !sessionStorage.getItem('easterShown'));
			
			// Call original setTab
			originalSetTab(t);
			
			// Show holiday messages AFTER tab is set
			if(shouldShowChristmas) {
				sessionStorage.setItem('christmasShown', 'true');
				setTimeout(() => showChristmasMessage(), 500);
			} else if(shouldShowEaster) {
				sessionStorage.setItem('easterShown', 'true');
				setTimeout(() => showEasterMessage(), 500);
			}
		};

		function isEaster(date) {
			const easterDates = {
				2025: '04-20',
				2026: '04-05',
				2027: '03-28',
				2028: '04-16',
				2029: '04-01',
				2030: '04-21'
			};
			const year = date.getFullYear();
			const monthDay = `${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
			return easterDates[year] === monthDay;
		}

		function showChristmasMessage() {
			const modal = document.createElement('div');
			modal.className = 'fixed top-4 right-4 z-[200] bg-gradient-to-br from-red-50 to-green-50 rounded-2xl p-6 shadow-2xl border-2 border-red-400 animate-in max-w-sm';
			modal.innerHTML = `
				<div class="text-center">
					<div class="text-5xl mb-3">🎄</div>
					<p class="text-lg font-black text-red-900 mb-2">Merry Christmas!</p>
					<p class="text-sm text-slate-700 italic">"For unto you is born this day in the city of David a Saviour, which is Christ the Lord."</p>
					<p class="text-xs text-slate-500 mt-2">- Luke 2:11</p>
					<button onclick="this.parentElement.parentElement.remove()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-xl text-sm font-bold hover:bg-red-700">Amen! 🎅</button>
				</div>
			`;
			document.body.appendChild(modal);
			setTimeout(() => modal.remove(), 10000);
		}

		function showEasterMessage() {
			const modal = document.createElement('div');
			modal.className = 'fixed top-4 right-4 z-[200] bg-gradient-to-br from-purple-50 to-yellow-50 rounded-2xl p-6 shadow-2xl border-2 border-purple-400 animate-in max-w-sm';
			modal.innerHTML = `
				<div class="text-center">
					<div class="text-5xl mb-3">✝️</div>
					<p class="text-lg font-black text-purple-900 mb-2">He is Risen!</p>
					<p class="text-sm text-slate-700 italic">"Why seek ye the living among the dead? He is not here, but is risen!"</p>
					<p class="text-xs text-slate-500 mt-2">- Luke 24:5-6</p>
					<button onclick="this.parentElement.parentElement.remove()" class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-xl text-sm font-bold hover:bg-purple-700">Hallelujah! 🙏</button>
				</div>
			`;
			document.body.appendChild(modal);
			setTimeout(() => modal.remove(), 10000);
		}

		// --- EASTER EGG 7: Triple-click Logo for Dark Mode ---
		let logoClicks = 0;
		let logoClickTimeout;
		const logo = document.querySelector('h1');

		if(logo) {
			logo.style.cursor = 'pointer';
			logo.addEventListener('click', () => {
				logoClicks++;
				clearTimeout(logoClickTimeout);
				logoClickTimeout = setTimeout(() => logoClicks = 0, 1000);
				
				if(logoClicks === 3) {
					toggleDarkMode();
					logoClicks = 0;
				}
			});
		}

		function toggleDarkMode() {
			document.body.classList.toggle('dark-mode');
			const isDark = document.body.classList.contains('dark-mode');
			
			if(!document.getElementById('dark-mode-style')) {
				const style = document.createElement('style');
				style.id = 'dark-mode-style';
				style.textContent = `
					.dark-mode { 
						filter: invert(0.9) hue-rotate(180deg); 
						background: #1a1a1a !important;
					}
					.dark-mode img { filter: invert(1) hue-rotate(180deg); }
				`;
				document.head.appendChild(style);
			}
			
			const notification = document.createElement('div');
			notification.className = 'fixed top-4 left-1/2 -translate-x-1/2 z-[200] bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl font-bold text-sm animate-in';
			notification.textContent = isDark ? '🌙 Dark Mode Enabled' : '☀️ Light Mode Enabled';
			document.body.appendChild(notification);
			setTimeout(() => notification.remove(), 2000);
		}

		console.log('🥚 Easter eggs loaded! Try: Konami Code, click profile dot 7x, complete Psalm 119, finish the Bible, type SHANE, triple-click logo, or visit on Christmas/Easter!');
		
		
    </script>
</body>

</html>
