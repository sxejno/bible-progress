<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Progress</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bible Progress">

    <!-- SEO and Social Meta Tags -->
    <meta name="description" content="Track your Bible reading progress with word-weighted precision. Features reading plans, streak tracking, and multi-profile support. Free and open source.">
    <meta name="keywords" content="bible tracker, bible reading plan, KJV, scripture tracker, reading progress, M'Cheyne, Horner plan">
    <meta name="author" content="Bible Progress">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://bibleprogress.com">

    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Bible Progress">
    <meta property="og:url" content="https://bibleprogress.com">
    <meta property="og:title" content="Bible Progress">
    <meta property="og:description" content="Track your Bible reading progress with word-weighted precision. Features reading plans, streak tracking, and multi-profile support.">
    <meta property="og:image" content="https://bibleprogress.com/icon-512.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta property="og:image:alt" content="Bible Progress App Icon">
    <meta property="og:locale" content="en_US">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Bible Progress - Word-Weighted Bible Reading Tracker">
    <meta name="twitter:description" content="Track your Bible reading progress with word-weighted precision. Features reading plans, streak tracking, and multi-profile support.">
    <meta name="twitter:image" content="https://bibleprogress.com/icon-512.png">
    <meta name="twitter:image:alt" content="Bible Progress App Icon">

    <!-- Security Headers (Content Security Policy would be better implemented at server level) -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #0f172a; -webkit-font-smoothing: antialiased; }
        .tab-active {
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
            color: white;
            border-color: #4f46e5;
            box-shadow: 0 4px 14px rgba(79, 70, 229, 0.3), 0 2px 4px rgba(79, 70, 229, 0.1);
            transform: translateY(-1px);
        }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); }
        
        /* Subtle hover lift for books */
        .book-card { transition: all 0.2s ease-out; }
        .book-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px -3px rgba(0, 0, 0, 0.1); }
        
        /* Animation */
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Verse fade in/out animation */
        .verse-fade-in {
            animation: verseFadeIn 2s ease-in-out forwards;
        }
        .verse-fade-out {
            animation: verseFadeOut 2s ease-in-out forwards;
        }
        @keyframes verseFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes verseFadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Hide scrollbar for the stats/legend bar but allow scrolling */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Profile color dot animation */
        .profile-dot { transition: all 0.3s ease; }
        .profile-dot:hover { transform: scale(1.2); }

        /* Scroll indicator for tab bar */
        .tab-scroll-wrapper { position: relative; }
        .tab-scroll-indicator {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 60px;
            background: linear-gradient(to left, rgba(248, 250, 252, 1) 0%, rgba(248, 250, 252, 0) 100%);
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        .tab-scroll-indicator.hidden { opacity: 0; }

        /* Enhanced tab content transitions */
        .slide-in-right { animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Checkbox celebration animations */
        @keyframes checkboxCelebrate {
            0% { transform: scale(1); }
            25% { transform: scale(1.2) rotate(5deg); }
            50% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.15) rotate(3deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        .checkbox-celebrate { animation: checkboxCelebrate 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }

        /* Confetti-style celebration particles */
        @keyframes confetti {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx, 0), var(--ty, -100px)) rotate(720deg) scale(0);
                opacity: 0;
            }
        }
        .confetti-particle {
            position: fixed;
            width: 8px;
            height: 8px;
            background: #4f46e5;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: confetti 1s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        /* Progress bar smooth transitions */
        .progress-bar {
            transition: width 0.6s cubic-bezier(0.65, 0, 0.35, 1);
        }

        /* Button press effect */
        .btn-press:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        /* Enhanced modal entrance */
        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        .modal-in { animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }

        /* Shimmer effect for loading states */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        /* Enhanced progress bar with gradient shine */
        .progress-bar-shine {
            position: relative;
            overflow: hidden;
        }
        .progress-bar-shine::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progress-shine 3s ease-in-out infinite;
        }
        @keyframes progress-shine {
            0%, 100% { left: -100%; }
            50% { left: 100%; }
        }

        /* Smooth gradient backgrounds for cards */
        .gradient-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);
            transition: all 0.3s ease;
        }
        .gradient-card:hover {
            background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(248,250,252,1) 100%);
            transform: translateY(-2px);
        }

        /* Pulsing animation for streak badge */
        @keyframes pulse-subtle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        .pulse-badge {
            animation: pulse-subtle 3s ease-in-out infinite;
        }

        /* Enhanced shadow transitions */
        .shadow-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .shadow-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Smooth tab indicator animation */
        .tab-indicator {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Bible Reader Modal */
        #bible-reader-modal {
            backdrop-filter: blur(8px);
        }
        .bible-reader-content {
            max-height: 85vh;
            overflow-y: auto;
        }
        .bible-verse {
            transition: background-color 0.2s ease;
        }
        .bible-verse:hover {
            background-color: rgba(79, 70, 229, 0.05);
        }
        .verse-number {
            user-select: none;
            min-width: 2.5rem;
        }

        /* Smooth scrollbar for Bible reader */
        .bible-reader-content::-webkit-scrollbar {
            width: 8px;
        }
        .bible-reader-content::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        .bible-reader-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .bible-reader-content::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Pronunciation indicators */
        .pronunciation-word {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted #94a3b8;
            cursor: help;
            transition: all 0.2s ease;
        }
        .pronunciation-word:hover {
            border-bottom-color: #4f46e5;
            color: #4f46e5;
        }
        .pronunciation-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease, transform 0.2s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            letter-spacing: 0.5px;
        }
        .pronunciation-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #6366f1;
        }
        .pronunciation-word:hover .pronunciation-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }
    </style>
</head>
<body class="pb-24">

    <div id="auth-modal" class="hidden fixed inset-0 z-[100] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] p-6 w-full max-w-sm shadow-2xl modal-in border border-white/50">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-black text-slate-900 tracking-tight">Sync Progress</h2>
                <button onclick="window.toggleAuthModal(false)" class="p-2 bg-slate-50 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-600" aria-label="Close authentication modal">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="space-y-3 mb-4">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1">Email</label>
                    <input type="email" id="email-input" placeholder="you@example.com" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder-slate-300" aria-label="Email address">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1">Password</label>
                    <input type="password" id="pass-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder-slate-300" aria-label="Password">
                </div>
                <div id="auth-error" class="text-xs font-bold text-red-500 bg-red-50 p-2 rounded-lg hidden"></div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="window.handleEmailAuth('LOGIN')" id="btn-login-email" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-xl text-xs font-black uppercase tracking-wide hover:from-indigo-700 hover:to-purple-700 hover:shadow-lg hover:shadow-indigo-200 transition-all hover:scale-105 active:scale-95" aria-label="Log in with email">Log In</button>
                <button onclick="window.handleEmailAuth('REGISTER')" id="btn-signup-email" class="bg-white border-2 border-slate-200 text-slate-600 py-3 rounded-xl text-xs font-black uppercase tracking-wide hover:bg-slate-50 hover:border-indigo-200 hover:shadow-md transition-all hover:scale-105 active:scale-95" aria-label="Sign up with email">Sign Up</button>
            </div>

            <div class="relative flex py-2 items-center mb-6">
                <div class="flex-grow border-t border-slate-100"></div>
                <span class="flex-shrink-0 mx-4 text-[9px] font-black text-slate-300 uppercase tracking-widest">Or continue with</span>
                <div class="flex-grow border-t border-slate-100"></div>
            </div>

            <button onclick="window.handleGoogleLogin()" class="w-full flex items-center justify-center gap-3 bg-white border-2 border-slate-200 text-slate-700 py-3.5 rounded-xl text-sm font-bold hover:bg-slate-50 hover:shadow-lg transition-all hover:border-slate-300 hover:scale-105 active:scale-95 group" aria-label="Sign in with Google">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5 group-hover:scale-110 transition-transform" alt="Google logo">
                Google
            </button>
        </div>
    </div>

    <div id="intro-modal" class="hidden fixed inset-0 z-[100] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-gradient-to-br from-white to-indigo-50/30 rounded-[2.5rem] p-10 w-full max-w-md shadow-2xl modal-in border border-white/50 relative overflow-hidden">
            <!-- Decorative background elements -->
            <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-indigo-200/20 rounded-full blur-3xl"></div>
            <div class="absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-purple-200/20 rounded-full blur-3xl"></div>

            <!-- Content -->
            <div class="relative">
                <button onclick="window.closeIntroModal()" class="absolute -top-2 -right-2 p-2 bg-white/80 hover:bg-white rounded-full transition-colors text-slate-400 hover:text-slate-600 shadow-sm" aria-label="Close introduction modal">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>

                <!-- Icon -->
                <div class="flex justify-center mb-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-xl shadow-indigo-300/50 rotate-3 hover:rotate-0 hover:scale-110 transition-all duration-300 cursor-pointer">
                        <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path></svg>
                    </div>
                </div>

                <!-- Heading -->
                <h2 class="text-3xl font-black text-slate-900 tracking-tight mb-3 text-center">Bible Progress</h2>
                <p class="text-center text-slate-600 mb-8 leading-relaxed">
                    Read the Bible and track your progress!
                </p>

                <!-- Key points -->
                <div class="space-y-3 mb-8">
                    <div class="flex items-start gap-3 bg-white/60 p-3 rounded-xl border border-slate-200">
                        <div class="flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-indigo-600" fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-slate-900">Check chapters as you read</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3 bg-white/60 p-3 rounded-xl border border-slate-200">
                        <div class="flex-shrink-0 w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-emerald-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/></svg>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-slate-900">Follow built-in reading plans</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3 bg-white/60 p-3 rounded-xl border border-slate-200">
                        <div class="flex-shrink-0 w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/></svg>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-slate-900">Sync progress across devices</p>
                        </div>
                    </div>
                </div>

                <!-- CTA buttons -->
                <div class="space-y-3">
                    <button onclick="window.closeIntroModal()" class="w-full bg-indigo-600 text-white px-6 py-3 rounded-xl text-sm font-bold hover:bg-indigo-700 transition-colors" aria-label="Start reading and close introduction">
                        Start Reading
                    </button>
                    <button onclick="window.closeIntroModal(); setTimeout(() => window.setTab('ABOUT'), 300);" class="w-full bg-white text-slate-700 px-6 py-3 rounded-xl text-sm font-bold hover:bg-slate-50 transition-colors border border-slate-200" aria-label="Learn more about Bible Progress">
                        Learn More
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bible Reader Modal -->
    <div id="bible-reader-modal" class="hidden fixed inset-0 z-[100] bg-slate-900/50 flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] w-full max-w-4xl shadow-2xl modal-in border border-white/50 flex flex-col" style="max-height: 90vh;">
            <!-- Header -->
            <div class="flex justify-between items-center p-6 border-b border-slate-200">
                <div>
                    <h2 id="bible-reader-title" class="text-2xl font-black text-slate-900 tracking-tight">Loading...</h2>
                    <p id="bible-reader-subtitle" class="text-sm text-slate-500 mt-1">King James Version</p>
                </div>
                <button onclick="window.closeBibleReader()" class="p-2 bg-slate-50 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-600" aria-label="Close Bible reader">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- Content -->
            <div id="bible-reader-verses" class="bible-reader-content flex-1 overflow-y-auto p-6 sm:p-8">
                <div class="flex items-center justify-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
                </div>
            </div>

            <!-- Footer with navigation and actions -->
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4 p-6 border-t border-slate-200 bg-slate-50">
                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <button id="bible-reader-prev" onclick="window.navigateBibleChapter(-1)" class="flex-1 sm:flex-none px-4 py-2 bg-white hover:bg-slate-50 text-slate-700 rounded-xl text-sm font-bold transition-colors border border-slate-200 flex items-center justify-center gap-2" aria-label="Previous chapter">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        <span class="hidden sm:inline">Previous</span>
                    </button>
                    <button id="bible-reader-next" onclick="window.navigateBibleChapter(1)" class="flex-1 sm:flex-none px-4 py-2 bg-white hover:bg-slate-50 text-slate-700 rounded-xl text-sm font-bold transition-colors border border-slate-200 flex items-center justify-center gap-2" aria-label="Next chapter">
                        <span class="hidden sm:inline">Next</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
                <button id="bible-reader-mark-read" onclick="window.markCurrentChapterAsRead()" class="w-full sm:w-auto px-6 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl text-sm font-bold transition-colors shadow-sm hover:shadow-md flex items-center justify-center gap-2" aria-label="Mark chapter as read">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    Mark as Read
                </button>
            </div>
        </div>
    </div>

    <header class="sticky top-0 z-50 glass border-b border-indigo-100 shadow-sm">
        <div class="max-w-5xl mx-auto px-4 py-4 sm:px-6">
            <div class="flex flex-col gap-5">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div>
                                <h1 class="text-2xl font-black text-indigo-950 tracking-tighter">BIBLE PROGRESS</h1>
                                <p id="books-completed-stat" class="text-xs font-bold text-slate-500 uppercase tracking-widest mt-1">0 OF 66 BOOKS READ</p>
                            </div>
                            <div id="header-streak-badge" class="hidden bg-gradient-to-r from-orange-50 to-amber-50 border-2 border-orange-200 px-3 py-2 rounded-xl cursor-pointer hover:shadow-md transition-all" onclick="window.goToStreakSection()" role="button" aria-label="Click to view streak details" tabindex="0" onkeypress="if(event.key==='Enter'||event.key===' ')window.goToStreakSection()">
                                <div class="flex items-center gap-2">
                                    <span id="header-streak-emoji" class="text-xl">üî•</span>
                                    <div class="flex flex-col">
                                        <span id="header-streak-count" class="text-sm font-black text-orange-900 leading-none">0</span>
                                        <span class="text-[9px] font-bold text-orange-600 uppercase tracking-wide">day streak</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 self-end sm:self-auto">
                        <button onclick="window.showIntroModal()" class="p-2 bg-white hover:bg-indigo-50 rounded-full transition-all text-slate-600 hover:text-indigo-600 border border-slate-200 hover:border-indigo-200 shadow-sm hover:shadow-md hover:scale-110" title="Help & Introduction" aria-label="Show help and introduction">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </button>

                        <div class="relative group">
                            <button id="profile-menu-btn" onclick="window.toggleProfileMenu()" class="flex items-center gap-2 bg-white text-slate-700 px-4 py-2 rounded-full text-sm font-bold hover:bg-slate-50 transition-all border border-slate-200 hover:border-slate-300 shadow-sm hover:shadow-md" aria-label="Toggle profile menu" aria-expanded="false" aria-haspopup="true">
                                <div id="current-profile-dot" class="w-3 h-3 rounded-full profile-dot shadow-sm"></div>
                                <span id="current-profile-name">Default</span>
                                <svg class="w-4 h-4 text-slate-400 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>

                            <div id="profile-menu" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-2xl shadow-xl border border-slate-100 p-2 z-50 animate-in ring-1 ring-black/5">
                                <div id="profile-list" class="flex flex-col gap-1 mb-2 border-b border-slate-100 pb-2"></div>
                                <button onclick="window.createNewProfile()" class="w-full text-left px-3 py-3 text-sm font-bold text-indigo-600 hover:bg-indigo-50 rounded-xl flex items-center gap-2 transition-colors" aria-label="Create new profile">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                    New Profile
                                </button>
                            </div>
                        </div>

                        <div id="sync-status" class="flex items-center justify-center w-8 h-8 rounded-full bg-white text-slate-400 border border-slate-200 shadow-sm hover:shadow-md transition-all hover:scale-110 cursor-default" title="Local Only" aria-label="Sync status: Local only">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>
                        </div>

                        <button id="login-btn" onclick="window.toggleAuthModal(true)" class="flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-5 py-2 rounded-full text-sm font-bold hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg shadow-indigo-200/50 hover:shadow-xl hover:shadow-indigo-300/50 hover:scale-105" aria-label="Open sync and login modal">
                            <span id="login-text">Sync</span>
                        </button>
                        <div id="user-profile" class="hidden flex items-center gap-3">
                            <img id="user-photo" src="" alt="User profile photo" class="w-9 h-9 rounded-full border-2 border-indigo-200">
                            <button id="logout-btn" class="text-xs font-bold text-slate-400 hover:text-red-500 uppercase tracking-wide" aria-label="Log out">Logout</button>
                        </div>
                    </div>
                </div>

                <div class="space-y-1">
                    <div id="total-progress-section" class="cursor-pointer transition-all hover:opacity-90" onclick="window.toggleProgressView()" role="button" aria-label="Click to toggle between total progress and testament progress views" tabindex="0" onkeypress="if(event.key==='Enter'||event.key===' ')window.toggleProgressView()">
                        <div class="w-full bg-gradient-to-r from-slate-200 to-slate-300 rounded-full h-3 overflow-hidden shadow-inner">
                            <div id="total-progress-bar" class="bg-gradient-to-r from-indigo-600 to-purple-600 h-full progress-bar progress-bar-shine shadow-sm" style="width: 0%"></div>
                        </div>

                        <div class="flex justify-between items-end px-1">
                             <div class="text-left">
                                <span id="total-percent" class="text-4xl font-black text-indigo-600 leading-none">0.00%</span>
                                <div class="text-xs font-bold text-slate-500 uppercase tracking-tight mt-1">Total Words Read</div>
                            </div>
                        </div>
                    </div>

                    <div id="testament-progress-section" class="hidden cursor-pointer transition-all hover:opacity-90" onclick="window.toggleProgressView()" role="button" aria-label="Click to toggle back to total progress view" tabindex="0" onkeypress="if(event.key==='Enter'||event.key===' ')window.toggleProgressView()">
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div class="bg-gradient-to-br from-white/80 to-amber-50/30 backdrop-blur-sm p-3 rounded-2xl border border-amber-100/50 shadow-sm">
                                <div class="flex justify-between text-[11px] font-bold text-slate-500 uppercase mb-2">
                                    <span>Old Testament</span>
                                    <span id="ot-percent" class="text-amber-900 font-black">0.00%</span>
                                </div>
                                <div class="w-full bg-gradient-to-r from-slate-200 to-amber-100 rounded-full h-2 overflow-hidden shadow-inner">
                                    <div id="ot-progress-bar" class="bg-gradient-to-r from-amber-500 to-orange-500 h-full progress-bar progress-bar-shine" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-white/80 to-emerald-50/30 backdrop-blur-sm p-3 rounded-2xl border border-emerald-100/50 shadow-sm">
                                <div class="flex justify-between text-[11px] font-bold text-slate-500 uppercase mb-2">
                                    <span>New Testament</span>
                                    <span id="nt-percent" class="text-emerald-900 font-black">0.00%</span>
                                </div>
                                <div class="w-full bg-gradient-to-r from-slate-200 to-emerald-100 rounded-full h-2 overflow-hidden shadow-inner">
                                    <div id="nt-progress-bar" class="bg-gradient-to-r from-emerald-500 to-teal-500 h-full progress-bar progress-bar-shine" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Centered verse with proper spacing -->
                    <div id="verse-content" class="mt-4 mb-6 min-h-[60px] verse-fade-container flex items-center justify-center px-4">
                        <div class="text-xs text-slate-400 italic leading-relaxed text-center"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 mt-8">

        <div class="tab-scroll-wrapper">
            <div id="tab-scroll-container" class="overflow-x-auto no-scrollbar pb-2 -mx-4 px-4 sm:mx-0 sm:px-0">
                <div class="flex gap-2 mb-6 p-1.5 bg-slate-200/50 rounded-2xl w-max sm:w-fit" role="tablist" aria-label="Main navigation">
                    <button onclick="window.setTab('ALL')" id="tab-all" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all tab-active whitespace-nowrap" role="tab" aria-selected="true" aria-controls="view-books">All Books</button>
                    <button onclick="window.setTab('OT')" id="tab-ot" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap" role="tab" aria-selected="false" aria-controls="view-books">OT Books</button>
                    <button onclick="window.setTab('NT')" id="tab-nt" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap" role="tab" aria-selected="false" aria-controls="view-books">NT Books</button>
                    <button onclick="window.setTab('PLAN')" id="tab-plan" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap" role="tab" aria-selected="false" aria-controls="view-plan">Daily Plan</button>
                    <button onclick="window.setTab('STATS')" id="tab-stats" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap" role="tab" aria-selected="false" aria-controls="view-stats">Stats</button>
                    <button onclick="window.setTab('TOOLS')" id="tab-tools" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap" role="tab" aria-selected="false" aria-controls="view-tools">Tools</button>
                    <button onclick="window.setTab('SETTINGS')" id="tab-settings" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap" role="tab" aria-selected="false" aria-controls="view-settings">Settings</button>
                    <button onclick="window.setTab('ABOUT')" id="tab-about" class="px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 whitespace-nowrap" role="tab" aria-selected="false" aria-controls="view-about">About</button>
                </div>
            </div>
            <div id="tab-scroll-indicator" class="tab-scroll-indicator"></div>
        </div>

        <div id="view-books" class="animate-in">
            <div class="mb-6">
                <div class="relative group">
                    <input type="text" id="book-search" oninput="window.debouncedHandleSearch()" placeholder="Search books..." class="w-full pl-12 pr-4 py-4 rounded-2xl border-2 border-transparent bg-white shadow-sm hover:shadow-lg text-base font-medium text-slate-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-200 focus:shadow-xl placeholder-slate-400 outline-none transition-all" aria-label="Search books">
                    <svg class="w-6 h-6 absolute left-4 top-4 text-slate-300 group-focus-within:text-indigo-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
                <div id="search-results-count" class="mt-2 text-sm text-slate-500 hidden"></div>
            </div>
            <div id="subdivision-bar" class="hidden sm:flex flex-wrap gap-3 overflow-y-auto max-h-40 mb-8 pb-2 pr-2"></div>
            <div id="book-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        </div>

        <div id="view-plan" class="hidden animate-in">
            <div class="bg-indigo-600 rounded-[2.5rem] p-8 shadow-xl shadow-indigo-200 mb-8 text-white relative overflow-hidden">
                <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
                
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-4 relative z-10">
                    <div>
                        <h2 class="text-3xl font-black tracking-tight mb-2">Today's Reading</h2>
                        <p class="text-indigo-100 text-sm font-medium">Your customized daily chapters.</p>
                    </div>
                    <select id="plan-selector" onchange="window.changePlan()" class="bg-white/20 text-white border border-white/30 rounded-xl text-sm font-bold uppercase tracking-wide py-3 px-5 outline-none focus:bg-white/30 focus:ring-2 focus:ring-white/50 cursor-pointer w-full md:w-auto" aria-label="Select reading plan">
                        <option value="SEQUENTIAL" class="text-slate-900">Canonical</option>
                        <option value="FIVE_DAY" class="text-slate-900">Five-Day Plan (Weekends Off)</option>
                        <option value="ONE_YEAR" class="text-slate-900">One Year (OT+NT Daily)</option>
                        <option value="MCHEYNE" class="text-slate-900">M'Cheyne (1 Year)</option>
                        <option value="HORNER" class="text-slate-900">Prof. Horner (10 Lists)</option>
                    </select>
                </div>
                
                <div id="plan-description-box" class="relative z-10 mb-8 mt-4 p-4 bg-white/10 rounded-2xl border border-white/10 text-sm text-indigo-50 leading-relaxed hidden">
                    </div>

                <div id="daily-plan-list" class="flex flex-col gap-3 relative z-10"></div>
                <p id="plan-footer-msg" class="text-center text-xs font-bold text-indigo-200 mt-6 uppercase tracking-widest relative z-10 opacity-70"></p>
            </div>
        </div>

        <div id="view-stats" class="hidden animate-in">
            <div class="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50 mb-8 flex flex-col lg:flex-row items-center gap-8 lg:gap-12">
                <div class="w-full lg:w-5/12 relative min-h-[300px] flex items-center justify-center">
                    <canvas id="mainDonutChart"></canvas>
                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Total Read</span>
                        <span id="stats-page-total-percent" class="text-4xl font-black text-indigo-900">0%</span>
                        <div class="mt-3 flex flex-col gap-1">
                            <span id="stats-words-count" class="text-xs text-slate-500 font-semibold">0 / 789,634 words</span>
                            <span id="stats-chapters-count" class="text-xs text-slate-500 font-semibold">0 / 0 chapters</span>
                        </div>
                    </div>
                </div>
                <div class="w-full lg:w-7/12 text-center lg:text-left">
                    <h2 class="text-3xl font-black text-slate-900 tracking-tight mb-2">Bible Completion</h2>
                    <p class="text-base text-slate-500 mb-8 max-w-md mx-auto lg:mx-0 leading-relaxed">Your reading progress across all categories of the Bible.</p>
                    <div id="legend-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3 text-left"></div>
                </div>
            </div>
            <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6 px-2">Category Breakdown</h3>
            <div id="category-stats-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>

            <div class="mt-12">
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6 px-2">Reading Activity</h3>
                <div class="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50">
                    <!-- Streak Status Banner -->
                    <div id="streak-status-banner" class="mb-6 hidden">
                        <!-- Dynamically rendered based on streak status -->
                    </div>

                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <div class="text-center lg:text-left">
                            <div class="inline-flex flex-col items-center gap-2 bg-gradient-to-r from-indigo-50 to-indigo-100/50 px-6 py-4 rounded-2xl border border-indigo-100 w-full relative">
                                <span id="streak-emoji" class="text-3xl">üî•</span>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-slate-500 uppercase tracking-wide">Current Streak</div>
                                    <div id="current-streak" class="text-2xl font-black text-indigo-900">0 days</div>
                                    <div id="streak-milestone-progress" class="text-[10px] text-slate-400 mt-1"></div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center lg:text-left">
                            <div class="inline-flex flex-col items-center gap-2 bg-gradient-to-r from-amber-50 to-amber-100/50 px-6 py-4 rounded-2xl border border-amber-100 w-full">
                                <span class="text-3xl">‚≠ê</span>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-slate-500 uppercase tracking-wide">Longest Streak</div>
                                    <div id="longest-streak" class="text-2xl font-black text-amber-900">0 days</div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center lg:text-left">
                            <div class="inline-flex flex-col items-center gap-2 bg-gradient-to-r from-emerald-50 to-emerald-100/50 px-6 py-4 rounded-2xl border border-emerald-100 w-full">
                                <span class="text-3xl">üìÖ</span>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-slate-500 uppercase tracking-wide">Total Days</div>
                                    <div id="total-reading-days" class="text-2xl font-black text-emerald-900">0</div>
                                    <div id="avg-chapters-day" class="text-[10px] text-slate-400 mt-1"></div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center lg:text-left">
                            <div class="inline-flex flex-col items-center gap-2 bg-gradient-to-r from-rose-50 to-rose-100/50 px-6 py-4 rounded-2xl border border-rose-100 w-full">
                                <span class="text-3xl">üìä</span>
                                <div class="text-center">
                                    <div class="text-xs font-bold text-slate-500 uppercase tracking-wide">Best Day</div>
                                    <div id="best-day" class="text-2xl font-black text-rose-900">0 ch</div>
                                    <div id="year-chapters" class="text-[10px] text-slate-400 mt-1"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Time Remaining Card -->
                    <div class="mb-6">
                        <div class="bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-2xl p-6 text-center">
                            <div class="text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Reading Time to Completion</div>
                            <div id="time-remaining-stat" class="text-2xl font-black text-purple-900">Calculating...</div>
                        </div>
                    </div>

                    <!-- Guilt-trip Comparison Card -->
                    <div id="reading-comparison" class="mb-6">
                        <!-- Dynamically rendered comparison message -->
                    </div>
                    <div class="overflow-x-auto">
                        <div id="heatmap-container" class="min-w-[600px]"></div>
                    </div>
                    <p class="text-xs text-slate-400 mt-4 text-center">Your reading activity over time. Each square represents a day of Bible reading.</p>
                </div>
            </div>
        </div>

        <div id="view-tools" class="hidden animate-in">
            <div class="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50 mb-8">
                <h2 class="text-3xl font-black text-slate-900 tracking-tight mb-8">Tools & Resources</h2>

                <div class="mb-10">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6">Games & Activities</h3>
                    <a href="bible-books-game.html" class="block group">
                        <div class="bg-gradient-to-br from-purple-50 to-indigo-50 p-8 rounded-3xl border-2 border-purple-200 hover:border-purple-400 transition-all hover:shadow-lg">
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 w-14 h-14 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <span class="text-3xl">üìñ</span>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-xl font-black text-purple-900 mb-2 group-hover:text-purple-700 transition-colors">Bible Books Memory Game</h4>
                                    <p class="text-slate-700 leading-relaxed mb-3">How many of the 66 books can you name in 5 minutes?</p>
                                    <div class="flex items-center gap-2 text-purple-700 font-bold text-sm group-hover:translate-x-2 transition-transform">
                                        <span>Play Now</span>
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>

                    <div onclick="window.showMemorizedVerses()" class="block group mt-4 cursor-pointer">
                        <div class="bg-gradient-to-br from-amber-50 to-yellow-50 p-8 rounded-3xl border-2 border-amber-200 hover:border-amber-400 transition-all hover:shadow-lg">
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 w-14 h-14 bg-gradient-to-br from-amber-500 to-yellow-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <span class="text-3xl">‚≠ê</span>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-xl font-black text-amber-900 mb-2 group-hover:text-amber-700 transition-colors">My Memorized Verses</h4>
                                    <p class="text-slate-700 leading-relaxed mb-3">View and manage verses you've marked for memorization. Add verses directly from the Bible reader.</p>
                                    <div class="flex items-center gap-2 text-amber-700 font-bold text-sm group-hover:translate-x-2 transition-transform">
                                        <span>View Verses</span>
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <a href="memorize.html" class="block group mt-4">
                        <div class="bg-gradient-to-br from-emerald-50 to-teal-50 p-8 rounded-3xl border-2 border-emerald-200 hover:border-emerald-400 transition-all hover:shadow-lg relative overflow-hidden">
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <span class="text-3xl">üí°</span>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-xl font-black text-emerald-900 mb-2 group-hover:text-emerald-700 transition-colors">Verse Memorization Helper</h4>
                                    <p class="text-slate-700 leading-relaxed mb-3">Memorize Scripture with first-letter hints. Choose popular verses or add your own.</p>
                                    <div class="flex items-center gap-2 text-emerald-700 font-bold text-sm group-hover:translate-x-2 transition-transform">
                                        <span>Start Memorizing</span>
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>

                <div class="mb-10">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6">Reading Plans</h3>
                    <div class="block group cursor-pointer" onclick="window.setTab('PLAN'); setTimeout(() => { document.getElementById('plan-selector').value = 'HORNER'; window.changePlan(); }, 100)">
                        <div class="bg-gradient-to-br from-rose-50 to-pink-50 p-8 rounded-3xl border-2 border-rose-200 hover:border-rose-400 transition-all hover:shadow-lg relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-rose-200/20 rounded-full blur-3xl -mr-10 -mt-10"></div>
                            <div class="flex items-start gap-4 relative z-10">
                                <div class="flex-shrink-0 w-14 h-14 bg-gradient-to-br from-rose-500 to-pink-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform shadow-lg shadow-rose-200">
                                    <span class="text-3xl">üìö</span>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-xl font-black text-rose-900 mb-2 group-hover:text-rose-700 transition-colors">Professor Horner's Bible Reading System</h4>
                                    <p class="text-slate-700 leading-relaxed mb-4">Read 10 chapters daily from different Bible sections. Each list rotates through different parts, creating fresh combinations daily.</p>
                                    <div class="bg-white/60 backdrop-blur-sm p-4 rounded-xl border border-rose-100 mb-3">
                                        <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
                                            <li>10 rotating lists from different Bible sections</li>
                                            <li>Track daily list completion</li>
                                            <li>See <a href="horner.html" class="text-rose-700 font-semibold hover:underline">analytics page</a> for plan details and reading estimates</li>
                                        </ul>
                                    </div>
                                    <div class="flex items-center gap-2 text-rose-700 font-bold text-sm group-hover:translate-x-2 transition-transform">
                                        <span>Start Horner Plan</span>
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-10">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">External Resources</h3>

                    <!-- Collapsible Warning Flap -->
                    <div class="bg-amber-50 border-2 border-amber-200 rounded-2xl overflow-hidden">
                        <button onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('.toggle-icon').classList.toggle('rotate-180');" class="w-full p-5 flex items-center justify-between hover:bg-amber-100 transition-all cursor-pointer group" aria-label="Show external resources">
                            <div class="flex items-center gap-3">
                                <div class="flex-shrink-0 w-10 h-10 bg-amber-200 rounded-xl flex items-center justify-center">
                                    <svg class="w-5 h-5 text-amber-700" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div class="text-left">
                                    <h4 class="font-bold text-amber-900 text-sm">Bible Study Resources</h4>
                                    <p class="text-xs text-amber-700 mt-0.5">Click to view helpful external websites</p>
                                </div>
                            </div>
                            <svg class="toggle-icon w-6 h-6 text-amber-600 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>

                        <div class="hidden">
                            <!-- Warning Message -->
                            <div class="px-5 pb-4">
                                <div class="bg-amber-100 border border-amber-300 rounded-xl p-4 mb-4">
                                    <p class="text-xs text-amber-800 leading-relaxed">
                                        <span class="font-bold block mb-1">‚ö†Ô∏è External Resources Disclaimer</span>
                                        The following websites are <strong>not affiliated</strong> with BibleProgress.com. These are third-party resources that may be helpful for Bible study. BibleProgress does not endorse or take responsibility for the content on these sites.
                                    </p>
                                </div>

                                <!-- External Links Grid -->
                                <div class="grid sm:grid-cols-2 gap-4">
                                    <a href="https://study.bible" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-white rounded-2xl border border-slate-200 hover:border-emerald-200 hover:bg-emerald-50/50 transition-all group">
                                        <div class="flex-shrink-0 w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center">
                                            <svg class="w-5 h-5 text-emerald-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-900 mb-1 group-hover:text-emerald-900">Study.Bible</h4>
                                            <p class="text-xs text-slate-600">Interactive Bible study tools</p>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400 group-hover:text-emerald-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                    </a>

                                    <a href="https://biblereadingplangenerator.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-white rounded-2xl border border-slate-200 hover:border-sky-200 hover:bg-sky-50/50 transition-all group">
                                        <div class="flex-shrink-0 w-10 h-10 bg-sky-100 rounded-xl flex items-center justify-center">
                                            <svg class="w-5 h-5 text-sky-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-900 mb-1 group-hover:text-sky-900">Reading Plan Generator</h4>
                                            <p class="text-xs text-slate-600">Create custom reading plans</p>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400 group-hover:text-sky-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                    </a>

                                    <a href="https://benbornagain.faith/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-white rounded-2xl border border-slate-200 hover:border-amber-200 hover:bg-amber-50/50 transition-all group">
                                        <div class="flex-shrink-0 w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center">
                                            <svg class="w-5 h-5 text-amber-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-900 mb-1 group-hover:text-amber-900">Ben Born Again</h4>
                                            <p class="text-xs text-slate-600">Faith resources and insights</p>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400 group-hover:text-amber-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                    </a>

                                    <a href="https://www.abarim-publications.com/index.html" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-white rounded-2xl border border-slate-200 hover:border-rose-200 hover:bg-rose-50/50 transition-all group">
                                        <div class="flex-shrink-0 w-10 h-10 bg-rose-100 rounded-xl flex items-center justify-center">
                                            <svg class="w-5 h-5 text-rose-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-900 mb-1 group-hover:text-rose-900">Abarim Publications</h4>
                                            <p class="text-xs text-slate-600">Biblical name meanings & analysis</p>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400 group-hover:text-rose-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                    </a>

                                    <a href="https://www.blueletterbible.org/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-white rounded-2xl border border-slate-200 hover:border-blue-200 hover:bg-blue-50/50 transition-all group">
                                        <div class="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                                            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-900 mb-1 group-hover:text-blue-900">Blue Letter Bible</h4>
                                            <p class="text-xs text-slate-600">Comprehensive Bible study tools</p>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400 group-hover:text-blue-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                    </a>

                                    <a href="https://home.snu.edu/~hculbert/study.htm" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-white rounded-2xl border border-slate-200 hover:border-purple-200 hover:bg-purple-50/50 transition-all group">
                                        <div class="flex-shrink-0 w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                                            <svg class="w-5 h-5 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-900 mb-1 group-hover:text-purple-900">SNU Bible Study Guide</h4>
                                            <p class="text-xs text-slate-600">Study guides and resources</p>
                                        </div>
                                        <svg class="w-5 h-5 text-slate-400 group-hover:text-purple-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-about" class="hidden animate-in">
             <div class="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50 mb-8">
                <h2 class="text-3xl font-black text-slate-900 tracking-tight mb-8">About</h2>

                <div class="mb-8">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">What Makes This Different?</h3>
                    <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                        <h4 class="text-lg font-bold text-slate-900 mb-2">Word-Weighted Tracking</h4>
                        <p class="text-slate-700 mb-4">Progress is tracked by word count, not just chapters. Psalm 117 has 33 words. Psalm 119 has 2,423 words.</p>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Who Made This?</h3>
                    <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                        <p id="person" class="text-lg font-bold text-slate-900 mb-2 cursor-default">Made by a friend!</p>
                        <p class="text-sm text-slate-700 mb-4">A simple tracker that reflects actual reading effort.</p>

                        <script>
                          const person = document.getElementById("person");
                          person.addEventListener("mouseover", () => {
                            const tag = document.createElement("span");
                            tag.textContent = " (Shane)";
                            tag.id = "hoverTag";
                            tag.className = "text-indigo-600 ml-1 text-base font-bold";
                            person.appendChild(tag);
                          });
                          person.addEventListener("mouseout", () => {
                            const tag = document.getElementById("hoverTag");
                            if (tag) tag.remove();
                          });
                        </script>

                        <div class="pt-4 border-t border-indigo-200/50 flex flex-col items-center">
                            <a href="https://www.buymeacoffee.com/bibleprogress" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 px-6 py-2 bg-[#FFDD00] text-black rounded-full font-bold text-sm hover:shadow-lg transition-shadow">
                                <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                                    <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd" />
                                </svg>
                                Buy me a coffee
                            </a>
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">How to Use</h3>
                    <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                        <ul class="space-y-3 text-sm text-slate-700">
                            <li class="flex items-start gap-2">
                                <span class="text-indigo-600 font-bold">‚Ä¢</span>
                                <span>Click any book to expand and view chapters</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-indigo-600 font-bold">‚Ä¢</span>
                                <span>Check off chapters as you read them</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-indigo-600 font-bold">‚Ä¢</span>
                                <span>Click chapter names to read on Blue Letter Bible</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-indigo-600 font-bold">‚Ä¢</span>
                                <span>Create profiles to track different reading plans</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-indigo-600 font-bold">‚Ä¢</span>
                                <span>Sign in to sync progress across devices</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Reading Plans</h3>
                    <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200 space-y-4">
                        <div>
                            <div class="font-bold text-slate-900 mb-1">Sequential</div>
                            <p class="text-sm text-slate-600">Read from Genesis to Revelation in order.</p>
                        </div>

                        <div>
                            <div class="font-bold text-slate-900 mb-1">One Year (OT+NT Daily)</div>
                            <p class="text-sm text-slate-600">3 OT chapters + 1 NT chapter daily. Finish in one year.</p>
                        </div>

                        <div>
                            <div class="font-bold text-slate-900 mb-1">M'Cheyne</div>
                            <p class="text-sm text-slate-600">4 chapters daily. NT and Psalms twice yearly, rest once.</p>
                        </div>

                        <div>
                            <div class="font-bold text-slate-900 mb-1">Horner System</div>
                            <p class="text-sm text-slate-600">10 chapters daily from 10 rotating lists. Designed for continuous reading.</p>
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6">Legal & Compliance</h3>
                    <div class="grid sm:grid-cols-2 gap-4">
                        <a href="/privacy.html" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-slate-50 rounded-2xl border border-slate-200 hover:border-indigo-200 hover:bg-indigo-50/50 transition-all group">
                            <div class="flex-shrink-0 w-10 h-10 bg-indigo-100 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-slate-900 mb-1 group-hover:text-indigo-900">Privacy Policy</h4>
                                <p class="text-xs text-slate-600">How we protect your data</p>
                            </div>
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-indigo-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>

                        <a href="/terms.html" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-slate-50 rounded-2xl border border-slate-200 hover:border-indigo-200 hover:bg-indigo-50/50 transition-all group">
                            <div class="flex-shrink-0 w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-emerald-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-slate-900 mb-1 group-hover:text-indigo-900">Terms of Service</h4>
                                <p class="text-xs text-slate-600">User agreement and terms</p>
                            </div>
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-indigo-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>

                        <a href="/accessibility.html" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-slate-50 rounded-2xl border border-slate-200 hover:border-indigo-200 hover:bg-indigo-50/50 transition-all group">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-slate-900 mb-1 group-hover:text-indigo-900">Accessibility Statement</h4>
                                <p class="text-xs text-slate-600">Our commitment to accessibility</p>
                            </div>
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-indigo-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>

                        <!-- GitHub Link (Temporarily Removed) -->
                        <!--
                        <a href="https://github.com/sxejno/bible-progress" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-5 bg-slate-50 rounded-2xl border border-slate-200 hover:border-indigo-200 hover:bg-indigo-50/50 transition-all group">
                            <div class="flex-shrink-0 w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-slate-900 mb-1 group-hover:text-indigo-900">Open Source (MIT)</h4>
                                <p class="text-xs text-slate-600">View code on GitHub</p>
                            </div>
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-indigo-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>
                        -->
                    </div>

                    <div class="mt-6 p-6 bg-gradient-to-br from-indigo-50 to-purple-50/30 rounded-3xl border border-indigo-100">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="flex-shrink-0 w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-900 mb-2">Your Privacy Matters</h4>
                                <p class="text-sm text-slate-700 leading-relaxed mb-2">
                                    Bible Progress is designed with privacy in mind. Your reading progress is stored locally on your device by default. Cloud sync is completely optional.
                                </p>
                                <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
                                    <li>No tracking without your consent</li>
                                    <li>Export your data anytime (JSON backup)</li>
                                    <li>GDPR & CCPA compliant</li>
                                    <li>Open source and transparent</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

             </div>
        </div>

        <div id="view-settings" class="hidden animate-in">
            <div class="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50 mb-8">
                <h2 class="text-3xl font-black text-slate-900 tracking-tight mb-8">Settings</h2>

                <div class="mb-8 pb-8 border-b border-slate-100">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Appearance</h3>
                    <div class="flex items-center justify-between p-4 rounded-xl bg-slate-50 border border-slate-200 mb-4">
                        <div>
                            <div class="font-bold text-slate-700 text-sm mb-1">Dark Mode</div>
                            <div class="text-xs text-slate-500">Reduce eye strain</div>
                        </div>
                        <button onclick="window.toggleDarkModeSetting()" id="dark-mode-toggle" class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 bg-slate-300" role="switch" aria-checked="false" aria-label="Toggle dark mode">
                            <span id="dark-mode-toggle-circle" class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform translate-x-1 shadow-md"></span>
                        </button>
                    </div>

                    <div class="flex items-center justify-between p-4 rounded-xl bg-slate-50 border border-slate-200">
                        <div class="flex-1">
                            <div class="font-bold text-slate-700 text-sm mb-1">Default Tab on Load</div>
                            <div class="text-xs text-slate-500">Choose which tab opens when you load the app</div>
                        </div>
                        <select id="default-tab-selector" onchange="window.setDefaultTab(this.value)" class="bg-white border border-slate-300 rounded-lg text-sm font-bold text-slate-700 py-2 px-3 outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer" aria-label="Select default tab on load">
                            <option value="ALL">All Books</option>
                            <option value="OT">OT Books</option>
                            <option value="NT">NT Books</option>
                            <option value="PLAN">Daily Plan</option>
                            <option value="STATS">Stats</option>
                        </select>
                    </div>
                </div>

                <div class="mb-8 pb-8 border-b border-slate-100">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Reading Plan</h3>

                    <div class="flex items-center justify-between p-4 rounded-xl bg-slate-50 border border-slate-200 mb-4">
                        <div>
                            <div class="font-bold text-slate-700 text-sm mb-1">Reading Time Estimates</div>
                            <div class="text-xs text-slate-500">Show time estimates in daily plan</div>
                        </div>
                        <button onclick="window.toggleReadingTime()" id="reading-time-toggle" class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 bg-slate-300" role="switch" aria-checked="false" aria-label="Toggle reading time estimates">
                            <span id="reading-time-toggle-circle" class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform translate-x-1 shadow-md"></span>
                        </button>
                    </div>

                    <div id="wpm-setting-container" class="p-4 rounded-xl bg-slate-50 border border-slate-200" style="display: none;">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <div class="font-bold text-slate-700 text-sm mb-1">Reading Speed (WPM)</div>
                                <div class="text-xs text-slate-500">Adjust words per minute</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <input type="number" id="wpm-input" min="100" max="500" step="10" value="250"
                                    onchange="window.updateWPM(this.value)"
                                    class="w-20 px-3 py-2 rounded-lg border border-slate-300 text-center font-bold text-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-label="Words per minute reading speed">
                                <span class="text-xs font-bold text-slate-500 uppercase">WPM</span>
                            </div>
                        </div>
                        <div class="text-xs text-slate-500 leading-relaxed bg-blue-50 p-3 rounded-lg border border-blue-100">
                            <strong>Reference:</strong> Average reading speed is 200-250 WPM. Fast readers: 300+ WPM. Slow/careful reading: 100-150 WPM.
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Data Management</h3>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button onclick="window.backupData()" class="flex-1 flex items-center justify-center gap-2 px-6 py-4 rounded-xl bg-slate-50 border border-slate-200 text-slate-600 font-bold hover:bg-slate-100 transition-colors text-sm uppercase tracking-wide" aria-label="Download backup of reading progress">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            Download Backup
                        </button>
                        <label class="flex-1 cursor-pointer flex items-center justify-center gap-2 px-6 py-4 rounded-xl bg-slate-50 border border-slate-200 text-slate-600 font-bold hover:bg-slate-100 transition-colors text-sm uppercase tracking-wide" aria-label="Restore reading progress from file">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m-4-4v12"></path></svg>
                            Restore from File
                            <input type="file" id="restore-input-settings" class="hidden" accept=".json" onchange="window.restoreData(this)" aria-label="Select backup file to restore">
                        </label>
                    </div>
                    <p id="restore-msg-settings" class="text-center text-sm font-bold text-emerald-600 mt-4 hidden bg-emerald-50 py-2 rounded-lg"></p>
                    <p class="text-xs text-slate-500 mt-4 text-center leading-relaxed">
                        Backup and restore your reading progress.
                    </p>
                </div>

                <div id="advanced-settings-container" class="mb-8" style="display: none;">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Advanced: Cross-Profile Sync</h3>
                    <p class="text-xs text-slate-500 mb-4 leading-relaxed">
                        Configure one-way chapter syncing between profiles. When you mark a chapter as read in the <strong>source profile</strong>, it will automatically be marked as read in the <strong>target profile</strong> (but not vice versa).
                    </p>
                    <p class="text-xs text-slate-600 mb-4 leading-relaxed bg-blue-50 p-3 rounded-lg border border-blue-100">
                        <strong>Example:</strong> If you have a "Family" profile and a "Private" profile, you can set Family ‚Üí Private so that chapters read with the family also count toward your private progress.
                    </p>
                    <div id="profile-sync-rules" class="space-y-3"></div>
                    <button onclick="window.addProfileSyncRule()" class="mt-4 flex items-center gap-2 px-4 py-2 rounded-lg bg-indigo-50 border border-indigo-200 text-indigo-600 font-bold hover:bg-indigo-100 transition-colors text-sm" aria-label="Add profile sync rule">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        Add Sync Rule
                    </button>
                </div>
            </div>
        </div>

        <div id="view-chapters" class="hidden animate-in">
            <div class="flex items-center justify-between mb-8">
                <button onclick="window.showBooks()" class="flex items-center text-indigo-600 font-bold text-sm hover:-translate-x-1 transition-transform bg-indigo-50 px-4 py-2 rounded-full" aria-label="Back to library">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                    Back to Library
                </button>
                <div id="book-label" class="bg-indigo-100 text-indigo-700 text-xs font-black px-4 py-2 rounded-full uppercase tracking-widest shadow-sm">Testament</div>
            </div>
            
            <div class="bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-xl shadow-indigo-100/40 border border-indigo-50">
                <div class="mb-10 text-center">
                    <h2 id="active-book-title" class="text-4xl sm:text-5xl font-black text-slate-900 tracking-tighter mb-4">Genesis</h2>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-3 sm:gap-4">
                        <span id="book-chapters-read" class="text-xs font-black text-indigo-600 uppercase tracking-widest whitespace-nowrap">0/50 chapters</span>
                        <div class="w-full sm:flex-1 sm:max-w-xs bg-slate-100 h-3 rounded-full overflow-hidden">
                            <div id="book-inner-bar" class="bg-indigo-500 h-full progress-bar" style="width: 0%"></div>
                        </div>
                        <span id="book-time-left" class="text-xs font-black text-slate-500 uppercase tracking-widest whitespace-nowrap">‚è±Ô∏è ~0 min</span>
                    </div>
                </div>
                
                <div id="chapter-grid" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-3 sm:gap-4"></div>

                <div class="mt-12 pt-8 border-t border-slate-100 flex flex-col sm:flex-row justify-center gap-4">
                    <button onclick="window.toggleAllInBook(true)" class="text-xs font-black text-emerald-600 uppercase tracking-widest hover:bg-emerald-50 px-6 py-3 rounded-full transition-colors border border-transparent hover:border-emerald-100" aria-label="Mark all chapters in book as finished">Mark Book Finished</button>
                    <button onclick="window.toggleAllInBook(false)" class="text-xs font-black text-slate-400 uppercase tracking-widest hover:bg-slate-50 px-6 py-3 rounded-full transition-colors border border-transparent hover:border-slate-200" aria-label="Reset all chapters in book to unread">Reset Book</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="max-w-5xl mx-auto px-4 py-8 sm:px-6 mt-12 border-t border-slate-200">
        <div class="text-center">
            <div class="flex flex-wrap justify-center items-center gap-4 mb-4 text-sm text-slate-600">
                <a href="/privacy.html" class="hover:text-indigo-600 font-medium transition-colors" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
                <span class="text-slate-300">‚Ä¢</span>
                <a href="/terms.html" class="hover:text-indigo-600 font-medium transition-colors" target="_blank" rel="noopener noreferrer">Terms of Service</a>
                <span class="text-slate-300">‚Ä¢</span>
                <a href="/accessibility.html" class="hover:text-indigo-600 font-medium transition-colors" target="_blank" rel="noopener noreferrer">Accessibility</a>
                <!-- GitHub Link (Temporarily Removed) -->
                <!--
                <span class="text-slate-300">‚Ä¢</span>
                <a href="https://github.com/sxejno/bible-progress" class="hover:text-indigo-600 font-medium transition-colors" target="_blank" rel="noopener noreferrer">GitHub</a>
                -->
            </div>
            <p class="text-xs text-slate-500">
                &copy; 2026 Bible Progress. Licensed under the <a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer" class="hover:text-indigo-600 transition-colors">MIT License</a>.
            </p>
            <p class="text-xs text-slate-400 mt-2">
                King James Version (KJV) Bible text is in the public domain.
            </p>
        </div>
    </footer>

    <!-- Cookie Consent Banner (Temporarily Removed) -->
    <!--
    <div id="cookie-consent-banner" class="hidden fixed bottom-0 left-0 right-0 z-50 glass border-t border-slate-200 shadow-2xl">
        <div class="max-w-5xl mx-auto px-4 py-6 sm:px-6">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <div class="flex-1">
                    <h3 class="text-sm font-bold text-slate-900 mb-2">Cookie Notice</h3>
                    <p class="text-sm text-slate-700 leading-relaxed">
                        We use essential cookies for authentication and analytics cookies to improve your experience. By using Bible Progress, you consent to our use of cookies.
                        <a href="/privacy.html" class="text-indigo-600 hover:underline font-medium" target="_blank" rel="noopener noreferrer">Learn more</a>
                    </p>
                </div>
                <div class="flex gap-3 self-end sm:self-auto">
                    <button onclick="window.dismissCookieConsent()" class="px-6 py-2.5 bg-indigo-600 text-white rounded-xl text-sm font-bold hover:bg-indigo-700 transition-colors shadow-md" aria-label="Accept cookies">
                        Accept
                    </button>
                </div>
            </div>
        </div>
    </div>
    -->

    <script type="module">
        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";

        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBkQc0Hyw6zFu9s8QQz1KfEz-5lEkpPVd0",
            authDomain: "bibleprogress-48cfd.firebaseapp.com",
            projectId: "bibleprogress-48cfd",
            storageBucket: "bibleprogress-48cfd.firebasestorage.app",
            messagingSenderId: "400605616220",
            appId: "1:400605616220:web:ce3c6f7b3048c90b636e99",
            measurementId: "G-94H40H1FCR"
        };

        // --- INITIALIZE FIREBASE ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);
        const provider = new GoogleAuthProvider();

        // --- GLOBAL ERROR HANDLER ---
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('‚ùå Global Error:', {
                message: msg,
                url: url,
                line: lineNo,
                column: columnNo,
                error: error,
                stack: error?.stack
            });

            // Log to analytics if available
            try {
                if (typeof analytics !== 'undefined') {
                    logEvent(analytics, 'exception', {
                        description: msg,
                        fatal: false
                    });
                }
            } catch (analyticsError) {
                console.warn('Failed to log error to analytics:', analyticsError);
            }

            return false; // Allow default error handling
        };

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            console.error('‚ùå Unhandled Promise Rejection:', {
                reason: event.reason,
                promise: event.promise
            });

            // Log to analytics if available
            try {
                if (typeof analytics !== 'undefined') {
                    logEvent(analytics, 'exception', {
                        description: `Unhandled Promise: ${event.reason}`,
                        fatal: false
                    });
                }
            } catch (analyticsError) {
                console.warn('Failed to log error to analytics:', analyticsError);
            }
        });

        // --- HASH-BASED COLOR GENERATOR ---
        function stringToColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            const hue = Math.abs(hash % 360);
            return {
                bg: `hsl(${hue}, 70%, 92%)`,
                border: `hsl(${hue}, 50%, 70%)`,
                text: `hsl(${hue}, 60%, 35%)`,
                solid: `hsl(${hue}, 65%, 55%)`
            };
        }

        // --- SANITIZE PROFILE NAME (ALPHANUMERIC ONLY, MAX 20 CHARS) ---
        function sanitizeProfileName(name) {
            const cleaned = name.replace(/[^a-zA-Z0-9]/g, '').substring(0, 20);
            return cleaned;
        }

        // --- VALIDATE URL (MUST BE HTTPS) ---
        function isValidHttpsUrl(urlString) {
            try {
                const url = new URL(urlString);
                return url.protocol === 'https:';
            } catch (e) {
                return false;
            }
        }

        // --- VALIDATE APP DATA ---
        function validateAppData(data) {
            if(!data || typeof data !== 'object') return false;
            if(!data.profiles || typeof data.profiles !== 'object') return false;
            // Must have at least one profile
            if(Object.keys(data.profiles).length === 0) return false;
            // activeProfileId should be a string (but doesn't need to exist in profiles - we'll fix that in migration)
            if(!data.activeProfileId || typeof data.activeProfileId !== 'string') return false;
            // Validate each profile contains valid chapter data
            for(const profileName in data.profiles) {
                const profile = data.profiles[profileName];
                if(typeof profile !== 'object') return false;
            }
            return true;
        }

        // --- APP STATE & MIGRATION ---
        let savedData = null;
        try {
            const rawData = localStorage.getItem('kjv_v6_data');
            if (rawData) {
                savedData = JSON.parse(rawData);
                if(savedData && !validateAppData(savedData)) {
                    console.warn('Invalid saved data, resetting to defaults');
                    savedData = null;
                }
            }
        } catch (e) {
            console.error('Failed to parse saved data:', e);
            savedData = null;
        }

        let oldProgress = null;
        try {
            const rawProgress = localStorage.getItem('kjv_v6_progress');
            if (rawProgress) {
                oldProgress = JSON.parse(rawProgress);
            }
        } catch (e) {
            console.error('Failed to parse old progress:', e);
            oldProgress = null;
        }
        let oldPlan = localStorage.getItem('kjv_v6_active_plan') || 'MCHEYNE';

        let appData = savedData || {
            profiles: { "Default": oldProgress || {} },
            activeProfileId: "Default",
            profilePlans: { "Default": oldPlan },
            defaultProfileId: "Default",
            profileSyncRules: {}
        };

        // Ensure data structure is valid
        if(!appData.profiles || Object.keys(appData.profiles).length === 0) {
            appData.profiles = { "Default": {} };
            appData.activeProfileId = "Default";
            appData.defaultProfileId = "Default";
        }

        // Migrate existing users to have profilePlans
        if(!appData.profilePlans) {
            appData.profilePlans = {};
            Object.keys(appData.profiles).forEach(name => {
                appData.profilePlans[name] = oldPlan;
            });
        }

        // Migrate existing users to have defaultProfileId
        if(!appData.defaultProfileId) {
            // Set the first profile as default (or current active profile)
            appData.defaultProfileId = appData.activeProfileId || Object.keys(appData.profiles)[0];
        }

        // Migrate existing users to have profileSyncRules
        if(!appData.profileSyncRules) {
            appData.profileSyncRules = {};
        }

        // Migrate existing users to have hornerDailyProgress (now per-profile)
        if(!appData.hornerDailyProgress) {
            appData.hornerDailyProgress = {};
        }
        // Migrate old global hornerDailyProgress to per-profile structure
        if(appData.hornerDailyProgress.date && appData.hornerDailyProgress.completedLists) {
            // Old global structure detected - migrate to current active profile
            const oldData = { ...appData.hornerDailyProgress };
            appData.hornerDailyProgress = {};
            appData.hornerDailyProgress[appData.activeProfileId] = oldData;
        }
        // Ensure each profile has hornerDailyProgress initialized
        Object.keys(appData.profiles).forEach(profileId => {
            if(!appData.hornerDailyProgress[profileId]) {
                appData.hornerDailyProgress[profileId] = {
                    date: new Date().toISOString().split('T')[0],
                    completedLists: []
                };
            }
        });

        // Migrate existing users to have reading time settings
        if(appData.showReadingTime === undefined) {
            appData.showReadingTime = true;
        }
        if(!appData.wordsPerMinute) {
            appData.wordsPerMinute = 250; // Average adult reading speed
        }

        // Migrate existing users to have verse memorization (per-profile)
        if(!appData.memorizedVerses) {
            appData.memorizedVerses = {};
            Object.keys(appData.profiles).forEach(profileId => {
                appData.memorizedVerses[profileId] = [];
            });
        }
        // Ensure each profile has memorizedVerses array
        Object.keys(appData.profiles).forEach(profileId => {
            if(!appData.memorizedVerses[profileId]) {
                appData.memorizedVerses[profileId] = [];
            }
        });

        // On app load, use defaultProfileId if it exists and is valid
        if(appData.defaultProfileId && appData.profiles[appData.defaultProfileId]) {
            appData.activeProfileId = appData.defaultProfileId;
        }

        // Ensure active profile exists
        if(!appData.profiles[appData.activeProfileId]) {
            appData.activeProfileId = Object.keys(appData.profiles)[0];
        }

        // Ensure default profile exists, otherwise set it to active profile
        if(!appData.profiles[appData.defaultProfileId]) {
            appData.defaultProfileId = appData.activeProfileId;
        }

        // Migrate boolean progress values to timestamps (for heatmap/streak tracking)
        Object.keys(appData.profiles).forEach(profileName => {
            const profile = appData.profiles[profileName];
            Object.keys(profile).forEach(chapterKey => {
                if(profile[chapterKey] === true) {
                    // Convert true to current timestamp (one-time migration)
                    profile[chapterKey] = Date.now();
                }
            });
        });

        // If "Default" is active/default but other profiles exist, switch away from it
        const allProfileNames = Object.keys(appData.profiles);
        if(allProfileNames.length > 1 && appData.activeProfileId === 'Default') {
            // Switch to the first non-Default profile
            const nonDefaultProfile = allProfileNames.find(name => name !== 'Default');
            if(nonDefaultProfile) {
                appData.activeProfileId = nonDefaultProfile;
                appData.defaultProfileId = nonDefaultProfile;
            }
        }

        // Ensure all profiles have a plan
        Object.keys(appData.profiles).forEach(name => {
            if(!appData.profilePlans[name]) {
                appData.profilePlans[name] = 'MCHEYNE';
            }
        });

        // Save any migration fixes to localStorage immediately
        // This prevents the "Default" profile from being recreated on reload
        localStorage.setItem('kjv_v6_data', JSON.stringify(appData));

        let activePlan = appData.profilePlans[appData.activeProfileId] || 'MCHEYNE';
        let currentUser = null;

        // --- CHAPTER SUMMARIES ---
        let chapterSummaries = {};

        // Load chapter summaries from JSON
        fetch('bible_chapter_summaries_concise.json')
            .then(response => response.json())
            .then(data => {
                // Convert array to lookup object for faster access
                data.forEach(item => {
                    chapterSummaries[item.id] = item.summary;
                });
            })
            .catch(err => {
                console.log('Chapter summaries not loaded:', err);
            });

        // --- UTILITY FUNCTIONS ---
        // Helper function to get local date string (YYYY-MM-DD) from timestamp
        function getLocalDateString(timestamp) {
            const date = new Date(timestamp);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // --- HORNER DAILY PROGRESS HELPERS ---
        const getTodaysDate = () => getLocalDateString(Date.now());

        const resetHornerDailyProgressIfNeeded = () => {
            const today = getTodaysDate();
            const profileId = appData.activeProfileId;

            // Ensure the profile has hornerDailyProgress initialized
            if(!appData.hornerDailyProgress[profileId]) {
                appData.hornerDailyProgress[profileId] = {
                    date: today,
                    completedLists: []
                };
            }

            // Reset if it's a new day
            if(appData.hornerDailyProgress[profileId].date !== today) {
                appData.hornerDailyProgress[profileId] = {
                    date: today,
                    completedLists: []
                };
            }
        };

        const getHornerListForChapter = (chapterId) => {
            const [bookName] = chapterId.split('-');
            for(let i = 0; i < PLAN_HORNER.length; i++) {
                if(PLAN_HORNER[i].includes(bookName)) {
                    return i;
                }
            }
            return -1;
        };

        const markHornerListComplete = (listIndex) => {
            resetHornerDailyProgressIfNeeded();
            const profileId = appData.activeProfileId;
            if(!appData.hornerDailyProgress[profileId].completedLists.includes(listIndex)) {
                appData.hornerDailyProgress[profileId].completedLists.push(listIndex);
            }
        };

        const isHornerListComplete = (listIndex) => {
            resetHornerDailyProgressIfNeeded();
            const profileId = appData.activeProfileId;
            return appData.hornerDailyProgress[profileId].completedLists.includes(listIndex);
        };

        // Reset daily progress on load if it's a new day
        resetHornerDailyProgressIfNeeded();
        let unsubscribe = null;
        let saveTimeout = null;
        let userIsEditing = false; // NEW: Prevent cloud sync during edits

        // --- UI ELEMENTS ---
        const logoutBtn = document.getElementById('logout-btn');
        const userProfile = document.getElementById('user-profile');
        const userPhoto = document.getElementById('user-photo');
        const syncStatus = document.getElementById('sync-status');
        const currentProfileName = document.getElementById('current-profile-name');
        const currentProfileDot = document.getElementById('current-profile-dot');

        const planSelector = document.getElementById('plan-selector');
        if(planSelector) planSelector.value = activePlan;

        // --- UPDATE PROFILE COLOR ---
        function updateProfileColor() {
            const color = stringToColor(appData.activeProfileId);
            if(currentProfileDot) {
                currentProfileDot.style.backgroundColor = color.solid;
            }
        }

        // --- HELPER FOR CURRENT PROGRESS ---
        function getProgress() {
            return appData.profiles[appData.activeProfileId] || {};
        }
        function setProgress(newProg) {
            appData.profiles[appData.activeProfileId] = newProg;
        }

        // --- AUTH LOGIC ---
        window.toggleAuthModal = (show) => {
            const modal = document.getElementById('auth-modal');
            const errBox = document.getElementById('auth-error');
            if(show) {
                modal.classList.remove('hidden');
                errBox.classList.add('hidden');
            } else {
                modal.classList.add('hidden');
            }
        };

        // --- INTRO MODAL LOGIC ---
        window.showIntroModal = () => {
            const modal = document.getElementById('intro-modal');
            modal.classList.remove('hidden');
        };

        window.closeIntroModal = () => {
            const modal = document.getElementById('intro-modal');
            modal.classList.add('hidden');
            // Mark that user has seen the intro
            localStorage.setItem('kjv_intro_seen', 'true');
        };

        // Check if this is the user's first visit
        function checkFirstVisit() {
            const hasSeenIntro = localStorage.getItem('kjv_intro_seen');
            if (!hasSeenIntro) {
                // Show intro modal after a short delay for better UX
                setTimeout(() => {
                    window.showIntroModal();
                }, 500);
            }
        }

        window.handleGoogleLogin = () => {
            signInWithPopup(auth, provider)
                .then((result) => { window.toggleAuthModal(false); })
                .catch((error) => {
                    alert("Google Login Failed: " + error.message);
                });
        };

        window.handleEmailAuth = async (mode) => {
            const email = document.getElementById('email-input').value;
            const pass = document.getElementById('pass-input').value;
            const errBox = document.getElementById('auth-error');
            
            if (!email || !pass) {
                errBox.innerText = "Please enter both email and password.";
                errBox.classList.remove('hidden');
                return;
            }

            try {
                if (mode === 'REGISTER') {
                    await createUserWithEmailAndPassword(auth, email, pass);
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                }
                window.toggleAuthModal(false);
            } catch (error) {
                let msg = error.message;
                if (error.code === 'auth/invalid-credential') msg = "Incorrect email or password.";
                if (error.code === 'auth/email-already-in-use') msg = "That email is already registered.";
                if (error.code === 'auth/weak-password') msg = "Password should be at least 6 characters.";
                errBox.innerText = msg;
                errBox.classList.remove('hidden');
            }
        };

        logoutBtn.addEventListener('click', () => {
            signOut(auth).then(() => window.location.reload());
        });

        onAuthStateChanged(auth, (user) => {
            const loginBtn = document.getElementById('login-btn');
            if (user) {
                currentUser = user;
                loginBtn.classList.add('hidden');
                userProfile.classList.remove('hidden');
                // Validate photoURL is HTTPS before using it (prevent XSS/open redirect)
                if (user.photoURL && isValidHttpsUrl(user.photoURL)) {
                    userPhoto.src = user.photoURL;
                } else {
                    userPhoto.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.email)}&background=e0e7ff&color=4f46e5`;
                }
                
                syncStatus.className = "flex items-center justify-center w-8 h-8 rounded-full bg-emerald-50 text-emerald-600 border border-emerald-200";
                syncStatus.title = "Cloud Synced";
                syncStatus.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/><path d="M9 16.2L5.5 12.7l1.4-1.4L9 13.4l4.1-4.1 1.4 1.4z" fill="white"/></svg>';
                initCloudSync(user.uid);
            } else {
                currentUser = null;
                loginBtn.classList.remove('hidden');
                userProfile.classList.add('hidden');
                syncStatus.className = "flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 text-slate-400 border border-slate-200";
                syncStatus.title = "Local Only";
                syncStatus.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>';
                if(unsubscribe) unsubscribe(); 
            }
        });

        async function initCloudSync(uid) {
            const userDocRef = doc(db, "users", uid);
            unsubscribe = onSnapshot(userDocRef, (docSnap) => {
                // Skip sync if user is actively editing
                if(userIsEditing) {
                    console.log('‚è∏Ô∏è Skipping sync - user editing');
                    return;
                }
                
                if (docSnap.exists()) {
                    const cloudData = docSnap.data().appData || {};
                    if (Object.keys(cloudData).length > 0 && validateAppData(cloudData)) {
                        appData = cloudData;

                        // Ensure data integrity
                        if(!appData.profilePlans) {
                            appData.profilePlans = {};
                            Object.keys(appData.profiles).forEach(name => {
                                appData.profilePlans[name] = 'MCHEYNE';
                            });
                        }

                        // Ensure profileSyncRules exists (migration for existing users)
                        if(!appData.profileSyncRules) {
                            appData.profileSyncRules = {};
                        }

                        // Ensure hornerDailyProgress exists (migration for existing users)
                        if(!appData.hornerDailyProgress) {
                            appData.hornerDailyProgress = {};
                        }
                        // Ensure each profile has hornerDailyProgress initialized
                        Object.keys(appData.profiles).forEach(profileId => {
                            if(!appData.hornerDailyProgress[profileId]) {
                                appData.hornerDailyProgress[profileId] = {
                                    date: new Date().toISOString().split('T')[0],
                                    completedLists: []
                                };
                            }
                        });

                        // Ensure reading time settings exist (migration for existing users)
                        if(appData.showReadingTime === undefined) {
                            appData.showReadingTime = true;
                        }
                        if(!appData.wordsPerMinute) {
                            appData.wordsPerMinute = 250;
                        }

                        // Ensure active profile exists
                        if(!appData.profiles[appData.activeProfileId]) {
                            appData.activeProfileId = Object.keys(appData.profiles)[0];
                        }

                        // Reset daily progress if needed after loading from cloud
                        resetHornerDailyProgressIfNeeded();

                        localStorage.setItem('kjv_v6_data', JSON.stringify(appData));
                        refreshUI();
                    } else {
                        setDoc(userDocRef, { appData: appData }, { merge: true });
                    }
                } else {
                    setDoc(userDocRef, { appData: appData }, { merge: true });
                }
            });
        }

        function refreshUI() {
            currentProfileName.innerText = appData.activeProfileId;
            updateProfileColor();

            // Update active plan for current profile
            activePlan = appData.profilePlans[appData.activeProfileId] || 'MCHEYNE';
            const planSelector = document.getElementById('plan-selector');
            if(planSelector) planSelector.value = activePlan;

            if(window.activeTab === 'STATS') window.renderStatsPage();
            else if(window.activeTab === 'PLAN') window.renderDailyPlan();
            else if(window.activeTab === 'ABOUT') { }
            else { window.renderBookGrid(); window.renderSubdivisionStats(); }
            window.updateStats();
        }

        // --- OFFLINE/ONLINE DETECTION & TOAST NOTIFICATIONS ---
        function showToast(message, type = 'info') {
            // Remove any existing toasts
            const existingToast = document.getElementById('connection-toast');
            if(existingToast) existingToast.remove();

            const toast = document.createElement('div');
            toast.id = 'connection-toast';
            toast.className = 'fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[150] transition-all duration-300';

            const bgColors = {
                'offline': 'bg-amber-50 border-amber-200',
                'online': 'bg-emerald-50 border-emerald-200',
                'info': 'bg-slate-50 border-slate-200'
            };

            const textColors = {
                'offline': 'text-amber-900',
                'online': 'text-emerald-900',
                'info': 'text-slate-900'
            };

            const icons = {
                'offline': 'üì°',
                'online': '‚úÖ',
                'info': '‚ÑπÔ∏è'
            };

            toast.innerHTML = `
                <div class="${bgColors[type]} ${textColors[type]} px-6 py-4 rounded-2xl shadow-2xl border-2 flex items-center gap-3 modal-in max-w-md">
                    <span class="text-2xl">${icons[type]}</span>
                    <p class="text-sm font-bold leading-relaxed">${message}</p>
                </div>
            `;

            document.body.appendChild(toast);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if(toast && toast.parentNode) {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
        }

        function updateOfflineStatus() {
            if(!navigator.onLine) {
                if(syncStatus) {
                    syncStatus.className = "flex items-center justify-center w-8 h-8 rounded-full bg-amber-50 text-amber-600 border border-amber-200";
                    syncStatus.title = "Offline Mode";
                    syncStatus.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/><path d="M12 5v8l5.5 3.5-1 1.5-6.5-4V5z" fill="white" opacity="0.6"/></svg>';
                }
            } else if(currentUser) {
                if(syncStatus) {
                    syncStatus.className = "flex items-center justify-center w-8 h-8 rounded-full bg-emerald-50 text-emerald-600 border border-emerald-200";
                    syncStatus.title = "Cloud Synced";
                    syncStatus.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/><path d="M9 16.2L5.5 12.7l1.4-1.4L9 13.4l4.1-4.1 1.4 1.4z" fill="white"/></svg>';
                }
            } else {
                if(syncStatus) {
                    syncStatus.className = "flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 text-slate-400 border border-slate-200";
                    syncStatus.title = "Local Only";
                    syncStatus.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/></svg>';
                }
            }
        }

        // Offline event listener
        window.addEventListener('offline', () => {
            console.log('üì° Connection lost - entering offline mode');
            updateOfflineStatus();
            showToast('You are offline. All changes are saved locally and will sync when you\'re back online.', 'offline');
        });

        // Online event listener
        window.addEventListener('online', () => {
            console.log('‚úÖ Connection restored - back online');
            updateOfflineStatus();
            showToast('Connection restored! Your progress is syncing to the cloud.', 'online');

            // Trigger a save to sync any pending changes
            if(currentUser) {
                window.saveProgress(true);
            }
        });

        // Check initial offline status on load
        if(!navigator.onLine) {
            console.log('üì° Starting in offline mode');
            updateOfflineStatus();
        }

        // --- GLOBAL FUNCTIONS ---
        window.saveProgress = (immediate = false) => {
			// Always save to localStorage first (never fails)
			localStorage.setItem('kjv_v6_data', JSON.stringify(appData));
			localStorage.setItem('kjv_v6_progress', JSON.stringify(getProgress())); 
			
			// Try to save to Firebase if user is logged in
			if (currentUser) {
				if(immediate) {
					// Immediate save for plan changes - no debounce
					const userDocRef = doc(db, "users", currentUser.uid);
					setDoc(userDocRef, { appData: appData }, { merge: true })
						.then(() => {
							console.log('‚úÖ Saved immediately to Firebase');
						})
						.catch(err => {
							console.warn('‚ö†Ô∏è Firebase save failed (data saved locally):', err.message);
							// Update sync status to show warning
							if(syncStatus) {
								syncStatus.className = "flex items-center justify-center w-8 h-8 rounded-full bg-amber-50 text-amber-600 border border-amber-200";
								syncStatus.title = "‚ö†Ô∏è Sync Issue";
								syncStatus.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/><path d="M12 8v4M12 16h.01" stroke="white" stroke-width="2" stroke-linecap="round" fill="none"/></svg>';
							}
						});
				} else {
					// Debounced save for chapter toggles
					clearTimeout(saveTimeout);
					saveTimeout = setTimeout(() => {
						const userDocRef = doc(db, "users", currentUser.uid);
						setDoc(userDocRef, { appData: appData }, { merge: true })
							.then(() => {
								console.log('‚úÖ Saved to Firebase');
								if(syncStatus) {
									syncStatus.className = "flex items-center justify-center w-8 h-8 rounded-full bg-emerald-50 text-emerald-600 border border-emerald-200";
									syncStatus.title = "Cloud Synced";
									syncStatus.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/><path d="M9 16.2L5.5 12.7l1.4-1.4L9 13.4l4.1-4.1 1.4 1.4z" fill="white"/></svg>';
								}
							})
							.catch(err => {
								console.warn('‚ö†Ô∏è Firebase save failed (data saved locally):', err.message);
								if(syncStatus) {
									syncStatus.className = "flex items-center justify-center w-8 h-8 rounded-full bg-amber-50 text-amber-600 border border-amber-200";
									syncStatus.title = "‚ö†Ô∏è Sync Issue";
									syncStatus.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/><path d="M12 8v4M12 16h.01" stroke="white" stroke-width="2" stroke-linecap="round" fill="none"/></svg>';
								}
							});
					}, 1000);
				}
			}
			refreshUI();
		};

        // --- PROFILE MANAGEMENT ---
        window.toggleProfileMenu = () => {
            const menu = document.getElementById('profile-menu');
            menu.classList.toggle('hidden');
            if(!menu.classList.contains('hidden')) renderProfileList();
        };

        function renderProfileList() {
            const list = document.getElementById('profile-list');
            list.innerHTML = '';

            const allProfileNames = Object.keys(appData.profiles);
            const hasMultipleProfiles = allProfileNames.length > 1;

            // Hide "Default" profile from dropdown if other profiles exist
            const visibleProfiles = hasMultipleProfiles
                ? allProfileNames.filter(name => name !== 'Default')
                : allProfileNames;

            visibleProfiles.forEach(name => {
                const isActive = name === appData.activeProfileId;
                const color = stringToColor(name);

                const itemDiv = document.createElement('div');
                itemDiv.className = `flex items-center justify-between group/item px-3 py-2 rounded-xl hover:bg-slate-50 transition-colors ${isActive ? 'bg-indigo-50/50' : ''}`;

                const btn = document.createElement('button');
                btn.className = `text-left flex-1 text-sm font-bold ${isActive ? 'text-indigo-600' : 'text-slate-600'} flex items-center gap-2`;
                btn.onclick = () => window.switchProfile(name);

                const dot = document.createElement('div');
                dot.className = 'w-3 h-3 rounded-full profile-dot flex-shrink-0';
                dot.style.backgroundColor = color.solid;

                const nameSpan = document.createElement('span');
                nameSpan.className = 'truncate';
                nameSpan.textContent = name;

                btn.appendChild(dot);
                btn.appendChild(nameSpan);

                // Show "Active" badge for active profile
                if(isActive) {
                    const badge = document.createElement('span');
                    badge.className = 'ml-2 text-[8px] text-indigo-500 bg-indigo-100 px-2 py-0.5 rounded-full uppercase tracking-wider flex-shrink-0';
                    badge.textContent = 'Active';
                    btn.appendChild(badge);
                }

                // Show "Default" badge for default profile
                const isDefault = name === appData.defaultProfileId;
                if(isDefault && !isActive) {
                    const defaultBadge = document.createElement('span');
                    defaultBadge.className = 'ml-2 text-[8px] text-emerald-500 bg-emerald-100 px-2 py-0.5 rounded-full uppercase tracking-wider flex-shrink-0';
                    defaultBadge.textContent = 'Default';
                    btn.appendChild(defaultBadge);
                }

                // Show both badges if profile is both active and default
                if(isActive && isDefault) {
                    const defaultBadge = document.createElement('span');
                    defaultBadge.className = 'ml-2 text-[8px] text-emerald-500 bg-emerald-100 px-2 py-0.5 rounded-full uppercase tracking-wider flex-shrink-0';
                    defaultBadge.textContent = 'Default';
                    btn.appendChild(defaultBadge);
                }

                itemDiv.appendChild(btn);

                // Show rename button for all profiles
                const renameBtn = document.createElement('button');
                renameBtn.className = 'text-slate-300 hover:text-indigo-500 p-1 ml-1 opacity-0 group-hover/item:opacity-100 transition-opacity';
                renameBtn.onclick = () => window.renameProfile(name);
                renameBtn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>';
                renameBtn.title = 'Rename profile';
                itemDiv.appendChild(renameBtn);

                // Show "Set as Default" button for non-default profiles
                if(!isDefault) {
                    const setDefaultBtn = document.createElement('button');
                    setDefaultBtn.className = 'text-slate-300 hover:text-emerald-500 p-1 ml-1 opacity-0 group-hover/item:opacity-100 transition-opacity';
                    setDefaultBtn.onclick = () => window.setDefaultProfile(name);
                    setDefaultBtn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
                    setDefaultBtn.title = 'Set as default profile';
                    itemDiv.appendChild(setDefaultBtn);
                }

                // Show delete button for all non-active profiles
                if(!isActive) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'text-slate-300 hover:text-red-500 p-1 ml-1 opacity-0 group-hover/item:opacity-100 transition-opacity';
                    deleteBtn.onclick = () => window.deleteProfile(name);
                    deleteBtn.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>';
                    deleteBtn.title = 'Delete profile';
                    itemDiv.appendChild(deleteBtn);
                }

                list.appendChild(itemDiv);
            });
        }

        window.switchProfile = (name) => {
            userIsEditing = true;
            appData.activeProfileId = name;
            window.saveProgress(true); // Immediate save
            document.getElementById('profile-menu').classList.add('hidden');

            // Re-render current view to show new profile's data
            const viewChapters = document.getElementById('view-chapters');
            const viewBooks = document.getElementById('view-books');
            const viewStats = document.getElementById('view-stats');
            const viewPlan = document.getElementById('view-plan');

            if (!viewChapters.classList.contains('hidden')) {
                // In chapter view - update chapter checkboxes
                window.renderChapterGrid();
            } else if (!viewBooks.classList.contains('hidden')) {
                // In book grid view - update book grid and stats
                window.renderBookGrid();
                window.renderSubdivisionStats();
            } else if (!viewStats.classList.contains('hidden')) {
                // In stats view - update stats
                window.renderStatsPage();
            } else if (!viewPlan.classList.contains('hidden')) {
                // In plan view - update plan
                window.renderDailyPlan();
            }

            setTimeout(() => { userIsEditing = false; }, 2000);
        };

        window.createNewProfile = () => {
            const rawName = prompt("Enter new profile name (alphanumeric only, max 20 characters):\nExamples: Family, Kids, Personal2024");
            if(!rawName || rawName.trim() === "") return;
            
            const sanitized = sanitizeProfileName(rawName);
            
            if(sanitized === "") {
                alert("Profile name must contain at least one alphanumeric character.");
                return;
            }
            
            if(appData.profiles[sanitized]) { 
                alert(`Profile "${sanitized}" already exists!`); 
                return; 
            }
            
            if(Object.keys(appData.profiles).length >= 10) {
                alert("Maximum 10 profiles allowed.");
                return;
            }
            
            appData.profiles[sanitized] = {};
            appData.profilePlans[sanitized] = 'MCHEYNE';
            // Initialize hornerDailyProgress for new profile
            appData.hornerDailyProgress[sanitized] = {
                date: new Date().toISOString().split('T')[0],
                completedLists: []
            };
            // Initialize memorizedVerses for new profile
            if(!appData.memorizedVerses) appData.memorizedVerses = {};
            appData.memorizedVerses[sanitized] = [];
            window.switchProfile(sanitized);
        };

        window.deleteProfile = (name) => {
            if(name === appData.activeProfileId) {
                alert("‚ö†Ô∏è Cannot delete the active profile.\n\nPlease switch to another profile first.");
                return;
            }

            if(Object.keys(appData.profiles).length <= 1) {
                alert("‚ö†Ô∏è Cannot delete the last profile.\n\nYou must have at least one profile.");
                return;
            }

            const confirmMsg = `‚ö†Ô∏è DELETE PROFILE: "${name}"?\n\nThis will permanently delete:\n‚Ä¢ All reading progress\n‚Ä¢ Reading plan settings\n\nThis action CANNOT be undone.\n\nType the profile name to confirm:`;
            const userInput = prompt(confirmMsg);

            if(userInput === name) {
                delete appData.profiles[name];
                delete appData.profilePlans[name];
                delete appData.hornerDailyProgress[name];
                if(appData.memorizedVerses) delete appData.memorizedVerses[name];

                // If this was the default profile, set default to the active profile
                if(appData.defaultProfileId === name) {
                    appData.defaultProfileId = appData.activeProfileId;
                }

                // Clean up sync rules involving this profile
                if(appData.profileSyncRules) {
                    // Remove if this profile is a source
                    delete appData.profileSyncRules[name];

                    // Remove if this profile is a target
                    Object.keys(appData.profileSyncRules).forEach(sourceProfile => {
                        if(appData.profileSyncRules[sourceProfile] === name) {
                            delete appData.profileSyncRules[sourceProfile];
                        }
                    });
                }

                window.saveProgress(true); // Immediate save
                renderProfileList(); // Re-render the list
                alert(`‚úÖ Profile "${name}" has been deleted.`);
            } else if(userInput !== null) {
                alert("‚ùå Profile name did not match. Deletion cancelled.");
            }
        };

        window.renameProfile = (oldName) => {
            const rawName = prompt(`Enter new name for "${oldName}":\n(alphanumeric only, max 20 characters)`, oldName);
            if(!rawName || rawName.trim() === "") return;

            const newName = sanitizeProfileName(rawName);

            if(newName === "") {
                alert("Profile name must contain at least one alphanumeric character.");
                return;
            }

            if(newName === oldName) {
                return; // No change
            }

            if(appData.profiles[newName]) {
                alert(`Profile "${newName}" already exists!`);
                return;
            }

            // Rename the profile
            appData.profiles[newName] = appData.profiles[oldName];
            delete appData.profiles[oldName];

            // Rename in profilePlans if exists
            if(appData.profilePlans[oldName]) {
                appData.profilePlans[newName] = appData.profilePlans[oldName];
                delete appData.profilePlans[oldName];
            }

            // Update activeProfileId if this was the active profile
            if(appData.activeProfileId === oldName) {
                appData.activeProfileId = newName;
                currentProfileName.innerText = newName;
                updateProfileColor();
            }

            // Update defaultProfileId if this was the default profile
            if(appData.defaultProfileId === oldName) {
                appData.defaultProfileId = newName;
            }

            // Update sync rules if this profile is involved
            if(appData.profileSyncRules) {
                // Update if this profile is a source
                if(appData.profileSyncRules[oldName]) {
                    appData.profileSyncRules[newName] = appData.profileSyncRules[oldName];
                    delete appData.profileSyncRules[oldName];
                }

                // Update if this profile is a target
                Object.keys(appData.profileSyncRules).forEach(sourceProfile => {
                    if(appData.profileSyncRules[sourceProfile] === oldName) {
                        appData.profileSyncRules[sourceProfile] = newName;
                    }
                });
            }

            window.saveProgress(true); // Immediate save
            renderProfileList(); // Re-render the list
            alert(`‚úÖ Profile renamed from "${oldName}" to "${newName}".`);
        };

        window.setDefaultProfile = (name) => {
            if(!appData.profiles[name]) {
                alert("‚ö†Ô∏è Profile not found.");
                return;
            }

            appData.defaultProfileId = name;
            window.saveProgress(true); // Immediate save
            renderProfileList(); // Re-render the list
        };

        // --- PROFILE SYNC FUNCTIONS ---
        window.renderProfileSyncSettings = () => {
            const container = document.getElementById('advanced-settings-container');
            const rulesContainer = document.getElementById('profile-sync-rules');

            if(!container || !rulesContainer) return;

            const profileCount = Object.keys(appData.profiles).length;

            // Only show if there are 2+ profiles
            if(profileCount < 2) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';

            // Render existing sync rules
            rulesContainer.innerHTML = '';

            const syncRules = appData.profileSyncRules || {};
            const allProfileNames = Object.keys(appData.profiles).sort();

            if(Object.keys(syncRules).length === 0) {
                rulesContainer.innerHTML = '<p class="text-xs text-slate-400 italic p-4 text-center bg-slate-50 rounded-lg border border-slate-200">No sync rules configured. Click "Add Sync Rule" to create one.</p>';
                return;
            }

            Object.entries(syncRules).forEach(([sourceProfile, targetProfile]) => {
                // Skip if either profile no longer exists
                if(!appData.profiles[sourceProfile] || !appData.profiles[targetProfile]) {
                    delete appData.profileSyncRules[sourceProfile];
                    return;
                }

                const ruleDiv = document.createElement('div');
                ruleDiv.className = 'flex items-center justify-between p-4 rounded-xl bg-slate-50 border border-slate-200';

                const ruleText = document.createElement('div');
                ruleText.className = 'flex-1 flex items-center gap-2 text-sm';

                const sourceSpan = document.createElement('span');
                sourceSpan.className = 'font-bold text-slate-700';
                sourceSpan.textContent = sourceProfile;

                const arrow = document.createElement('span');
                arrow.className = 'text-indigo-500 font-black';
                arrow.innerHTML = '‚Üí';

                const targetSpan = document.createElement('span');
                targetSpan.className = 'font-bold text-indigo-600';
                targetSpan.textContent = targetProfile;

                ruleText.appendChild(sourceSpan);
                ruleText.appendChild(arrow);
                ruleText.appendChild(targetSpan);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-slate-400 hover:text-red-500 p-1 transition-colors';
                deleteBtn.onclick = () => window.removeProfileSyncRule(sourceProfile);
                deleteBtn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
                deleteBtn.title = 'Remove sync rule';

                ruleDiv.appendChild(ruleText);
                ruleDiv.appendChild(deleteBtn);
                rulesContainer.appendChild(ruleDiv);
            });
        };

        window.addProfileSyncRule = () => {
            const allProfileNames = Object.keys(appData.profiles).sort();
            const syncRules = appData.profileSyncRules || {};

            // Find profiles that don't already have a sync rule as source
            const availableSourceProfiles = allProfileNames.filter(name => !syncRules[name]);

            if(availableSourceProfiles.length === 0) {
                alert("‚ö†Ô∏è All profiles already have sync rules.\n\nEach profile can only be the source for one sync rule. Remove an existing rule to create a new one.");
                return;
            }

            let sourceProfile = availableSourceProfiles[0];
            if(availableSourceProfiles.length > 1) {
                const sourceMsg = "Select SOURCE profile (chapters marked here will sync):\n\n" +
                    availableSourceProfiles.map((name, i) => `${i + 1}. ${name}`).join('\n');
                const sourceInput = prompt(sourceMsg, '1');

                if(!sourceInput) return;

                const sourceIdx = parseInt(sourceInput) - 1;
                if(sourceIdx < 0 || sourceIdx >= availableSourceProfiles.length) {
                    alert("‚ùå Invalid selection.");
                    return;
                }
                sourceProfile = availableSourceProfiles[sourceIdx];
            }

            // Find profiles that can be targets (all except the source and existing targets)
            const existingTargets = Object.values(syncRules);
            const availableTargetProfiles = allProfileNames.filter(name =>
                name !== sourceProfile && !existingTargets.includes(name)
            );

            if(availableTargetProfiles.length === 0) {
                alert("‚ö†Ô∏è No available target profiles.\n\nAll other profiles are already targets of existing sync rules.");
                return;
            }

            let targetProfile = availableTargetProfiles[0];
            if(availableTargetProfiles.length > 1) {
                const targetMsg = `Select TARGET profile (will receive synced chapters from "${sourceProfile}"):\n\n` +
                    availableTargetProfiles.map((name, i) => `${i + 1}. ${name}`).join('\n');
                const targetInput = prompt(targetMsg, '1');

                if(!targetInput) return;

                const targetIdx = parseInt(targetInput) - 1;
                if(targetIdx < 0 || targetIdx >= availableTargetProfiles.length) {
                    alert("‚ùå Invalid selection.");
                    return;
                }
                targetProfile = availableTargetProfiles[targetIdx];
            }

            // Confirm the rule
            const confirmMsg = `Create sync rule?\n\n${sourceProfile} ‚Üí ${targetProfile}\n\nChapters marked in "${sourceProfile}" will automatically be marked in "${targetProfile}".`;
            if(!confirm(confirmMsg)) return;

            appData.profileSyncRules[sourceProfile] = targetProfile;
            window.saveProgress(true);
            window.renderProfileSyncSettings();
        };

        window.removeProfileSyncRule = (sourceProfile) => {
            const targetProfile = appData.profileSyncRules[sourceProfile];

            if(!confirm(`Remove sync rule?\n\n${sourceProfile} ‚Üí ${targetProfile}\n\nChapters will no longer sync automatically.`)) {
                return;
            }

            delete appData.profileSyncRules[sourceProfile];
            window.saveProgress(true);
            window.renderProfileSyncSettings();
        };

        document.addEventListener('click', (e) => {
            const menu = document.getElementById('profile-menu');
            const btn = document.getElementById('profile-menu-btn');
            if (menu && btn && !menu.contains(e.target) && !btn.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        window.changePlan = () => {
			userIsEditing = true; // Block cloud sync during edit
			
			// Get the NEW selected value from dropdown
			activePlan = document.getElementById('plan-selector').value;
			
			// Save it to appData immediately
			appData.profilePlans[appData.activeProfileId] = activePlan;
			
			console.log('üìù Plan changed to:', activePlan);
			
			// Save immediately (no debounce)
			window.saveProgress(true);
			
			// Re-render the daily plan
			window.renderDailyPlan();
			
			// Unblock cloud sync after 2 seconds
			setTimeout(() => {
				userIsEditing = false;
				console.log('‚úÖ Edit complete');
			}, 2000);
		};

        // --- CORE DATA ---
const bible = [{"name":"Genesis","testament":"OT","ch":[797,632,695,632,505,579,584,586,658,496,606,536,457,607,471,412,679,867,1108,498,775,629,539,1816,706,889,1262,621,829,1022,1417,794,508,790,664,845,942,819,666,580,1404,977,938,874,731,766,965,639,766,687]},{"name":"Exodus","testament":"OT","ch":[457,657,791,891,594,753,692,936,982,899,325,1493,675,931,713,1062,465,760,702,561,893,790,827,492,926,937,558,1235,1341,970,438,1092,710,1004,820,892,738,831,1030,821]},{"name":"Leviticus","testament":"OT","ch":[525,487,511,1157,723,892,1057,988,624,628,1115,262,1857,1713,919,1157,553,667,898,836,587,880,1222,551,1532,1246,956]},{"name":"Numbers","testament":"OT","ch":[1333,828,1291,1416,898,742,1939,687,722,891,1056,384,742,1180,1068,1341,335,1111,683,791,931,1201,743,660,445,1446,610,779,954,503,1208,1009,928,630,965,445]},{"name":"Deuteronomy","testament":"OT","ch":[1262,1021,815,1503,921,643,843,566,963,604,950,1055,627,707,707,710,707,611,608,646,731,894,685,681,562,667,599,2075,851,665,1041,1306,805,320]},{"name":"Joshua","testament":"OT","ch":[573,768,566,706,550,904,926,1221,800,1393,717,486,825,485,1032,253,660,770,944,308,1026,1321,574,1044]},{"name":"Judges","testament":"OT","ch":[962,692,842,761,755,1295,952,987,1667,473,1235,399,765,706,648,1110,385,1035,1102,1455,740]},{"name":"Ruth","testament":"OT","ch":[649,763,541,621]},{"name":"1 Samuel","testament":"OT","ch":[782,1104,549,733,439,752,510,541,990,862,503,771,697,1606,981,680,1719,845,696,1289,499,761,831,661,1452,849,385,835,421,956,348]},{"name":"2 Samuel","testament":"OT","ch":[712,911,1143,434,624,713,858,447,408,608,814,992,1148,1117,1118,738,935,1096,1473,848,778,951,878,855]},{"name":"1 Kings","testament":"OT","ch":[1499,1510,850,706,527,1018,1482,2139,826,839,1253,1038,1138,987,951,1035,680,1397,732,1480,908,1517]},{"name":"2 Kings","testament":"OT","ch":[669,848,848,1368,975,1019,824,953,1205,1203,738,688,775,881,1092,656,1245,1221,1148,660,747,712,1477,584,985]},{"name":"1 Chronicles","testament":"OT","ch":[683,846,347,852,664,1341,831,491,960,364,944,987,386,357,714,850,779,399,630,289,914,605,681,541,543,710,805,864,988]},{"name":"2 Chronicles","testament":"OT","ch":[530,645,481,595,497,1402,748,536,882,559,486,481,642,448,518,479,459,1051,352,1148,623,444,788,933,970,721,244,896,1157,869,757,1084,780,1223,900,741]},{"name":"Ezra","testament":"OT","ch":[371,998,547,769,583,778,863,990,617,924]},{"name":"Nehemiah","testament":"OT","ch":[390,718,896,716,636,602,1176,686,1328,652,788,930,962]},{"name":"Esther","testament":"OT","ch":[716,806,552,517,494,476,343,649,984,93]},{"name":"Job","testament":"OT","ch":[641,387,434,336,447,482,394,340,544,402,337,399,413,410,549,375,262,342,475,521,522,482,280,481,90,206,373,455,404,514,691,375,524,615,254,495,402,659,477,361,507,441]},{"name":"Psalms","testament":"OT","ch":[130,206,139,165,245,159,327,166,367,350,128,147,107,149,99,206,311,918,272,144,246,581,118,178,342,183,340,201,179,231,498,241,350,347,564,223,702,361,270,400,240,281,130,451,327,204,143,229,337,400,322,165,152,110,435,225,230,218,339,211,133,228,194,184,267,327,111,698,670,102,471,369,423,413,189,193,330,1225,277,334,288,116,273,226,207,312,113,296,879,320,288,258,92,356,199,226,189,170,157,86,173,455,342,598,632,762,685,206,534,142,177,172,142,106,274,287,33,465,2423,88,110,124,94,121,108,94,110,101,119,116,60,276,69,44,329,353,165,172,410,239,203,151,252,302,331,178,299,202,143,85]},{"name":"Proverbs","testament":"OT","ch":[519,309,541,418,354,546,411,562,288,527,524,476,400,572,544,543,476,381,506,498,501,495,566,580,522,459,460,528,425,640,467]},{"name":"Ecclesiastes","testament":"OT","ch":[380,734,517,380,533,301,618,515,555,402,273,372]},{"name":"Song of Solomon","testament":"OT","ch":[326,351,287,363,397,282,292,360]},{"name":"Isaiah","testament":"OT","ch":[758,568,587,210,863,366,693,558,599,928,519,134,576,856,266,415,428,255,730,169,417,675,469,592,381,550,405,814,742,1059,322,436,585,522,277,690,1131,592,268,796,804,676,711,886,774,342,471,627,867,365,771,405,387,493,399,361,569,522,591,665,380,362,538,308,753,811]},{"name":"Jeremiah","testament":"OT","ch":[528,1019,802,861,874,827,970,706,772,674,749,544,739,688,702,699,829,659,541,594,498,837,1186,361,1138,800,762,540,1005,717,1294,1432,842,824,657,1110,611,984,545,681,664,774,460,1228,152,821,215,1172,1180,1460,1853,1074]},{"name":"Lamentations","testament":"OT","ch":[758,883,876,598,296]},{"name":"Ezekiel","testament":"OT","ch":[870,273,809,519,628,470,768,655,400,659,721,799,738,746,205,1820,773,919,356,1601,945,840,1322,774,508,727,907,809,714,760,679,1077,1071,958,402,1180,870,776,928,1530,802,568,907,1031,882,880,780,1045]},{"name":"Daniel","testament":"OT","ch":[589,1500,992,1290,995,905,926,852,966,647,1530,411]},{"name":"Hosea","testament":"OT","ch":[355,678,156,465,368,254,398,330,468,425,308,311,426,232]},{"name":"Joel","testament":"OT","ch":[508,957,568]},{"name":"Amos","testament":"OT","ch":[455,441,397,432,658,399,471,414,549]},{"name":"Obadiah","testament":"OT","ch":[669]},{"name":"Jonah","testament":"OT","ch":[514,214,260,332]},{"name":"Micah","testament":"OT","ch":[452,400,354,476,447,440,583]},{"name":"Nahum","testament":"OT","ch":[394,371,519]},{"name":"Habakkuk","testament":"OT","ch":[423,563,489]},{"name":"Zephaniah","testament":"OT","ch":[555,463,598]},{"name":"Haggai","testament":"OT","ch":[451,679]},{"name":"Zechariah","testament":"OT","ch":[622,317,296,365,338,424,378,703,537,408,502,462,337,754]},{"name":"Malachi","testament":"OT","ch":[487,546,565,183]},{"name":"Matthew","testament":"NT","ch":[473,619,387,557,1081,794,626,773,837,919,668,1168,1367,721,785,688,620,869,719,779,1126,828,833,1047,995,1625,1359,421]},{"name":"Mark","testament":"NT","ch":[930,724,663,923,952,1323,806,842,1164,1218,778,1058,828,1595,913,449]},{"name":"Luke","testament":"NT","ch":[1583,1094,1017,1021,949,1229,1209,1431,1457,992,1331,1407,864,812,725,752,809,868,1047,954,820,1396,1117,1055]},{"name":"John","testament":"NT","ch":[1004,510,763,1094,1001,1506,1002,1307,876,820,1157,1060,826,731,613,789,636,947,1010,749,693]},{"name":"Acts","testament":"NT","ch":[661,1021,634,865,1026,355,1430,883,1046,1108,667,662,1273,627,925,943,855,664,975,882,1067,773,921,640,711,781,1033,818]},{"name":"Romans","testament":"NT","ch":[714,604,562,546,480,484,605,903,719,461,818,397,361,525,742,501]},{"name":"1 Corinthians","testament":"NT","ch":[649,373,459,509,321,465,959,309,671,667,718,593,270,887,1166,446]},{"name":"2 Corinthians","testament":"NT","ch":[591,401,389,406,487,357,452,568,355,437,718,589,315]},{"name":"Galatians","testament":"NT","ch":[453,573,648,610,447,353]},{"name":"Ephesians","testament":"NT","ch":[508,453,410,617,564,470]},{"name":"Philippians","testament":"NT","ch":[632,601,483,467]},{"name":"Colossians","testament":"NT","ch":[656,503,457,363]},{"name":"1 Thessalonians","testament":"NT","ch":[253,479,295,396,414]},{"name":"2 Thessalonians","testament":"NT","ch":[291,381,350]},{"name":"1 Timothy","testament":"NT","ch":[432,247,324,310,470,461]},{"name":"2 Timothy","testament":"NT","ch":[438,506,297,425]},{"name":"Titus","testament":"NT","ch":[337,265,294]},{"name":"Philemon","testament":"NT","ch":[430]},{"name":"Hebrews","testament":"NT","ch":[338,472,362,404,321,425,607,387,678,784,922,696,501]},{"name":"James","testament":"NT","ch":[544,528,378,369,485]},{"name":"1 Peter","testament":"NT","ch":[597,548,551,479,300]},{"name":"2 Peter","testament":"NT","ch":[488,581,484]},{"name":"1 John","testament":"NT","ch":[247,735,534,480,520]},{"name":"2 John","testament":"NT","ch":[298]},{"name":"3 John","testament":"NT","ch":[295]},{"name":"Jude","testament":"NT","ch":[608]},{"name":"Revelation","testament":"NT","ch":[592,802,658,348,435,540,491,397,592,353,580,497,538,651,252,567,522,747,634,477,749,573]}];
		// --- READING PLANS ---
        const PLAN_HORNER = [
            ["Matthew", "Mark", "Luke", "John"],
            ["Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy"],
            ["Romans", "1 Corinthians", "2 Corinthians", "Galatians", "Ephesians", "Philippians", "Colossians", "Hebrews"],
            ["1 Thessalonians", "2 Thessalonians", "1 Timothy", "2 Timothy", "Titus", "Philemon", "James", "1 Peter", "2 Peter", "1 John", "2 John", "3 John", "Jude", "Revelation"],
            ["Job", "Ecclesiastes", "Song of Solomon"],
            ["Psalms"],
            ["Proverbs"],
            ["Joshua", "Judges", "Ruth", "1 Samuel", "2 Samuel", "1 Kings", "2 Kings", "1 Chronicles", "2 Chronicles", "Ezra", "Nehemiah", "Esther"],
            ["Isaiah", "Jeremiah", "Lamentations", "Ezekiel", "Daniel", "Hosea", "Joel", "Amos", "Obadiah", "Jonah", "Micah", "Nahum", "Habakkuk", "Zephaniah", "Haggai", "Zechariah", "Malachi"],
            ["Acts"]
        ];

        // Five-Day Plan Data (from fivedayplan.json)
        const PLAN_FIVE_DAY = {"program_name":"The Five Day Bible Reading Program","year":2026,"description":"A schedule to read the entire Bible (or just the New Testament) in one year by reading five times a week. The Old Testament is ordered chronologically, and the New Testament is spaced throughout the year.","schedule":[{"week_number":1,"date_range":"Dec 28 - Jan 3","readings":[{"day":1,"scriptures":["Genesis 1-2","Psalm 19","Mark 1"]},{"day":2,"scriptures":["Genesis 3-5","Mark 2"]},{"day":3,"scriptures":["Genesis 6-8","Psalm 104","Mark 3"]},{"day":4,"scriptures":["Genesis 9-11","Mark 4"]},{"day":5,"scriptures":["Genesis 12-15","Psalm 148","Mark 5"]}]},{"week_number":2,"date_range":"Jan 4 - 10","readings":[{"day":1,"scriptures":["Genesis 16-18","Mark 6"]},{"day":2,"scriptures":["Genesis 19-20","Psalm 1","Mark 7"]},{"day":3,"scriptures":["Genesis 21-23","Psalm 107","Mark 8"]},{"day":4,"scriptures":["Genesis 24-25","Psalm 4","Mark 9"]},{"day":5,"scriptures":["Genesis 26-27","Mark 10"]}]},{"week_number":3,"date_range":"Jan 11 - 17","readings":[{"day":1,"scriptures":["Genesis 28-29","Mark 11"]},{"day":2,"scriptures":["Genesis 30-31","Psalm 11","Mark 12"]},{"day":3,"scriptures":["Genesis 32-34","Psalm 145","Mark 13"]},{"day":4,"scriptures":["Genesis 35-37","Psalm 12","Mark 14"]},{"day":5,"scriptures":["Genesis 38-40","Mark 15"]}]},{"week_number":4,"date_range":"Jan 18 - 24","readings":[{"day":1,"scriptures":["Genesis 41-42","Mark 16"]},{"day":2,"scriptures":["Genesis 43-44","Psalm 24","Galatians 1"]},{"day":3,"scriptures":["Genesis 45-46","Psalm 108","Galatians 2"]},{"day":4,"scriptures":["Genesis 47-48","Psalm 25","Galatians 3"]},{"day":5,"scriptures":["Genesis 49-50","Galatians 4"]}]},{"week_number":5,"date_range":"Jan 25 - 31","readings":[{"day":1,"scriptures":["Exodus 1-3","Galatians 5"]},{"day":2,"scriptures":["Exodus 4-6","Galatians 6"]},{"day":3,"scriptures":["Exodus 7-9","Psalm 105","Ephesians 1"]},{"day":4,"scriptures":["Exodus 10-12","Ephesians 2"]},{"day":5,"scriptures":["Exodus 13-15","Psalm 114","Ephesians 3"]}]},{"week_number":6,"date_range":"Feb 1 - 7","readings":[{"day":1,"scriptures":["Exodus 16-18","Ephesians 4"]},{"day":2,"scriptures":["Exodus 19-21","Psalm 33","Ephesians 5"]},{"day":3,"scriptures":["Exodus 22-24","Psalm 109","Ephesians 6"]},{"day":4,"scriptures":["Exodus 25-27","Psalm 90","Philippians 1"]},{"day":5,"scriptures":["Exodus 28-31","Philippians 2"]}]},{"week_number":7,"date_range":"Feb 8 - 14","readings":[{"day":1,"scriptures":["Exodus 32-34","Philippians 3"]},{"day":2,"scriptures":["Exodus 35-37","Psalm 26","Philippians 4"]},{"day":3,"scriptures":["Exodus 38-40","Hebrews 1"]},{"day":4,"scriptures":["Leviticus 1-3","Psalm 27","Hebrews 2"]},{"day":5,"scriptures":["Leviticus 4-7","Hebrews 3"]}]},{"week_number":8,"date_range":"Feb 15 - 21","readings":[{"day":1,"scriptures":["Leviticus 8-11","Psalm 110","Hebrews 4"]},{"day":2,"scriptures":["Leviticus 12-14","Psalm 111","Hebrews 5"]},{"day":3,"scriptures":["Leviticus 15-18","Psalm 31","Hebrews 6"]},{"day":4,"scriptures":["Leviticus 19-20","Hebrews 7"]},{"day":5,"scriptures":["Leviticus 21-23","Hebrews 8"]}]},{"week_number":9,"date_range":"Feb 22 - 28","readings":[{"day":1,"scriptures":["Leviticus 24-25","Psalm 81","Hebrews 9"]},{"day":2,"scriptures":["Leviticus 26-27","Psalm 112","Hebrews 10"]},{"day":3,"scriptures":["Numbers 1-2","Psalm 64","Hebrews 11"]},{"day":4,"scriptures":["Numbers 3-5","Hebrews 12"]},{"day":5,"scriptures":["Numbers 6-7","Hebrews 13"]}]},{"week_number":10,"date_range":"Mar 1 - 7","readings":[{"day":1,"scriptures":["Numbers 8-11","Colossians 1"]},{"day":2,"scriptures":["Numbers 12-14","Psalm 28","Colossians 2"]},{"day":3,"scriptures":["Numbers 15-18","Psalm 113","Colossians 3"]},{"day":4,"scriptures":["Numbers 19-21","Colossians 4"]},{"day":5,"scriptures":["Numbers 22-25","Luke 1"]}]},{"week_number":11,"date_range":"Mar 8 - 14","readings":[{"day":1,"scriptures":["Numbers 26-29","Luke 2"]},{"day":2,"scriptures":["Numbers 30-33","Psalm 35","Luke 3"]},{"day":3,"scriptures":["Numbers 34-36","Luke 4"]},{"day":4,"scriptures":["Deuteronomy 1-3","Psalm 36","Luke 5"]},{"day":5,"scriptures":["Deuteronomy 4-5","Luke 6"]}]},{"week_number":12,"date_range":"Mar 15 - 21","readings":[{"day":1,"scriptures":["Deuteronomy 6-9","Luke 7"]},{"day":2,"scriptures":["Deuteronomy 10-14","Psalm 5","Luke 8"]},{"day":3,"scriptures":["Deuteronomy 15-18","Psalm 115","Luke 9"]},{"day":4,"scriptures":["Deuteronomy 19-22","Psalm 6","Luke 10"]},{"day":5,"scriptures":["Deuteronomy 23-26","Luke 11"]}]},{"week_number":13,"date_range":"Mar 22 - 28","readings":[{"day":1,"scriptures":["Deuteronomy 27-31","Luke 12"]},{"day":2,"scriptures":["Deuteronomy 32-34","Psalm 13","Luke 13"]},{"day":3,"scriptures":["Joshua 1-4","Psalm 143","Luke 14"]},{"day":4,"scriptures":["Joshua 5-8","Psalm 14","Luke 15"]},{"day":5,"scriptures":["Joshua 9-13","Luke 16"]}]},{"week_number":14,"date_range":"Mar 29 - Apr 4","readings":[{"day":1,"scriptures":["Joshua 14-17","Luke 17"]},{"day":2,"scriptures":["Joshua 18-21","Psalm 15","Luke 18"]},{"day":3,"scriptures":["Joshua 22-24","Psalm 116","Luke 19"]},{"day":4,"scriptures":["Judges 1-3","Psalm 16","Luke 20"]},{"day":5,"scriptures":["Judges 4-6","Luke 21"]}]},{"week_number":15,"date_range":"Apr 5 - 11","readings":[{"day":1,"scriptures":["Judges 7-8","Luke 22"]},{"day":2,"scriptures":["Judges 9-11","Psalm 17","Luke 23"]},{"day":3,"scriptures":["Judges 12-16","Psalm 146","Luke 24"]},{"day":4,"scriptures":["Judges 17-18","Psalm 21","Acts 1"]},{"day":5,"scriptures":["Judges 19-21","Acts 2"]}]},{"week_number":16,"date_range":"Apr 12 - 18","readings":[{"day":1,"scriptures":["Ruth 1-2","Acts 3"]},{"day":2,"scriptures":["Ruth 3-4","Psalm 37","Acts 4"]},{"day":3,"scriptures":["1 Samuel 1-2","Psalm 120","Acts 5"]},{"day":4,"scriptures":["1 Samuel 3-5","Psalm 23","Acts 6"]},{"day":5,"scriptures":["1 Samuel 6-8","Acts 7"]}]},{"week_number":17,"date_range":"Apr 19 - 25","readings":[{"day":1,"scriptures":["1 Samuel 9-10","Acts 8"]},{"day":2,"scriptures":["1 Samuel 11-13","Psalm 38","Acts 9"]},{"day":3,"scriptures":["1 Samuel 14","Psalm 124","Acts 10"]},{"day":4,"scriptures":["1 Samuel 15-16","1 Chronicles 1","Psalm 39","Acts 11"]},{"day":5,"scriptures":["1 Samuel 17","1 Chronicles 2","Acts 12"]}]},{"week_number":18,"date_range":"Apr 26 - May 2","readings":[{"day":1,"scriptures":["1 Samuel 18-19","1 Chronicles 3","Psalm 59","Acts 13"]},{"day":2,"scriptures":["1 Samuel 20","1 Chronicles 4","Psalm 56","Psalm 57","Psalm 142","Acts 14"]},{"day":3,"scriptures":["1 Samuel 21-22","1 Chronicles 5","Psalm 52","Acts 15"]},{"day":4,"scriptures":["1 Samuel 23-24","1 Chronicles 6","Psalm 54","Acts 16"]},{"day":5,"scriptures":["1 Samuel 25","1 Chronicles 7","Acts 17"]}]},{"week_number":19,"date_range":"May 3 - 9","readings":[{"day":1,"scriptures":["1 Samuel 26-27","1 Chronicles 8","Acts 18"]},{"day":2,"scriptures":["1 Samuel 28-29","1 Chronicles 9","Acts 19"]},{"day":3,"scriptures":["1 Samuel 30-31","1 Chronicles 10","Acts 20"]},{"day":4,"scriptures":["2 Samuel 1-2","1 Chronicles 11","Psalm 96","Psalm 106","Acts 21"]},{"day":5,"scriptures":["2 Samuel 3-5","1 Chronicles 12","Psalm 122","Acts 22"]}]},{"week_number":20,"date_range":"May 10 - 16","readings":[{"day":1,"scriptures":["2 Samuel 6","1 Chronicles 13","Psalm 60","Acts 23"]},{"day":2,"scriptures":["1 Chronicles 14-16","Acts 24"]},{"day":3,"scriptures":["2 Samuel 7-8","1 Chronicles 17","Psalm 132","Acts 25"]},{"day":4,"scriptures":["2 Samuel 9-10","1 Chronicles 18-19","Psalm 89","Acts 26"]},{"day":5,"scriptures":["2 Samuel 11-12","1 Chronicles 20","Psalm 51","Psalm 32","Acts 27"]}]},{"week_number":21,"date_range":"May 17 - 23","readings":[{"day":1,"scriptures":["2 Samuel 13-14","Acts 28"]},{"day":2,"scriptures":["2 Samuel 15-17","Psalm 3","Psalm 63","Romans 1"]},{"day":3,"scriptures":["2 Samuel 18-20","Psalm 34","Romans 2"]},{"day":4,"scriptures":["2 Samuel 21-23","Psalm 18","Romans 3"]},{"day":5,"scriptures":["2 Samuel 24","1 Chronicles 21","Romans 4"]}]},{"week_number":22,"date_range":"May 24 - 30","readings":[{"day":1,"scriptures":["1 Chronicles 22-25","Psalm 78","Romans 5"]},{"day":2,"scriptures":["1 Kings 1","1 Chronicles 26-28","Romans 6"]},{"day":3,"scriptures":["1 Kings 2","1 Chronicles 29","Romans 7"]},{"day":4,"scriptures":["1 Kings 3","2 Chronicles 1","Psalm 42","Romans 8"]},{"day":5,"scriptures":["1 Kings 4","Proverbs 1-2","Psalm 43","Romans 9"]}]},{"week_number":23,"date_range":"May 31 - Jun 6","readings":[{"day":1,"scriptures":["Proverbs 3-5","Romans 10"]},{"day":2,"scriptures":["Proverbs 6-7","Psalm 7","Romans 11"]},{"day":3,"scriptures":["Proverbs 8-10","Psalm 144","Romans 12"]},{"day":4,"scriptures":["Proverbs 11-13","Psalm 8","Romans 13"]},{"day":5,"scriptures":["Proverbs 14-15","Romans 14"]}]},{"week_number":24,"date_range":"Jun 7 - 13","readings":[{"day":1,"scriptures":["Proverbs 16-18","Romans 15"]},{"day":2,"scriptures":["Proverbs 19-21","Psalm 40","Romans 16"]},{"day":3,"scriptures":["Proverbs 22-23","Psalm 117","1 Thessalonians 1"]},{"day":4,"scriptures":["Proverbs 24-25","Psalm 41","1 Thessalonians 2"]},{"day":5,"scriptures":["Proverbs 26-28","1 Thessalonians 3"]}]},{"week_number":25,"date_range":"Jun 14 - 20","readings":[{"day":1,"scriptures":["Proverbs 29-31","1 Thessalonians 4"]},{"day":2,"scriptures":["Song of Solomon 1-3","Psalm 72","1 Thessalonians 5"]},{"day":3,"scriptures":["Song of Solomon 4-6","2 Thessalonians 1"]},{"day":4,"scriptures":["Song of Solomon 7-8","Psalm 127","2 Thessalonians 2"]},{"day":5,"scriptures":["1 Kings 5","2 Chronicles 2","2 Thessalonians 3"]}]},{"week_number":26,"date_range":"Jun 21 - 27","readings":[{"day":1,"scriptures":["1 Kings 6","2 Chronicles 3","1 Timothy 1"]},{"day":2,"scriptures":["1 Kings 7","2 Chronicles 4","Psalm 44","1 Timothy 2"]},{"day":3,"scriptures":["1 Kings 8","Psalm 30","1 Timothy 3"]},{"day":4,"scriptures":["2 Chronicles 5-7","Psalm 121","1 Timothy 4"]},{"day":5,"scriptures":["1 Kings 9","2 Chronicles 8","1 Timothy 5"]}]},{"week_number":27,"date_range":"Jun 28 - Jul 4","readings":[{"day":1,"scriptures":["1 Kings 10-11","2 Chronicles 9","1 Timothy 6"]},{"day":2,"scriptures":["Ecclesiastes 1-3","Psalm 45","2 Timothy 1"]},{"day":3,"scriptures":["Ecclesiastes 4-6","Psalm 125","2 Timothy 2"]},{"day":4,"scriptures":["Ecclesiastes 7-9","Psalm 46","2 Timothy 3"]},{"day":5,"scriptures":["Ecclesiastes 10-12","2 Timothy 4"]}]},{"week_number":28,"date_range":"Jul 5 - 11","readings":[{"day":1,"scriptures":["1 Kings 12","2 Chronicles 10-11","Titus 1"]},{"day":2,"scriptures":["1 Kings 13-14","2 Chronicles 12","Psalm 47","Titus 2"]},{"day":3,"scriptures":["1 Kings 15","2 Chronicles 13-14","Titus 3"]},{"day":4,"scriptures":["2 Chronicles 15-16","1 Kings 16","Philemon"]},{"day":5,"scriptures":["1 Kings 17-18","Psalm 119","Jude"]}]},{"week_number":29,"date_range":"Jul 12 - 18","readings":[{"day":1,"scriptures":["1 Kings 19-21","2 Chronicles 17","Psalm 129","Matthew 1"]},{"day":2,"scriptures":["1 Kings 22","2 Chronicles 18","Matthew 2"]},{"day":3,"scriptures":["2 Chronicles 19-20","2 Kings 1","Psalm 20","Matthew 3"]},{"day":4,"scriptures":["2 Kings 2-3","Psalm 48","Matthew 4"]},{"day":5,"scriptures":["2 Kings 4-6","Matthew 5"]}]},{"week_number":30,"date_range":"Jul 19 - 25","readings":[{"day":1,"scriptures":["2 Kings 7-8","2 Chronicles 21","Matthew 6"]},{"day":2,"scriptures":["2 Kings 9-10","Psalm 49","Matthew 7"]},{"day":3,"scriptures":["2 Chronicles 22-23","2 Kings 11","Psalm 131","Matthew 8"]},{"day":4,"scriptures":["2 Chronicles 24","2 Kings 12","Psalm 50","Matthew 9"]},{"day":5,"scriptures":["Joel 1-3","Matthew 10"]}]},{"week_number":31,"date_range":"Jul 26 - Aug 1","readings":[{"day":1,"scriptures":["Jonah 1-4","Matthew 11"]},{"day":2,"scriptures":["2 Kings 13-14","2 Chronicles 25","Psalm 53","Matthew 12"]},{"day":3,"scriptures":["Amos 1-3","Matthew 13"]},{"day":4,"scriptures":["Amos 4-6","Psalm 55","Matthew 14"]},{"day":5,"scriptures":["Amos 7-9","Matthew 15"]}]},{"week_number":32,"date_range":"Aug 2 - 8","readings":[{"day":1,"scriptures":["Hosea 1-3","Matthew 16"]},{"day":2,"scriptures":["Hosea 4-6","Psalm 58","Matthew 17"]},{"day":3,"scriptures":["Hosea 7-10","Matthew 18"]},{"day":4,"scriptures":["Hosea 11-13","Matthew 19"]},{"day":5,"scriptures":["Hosea 14","2 Chronicles 26-27","Psalm 61","Matthew 20"]}]},{"week_number":33,"date_range":"Aug 9 - 15","readings":[{"day":1,"scriptures":["2 Kings 15-16","Matthew 21"]},{"day":2,"scriptures":["Isaiah 1-3","Psalm 9","Matthew 22"]},{"day":3,"scriptures":["Isaiah 4-6","Matthew 23"]},{"day":4,"scriptures":["Micah 1-4","Psalm 10","Matthew 24"]},{"day":5,"scriptures":["Micah 5-7","Matthew 25"]}]},{"week_number":34,"date_range":"Aug 16 - 22","readings":[{"day":1,"scriptures":["Isaiah 7-10","Psalm 22","Matthew 26"]},{"day":2,"scriptures":["Isaiah 11-13","Psalm 118","Matthew 27"]},{"day":3,"scriptures":["Isaiah 14-16","Matthew 28"]},{"day":4,"scriptures":["Isaiah 17-19","Psalm 62","1 Corinthians 1"]},{"day":5,"scriptures":["Isaiah 20-22","1 Corinthians 2"]}]},{"week_number":35,"date_range":"Aug 23 - 29","readings":[{"day":1,"scriptures":["Isaiah 23-25","1 Corinthians 3"]},{"day":2,"scriptures":["Isaiah 26-29","Psalm 65","1 Corinthians 4"]},{"day":3,"scriptures":["Isaiah 30-32","1 Corinthians 5"]},{"day":4,"scriptures":["Isaiah 33-35","1 Corinthians 6"]},{"day":5,"scriptures":["2 Chronicles 28","2 Kings 17","Psalm 66","1 Corinthians 7"]}]},{"week_number":36,"date_range":"Aug 30 - Sep 5","readings":[{"day":1,"scriptures":["2 Chronicles 29-31","1 Corinthians 8"]},{"day":2,"scriptures":["2 Kings 18-19","2 Chronicles 32","Psalm 67","1 Corinthians 9"]},{"day":3,"scriptures":["Isaiah 36-37","Psalm 123","1 Corinthians 10"]},{"day":4,"scriptures":["2 Kings 20","Isaiah 38-40","Psalm 68","1 Corinthians 11"]},{"day":5,"scriptures":["Isaiah 41-44","1 Corinthians 12"]}]},{"week_number":37,"date_range":"Sep 6 - 12","readings":[{"day":1,"scriptures":["Isaiah 45-48","1 Corinthians 13"]},{"day":2,"scriptures":["Isaiah 49-52","Psalm 69","1 Corinthians 14"]},{"day":3,"scriptures":["Isaiah 53-55","Psalm 128","1 Corinthians 15"]},{"day":4,"scriptures":["Isaiah 56-59","Psalm 70","1 Corinthians 16"]},{"day":5,"scriptures":["Isaiah 60-63","2 Corinthians 1"]}]},{"week_number":38,"date_range":"Sep 13 - 19","readings":[{"day":1,"scriptures":["Isaiah 64-66","2 Corinthians 2"]},{"day":2,"scriptures":["2 Kings 21","2 Chronicles 33","Psalm 71","2 Corinthians 3"]},{"day":3,"scriptures":["Nahum 1-3","Psalm 149","2 Corinthians 4"]},{"day":4,"scriptures":["2 Kings 22-23","Psalm 73","2 Corinthians 5"]},{"day":5,"scriptures":["2 Chronicles 34-35","2 Corinthians 6"]}]},{"week_number":39,"date_range":"Sep 20 - 26","readings":[{"day":1,"scriptures":["Habakkuk 1-3","2 Corinthians 7"]},{"day":2,"scriptures":["Zephaniah 1-3","Psalm 74","2 Corinthians 8"]},{"day":3,"scriptures":["Jeremiah 1-4","Psalm 130","2 Corinthians 9"]},{"day":4,"scriptures":["Jeremiah 5-7","Psalm 75","2 Corinthians 10"]},{"day":5,"scriptures":["Jeremiah 8-10","2 Corinthians 11"]}]},{"week_number":40,"date_range":"Sep 27 - Oct 3","readings":[{"day":1,"scriptures":["Jeremiah 11-13","2 Corinthians 12"]},{"day":2,"scriptures":["Jeremiah 14-16","Psalm 76","2 Corinthians 13"]},{"day":3,"scriptures":["Jeremiah 17-20","James 1"]},{"day":4,"scriptures":["Jeremiah 22","Jeremiah 23","Jeremiah 26","Psalm 77","James 2"]},{"day":5,"scriptures":["Jeremiah 25","Jeremiah 35","Jeremiah 36","Jeremiah 45","Psalm 133","James 3"]}]},{"week_number":41,"date_range":"Oct 4 - 10","readings":[{"day":1,"scriptures":["Jeremiah 27","Jeremiah 28","Jeremiah 29","Jeremiah 24","James 4"]},{"day":2,"scriptures":["Jeremiah 37","Jeremiah 21","Jeremiah 34","Psalm 79","James 5"]},{"day":3,"scriptures":["Jeremiah 30-33","1 Peter 1"]},{"day":4,"scriptures":["Jeremiah 38","Jeremiah 39","Jeremiah 52","1 Peter 2"]},{"day":5,"scriptures":["2 Kings 24-25","2 Chronicles 36","Psalm 126","1 Peter 3"]}]},{"week_number":42,"date_range":"Oct 11 - 17","readings":[{"day":1,"scriptures":["Lamentations 1-5","Psalm 137","1 Peter 4"]},{"day":2,"scriptures":["Obadiah","Jeremiah 40-42","Psalm 147","1 Peter 5"]},{"day":3,"scriptures":["Jeremiah 43","Jeremiah 44","Jeremiah 46","2 Peter 1"]},{"day":4,"scriptures":["Jeremiah 47","Jeremiah 48","Jeremiah 49","Psalm 80","2 Peter 2"]},{"day":5,"scriptures":["Jeremiah 50-51","2 Peter 3"]}]},{"week_number":43,"date_range":"Oct 18 - 24","readings":[{"day":1,"scriptures":["Ezekiel 1-3","John 1"]},{"day":2,"scriptures":["Ezekiel 4-6","Psalm 82","John 2"]},{"day":3,"scriptures":["Ezekiel 7-9","John 3"]},{"day":4,"scriptures":["Ezekiel 10-12","Psalm 83","John 4"]},{"day":5,"scriptures":["Ezekiel 13-15","Psalm 136","John 5"]}]},{"week_number":44,"date_range":"Oct 25 - 31","readings":[{"day":1,"scriptures":["Ezekiel 16-18","John 6"]},{"day":2,"scriptures":["Ezekiel 19-21","Psalm 84","John 7"]},{"day":3,"scriptures":["Ezekiel 22-24","Psalm 134","John 8"]},{"day":4,"scriptures":["Ezekiel 25-27","Psalm 85","John 9"]},{"day":5,"scriptures":["Ezekiel 28-30","John 10"]}]},{"week_number":45,"date_range":"Nov 1 - 7","readings":[{"day":1,"scriptures":["Ezekiel 31-33","John 11"]},{"day":2,"scriptures":["Ezekiel 34-36","Psalm 86","John 12"]},{"day":3,"scriptures":["Ezekiel 37-39","Psalm 87","John 13"]},{"day":4,"scriptures":["Ezekiel 40-42","John 14"]},{"day":5,"scriptures":["Ezekiel 43-45","Psalm 135","John 15"]}]},{"week_number":46,"date_range":"Nov 8 - 14","readings":[{"day":1,"scriptures":["Ezekiel 46-48","John 16"]},{"day":2,"scriptures":["Daniel 1-3","Psalm 88","John 17"]},{"day":3,"scriptures":["Daniel 4-6","John 18"]},{"day":4,"scriptures":["Daniel 7-9","Psalm 91","John 19"]},{"day":5,"scriptures":["Daniel 10-12","John 20"]}]},{"week_number":47,"date_range":"Nov 15 - 21","readings":[{"day":1,"scriptures":["Ezra 1-2","John 21"]},{"day":2,"scriptures":["Ezra 3-4","Psalm 92","1 John 1"]},{"day":3,"scriptures":["Haggai","Zechariah 1","Psalm 138","1 John 2"]},{"day":4,"scriptures":["Zechariah 2-5","Psalm 93","1 John 3"]},{"day":5,"scriptures":["Zechariah 6-8","1 John 4"]}]},{"week_number":48,"date_range":"Nov 22 - 28","readings":[{"day":1,"scriptures":["Zechariah 9-11","1 John 5"]},{"day":2,"scriptures":["Zechariah 12-14","Psalm 94","2 John"]},{"day":3,"scriptures":["Ezra 5-6","Psalm 95","3 John"]},{"day":4,"scriptures":["Esther 1-3","Psalm 139","Revelation 1"]},{"day":5,"scriptures":["Esther 4-6","Revelation 2"]}]},{"week_number":49,"date_range":"Nov 29 - Dec 5","readings":[{"day":1,"scriptures":["Esther 7-10","Revelation 3"]},{"day":2,"scriptures":["Ezra 7-10","Psalm 97","Revelation 4"]},{"day":3,"scriptures":["Nehemiah 1-3","Revelation 5"]},{"day":4,"scriptures":["Nehemiah 4-6","Psalm 98","Revelation 6"]},{"day":5,"scriptures":["Nehemiah 7-9","Psalm 140","Revelation 7"]}]},{"week_number":50,"date_range":"Dec 6 - 12","readings":[{"day":1,"scriptures":["Nehemiah 10-13","Revelation 8"]},{"day":2,"scriptures":["Malachi","Psalm 2","Revelation 9"]},{"day":3,"scriptures":["Job 1-3","Psalm 29","Revelation 10"]},{"day":4,"scriptures":["Job 4-7","Psalm 99","Revelation 11"]},{"day":5,"scriptures":["Job 8-11","Revelation 12"]}]},{"week_number":51,"date_range":"Dec 13 - 19","readings":[{"day":1,"scriptures":["Job 12-14","Psalm 100","Revelation 13"]},{"day":2,"scriptures":["Job 15-17","Revelation 14"]},{"day":3,"scriptures":["Job 18-20","Psalm 141","Revelation 15"]},{"day":4,"scriptures":["Job 21-23","Psalm 101","Revelation 16"]},{"day":5,"scriptures":["Job 24-27","Revelation 17"]}]},{"week_number":52,"date_range":"Dec 20 - 26","readings":[{"day":1,"scriptures":["Job 28-30","Revelation 18"]},{"day":2,"scriptures":["Job 31-33","Psalm 102","Revelation 19"]},{"day":3,"scriptures":["Job 34-36","Revelation 20"]},{"day":4,"scriptures":["Job 37-39","Psalm 103","Revelation 21"]},{"day":5,"scriptures":["Job 40-42","Psalm 150","Revelation 22"]}]}]};

        // M'Cheyne Data (Minified)
        const PLAN_MCHEYNE=[{d:1,r:["Genesis 1","Matthew 1","Ezra 1","Acts 1"]},{d:2,r:["Genesis 2","Matthew 2","Ezra 2","Acts 2"]},{d:3,r:["Genesis 3","Matthew 3","Ezra 3","Acts 3"]},{d:4,r:["Genesis 4","Matthew 4","Ezra 4","Acts 4"]},{d:5,r:["Genesis 5","Matthew 5","Ezra 5","Acts 5"]},{d:6,r:["Genesis 6","Matthew 6","Ezra 6","Acts 6"]},{d:7,r:["Genesis 7","Matthew 7","Ezra 7","Acts 7"]},{d:8,r:["Genesis 8","Matthew 8","Ezra 8","Acts 8"]},{d:9,r:["Genesis 9-10","Matthew 9","Ezra 9","Acts 9"]},{d:10,r:["Genesis 11","Matthew 10","Ezra 10","Acts 10"]},{d:11,r:["Genesis 12","Matthew 11","Nehemiah 1","Acts 11"]},{d:12,r:["Genesis 13","Matthew 12","Nehemiah 2","Acts 12"]},{d:13,r:["Genesis 14","Matthew 13","Nehemiah 3","Acts 13"]},{d:14,r:["Genesis 15","Matthew 14","Nehemiah 4","Acts 14"]},{d:15,r:["Genesis 16","Matthew 15","Nehemiah 5","Acts 15"]},{d:16,r:["Genesis 17","Matthew 16","Nehemiah 6","Acts 16"]},{d:17,r:["Genesis 18","Matthew 17","Nehemiah 7","Acts 17"]},{d:18,r:["Genesis 19","Matthew 18","Nehemiah 8","Acts 18"]},{d:19,r:["Genesis 20","Matthew 19","Nehemiah 9","Acts 19"]},{d:20,r:["Genesis 21","Matthew 20","Nehemiah 10","Acts 20"]},{d:21,r:["Genesis 22","Matthew 21","Nehemiah 11","Acts 21"]},{d:22,r:["Genesis 23","Matthew 22","Nehemiah 12","Acts 22"]},{d:23,r:["Genesis 24","Matthew 23","Nehemiah 13","Acts 23"]},{d:24,r:["Genesis 25","Matthew 24","Esther 1","Acts 24"]},{d:25,r:["Genesis 26","Matthew 25","Esther 2","Acts 25"]},{d:26,r:["Genesis 27","Matthew 26","Esther 3","Acts 26"]},{d:27,r:["Genesis 28","Matthew 27","Esther 4","Acts 27"]},{d:28,r:["Genesis 29","Matthew 28","Esther 5","Acts 28"]},{d:29,r:["Genesis 30","Mark 1","Esther 6","Romans 1"]},{d:30,r:["Genesis 31","Mark 2","Esther 7","Romans 2"]},{d:31,r:["Genesis 32","Mark 3","Esther 8","Romans 3"]},{d:32,r:["Genesis 33","Mark 4","Esther 9-10","Romans 4"]},{d:33,r:["Genesis 34","Mark 5","Job 1","Romans 5"]},{d:34,r:["Genesis 35-36","Mark 6","Job 2","Romans 6"]},{d:35,r:["Genesis 37","Mark 7","Job 3","Romans 7"]},{d:36,r:["Genesis 38","Mark 8","Job 4","Romans 8"]},{d:37,r:["Genesis 39","Mark 9","Job 5","Romans 9"]},{d:38,r:["Genesis 40","Mark 10","Job 6","Romans 10"]},{d:39,r:["Genesis 41","Mark 11","Job 7","Romans 11"]},{d:40,r:["Genesis 42","Mark 12","Job 8","Romans 12"]},{d:41,r:["Genesis 43","Mark 13","Job 9","Romans 13"]},{d:42,r:["Genesis 44","Mark 14","Job 10","Romans 14"]},{d:43,r:["Genesis 45","Mark 15","Job 11","Romans 15"]},{d:44,r:["Genesis 46","Mark 16","Job 12","Romans 16"]},{d:45,r:["Genesis 47","Luke 1:1-38","Job 13","1Corinthians 1"]},{d:46,r:["Genesis 48","Luke 1:39-80","Job 14","1Corinthians 2"]},{d:47,r:["Genesis 49","Luke 2","Job 15","1Corinthians 3"]},{d:48,r:["Genesis 50","Luke 3","Job 16-17","1Corinthians 4"]},{d:49,r:["Exodus 1","Luke 4","Job 18","1Corinthians 5"]},{d:50,r:["Exodus 2","Luke 5","Job 19","1Corinthians 6"]},{d:51,r:["Exodus 3","Luke 6","Job 20","1Corinthians 7"]},{d:52,r:["Exodus 4","Luke 7","Job 21","1Corinthians 8"]},{d:53,r:["Exodus 5","Luke 8","Job 22","1Corinthians 9"]},{d:54,r:["Exodus 6","Luke 9","Job 23","1Corinthians 10"]},{d:55,r:["Exodus 7","Luke 10","Job 24","1Corinthians 11"]},{d:56,r:["Exodus 8","Luke 11","Job 25-26","1Corinthians 12"]},{d:57,r:["Exodus 9","Luke 12","Job 27","1Corinthians 13"]},{d:58,r:["Exodus 10","Luke 13","Job 28","1Corinthians 14"]},{d:59,r:["Exodus 11","Luke 14","Job 29","1Corinthians 15"]},{d:60,r:["Exodus 12","Luke 15","Job 30","1Corinthians 16"]},{d:61,r:["Exodus 13","Luke 16","Job 31","2Corinthians 1"]},{d:62,r:["Exodus 14","Luke 17","Job 32","2Corinthians 2"]},{d:63,r:["Exodus 15","Luke 18","Job 33","2Corinthians 3"]},{d:64,r:["Exodus 16","Luke 19","Job 34","2Corinthians 4"]},{d:65,r:["Exodus 17","Luke 20","Job 35","2Corinthians 5"]},{d:66,r:["Exodus 18","Luke 21","Job 36","2Corinthians 6"]},{d:67,r:["Exodus 19","Luke 22","Job 37","2Corinthians 7"]},{d:68,r:["Exodus 20","Luke 23","Job 38","2Corinthians 8"]},{d:69,r:["Exodus 21","Luke 24","Job 39","2Corinthians 9"]},{d:70,r:["Exodus 22","John 1","Job 40","2Corinthians 10"]},{d:71,r:["Exodus 23","John 2","Job 41","2Corinthians 11"]},{d:72,r:["Exodus 24","John 3","Job 42","2Corinthians 12"]},{d:73,r:["Exodus 25","John 4","Proverbs 1","2Corinthians 13"]},{d:74,r:["Exodus 26","John 5","Proverbs 2","Galatians 1"]},{d:75,r:["Exodus 27","John 6","Proverbs 3","Galatians 2"]},{d:76,r:["Exodus 28","John 7","Proverbs 4","Galatians 3"]},{d:77,r:["Exodus 29","John 8","Proverbs 5","Galatians 4"]},{d:78,r:["Exodus 30","John 9","Proverbs 6","Galatians 5"]},{d:79,r:["Exodus 31","John 10","Proverbs 7","Galatians 6"]},{d:80,r:["Exodus 32","John 11","Proverbs 8","Ephesians 1"]},{d:81,r:["Exodus 33","John 12","Proverbs 9","Ephesians 2"]},{d:82,r:["Exodus 34","John 13","Proverbs 10","Ephesians 3"]},{d:83,r:["Exodus 35","John 14","Proverbs 11","Ephesians 4"]},{d:84,r:["Exodus 36","John 15","Proverbs 12","Ephesians 5"]},{d:85,r:["Exodus 37","John 16","Proverbs 13","Ephesians 6"]},{d:86,r:["Exodus 38","John 17","Proverbs 14","Philippians 1"]},{d:87,r:["Exodus 39","John 18","Proverbs 15","Philippians 2"]},{d:88,r:["Exodus 40","John 19","Proverbs 16","Philippians 3"]},{d:89,r:["Leviticus 1","John 20","Proverbs 17","Philippians 4"]},{d:90,r:["Leviticus 2-3","John 21","Proverbs 18","Colossians 1"]},{d:91,r:["Leviticus 4","Psalm 1-2","Proverbs 19","Colossians 2"]},{d:92,r:["Leviticus 5","Psalm 3-4","Proverbs 20","Colossians 3"]},{d:93,r:["Leviticus 6","Psalm 5-6","Proverbs 21","Colossians 4"]},{d:94,r:["Leviticus 7","Psalm 7-8","Proverbs 22","1Thessalonians 1"]},{d:95,r:["Leviticus 8","Psalm 9","Proverbs 23","1Thessalonians 2"]},{d:96,r:["Leviticus 9","Psalm 10","Proverbs 24","1Thessalonians 3"]},{d:97,r:["Leviticus 10","Psalm 11-12","Proverbs 25","1Thessalonians 4"]},{d:98,r:["Leviticus 11-12","Psalm 13-14","Proverbs 26","1Thessalonians 5"]},{d:99,r:["Leviticus 13","Psalm 15-16","Proverbs 27","2Thessalonians 1"]},{d:100,r:["Leviticus 14","Psalm 17","Proverbs 28","2Thessalonians 2"]},{d:101,r:["Leviticus 15","Psalm 18","Proverbs 29","2Thessalonians 3"]},{d:102,r:["Leviticus 16","Psalm 19","Proverbs 30","1Timothy 1"]},{d:103,r:["Leviticus 17","Psalm 20-21","Proverbs 31","1Timothy 2"]},{d:104,r:["Leviticus 18","Psalm 22","Ecclesiastes 1","1Timothy 3"]},{d:105,r:["Leviticus 19","Psalm 23-24","Ecclesiastes 2","1Timothy 4"]},{d:106,r:["Leviticus 20","Psalm 25","Ecclesiastes 3","1Timothy 5"]},{d:107,r:["Leviticus 21","Psalm 26-27","Ecclesiastes 4","1Timothy 6"]},{d:108,r:["Leviticus 22","Psalm 28-29","Ecclesiastes 5","2Timothy 1"]},{d:109,r:["Leviticus 23","Psalm 30","Ecclesiastes 6","2Timothy 2"]},{d:110,r:["Leviticus 24","Psalm 31","Ecclesiastes 7","2Timothy 3"]},{d:111,r:["Leviticus 25","Psalm 32","Ecclesiastes 8","2Timothy 4"]},{d:112,r:["Leviticus 26","Psalm 33","Ecclesiastes 9","Titus 1"]},{d:113,r:["Leviticus 27","Psalm 34","Ecclesiastes 10","Titus 2"]},{d:114,r:["Numbers 1","Psalm 35","Ecclesiastes 11","Titus 3"]},{d:115,r:["Numbers 2","Psalm 36","Ecclesiastes 12","Philemon 1"]},{d:116,r:["Numbers 3","Psalm 37","SongOfSongs 1","Hebrews 1"]},{d:117,r:["Numbers 4","Psalm 38","SongOfSongs 2","Hebrews 2"]},{d:118,r:["Numbers 5","Psalm 39","SongOfSongs 3","Hebrews 3"]},{d:119,r:["Numbers 6","Psalm 40-41","SongOfSongs 4","Hebrews 4"]},{d:120,r:["Numbers 7","Psalm 42-43","SongOfSongs 5","Hebrews 5"]},{d:121,r:["Numbers 8","Psalm 44","SongOfSongs 6","Hebrews 6"]},{d:122,r:["Numbers 9","Psalm 45","SongOfSongs 7","Hebrews 7"]},{d:123,r:["Numbers 10","Psalm 46-47","SongOfSongs 8","Hebrews 8"]},{d:124,r:["Numbers 11","Psalm 48","Isaiah 1","Hebrews 9"]},{d:125,r:["Numbers 12-13","Psalm 49","Isaiah 2","Hebrews 10"]},{d:126,r:["Numbers 14","Psalm 50","Isaiah 3-4","Hebrews 11"]},{d:127,r:["Numbers 15","Psalm 51","Isaiah 5","Hebrews 12"]},{d:128,r:["Numbers 16","Psalm 52-54","Isaiah 6","Hebrews 13"]},{d:129,r:["Numbers 17-18","Psalm 55","Isaiah 7","James 1"]},{d:130,r:["Numbers 19","Psalm 56-57","Isaiah 8","James 2"]},{d:131,r:["Numbers 20","Psalm 58-59","Isaiah 9","James 3"]},{d:132,r:["Numbers 21","Psalm 60-61","Isaiah 10","James 4"]},{d:133,r:["Numbers 22","Psalm 62-63","Isaiah 11-12","James 5"]},{d:134,r:["Numbers 23","Psalm 64-65","Isaiah 13","1Peter 1"]},{d:135,r:["Numbers 24","Psalm 66-67","Isaiah 14","1Peter 2"]},{d:136,r:["Numbers 25","Psalm 68","Isaiah 15","1Peter 3"]},{d:137,r:["Numbers 26","Psalm 69","Isaiah 16","1Peter 4"]},{d:138,r:["Numbers 27","Psalm 70-71","Isaiah 17-18","1Peter 5"]},{d:139,r:["Numbers 28","Psalm 72","Isaiah 19-20","2Peter 1"]},{d:140,r:["Numbers 29","Psalm 73","Isaiah 21","2Peter 2"]},{d:141,r:["Numbers 30","Psalm 74","Isaiah 22","2Peter 3"]},{d:142,r:["Numbers 31","Psalm 75-76","Isaiah 23","1John 1"]},{d:143,r:["Numbers 32","Psalm 77","Isaiah 24","1John 2"]},{d:144,r:["Numbers 33","Psalm 78:1-39","Isaiah 25","1John 3"]},{d:145,r:["Numbers 34","Psalm 78:40-72","Isaiah 26","1John 4"]},{d:146,r:["Numbers 35","Psalm 79","Isaiah 27","1John 5"]},{d:147,r:["Numbers 36","Psalm 80","Isaiah 28","2John 1"]},{d:148,r:["Deuteronomy 1","Psalm 81-82","Isaiah 29","3John 1"]},{d:149,r:["Deuteronomy 2","Psalm 83-84","Isaiah 30","Jude 1"]},{d:150,r:["Deuteronomy 3","Psalm 85","Isaiah 31","Revelation 1"]},{d:151,r:["Deuteronomy 4","Psalm 86-87","Isaiah 32","Revelation 2"]},{d:152,r:["Deuteronomy 5","Psalm 88","Isaiah 33","Revelation 3"]},{d:153,r:["Deuteronomy 6","Psalm 89","Isaiah 34","Revelation 4"]},{d:154,r:["Deuteronomy 7","Psalm 90","Isaiah 35","Revelation 5"]},{d:155,r:["Deuteronomy 8","Psalm 91","Isaiah 36","Revelation 6"]},{d:156,r:["Deuteronomy 9","Psalm 92-93","Isaiah 37","Revelation 7"]},{d:157,r:["Deuteronomy 10","Psalm 94","Isaiah 38","Revelation 8"]},{d:158,r:["Deuteronomy 11","Psalm 95-96","Isaiah 39","Revelation 9"]},{d:159,r:["Deuteronomy 12","Psalm 97-98","Isaiah 40","Revelation 10"]},{d:160,r:["Deuteronomy 13-14","Psalm 99-101","Isaiah 41","Revelation 11"]},{d:161,r:["Deuteronomy 15","Psalm 102","Isaiah 42","Revelation 12"]},{d:162,r:["Deuteronomy 16","Psalm 103","Isaiah 43","Revelation 13"]},{d:163,r:["Deuteronomy 17","Psalm 104","Isaiah 44","Revelation 14"]},{d:164,r:["Deuteronomy 18","Psalm 105","Isaiah 45","Revelation 15"]},{d:165,r:["Deuteronomy 19","Psalm 106","Isaiah 46","Revelation 16"]},{d:166,r:["Deuteronomy 20","Psalm 107","Isaiah 47","Revelation 17"]},{d:167,r:["Deuteronomy 21","Psalm 108-109","Isaiah 48","Revelation 18"]},{d:168,r:["Deuteronomy 22","Psalm 110-111","Isaiah 49","Revelation 19"]},{d:169,r:["Deuteronomy 23","Psalm 112-113","Isaiah 50","Revelation 20"]},{d:170,r:["Deuteronomy 24","Psalm 114-115","Isaiah 51","Revelation 21"]},{d:171,r:["Deuteronomy 25","Psalm 116","Isaiah 52","Revelation 22"]},{d:172,r:["Deuteronomy 26","Psalm 117-118","Isaiah 53","Matthew 1"]},{d:173,r:["Deuteronomy 27","Psalm 119:1-24","Isaiah 54","Matthew 2"]},{d:174,r:["Deuteronomy 28","Psalm 119:25-48","Isaiah 55","Matthew 3"]},{d:175,r:["Deuteronomy 29","Psalm 119:49-72","Isaiah 56","Matthew 4"]},{d:176,r:["Deuteronomy 30","Psalm 119:73-96","Isaiah 57","Matthew 5"]},{d:177,r:["Deuteronomy 31","Psalm 119:97-120","Isaiah 58","Matthew 6"]},{d:178,r:["Deuteronomy 32","Psalm 119:121-144","Isaiah 59","Matthew 7"]},{d:179,r:["Deuteronomy 33-34","Psalm 119:145-176","Isaiah 60","Matthew 8"]},{d:180,r:["Joshua 1","Psalm 120-122","Isaiah 61","Matthew 9"]},{d:181,r:["Joshua 2","Psalm 123-125","Isaiah 62","Matthew 10"]},{d:182,r:["Joshua 3","Psalm 126-128","Isaiah 63","Matthew 11"]},{d:183,r:["Joshua 4","Psalm 129-131","Isaiah 64","Matthew 12"]},{d:184,r:["Joshua 5","Psalm 132-134","Isaiah 65","Matthew 13"]},{d:185,r:["Joshua 6","Psalm 135-136","Isaiah 66","Matthew 14"]},{d:186,r:["Joshua 7","Psalm 137-138","Jeremiah 1","Matthew 15"]},{d:187,r:["Joshua 8","Psalm 139","Jeremiah 2","Matthew 16"]},{d:188,r:["Joshua 9","Psalm 140-141","Jeremiah 3","Matthew 17"]},{d:189,r:["Joshua 10","Psalm 142-143","Jeremiah 4","Matthew 18"]},{d:190,r:["Joshua 11","Psalm 144","Jeremiah 5","Matthew 19"]},{d:191,r:["Joshua 12-13","Psalm 145","Jeremiah 6","Matthew 20"]},{d:192,r:["Joshua 14-15","Psalm 146-147","Jeremiah 7","Matthew 21"]},{d:193,r:["Joshua 16-17","Psalm 148","Jeremiah 8","Matthew 22"]},{d:194,r:["Joshua 18-19","Psalm 149-150","Jeremiah 9","Matthew 23"]},{d:195,r:["Joshua 20-21","Acts 1","Jeremiah 10","Matthew 24"]},{d:196,r:["Joshua 22","Acts 2","Jeremiah 11","Matthew 25"]},{d:197,r:["Joshua 23","Acts 3","Jeremiah 12","Matthew 26"]},{d:198,r:["Joshua 24","Acts 4","Jeremiah 13","Matthew 27"]},{d:199,r:["Judges 1","Acts 5","Jeremiah 14","Matthew 28"]},{d:200,r:["Judges 2","Acts 6","Jeremiah 15","Mark 1"]},{d:201,r:["Judges 3","Acts 7","Jeremiah 16","Mark 2"]},{d:202,r:["Judges 4","Acts 8","Jeremiah 17","Mark 3"]},{d:203,r:["Judges 5","Acts 9","Jeremiah 18","Mark 4"]},{d:204,r:["Judges 6","Acts 10","Jeremiah 19","Mark 5"]},{d:205,r:["Judges 7","Acts 11","Jeremiah 20","Mark 6"]},{d:206,r:["Judges 8","Acts 12","Jeremiah 21","Mark 7"]},{d:207,r:["Judges 9","Acts 13","Jeremiah 22","Mark 8"]},{d:208,r:["Judges 10","Acts 14","Jeremiah 23","Mark 9"]},{d:209,r:["Judges 11","Acts 15","Jeremiah 24","Mark 10"]},{d:210,r:["Judges 12","Acts 16","Jeremiah 25","Mark 11"]},{d:211,r:["Judges 13","Acts 17","Jeremiah 26","Mark 12"]},{d:212,r:["Judges 14","Acts 18","Jeremiah 27","Mark 13"]},{d:213,r:["Judges 15","Acts 19","Jeremiah 28","Mark 14"]},{d:214,r:["Judges 16","Acts 20","Jeremiah 29","Mark 15"]},{d:215,r:["Judges 17","Acts 21","Jeremiah 30-31","Mark 16"]},{d:216,r:["Judges 18","Acts 22","Jeremiah 32","Luke 1"]},{d:217,r:["Judges 19","Acts 23","Jeremiah 33","Luke 2"]},{d:218,r:["Judges 20","Acts 24","Jeremiah 34","Luke 3"]},{d:219,r:["Judges 21","Acts 25","Jeremiah 35","Luke 4"]},{d:220,r:["Ruth 1","Acts 26","Jeremiah 36","Luke 5"]},{d:221,r:["Ruth 2","Acts 27","Jeremiah 37","Luke 6"]},{d:222,r:["Ruth 3-4","Acts 28","Jeremiah 38","Luke 7"]},{d:223,r:["1Samuel 1","Romans 1","Jeremiah 39","Luke 8"]},{d:224,r:["1Samuel 2","Romans 2","Jeremiah 40","Luke 9"]},{d:225,r:["1Samuel 3","Romans 3","Jeremiah 41","Luke 10"]},{d:226,r:["1Samuel 4","Romans 4","Jeremiah 42","Luke 11"]},{d:227,r:["1Samuel 5-6","Romans 5","Jeremiah 43","Luke 12"]},{d:228,r:["1Samuel 7-8","Romans 6","Jeremiah 44-45","Luke 13"]},{d:229,r:["1Samuel 9","Romans 7","Jeremiah 46","Luke 14"]},{d:230,r:["1Samuel 10","Romans 8","Jeremiah 47","Luke 15"]},{d:231,r:["1Samuel 11","Romans 9","Jeremiah 48","Luke 16"]},{d:232,r:["1Samuel 12","Romans 10","Jeremiah 49","Luke 17"]},{d:233,r:["1Samuel 13","Romans 11","Jeremiah 50","Luke 18"]},{d:234,r:["1Samuel 14","Romans 12","Jeremiah 51","Luke 19"]},{d:235,r:["1Samuel 15","Romans 13","Jeremiah 52","Luke 20"]},{d:236,r:["1Samuel 16","Romans 14","Lamentations 1","Luke 21"]},{d:237,r:["1Samuel 17","Romans 15","Lamentations 2","Luke 22"]},{d:238,r:["1Samuel 18","Romans 16","Lamentations 3","Luke 23"]},{d:239,r:["1Samuel 19","1Corinthians 1","Lamentations 4","Luke 24"]},{d:240,r:["1Samuel 20","1Corinthians 2","Lamentations 5","John 1"]},{d:241,r:["1Samuel 21-22","1Corinthians 3","Ezekiel 1","John 2"]},{d:242,r:["1Samuel 23","1Corinthians 4","Ezekiel 2","John 3"]},{d:243,r:["1Samuel 24","1Corinthians 5","Ezekiel 3","John 4"]},{d:244,r:["1Samuel 25","1Corinthians 6","Ezekiel 4","John 5"]},{d:245,r:["1Samuel 26","1Corinthians 7","Ezekiel 5","John 6"]},{d:246,r:["1Samuel 27","1Corinthians 8","Ezekiel 6","John 7"]},{d:247,r:["1Samuel 28","1Corinthians 9","Ezekiel 7","John 8"]},{d:248,r:["1Samuel 29-30","1Corinthians 10","Ezekiel 8","John 9"]},{d:249,r:["1Samuel 31","1Corinthians 11","Ezekiel 9","John 10"]},{d:250,r:["2Samuel 1","1Corinthians 12","Ezekiel 10","John 11"]},{d:251,r:["2Samuel 2","1Corinthians 13","Ezekiel 11","John 12"]},{d:252,r:["2Samuel 3","1Corinthians 14","Ezekiel 12","John 13"]},{d:253,r:["2Samuel 4-5","1Corinthians 15","Ezekiel 13","John 14"]},{d:254,r:["2Samuel 6","1Corinthians 16","Ezekiel 14","John 15"]},{d:255,r:["2Samuel 7","2Corinthians 1","Ezekiel 15","John 16"]},{d:256,r:["2Samuel 8-9","2Corinthians 2","Ezekiel 16","John 17"]},{d:257,r:["2Samuel 10","2Corinthians 3","Ezekiel 17","John 18"]},{d:258,r:["2Samuel 11","2Corinthians 4","Ezekiel 18","John 19"]},{d:259,r:["2Samuel 12","2Corinthians 5","Ezekiel 19","John 20"]},{d:260,r:["2Samuel 13","2Corinthians 6","Ezekiel 20","John 21"]},{d:261,r:["2Samuel 14","2Corinthians 7","Ezekiel 21","Psalm 1-2"]},{d:262,r:["2Samuel 15","2Corinthians 8","Ezekiel 22","Psalm 3-4"]},{d:263,r:["2Samuel 16","2Corinthians 9","Ezekiel 23","Psalm 5-6"]},{d:264,r:["2Samuel 17","2Corinthians 10","Ezekiel 24","Psalm 7-8"]},{d:265,r:["2Samuel 18","2Corinthians 11","Ezekiel 25","Psalm 9"]},{d:266,r:["2Samuel 19","2Corinthians 12","Ezekiel 26","Psalm 10"]},{d:267,r:["2Samuel 20","2Corinthians 13","Ezekiel 27","Psalm 11-12"]},{d:268,r:["2Samuel 21","Galatians 1","Ezekiel 28","Psalm 13-14"]},{d:269,r:["2Samuel 22","Galatians 2","Ezekiel 29","Psalm 15-16"]},{d:270,r:["2Samuel 23","Galatians 3","Ezekiel 30","Psalm 17"]},{d:271,r:["2Samuel 24","Galatians 4","Ezekiel 31","Psalm 18"]},{d:272,r:["1Kings 1","Galatians 5","Ezekiel 32","Psalm 19"]},{d:273,r:["1Kings 2","Galatians 6","Ezekiel 33","Psalm 20-21"]},{d:274,r:["1Kings 3","Ephesians 1","Ezekiel 34","Psalm 22"]},{d:275,r:["1Kings 4-5","Ephesians 2","Ezekiel 35","Psalm 23-24"]},{d:276,r:["1Kings 6","Ephesians 3","Ezekiel 36","Psalm 25"]},{d:277,r:["1Kings 7","Ephesians 4","Ezekiel 37","Psalm 26-27"]},{d:278,r:["1Kings 8","Ephesians 5","Ezekiel 38","Psalm 28-29"]},{d:279,r:["1Kings 9","Ephesians 6","Ezekiel 39","Psalm 30"]},{d:280,r:["1Kings 10","Philippians 1","Ezekiel 40","Psalm 31"]},{d:281,r:["1Kings 11","Philippians 2","Ezekiel 41","Psalm 32"]},{d:282,r:["1Kings 12","Philippians 3","Ezekiel 42","Psalm 33"]},{d:283,r:["1Kings 13","Philippians 4","Ezekiel 43","Psalm 34"]},{d:284,r:["1Kings 14","Colossians 1","Ezekiel 44","Psalm 35"]},{d:285,r:["1Kings 15","Colossians 2","Ezekiel 45","Psalm 36"]},{d:286,r:["1Kings 16","Colossians 3","Ezekiel 46","Psalm 37"]},{d:287,r:["1Kings 17","Colossians 4","Ezekiel 47","Psalm 38"]},{d:288,r:["1Kings 18","1Thessalonians 1","Ezekiel 48","Psalm 39"]},{d:289,r:["1Kings 19","1Thessalonians 2","Daniel 1","Psalm 40-41"]},{d:290,r:["1Kings 20","1Thessalonians 3","Daniel 2","Psalm 42-43"]},{d:291,r:["1Kings 21","1Thessalonians 4","Daniel 3","Psalm 44"]},{d:292,r:["1Kings 22","1Thessalonians 5","Daniel 4","Psalm 45"]},{d:293,r:["2Kings 1","2Thessalonians 1","Daniel 5","Psalm 46-47"]},{d:294,r:["2Kings 2","2Thessalonians 2","Daniel 6","Psalm 48"]},{d:295,r:["2Kings 3","2Thessalonians 3","Daniel 7","Psalm 49"]},{d:296,r:["2Kings 4","1Timothy 1","Daniel 8","Psalm 50"]},{d:297,r:["2Kings 5","1Timothy 2","Daniel 9","Psalm 51"]},{d:298,r:["2Kings 6","1Timothy 3","Daniel 10","Psalm 52-54"]},{d:299,r:["2Kings 7","1Timothy 4","Daniel 11","Psalm 55"]},{d:300,r:["2Kings 8","1Timothy 5","Daniel 12","Psalm 56-57"]},{d:301,r:["2Kings 9","1Timothy 6","Hosea 1","Psalm 58-59"]},{d:302,r:["2Kings 10-11","2Timothy 1","Hosea 2","Psalm 60-61"]},{d:303,r:["2Kings 12","2Timothy 2","Hosea 3-4","Psalm 62-63"]},{d:304,r:["2Kings 13","2Timothy 3","Hosea 5-6","Psalm 64-65"]},{d:305,r:["2Kings 14","2Timothy 4","Hosea 7","Psalm 66-67"]},{d:306,r:["2Kings 15","Titus 1","Hosea 8","Psalm 68"]},{d:307,r:["2Kings 16","Titus 2","Hosea 9","Psalm 69"]},{d:308,r:["2Kings 17","Titus 3","Hosea 10","Psalm 70-71"]},{d:309,r:["2Kings 18","Philemon 1","Hosea 11","Psalm 72"]},{d:310,r:["2Kings 19","Hebrews 1","Hosea 12","Psalm 73"]},{d:311,r:["2Kings 20","Hebrews 2","Hosea 13","Psalm 74"]},{d:312,r:["2Kings 21","Hebrews 3","Hosea 14","Psalm 75-76"]},{d:313,r:["2Kings 22","Hebrews 4","Joel 1","Psalm 77"]},{d:314,r:["2Kings 23","Hebrews 5","Joel 2","Psalm 78"]},{d:315,r:["2Kings 24","Hebrews 6","Joel 3","Psalm 79"]},{d:316,r:["2Kings 25","Hebrews 7","Amos 1","Psalm 80"]},{d:317,r:["1Chronicles 1-2","Hebrews 8","Amos 2","Psalm 81-82"]},{d:318,r:["1Chronicles 3-4","Hebrews 9","Amos 3","Psalm 83-84"]},{d:319,r:["1Chronicles 5-6","Hebrews 10","Amos 4","Psalm 85"]},{d:320,r:["1Chronicles 7-8","Hebrews 11","Amos 5","Psalm 86"]},{d:321,r:["1Chronicles 9-10","Hebrews 12","Amos 6","Psalm 87-88"]},{d:322,r:["1Chronicles 11-12","Hebrews 13","Amos 7","Psalm 89"]},{d:323,r:["1Chronicles 13-14","James 1","Amos 8","Psalm 90"]},{d:324,r:["1Chronicles 15","James 2","Amos 9","Psalm 91"]},{d:325,r:["1Chronicles 16","James 3","Obadiah 1","Psalm 92-93"]},{d:326,r:["1Chronicles 17","James 4","Jonah 1","Psalm 94"]},{d:327,r:["1Chronicles 18","James 5","Jonah 2","Psalm 95-96"]},{d:328,r:["1Chronicles 19-20","1Peter 1","Jonah 3","Psalm 97-98"]},{d:329,r:["1Chronicles 21","1Peter 2","Jonah 4","Psalm 99-101"]},{d:330,r:["1Chronicles 22","1Peter 3","Micah 1","Psalm 102"]},{d:331,r:["1Chronicles 23","1Peter 4","Micah 2","Psalm 103"]},{d:332,r:["1Chronicles 24-25","1Peter 5","Micah 3","Psalm 104"]},{d:333,r:["1Chronicles 26-27","2Peter 1","Micah 4","Psalm 105"]},{d:334,r:["1Chronicles 28","2Peter 2","Micah 5","Psalm 106"]},{d:335,r:["1Chronicles 29","2Peter 3","Micah 6","Psalm 107"]},{d:336,r:["2Chronicles 1","1John 1","Micah 7","Psalm 108-109"]},{d:337,r:["2Chronicles 2","1John 2","Nahum 1","Psalm 110-111"]},{d:338,r:["2Chronicles 3-4","1John 3","Nahum 2","Psalm 112-113"]},{d:339,r:["2Chronicles 5","1John 4","Nahum 3","Psalm 114-115"]},{d:340,r:["2Chronicles 6","1John 5","Habakkuk 1","Psalm 116"]},{d:341,r:["2Chronicles 7","2John 1","Habakkuk 2","Psalm 117-118"]},{d:342,r:["2Chronicles 8","3John 1","Habakkuk 3","Psalm 119:1-24"]},{d:343,r:["2Chronicles 9","Jude 1","Zephaniah 1","Psalm 119:25-48"]},{d:344,r:["2Chronicles 10","Revelation 1","Zephaniah 2","Psalm 119:49-72"]},{d:345,r:["2Chronicles 11-12","Revelation 2","Zephaniah 3","Psalm 119:73-96"]},{d:346,r:["2Chronicles 13","Revelation 3","Haggai 1","Psalm 119:97-120"]},{d:347,r:["2Chronicles 14-15","Revelation 4","Haggai 2","Psalm 119:121-144"]},{d:348,r:["2Chronicles 16","Revelation 5","Zechariah 1","Psalm 119:145-176"]},{d:349,r:["2Chronicles 17","Revelation 6","Zechariah 2","Psalm 120-122"]},{d:350,r:["2Chronicles 18","Revelation 7","Zechariah 3","Psalm 123-125"]},{d:351,r:["2Chronicles 19-20","Revelation 8","Zechariah 4","Psalm 126-128"]},{d:352,r:["2Chronicles 21","Revelation 9","Zechariah 5","Psalm 129-131"]},{d:353,r:["2Chronicles 22-23","Revelation 10","Zechariah 6","Psalm 132-134"]},{d:354,r:["2Chronicles 24","Revelation 11","Zechariah 7","Psalm 135-136"]},{d:355,r:["2Chronicles 25","Revelation 12","Zechariah 8","Psalm 137-138"]},{d:356,r:["2Chronicles 26","Revelation 13","Zechariah 9","Psalm 139"]},{d:357,r:["2Chronicles 27-28","Revelation 14","Zechariah 10","Psalm 140-141"]},{d:358,r:["2Chronicles 29","Revelation 15","Zechariah 11","Psalm 142"]},{d:359,r:["2Chronicles 30","Revelation 16","Zechariah 12","Psalm 143"]},{d:360,r:["2Chronicles 31","Revelation 17","Zechariah 13","Psalm 144"]},{d:361,r:["2Chronicles 32","Revelation 18","Zechariah 14","Psalm 145"]},{d:362,r:["2Chronicles 33","Revelation 19","Malachi 1","Psalm 146-147"]},{d:363,r:["2Chronicles 34","Revelation 20","Malachi 2","Psalm 148"]},{d:364,r:["2Chronicles 35","Revelation 21","Malachi 3","Psalm 149"]},{d:365,r:["2Chronicles 36","Revelation 22","Malachi 4","Psalm 150"]}];

        const WORD_TOTALS = { GLOBAL: 789634, OT: 609252, NT: 180382 };
        let activeTab = appData.defaultTab || 'PLAN';
        let activeBookIdx = null;
        let searchQuery = "";
        let mainChart = null;
        let miniCharts = [];

        // --- BIBLE READER ---
        let kjvBibleData = null;  // Will hold the full Bible text
        let currentReaderBook = null;
        let currentReaderChapter = null;

        // --- PRONUNCIATION GUIDE ---
        // Dictionary mapping Bible words to their pronunciations
        const PRONUNCIATION_GUIDE = {
            "Aaron": "AIR-un", "Abaddon": "Ah-BAD-dun", "Abana": "AHB-ah-nah", "Abarim": "Ah-bah-REEM", "Abba": "AHB-ah",
            "Abdon": "AB-dun", "Abednego": "ah-BED-nee-go", "Abel": "AY-bel", "Abel-Beth-Maacah": "AH-bell-BETH-mah-ah-CAH",
            "Abel-meholah": "AY-bel-mi-HO-lah", "Abelmaim": "AH-bel-MAH-yim", "Abiathar": "uh-BY-uh-thar", "Abihu": "uh-BY-hew",
            "Abijah": "Ah-BEE-jah", "Abijam": "Ah-BEE-jam", "Abilene": "ab-ih-LEE-nee", "Abimelech": "Ah-BIM-uh-leck",
            "Abinadab": "Ah-BIH-nuh-dab", "Abinoam": "Ah-bih-NOH-um", "Abiram": "Ah-BEE-ram", "Abishag": "AB-ih-shag",
            "Abishai": "AA-bih-shigh", "Abner": "AB-ner", "Abomination": "Ah-bah-mih-NAY-shun", "Abraham": "AY-brah-ham",
            "Absalom": "AB-sah-lom", "Acacia": "Ah-KAY-shah", "Achaia": "ah-KAY-yah", "Achan": "AH-kun", "Achar": "Ah-KAHR",
            "Achish": "Ah-KEESH", "Achor": "Ah-CORE", "Achsah": "AHK-sah", "Achshaph": "AHK-shahf",
            "Achzib": "Ahk-ZEEB", "Acropolis": "Ah-CRAH-poh-liss", "Adonijah": "Ah-doh-NIGH-juh",
            "Adoniram": "Ah-doh-NIGH-ram", "Adonizedek": "Ah-doh-nigh-ZEH-dek", "Adoram": "Ah-DORE-um",
            "Adrammelech": "AH-druh-MEH-leck", "Adramyttium": "Ah-drah-MIH-tee-um", "Adullam": "Ah-DUHL-ahm",
            "Aegean": "Ah-GEE-an", "Aeneas": "Ah-NEE-us", "Aenon": "EYE-non", "Agabus": "AG-ah-bus",
            "Agape": "Ah-GAH-pay", "Agrippa": "Ah-GRIP-ah", "Agur": "AH-gur", "Ahasuerus": "Ah-hah-zoo-AIR-us",
            "Ahaz": "AY-haz", "Ahaziah": "Ah-hah-ZIGH-ah", "Ahijah": "Ah-HEE-jah", "Ahimaaz": "Ah-HIH-mah-az",
            "Ahimelech": "Ah-HIH-meh-leck", "Ahinoam": "Ah-hee-NOH-um", "Ahisamach": "Ah-HEE-sah-mahk",
            "Ahithophel": "Ah-HITH-oh-fel", "Ai": "EYE", "Aiah": "Ah-EE-ah", "Aijalon": "AY-jah-lun",
            "Ahaz": "AY-haz", "Akkadian": "Ah-KAY-dee-an", "Akeldama": "uh-KEL-deh-muh", "Akrabbim": "Ah-krah-BEEM",
            "Alamoth": "AL-uh-moth", "Alpha": "AL-fah", "Alphaeus": "al-FEE-us", "Amalek": "AM-ah-lek",
            "Amalekites": "ah-MAL-eh-kites", "Amana": "Ah-MAH-nah", "Amariah": "Am-ah-RIGH-ah",
            "Amasa": "Ah-MAH-sah", "Amasis": "AM-ah-sis", "Amaziah": "am-uh-ZY-uh",
            "Amenemopet": "Ah-men-EM-oh-pay", "Amethyst": "AM-eh-thist", "Ammon": "AM-mun",
            "Ammonites": "AM-mo-nites", "Amon": "AM-on", "Amorite": "AM-moh-rite", "Amorites": "AM-oh-rites",
            "Amos": "AY-mus", "Amoz": "AY-muz", "Amphipolis": "am-FIPP-oh-lis", "Ampliatus": "Am-plee-AH-tus",
            "Amram": "Ahm-RAHM", "Amulet": "AM-you-let", "Anakim": "Ah-nah-KEEM", "Ananias": "Ah-nah-NIGH-us",
            "Ananias": "an-ah-NYE-us", "Anathoth": "AN-uh-thothe", "Andronicus": "An-DROH-nih-kus", "Annas": "AN-us",
            "Antichrist": "AN-tee-christ", "Antioch": "AN-tee-ock", "Antiochus": "An-TIE-oh-kus",
            "Apelles": "Ah-PELL-us", "Aphek": "AY-fek", "Aphiah": "Ah-FEE-ah", "Apocalypse": "Ah-POCK-ah-lips",
            "Apocalyptic": "Ah-pah-kah-LIP-tic", "Apodictic": "Aa-poh-DIK-tik", "Apollo": "Ah-PAHL-oh",
            "Apollonia": "ap-puh-LOW-nee-ah", "Apollos": "ah-PAWL-lus", "Apollyon": "Ah-PAHL-yon", "Apostasy": "Ah-PAHS-tah-see",
            "Apphia": "AF-ih-ah", "Aquila": "Ah-KWILL-ah", "Arabah": "AR-ah-bah", "Arabia": "Ah-RAY-bee-ah",
            "Arad": "ARE-ad", "Aram": "AIR-um", "Aram-maacah": "AR-am-mah-ah-CAH",
            "Aram-nahaaraim": "AIR-am-Nah-har-uh-EEM", "Aram-zobah": "AIR-um-ZOH-bah", "Aramaic": "Air-ah-MAY-ick",
            "Aramean": "Air-ah-MEE-an", "Ararat": "AIR-ah-rat", "Archelaus": "Ark-keh-LAY-us",
            "Archippus": "ar-KIPP-us", "Areopagus": "Air-ee-OP-ah-gus", "Aretas": "AH-reh-tas",
            "Argob": "Ar-GOBE", "Ariel": "Air-ee-ELL", "Arimathea": "air-ih-mah-THEE-uh", "Arioch": "ARE-ee-ock",
            "Aristarchus": "Ar-iss-STAR-kus", "Aristobulus": "Air-iss-TAH-bih-lus", "Armoni": "Ar-MOH-nee",
            "Arnon": "ARE-non", "Aroer": "Ah-ROH-er", "Arpachshad": "Ar-POCK-shad", "Arpad": "ARE-pahd",
            "Artemas": "ARE-teh-mas", "Artemis": "AHR-teh-miss", "Arvad": "ARE-vahd", "Asa": "AY-suh",
            "Asaph": "AY-saf", "Ashdod": "ASH-dod", "Asher": "AA-sher", "Asherah": "Ah-sheh-RAH",
            "Asherim": "Ash-uh-REEM", "Ashkelon": "ASH-keh-lon", "Ashpenaz": "ASH-peh-noz",
            "Ashtaroth": "ASH-tah-roth", "Ashtoreth": "ASH-toh-reth", "Assur": "ASH-ur", "Assyria": "Ah-SEER-ee-ah",
            "Astarte": "As-TAR-teh", "Asyncritus": "Ah-SIN-crih-tus", "Atad": "AY-tad", "Ataroth": "Ah-tah-ROTHE",
            "Athaliah": "Ath-ah-LIGH-ah", "Atharim": "Ah-thah-REEM", "Augustus": "Ah-GUSS-tuss",
            "Avvim": "Ah-VEEM", "Azariah": "az-ah-RYE-ah", "Azazel": "Ah-zah-ZALE", "Azekah": "Ah-zeh-KAH",
            "Azmon": "AZ-mon", "Azubah": "Ah-ZOO-bah", "Azzur": "AZZ-ur", "Baal": "BAY-uhl",
            "Baal-hazor": "Bah-AHL-hah-TSORE", "Baal-meon": "Bah-ALL-may-AHN", "Baal-perazim": "Bah-AHL-per-rah-ZEEM",
            "Baal-zephon": "BAY-uhl-ZEE-fon", "Baalath": "Bah-ah-LAHTH", "Baale-judah": "Bah-AHL-le- JOO-dah",
            "Baanah": "Bah-ah-NAH", "Baasha": "Bah-ah-SHAH", "Babylon": "BAA-beh-lon", "Babylonia": "bab-ih-LOW-nee-ah",
            "Baca": "Bah-KAH", "Bahurim": "Bah-hoor-EEM", "Balaam": "BAY-lam", "Baladan": "BAH-lah-don", "Balak": "BAY-lak",
            "Bamah": "Bah-MAH", "Bamoth": "Bah-MOTHE", "Barabbas": "bar-RAHB-as", "Barachel": "Bah-rah-KELL",
            "Barachia": "Bah-rah-KEE-ah", "Barak": "Bah-RACK", "Barnabas": "BAR-nah-bas", "Barsabbas": "bar-SAH-bus",
            "Bartimaeus": "bar-tih-MEE-us", "Barzillai": "Bar-ZIL-eye", "Bashan": "BAY-shan",
            "Bath-rabbim": "Bah-AHTH-rah-BEEM", "Bdellium": "DELL-ih-um", "Becorath": "Beh-COR-rath", "Beelzebub": "bee-ELL-ze-bub",
            "Beelzebul": "Bee-EHL-ze-bul", "Beer-la-hai-roi": "BEER-lah-HIGH-roi", "Beeroth": "Buh-eh-ROTHE",
            "Beersheba": "beer-SHEE-bah", "Beor": "BEE-or",
            "Behemoth": "Beh-HEE-moth", "Belshazzar": "BELL-shah-zar", "Ben-hadad": "Ben-hah-DAHD",
            "Benaiah": "Beh-NIGH-ah", "Benhadad": "Ben-hah-DAHD", "Beon": "Beh-OWN", "Beracah": "Ber-ah-CAH",
            "Berechiah": "Beh-reh-KIGH-ah", "Berea": "beh-REE-ah", "Berith": "Buh-REETH",
            "Berothah": "Beh-ROH-thah", "Berothai": "Beh-roh-THAI", "Beryl": "BEHR-ill", "Besor": "Beh-SORE",
            "Beth-horon": "Beth-HOR-on", "Beth-jeshimoth": "BETH-yeh-shih-MOTHE", "Beth-le-aphrah": "BETH-leh-ah-FRAH",
            "Beth-shemesh": "Beth-SHEH-mesh", "Beth-togannah": "BETH-toh-gar-MAH", "Bethany": "BETH-ah-nee",
            "Bethel": "Beth-ELL", "Bethesda": "Beh-THEHZ-dah", "Bethezel": "Beth-eh-ZEL",
            "Bethhaccherem": "BETH-hah-I-IR-um", "Bethharam": "Beth-hah-RAHM",
            "Bethlehem Ephrathah": "BETH-leh-hem-eh-FRAH-thah", "Bethlehem": "BETH-leh-hem",
            "Bethphage": "BETH-fah-jee", "Bethsaida": "Beth-SAY-ih-dah", "Bethuel": "BETH-you-eli",
            "Bethzatha": "Beth-ZAH-thah", "Bezalel": "BEZ-ah-lel", "Bezek": "BAY-zek", "Bezer": "BEH-zer",
            "Bildad": "BILL-dad", "Bilhah": "BIL-hah", "Bithynia": "Bih-THIN-ee-ah", "Boaz": "BO-az",
            "Bochim": "Boh-KEEM", "Bozrah": "BOZ-rah", "Bul": "BOOL", "Buz": "BUHZ", "Buzi": "BU-zye",
            "Buzite": "BOO-zite", "Byblos": "BIB-los", "Cabul": "KAY-bul", "Caesar": "SEE-zar",
            "Caesarea": "sess-ah-REE-ah", "Caesarea-Philippi": "Sess-ah-REE-ah-FILL-ih-pie",
            "Caiaphas": "KAY-ah-fas", "Caiaphus": "KAY-ah-fuss", "Caligula": "Kah-LIG-you-lah",
            "Cana": "KAY-nah", "Canaan": "KAY-nan",
            "Canaanites": "KAY-nuh-nites", "Canneh": "CAN-neh", "Capernaum": "kuh-PER-nee-um",
            "Caphtorim": "Caf-toh-REEM", "Cappadocia": "kap-puh-DOH-shee-uh", "Carchemish": "CAR-keh-mish",
            "Carmel": "Car-MEL", "Carnelian": "Kar-NEEL-yen", "Casuistic": "Kaa-zoo-ISS-tic",
            "Cenchreae": "SEN-kree-ah", "Censer": "SEN-ser", "Centurion": "Sen-TOOR-ee-un", "Cephas": "SEE-fas",
            "Chalcedony": "Kal-SEH-doh-nee", "Chaldean": "Cal-DEE-an", "Chaldeans": "kal-DEE-anz",
            "Chebar": "KEE-bar", "Chemosh": "KEE-mosh",
            "Cherethites": "CHAIR-eh-thites", "Cherith": "KEE-rith", "Cherubim": "CHAIR-uh-bim",
            "Chileab": "CHIH-lee-ab", "Chilion": "KIL-ee-un", "Chilmad": "KILL-mad", "Chinnereth": "KIH-neh-reth",
            "Chinneroth": "KIN-eh-roth", "Chislev": "KIZ-lev", "Chloe": "KLOH-ee", "Chorazim": "KORE-ah-zim",
            "Chorazin": "Koh-RAH-zin", "Chrysolite": "KRIS-oh-light", "Chrysoprase": "KRIS-oh-prays",
            "Cilicia": "sih-LISH-ih-ah", "Circumcision": "SUR-kum-sih-zhun", "Claudius": "KLAW-dee-us",
            "Cleopas": "KLEE-oh-pas", "Clopas": "KLOH-pas", "Colossae": "koh-LAH-sih", "Cor": "CORE",
            "Cornelius": "Kor-NEE-lee-us", "Crescens": "KRES-enz", "Cretans": "KREE-tuns", "Crispus": "KRIS-pus",
            "Cubit": "CUE-bit", "Cush": "KOOSH", "Cushan": "KOO-shan", "Cushan-rishathaim": "KOO-shan-rish-uh-THAY-im",
            "Cushi": "KOOSH-eye", "Cyprus": "SIGH-pruss", "Cyrene": "sigh-REE-nee", "Cyrenians": "Sigh-REE-nee-ans",
            "Dagon": "DAY-gone", "Dalmanutha": "Dal-mah-NOO-thah", "Dalmatia": "dal-MAY-shih-ah",
            "Damascus": "Duh-MAS-kuhs",
            "Darius": "DARE-ee-us", "Dathan": "Dah-THAHN", "Debir": "Deh-BEER", "Decalogue": "DEH-kah-log",
            "Decapolis": "Dee-CAP-oh-liss", "Dedan": "DEE-dan", "Dedanites": "DEH-duh-nites", "Demas": "DEE-mas",
            "Demetrius": "Di-MEE-tree-us", "Denarii": "Deh-NAIR-ee", "Denarius": "Deh-NAIR-ee-us",
            "Desecration": "Deh-seh-KRAY-shun", "Dibon": "dih-BONE", "Diotrephes": "Die-AH-tref-ays",
            "Doeg": "DOH-egg", "Domitian": "Doh-MIH-shun", "Dorcus": "DOR-kus", "Dothan": "DOH-thun",
            "Dura": "DYOO-rah", "Eder": "AY-der", "Edom": "EE-dum", "Edrei": "EH-dreheye", "Egypt": "EE-jipt",
            "Ehud": "EE-hude",
            "Ekron": "EHK-ron", "El Shaddai": "ell SHAD-eye", "Elah": "EE-lah", "Elam": "EE-lam",
            "Elamites": "EE-lam-ights", "Eleazar": "Ell-ee-AY-zar", "Eldad": "ELL-dad", "Elhanan": "ELL-hah-non",
            "Eli": "EE-lie", "Eliab": "EH-lee-ab",
            "Eliada": "Ell-lee-AH-dah", "Eliezer": "ell-ih-EE-zer", "Elihu": "Ee-HIE-hew", "Elijah": "Ee-LIGH-jah",
            "Elim": "Eh-LEEM", "Elimelech": "Eh-lee-MEH-lek", "Eliphaz": "EHL-ih-faz", "Elishah": "Eh-LIGH-shah",
            "Elishama": "Ell-lee-SHAH-mah", "Elisheba": "Eh-lee-SHEH-bah", "Elishua": "Ell-lee-SHOO-ah",
            "Elizaphan": "Eh-lee-zah-FAHN", "Elkanah": "ELL-kah-nah", "Elkosh": "EL-kosh", "Elohim": "Eh-loh-HEEM",
            "Elohist": "EH-loh-hist", "Elon": "EE-lon", "Elyon": "Eh-lee-ON", "Emim": "Eh-MEEM",
            "Emmanuel": "Ih-MAN-yoo-ell", "En-eglaim": "En-eh-GLAH-eem", "En-gedi": "En-GEH-dee",
            "En-rogel": "En-roh-GEL", "Endor": "EN-door", "Enhakkore": "En-hah-KORE", "Enoch": "EE-nuck",
            "Enosh": "EE-nosh", "Epaenetus": "Ee-PAY-neh-tus", "Epaphras": "EH-pah-fras",
            "Epaphroditus": "Ee-paf-roh-DIGH-tus", "Ephah": "EE=fah", "Ephesus": "EF-eh-sus", "Ephod": "EE-fod",
            "Ephphatha": "EFF-fah-thah", "Epphatha": "EFF-ah-thah", "Ephraim": "EE-fray-um", "Ephraimites": "EE-frah-eem-ites",
            "Ephrathah": "EF-rah-thah", "Ephron": "EFF-ron", "Epicurean": "Eh-pih-CURE-ee-an",
            "Epilogue": "EH-pih-log", "Erastus": "Eh-RASS-tus", "Esarhaddon": "Eh-shar-HAD-dun", "Esau": "EE-saw",
            "Eschatological": "Ess-kah-toh-LAH-jih-cal", "Eschatology": "Ess-kah-TAH-lo-gee",
            "Eshtaol": "ESH-tah-ole", "Eshtemoa": "Esh-teh-MOH-ah", "Etham": "EE-tham", "Ethanim": "Eth-ah-NEEM",
            "Ethiopia": "Ee-thee-OH-pia", "Ethiopian": "Ee-thee-OH-pee-an", "Eubulus": "YOU-buh-lus",
            "Eunuch": "YOO-nick", "Euodia": "You-OH-dee-ah", "Euphrates": "you-FRAY-teez",
            "Eutychus": "YOO-tih-kus", "Evil-merodach": "Ee-vil-MER-oh-dak", "Exhortation": "Ex-or-TAY-shun",
            "Ezekiel Ben-adam": "Ee-ZEE-kee-al BEN-ah-DAHM", "Ezion-geber": "EH-zee-own-GEH-ber",
            "Ezrahite": "EZ-rah-hite", "Fair": "Jah-EER", "Favan": "JAH-van", "Fortunatus": "For-too-NAH-tus",
            "Freshets": "FRESH-ets", "Gaal": "Gah-ALL", "Gabbatha": "GAHB-ah-thah", "Gadarenes": "GAA-deh-reens", "Gaius": "GAY-us",
            "Galatia": "gah-LAY-shah", "Galilee": "GAL-ih-lee", "Gallim": "Gal-LEEM", "Gamad": "GAY-mad",
            "Gamaliel": "Ga-MAY-lee-el", "Gareb": "GAHR-eb", "Gaza": "GAH-zah", "Geba": "GAY-bah",
            "Gebal": "GAY-ball", "Gedaliah": "Geh-dah-LIGH-uh", "Gedara": "GEH-dah-rah", "Gedor": "GAY-dor",
            "Gehenna": "Geh-HEH-nuh", "Gennesaret": "geh-NESS-eh-ret", "Gentile": "JEN-tile", "Gera": "GER-ah",
            "Gerah": "GER-ah", "Gerar": "Ger-ARE", "Gerasa": "GEH-rah-sah", "Gerasene": "GER-ah-seen",
            "Gergesa": "GER-geh-sah", "Gerizim": "Geh-rih-ZEEM", "Gershom": "GER-shum",
            "Gethsemane": "Geth-SEH-mah-nee", "Gezer": "GEH-zer", "Gibbethon": "GIB-uh-thon", "Gibeah": "GIH-bee-ah",
            "Gibeath-Elohim": "GIB-ee-ath-el-oh-HEEM", "Gibeon": "GIB-ee-un", "Gideon": "GID-ee-un",
            "Gihazi": "Gih-HAH-zigh", "Gihon": "GY-hon", "Gilead": "GILL-ee-add", "Gilgal": "GILL-gal",
            "Ginath": "GIH-nath", "Gittith": "GIT-tith", "Glossa": "Gloss-a-LAY-lee-ah", "Gnostic": "NOSS-tik",
            "Gnosticism": "NOSS-tih-siz-um", "Goah": "GO-ah", "Goiim": "Goh-EEM", "Golgotha": "GAUL-goh-thah",
            "Gomer": "GO-mer", "Gomorrah": "goh-MOR-ah", "Goshen": "GOH-shen", "Gozan": "GOH-zan",
            "Habakkuk": "hah-BAK-uk", "Hachilah": "Hah-kee-LAH", "Hadad": "Hah-DAHD",
            "Hadadezer": "Hah-dah-DAY-zer", "Hadadrimmon": "HAH-dad-RIM-on", "Hades": "HAY-deez",
            "Hadrach": "HAD-rack", "Hagar": "HAY-gar", "Hagarites": "HAY-guh-rites", "Haggai": "HAG-eye",
            "Haggith": "HAG-ith", "Hamath-zobah": "Hah-MAHTH-ZOH-bah", "Hamath": "HAY-math",
            "Hamon-gog": "Hay-mahn-GOG", "Hamonah": "Hah-mo-NAH", "Hamor": "Hah-MORE", "Hanani": "Hah-han-NEE",
            "Hananiah": "han-ah-NYE-ah", "Hanukkah": "HAH-nah-kuh", "Hanun": "HAH-nun", "Haran": "HAIR-un",
            "Harosheth-ha-goiim": "Hah-roh-SHETH-hah-goh-EEM", "Hauran": "HAWR-ahn", "Havilah": "HAV-ih-lah",
            "Hazael": "HAHZ-ah-ell", "Hazar-enon": "Hah-ZAR-eh-NON", "Hazazon-tamar": "HAH-zah-zon-TAY-mar",
            "Hazer-hatticon": "Ha-ZER-hah-tee-KAHN", "Hazeroth": "Hah-zeh-ROTHE", "Hazor": "HAH-tsore",
            "Hebron": "HEH-brun", "Helbon": "HEL-bon", "Heldai": "HEL-die", "Helech": "HEH-leck",
            "Hellenistic": "Heh-leh-NISS-tic", "Hellenists": "HEL-eh-nists", "Heman": "Hay-MAHN",
            "Hermas": "HER-mas", "Hermes": "HER-meez", "Hermon": "Her-MON", "Herod": "HARE-ud",
            "Herodias": "Heh-ROH-dee-us", "Herodion": "Heh-ROH-dee-on", "Heshbon": "HESH-bon",
            "Hethlon": "HETH-lon", "Hezekiah": "Heh-zeh-KIGH-uh", "Hezion": "HEH-zee-on", "Higgaion": "HIG-eye-on",
            "Hilkiah": "Hil-KIGH-uh", "Hin": "Hihn", "Hinnom": "Hih-NOME", "Hiram": "HIGH-ram",
            "Hireling": "HIRE-ling", "Hittites": "HIH-tites", "Hivites": "HIH-vites", "Hobab": "HOH-bab",
            "Homer": "HO-mer", "Hophra": "HOFF-rah", "Horeb": "HOR-eb", "Hormah": "HOR-mah", "Hyssop": "HIH-sup",
            "Horonaim": "Hore-oh-NAY-yim", "Huram": "HYUR-am", "Hushai": "HOO-shigh", "Hyacinth": "HIGH-ah-sinth",
            "Hymenaeus": "High-MEEN-ee-us", "Ibhar": "IB-har", "Iconium": "eye-KOH-nee-um", "Iddo": "ID-oh",
            "Idumeans": "Ih-doo-ME-ans", "Ijon": "IGH-jon", "Illyricum": "Ih-LEER-ee-cum", "Irad": "EAR-rad",
            "Iscariot": "iss-KAR-ee-ott", "Ituraea": "it-yur-EE-ah",
            "Isaac": "EYE-zek", "Isaiah": "Eye-ZAY-uh", "Ishbi-benob": "ISH-bee-BAY-nob",
            "Ishbosheth": "ISH-boh-sheth", "Ishmael": "ISH-may-ell", "Ishmaelites": "ISH-may-eh-lites",
            "Ishmaiah": "Ish-MIGH-ah", "Issachar": "IS-ah-kahr", "Ithamar": "ITH-ah-mar", "Ithream": "ITH-ree-um",
            "Ivvah": "EE-vah", "Iye-abarim": "EYE-ah-bah-REEM", "Jaar": "Jah-ARE", "Jabbok": "JAB-ok",
            "Jaazaniah": "Jah-az-ah-NIGH-ah", "Jabal": "JAY-bal", "Jabesh-gilead": "JAH-besh-GIH-lee-ad",
            "Jabez": "JAH-bez", "Jabin": "JAY-bin", "Jairus": "JAI-rus",
            "Jachin": "Jah-KEEN", "Jael": "Jah-ELL", "Jahaz": "JAH-hahz", "Jair": "Jah-EER", "Jambres": "JAM-bres",
            "Jannes": "JAH-nus", "Japheth": "JAY-feth", "Japhia": "Jah-PHEE-ah", "Jared": "JAR-ed", "Jearim": "JEE-eh-rim",
            "Jashar": "Jah-SHAHR", "Jashobeam": "Jah-SHOH-bih-em", "Javan": "JAH-van", "Jazer": "JAH-zer",
            "Jebusite": "JEB-you-site", "Jeconiah": "Jeh-coh-NIGH-ah", "Jedaiah": "Jeh-DAY-yah",
            "Jedediah": "Jeh-deh-DIGH-uh", "Jeduthun": "Jeh-DOO-thun", "Jehiel": "Jeh-HEE-el",
            "Jehoahaz": "Jeh-HOE-ah-haz", "Jehoiachin": "Jeh-HOY-ah-kin", "Jehoiada": "Jeh-HOY-ah-dah",
            "Jehoiakim": "Jeh-HOY-ah-kim", "Jehoram": "Jeh-HOR-am", "Jehoshabeath": "Jeh-hoh-shah-BEE-ath",
            "Jehoshaphat": "Jeh-HOH-shuh-fat", "Jehozadak": "Jeh-HOE-zah-dak", "Jehu": "JEE-hyoo", "Jehus": "JEH-hus",
            "Jemimah": "Jeh-MY-mah", "Jeroboam": "jair-uh-BOH-am",
            "Jephthah": "JEF-thah", "Jephunneh": "Jeh-FOO-neh", "Jerahmeel": "Jeh-RAH-mih-el",
            "Jerahmeelites": "Jeh-RAH-meh-uh-lites", "Jericho": "JEH-rih-koh", "Jerimoth": "JER-ih-mothe",
            "Jerioth": "JER-ih-othe", "Jerubaal": "Jeh-ROO-bah-all",
            "Jerusalem": "Jeh-ROO-sah-lem", "Jeshanah": "JESH-ah-nah", "Jeshimon": "Jeh-SHEE-mun",
            "Jeshurun": "JEH-shoo-run", "Jezebel": "JEH-zeh-bell", "Jezreel": "Jez-REEL", "Joab": "JOH-ab",
            "Joash": "JOH-ash", "Job": "JOHB", "Jokneam": "Joke-NEE-urn", "Jonadab": "JOH-nuh-dab",
            "Jonah": "JOH-nuh", "Joppa": "JAH-pah", "Joram": "JOR-am", "Jordan": "JORE-dun", "Joses": "JOH-seez",
            "Josheb-basshebeth": "JOH-sheh-bah-SHAY-beth", "Joshua": "JOSH-oo-ah", "Josiah": "Joh-SIGH-ah",
            "Jotbathah": "JOT-bah-thah", "Jotham": "JOTH-em", "Jubel": "JOO-bal", "Judah": "JOO-dah",
            "Judaism": "JUDE-ah-iz-um", "Judas Iscariot": "JOO-das-Iss-CARE-ee-ot", "Judea": "Joo-DEE-ah",
            "Junias": "JOO-nee-as", "Jushab-hesed": "JOO-shab-HEH-sed", "Kabod": "Kah-BODE",
            "Kadesh-barnea": "Kah-desh-bar-NEE-uh", "Kadesh": "KAY-desh", "Kedar": "KEH-dar",
            "Kedemoth": "Keh-deh-MOTHE", "Kedesh": "KEH-desh", "Kenan": "KEN-an", "Kenaz": "KEH-naz",
            "Kenites": "KEH-nites", "Kenizzites": "KEH-nih-zites", "Kephas": "KAY-fass",
            "Kerenhappuch": "Keh-ren-HAH-puk", "Keturah": "Keh-TURE-ah", "Keziah": "Keh-ZIGH-ah",
            "Kidron": "KID-ron", "Kiriath-arba": "Kir-ee-ath-AR-buh", "Kiriath-jearim": "KIR-ee-ath-jeh-ah-REEM",
            "Kiriath-sepher": "Kir-ee-ath-SAY-fer", "Kiriathaim": "Kir-ee-ah-THAH-yim", "Kishion": "KISH-ee-un",
            "Koa": "KO-ah", "Kohath": "KOH-hath", "Koine": "Koy-NAY", "Korah": "KOR-ah", "Kue": "KOO-eh",
            "Laban": "LAY-ban", "Lachish": "Lah-KEESH", "Laish": "Lah-EESH", "Lamech": "LAH-meck",
            "Laodicea": "lay-oh-dih-SEE-ah", "Lasharon": "Lah-shah-RONE", "Leannoth": "LEE-un-noth",
            "Lycaonian": "lyk-ah-OH-nee-an", "Lysanias": "ly-SAY-nih-as",
            "Leaven": "LEH-ven", "Lehi": "LEE-high", "Lemuel": "LEM-you-el", "Levi": "LEE-vigh",
            "Leviathan": "Luh-VIE-uh-thun", "Levite": "LEE-vite", "Levitical": "Leh-VIH-tih-kal",
            "Libnah": "LIB-nuh", "Linus": "LIGH-nus", "Logos": "LAW-goss", "Lucius": "LOO-shus", "Lud": "LOOD",
            "Lydda": "LID-ah", "Lyre": "LIER", "Lystra": "LISS-trah", "Maacah": "Mah-ah-KAH",
            "Maccabees": "MACK-ah-beez", "Macedonia": "mass-eh-DOH-nee-ah", "Machir": "Mah-KEER",
            "Machpelah": "Mahk-peh-LAH", "Madon": "Mah-DON", "Magadan": "MAH-gah-don", "Magdala": "MAG-dah-lah",
            "Magdalene": "MAG-dah-lehn", "Magog": "MAH-gog", "Mahalalel": "Mah-HAH-luh-lel",
            "Mahalath": "Mah-hah-LATH", "Mahanaim": "Mah-hah-NIGH-im", "Mahlon": "Mah-LON", "Mahol": "MAY-hoi",
            "Makkedah": "Mah-kay-DAH", "Malachi": "MAL-ah-kigh", "Malchishua": "Mahl-kee-SHOO-uh",
            "Malchus": "MAL-kus", "Mammon": "MAA-mon", "Mamre": "MAHM-ree", "Manaen": "MAN-ah-en",
            "Manasseh": "mah-NASS-eh", "Manna": "MAN-nah", "Maon": "Mah-OWN", "Marah": "MAHR-ah", "Marcion": "MAR-see-un",
            "Marduk": "MAR-duke", "Mareshah": "Mah-reh-SHAH", "Maroth": "MAR-oth", "Martyr": "MAHR-ter",
            "Magdelene": "MAG-dah-lehn", "Maskil": "MAHS-kil", "Massah": "MASS-ah", "Matthias": "mah-THIGH-us",
            "Matrites": "MAH-trites", "Mazzaroth": "Mah-zah-ROTHE", "Medad": "MEE-dad", "Medeba": "Meh-deh-BAH",
            "Medes": "MEEDS", "Media": "MEE-dee-ah",
            "Megiddo": "Meh-GID-oh", "Mehujael": "Meh-HOO-jah-el", "Melchizedek": "Mel-KIH-zuh-dek",
            "Melqart": "MEL-kart", "Memphis": "MEM-fis", "Mene": "MEN-eh", "Menorah": "Meh-NOR-ah",
            "Mephibosheth": "Meh-FIB-oh-sheth", "Merab": "MARE-ab", "Merari": "Meh-RAH-ree",
            "Meribah": "MAIR-ih-bah", "Meribath-kadesh": "MER-ih-bath-KAH-desh", "Merodach": "MER-oh-dahk",
            "Merom": "Mare-OME", "Merran": "MAIR-un", "Meshach": "MEE-shak", "Meshech": "MEE-shek",
            "Meshullam": "Meh-SHOO-lam", "Mesopotamia": "mess-oh-poe-TAY-mee-ah", "Messiah": "Meh-SIGH-ah",
            "Methuselah": "Meh-THOO-zeh-lah",
            "Methushael": "Meh-THOO-shah-el", "Meunites": "Meh-OO-nights", "Micah": "MY-cuh",
            "Micaiah": "Mih-KIGH-ah", "Michal": "Mee-KAHL", "Midian": "MIH-dee-an", "Midianites": "MIH-dee-ah-nites",
            "Migdol": "MIG-dole", "Miktam": "MICK-tam", "Milcah": "MIL-kah", "Milcom": "MILL-kahm",
            "Millenium": "Mih-LEH-nee-um", "Miriam": "MIR-ee-am", "Mishael": "MISH-ah-el",
            "Misrephoth-maim": "MIZ-reh-foth-mah-EEM", "Mizpah": "MIZZ-puh", "Mispeh": "MIZZ-puh", "Moab": "MO-ab",
            "Molech": "MOH-lek", "Moresheth-gath": "MOR-eh-sheth-GATH", "Moriah": "Moh-RIGH-ah", "Moses": "MOH-zez",
            "Muth-labben": "MUTH-lab-un", "Naamah": "NAY-ah-mah", "Naamathite": "Nah-ah-MAH-thite",
            "Naameh": "Nah-ah-MEH", "Nabal": "Nah-BALL", "Nabonidus": "Nab-boh-NIGH-dus",
            "Nabopolasser": "Nab-boh-poh-LASS-er", "Naboth": "NAY-both", "Nacon": "Nah-CONE", "Nadab": "NAY-dab",
            "Nahash": "Nah-HASH", "Nahor": "NAY-hor", "Nahum": "NAY-hum", "Nain": "NAY-een",
            "Naomi": "Nay-OH-mee", "Naphath-dor": "Nah-fath-DOR", "Naphtali": "NAFF-tah-lee",
            "Narcissus": "Nar-SIH-sus", "Nathanael": "Nah-THAN-yell", "Nazareth": "NAZ-a-reth",
            "Nebaioth": "Neh-bah-YOTHE", "Nebat": "NEE-bat", "Nebuchadnezzar": "NEB-oo-cad-NEZ-er",
            "Nebuzaradan": "NEH-boo-ZAH-reh-dan", "Neco": "NEH-koh", "Negeb": "NEH-geb", "Nephilim": "Neh-fih-LEEM",
            "Nereus": "NEE-ree-us", "Nicanor": "NIGH-kan-or", "Nicolaitans": "Nih-koh-LAY-tons",
            "Nicopolis": "Nih-KAH-poh-lis", "Niger": "NIGH-jer", "Nimbus": "NIM-bus", "Nimrod": "NIM-rod",
            "Nineveh": "NIH-neh-vah", "Nisan": "NIGH-san", "Nisroch": "NIZ-rock", "Noah": "NOH-ah",
            "Obed-edom": "OH-bed-EE-dum", "Oboth": "Oh-BOTHE", "Ohel": "OH-hel", "Oholah": "Oh-ho-LAH",
            "Oholiab": "Oh-HOH-lee-ab", "Oholibah": "Oh-ho-lee-BAH", "Olympas": "Oh-LIM-pas", "Omri": "OHM-ree",
            "Onan": "OH-nan", "Onesimus": "Oh-NEH-sih-mus", "Onias": "Oh-NIGH-us", "Ophir": "OH-fer",
            "Oracle": "OR-ah-cul", "Oreb": "OR-ebb", "Orion": "Oh-RYE-un", "Orpah": "OR-puh",
            "Paddan-aram": "PAD-an-AIR-em", "Palanquin": "PAL-an-keen", "Pamphylia": "Pam-FILL-ee-ah",
            "Paphos": "PAF-ohs", "Papyrus": "Puh-PIE-russ", "Paran": "PAR-ahn", "Parmenas": "PAR-men-as",
            "Parousia": "Par-oo-SEE-uh", "Parsin": "PAR-sin", "Parthia": "PAHR-thee-ah", "Parvaim": "Par-VAY-im",
            "Paschal": "PASS-kul", "Pashhur": "PASH-er", "Pathros": "PATH-ros", "Patmos": "PAT-moss",
            "Patrobas": "PAT-roh-bas", "Pekah": "PEH-kah", "Pekahiah": "Pek-ah-HIGH-ah",
            "Pelatiah": "Pel-eh-TIGH-ah", "Peleg": "PAY-leg", "Pelethites": "PEL-eh-thites",
            "Pelusium": "Pih-LOO-see-um", "Peniel": "PEH-nee-el", "Peninnah": "Peh-NEE-nah",
            "Pentateuch": "PEN-tah-tuke", "Pentecost": "PEN-te-kost", "Penuel": "PEN-yoo-el", "Peor": "Peh-ORE",
            "Perez-uzzah": "PEH-rez-OO-zah", "Perez": "PEH-rez", "Perga": "PER-gah", "Pergamum": "Per-GAH-mum",
            "Perizim": "Pare-eh-ZEEM", "Perizzites": "PEH-rih-zites", "Persis": "PER-sis",
            "Pestilence": "PEST-eh-lents", "Phanuel": "FAN-you-ehl", "Pharaoh": "FAIR-oh", "Pharisee": "FAIR-ih-see",
            "Phicol": "FIGH-col", "Philemon": "Figh-LEE-mun", "Philippi": "FILL-ih-pigh",
            "Philippians": "Fih-LIP-ee-ans", "Philistia": "Fih-LISS-tee-ah", "Philistine": "FIL-iss-teen",
            "Philologus": "Fih-loh-LOH-gus", "Phinehas": "Fih-NAY-has", "Phlegon": "FLEH-gon", "Phoebe": "FEE-bee",
            "Phoenicia": "Fo-NEE-shuh", "Phrygia": "FRIH-jee-ah", "Pibeseth": "Pi-BEH-seth", "Pisgah": "PIZ-guh",
            "Pishon": "PIE-shon", "Pisidia": "Pih-SIH-dee-ah", "Pleiades": "PLEE-ah-deez", "Politarch": "POL-ih-tark",
            "Pontius Pilate": "PON-shus PIE-let", "Portent": "POR-tent", "Potiphar": "POH-tih-far",
            "Potiphera": "Poh-TIH-fuh-ruh", "Praetorium": "Pray-TORE-ee-um", "Prefect": "PREE-fect",
            "Prisca": "PRIH-sah", "Prochorus": "PRO-kor-us", "Proconsul": "Pro-KON-sul", "Prologue": "PRO-log",
            "Prophecy": "PRAH-feh-see", "Prophesy": "PRAH-feh-sigh", "Proselytes": "PRAH-sell-ites",
            "Ptolemias": "Tol-eh-MAY-us", "Ptolemy": "TOH-leh-mee", "Puah": "POO-ah", "Pudens": "POO-denz",
            "Purslane": "PURS-lin", "Put": "PUT", "Qesitah": "Keh-SEE-tah", "Quartus": "KWAR-tus",
            "Quirinius": "Kwih-RIHN-ee-us", "Raamah": "Rah-ah-MAH", "Rabbah": "Rah-BAH",
            "Rabshakeh": "RAHB-sheh-keh", "Rachel": "RAY-chel", "Rahab": "RAY-hab", "Ram": "RAHM",
            "Ramah": "RAH-mah", "Ramathaim-zophim": "Rah-mah-THAH-eem-zoh-FEEM", "Rameses": "RAM-sees",
            "Ramoth-gilead": "RAH-moth-GIL-ee-ad", "Rechab": "Reh-KAHB", "Rechabites": "REH-kah-bites",
            "Regem-melech": "REH-gehm-MEH-leck", "Rehob": "RAY-hob", "Rehoboam": "Ray-uh-BOH-am",
            "Rephaim": "Reh-fah-EEM", "Rephidim": "Reh-fih-DEEM", "Reuben": "ROO-ben", "Rezeph": "REH-zeff",
            "Rezin": "REH-zin", "Rezon": "REH-zon", "Rhegium": "RAY-jee-um", "Rhoda": "RO-dah", "Rhodes": "ROADS",
            "Riblah": "RIB-lah", "Rimmon": "RIM-on", "Rizpah": "RIZ-pah", "Sabeans": "Sah-BEE-ans",
            "Sadducees": "SAD-yoo-seez", "Salecah": "Sah-leh-KAH", "Salem": "SAY-lem", "Salim": "SAY-lehm",
            "Salmone": "Sal-MOE-nay", "Salome": "Sal-OH-may", "Samaria": "Sah-MARE-ee-ah",
            "Samaritans": "Sah-MARE-ih-tons", "Samson": "SAM-son", "Samuel": "SAM-yoo-ell",
            "Sanhedrin": "San-HEE-drin", "Sapphira": "Sah-FEER-ah", "Sapphire": "SAFF-ire", "Sarah": "SEHR-ah",
            "Sarai": "Sah-RIGH", "Sardis": "SAHR-dis", "Sardonyx": "Sar-DAH-niks", "Satan": "SAY-ten",
            "Satrap": "SAT-trap", "Scythian": "SIH-thee-an", "Seir": "Seh-EER", "Selah": "SEE-lah",
            "Seleucus": "Seh-LOO-sus", "Selucids": "Seh-LOO-sids", "Senir": "Seh-NEER",
            "Sennacherib": "Seh-NAK-er-ib", "Seraiah": "Ser-EYE-uh", "Sergius Paulus": "SER-jee-us-PAH-lus",
            "Shaalim": "Shah-ah-LEEM", "Shaddai": "Shah-DIGH", "Shadrach": "SHAD-rack", "Shalishah": "Shah-lee-SHAH",
            "Shalmaneser": "Shal-mah-NEE-zer", "Shammah": "SHAH-mah", "Shammua": "Shah-MOO-ah",
            "Shaphan": "SHAY-fan", "Shaphat": "SHAY-faht", "Shaphir": "SHAY-fer", "Sharezer": "Shah-REE-zer",
            "Shavsha": "SHAV-shah", "Shealtiel": "Shee-AL-tee-el", "Shear-jashub": "Sheh-ARE-yah-SHOOB",
            "Sheba": "SHEE-buh", "Shebat": "SHE-bat", "Shechem": "SHECK-em", "Shekel": "SHECK-el",
            "Shekinah": "Sheh-KIGH-nah", "Shelah": "Sheh-LA", "Shelomith": "Sheh-loh-MITH", "Shema": "Sheh-MAH",
            "Shemaiah": "Sheh-MIGH-ah", "Sheminith": "SHEM-uh-nith", "Sheol": "SHEE-ohl",
            "Shephatiah": "Sheh-fah-TEE-ah", "Shephelah": "Sheh-FAY-lah", "Shiggaion": "SHIG-eye-on",
            "Shigionoth": "Shig-ih-OH-noth", "Shiloh": "SHY-low", "Shimeah": "Shih-MAY-ah", "Shimei": "SHIH-migh",
            "Shimeites": "SHIM-eh-ites", "Shimron-meron": "Shim-RONE-meer-OWN", "Shinar": "SHIGH-nar",
            "Shiphrah": "SHIF-rah", "Shishak": "SHEE-shak", "Shittim": "Shih-TEEM", "Shoa": "SHOW-ah",
            "Shuah": "SHOO-ah", "Shuhite": "SHOO-hite", "Shulammite": "SHOO-lah-mite",
            "Shunammite": "SHOO-nah-mite", "Shunem": "SHOO-nem", "Shur": "SURE",
            "Shushan Eduth": "SHOE-shan-EE-doth", "Sibraim": "Sib-RAY-im", "Sicarius": "Sih-CAHR-ree-us",
            "Sidon": "SIGH-dun", "Sihon": "SEE-hun", "Siloam": "Sih-LOH-am", "Silvanus": "Sill-VAY-nus",
            "Simeon": "SIH-mee-un", "Sinai": "SIGH-nigh", "Sirion": "SEER-ee-on", "Sisera": "SIS-eh-rah",
            "Smaragdus": "Smeh-RAG-dus", "Smyrna": "SMER-nah", "Sodom": "SOD-um", "Solomon": "SOL-oh-mon",
            "Sosipater": "Sah-SIP-ah-ter", "Sosthenes": "SAHS-thuh-neez", "Stachys": "STAY-kis",
            "Stephanas": "STEH-fah-nus", "Stoic": "STOW-ick", "Succoth": "SUK-uth", "Sukkim": "Soo-KEEM",
            "Sumer": "SOO-mer", "Susa": "SUE-zah", "Suzerain": "SOO-zeh-rain", "Suzerainity": "SOO-zeh-rehn-tee",
            "Sychar": "SIGH-kar", "Syene": "Sigh-EEN", "Synagogue": "SIN-ah-gog", "Syntyche": "Sin-TIH-kay",
            "Syria": "SEER-ee-uh", "Taanach": "Tah-ah-NAHK", "Tabeel": "Tah-buh-ELL", "Taberah": "Tah-beh-RAH",
            "Tabitha": "TAB-ith-ah", "Tabrimmon": "Tab-RIM-mon", "Tadmor": "TAD-mor", "Tahpanhes": "TAH-puh-neez",
            "Talmai": "TAL-mai", "Tamar": "TAY-mar", "Tammuz": "Tah-MUZ", "Tappuah": "Tah-POO-uh",
            "Tarshish": "TAR-shish", "Tarsus": "TAR-sus", "Tehaphnehes": "Teh-HOFF-neh-hees", "Tekel": "TEH-kel",
            "Tekoa": "Teh-KOH-ah", "Tel-abib": "Tell-ah-BEEB", "Tema": "TAY-mah", "Teman": "TAY-mahn",
            "Temanite": "TAY-man-ite", "Terah": "TER-ah", "Teraphim": "TER-ah-fim", "Terebinths": "TEAR-uh-binths",
            "Tertius": "TER-tee-us", "Tertullus": "Ter-TULL-us", "Tether": "JAY-ther", "Thebes": "THEE-bz",
            "Thebez": "THEH-bez", "Theophilus": "Thee-AH-fil-us", "Thessalonica": "Theh-sah-loh-NIGH-kah",
            "Thummim": "THUM-im", "Thyatira": "Thee-ah-TEE-rah", "Tiberius": "Tie-BEER-ee-us",
            "Tiglath-pileser": "TIG-lath-pih-LEE-zer", "Tigris-Euphrates": "TIGH-griss-you-FRAY-tees",
            "Tilgath-pilneser": "TIL-gath-pil-NEE-zer", "Timnah": "Tim-NAH", "Timnath-serah": "Tim-nath-seh-RAH",
            "Timon": "TIM-on", "Timothy": "TIH-moh-thee", "Tirhakah": "Tear-hah-KAH", "Tirzah": "TEER-zah",
            "Titus": "TIE-tus", "Tobadonijah": "Toh-bad-oh-NIGH-jah", "Tobijah": "Toh-BE-jah", "Tola": "TOH-lah",
            "Topaz": "TOH-paz", "Topheth": "TOH-feth", "Torah": "TOH-rah", "Trachonitus": "Trak-uh-NIGHT-us",
            "Tribulation": "Trib-you-LAY-shun", "Troas": "TROH-ahs", "Trophimus": "TROH-fih-mus",
            "Tryphaena": "Treh-FAY-nah", "Tryphosa": "Treh-FOH-sah", "Tubal-Cain": "TOO-ball-CAIN",
            "Tubal": "TOO-bal", "Tychicus": "TIH-kih-kus", "Typology": "Tie-PAH-leh-jee", "Tyre": "TIRE",
            "Ulai": "YOU-lie", "Uphaz": "YOU-faz", "Urbanus": "Ur-BAN-us", "Urim": "YOOR-im", "Uz": "UHZ",
            "Uzal": "YOU-zal", "Uziel": "Oo-zee-ELL", "Uzzah": "OO-zah", "Uzziah": "You-ZIGH-ah",
            "Uzziel": "OO-zee-ell", "Vitellius": "Vih-TELL-ee-us", "Yahweh": "YAH-way", "Yahwist": "YAH-wist",
            "Yobel": "Yoh-BELL", "Yom Kippur": "YOME-Kih-POOR", "Zaanan": "ZAH-eh-nahn", "Zacchaeus": "Zak-EE-us",
            "Zadok": "ZAY-dock", "Zarephath": "ZARE-eh-FATH", "Zarethan": "ZAR-eh-than", "Zebedee": "ZEH-beh-dee",
            "Zebediah": "Zeh-beh-DIGH-ah", "Zebulun": "ZEB-yoo-lun", "Zechariah": "Zeh-kah-RIGH-uh",
            "Zedad": "ZEE-dad", "Zedekiah": "Zeh-deh-KIGH-uh", "Zelophehad": "Zeh-LOH-feh-had", "Zelzah": "ZEL-zah",
            "Zemaraim": "Zeh-mah-RIGH-im", "Zemer": "ZEH-mer", "Zenas": "ZEE-nas",
            "Zephaniah": "Zeh-fah-NIGH-ah", "Zephathah": "Zeph-ah-THAH", "Zerah": "ZEH-rah",
            "Zeredah": "ZER-eh-dah", "Zeror": "Ze-ROAR", "Zeruah": "Zeh-ROO-ah", "Zerubbabel": "Zeh-RUB-ah-bel",
            "Zeruiah": "Zeh-roo-EYE-ah", "Ziba": "ZEE-buh", "Ziklag": "ZIK-lag", "Zilpah": "ZIL-pah",
            "Zimri": "ZIM-ree", "Zion": "ZIGH-un", "Ziphites": "ZIF-ites", "Zipporah": "Zih-POH-rah",
            "Zoan": "ZOH-an", "Zoar": "ZOH-ar", "Zobah": "ZOH-bah", "Zophar": "ZOH-far"
        };

        // Add pronunciation indicators to Bible text
        function addPronunciationIndicators(text) {
            if (!text) return '';

            // Create a map for case-insensitive matching
            const pronunciationMap = {};
            Object.keys(PRONUNCIATION_GUIDE).forEach(word => {
                pronunciationMap[word.toLowerCase()] = {
                    original: word,
                    pronunciation: PRONUNCIATION_GUIDE[word]
                };
            });

            // Helper function to check if a word should get pronunciation help
            // Only matches capitalized words (proper nouns like Bible names/places)
            const shouldMatchPronunciation = (word) => {
                if (!word) return false;
                // Find the first letter in the word (skip apostrophes/hyphens at start)
                const firstLetter = word.match(/[a-zA-Z]/);
                if (!firstLetter) return false;
                // Only show pronunciation for capitalized words (proper nouns)
                return firstLetter[0] === firstLetter[0].toUpperCase();
            };

            // Split text into words while preserving punctuation and spaces
            let result = '';
            let currentWord = '';

            for (let i = 0; i < text.length; i++) {
                const char = text[i];

                // Check if character is a letter, hyphen, or apostrophe (part of a word)
                if (/[a-zA-Z'-]/.test(char)) {
                    currentWord += char;
                } else {
                    // We hit a non-word character, process the accumulated word
                    if (currentWord) {
                        const lowerWord = currentWord.toLowerCase();
                        const wordWithoutPunctuation = currentWord.replace(/['-]/g, '').toLowerCase();

                        // Only match if word is capitalized (proper noun)
                        if (shouldMatchPronunciation(currentWord)) {
                            // Check if word has pronunciation (try exact match first, then without punctuation)
                            if (pronunciationMap[lowerWord]) {
                                const { pronunciation } = pronunciationMap[lowerWord];
                                result += `<span class="pronunciation-word" aria-label="Pronunciation: ${pronunciation}">${escapeHtml(currentWord)}<span class="pronunciation-tooltip" aria-hidden="true">${escapeHtml(pronunciation)}</span></span>`;
                            } else if (pronunciationMap[wordWithoutPunctuation]) {
                                const { pronunciation } = pronunciationMap[wordWithoutPunctuation];
                                result += `<span class="pronunciation-word" aria-label="Pronunciation: ${pronunciation}">${escapeHtml(currentWord)}<span class="pronunciation-tooltip" aria-hidden="true">${escapeHtml(pronunciation)}</span></span>`;
                            } else {
                                result += escapeHtml(currentWord);
                            }
                        } else {
                            result += escapeHtml(currentWord);
                        }
                        currentWord = '';
                    }
                    result += char; // Add the non-word character
                }
            }

            // Process any remaining word at the end
            if (currentWord) {
                const lowerWord = currentWord.toLowerCase();
                const wordWithoutPunctuation = currentWord.replace(/['-]/g, '').toLowerCase();

                // Only match if word is capitalized (proper noun)
                if (shouldMatchPronunciation(currentWord)) {
                    if (pronunciationMap[lowerWord]) {
                        const { pronunciation } = pronunciationMap[lowerWord];
                        result += `<span class="pronunciation-word" aria-label="Pronunciation: ${pronunciation}">${escapeHtml(currentWord)}<span class="pronunciation-tooltip" aria-hidden="true">${escapeHtml(pronunciation)}</span></span>`;
                    } else if (pronunciationMap[wordWithoutPunctuation]) {
                        const { pronunciation } = pronunciationMap[wordWithoutPunctuation];
                        result += `<span class="pronunciation-word" aria-label="Pronunciation: ${pronunciation}">${escapeHtml(currentWord)}<span class="pronunciation-tooltip" aria-hidden="true">${escapeHtml(pronunciation)}</span></span>`;
                    } else {
                        result += escapeHtml(currentWord);
                    }
                } else {
                    result += escapeHtml(currentWord);
                }
            }

            return result;
        }

        // Load KJV Bible text from JSON file
        async function loadBibleText() {
            if (kjvBibleData) return kjvBibleData;  // Already loaded

            try {
                const response = await fetch('kjv_bible.json');

                if (!response.ok) {
                    throw new Error(`Failed to fetch Bible text: ${response.status} ${response.statusText}`);
                }

                kjvBibleData = await response.json();
                console.log('‚úÖ KJV Bible text loaded');
                return kjvBibleData;
            } catch (error) {
                console.error('‚ùå Failed to load Bible text:', error);
                return null;
            }
        }

        // Open Bible reader modal with specific book and chapter
        window.openBibleReader = async (bookName, chapterNumber) => {
            const modal = document.getElementById('bible-reader-modal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';  // Prevent background scrolling

            currentReaderBook = bookName;
            currentReaderChapter = chapterNumber;

            // Show loading state
            document.getElementById('bible-reader-verses').innerHTML = `
                <div class="flex items-center justify-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
                </div>
            `;

            // Load Bible data if not already loaded
            if (!kjvBibleData) {
                const result = await loadBibleText();

                // If loading failed, show error message
                if (!result) {
                    document.getElementById('bible-reader-verses').innerHTML = `
                        <div class="flex flex-col items-center justify-center py-12 px-6 text-center">
                            <svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            <h3 class="text-xl font-bold text-slate-800 mb-2">Unable to Load Bible Text</h3>
                            <p class="text-sm text-slate-600 mb-6 max-w-md">
                                We couldn't load the Bible text. This might be due to a network issue or the file being unavailable.
                                Please check your internet connection and try again.
                            </p>
                            <button onclick="window.openBibleReader('${bookName}', ${chapterNumber})"
                                class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold transition-colors shadow-sm hover:shadow-md">
                                Try Again
                            </button>
                        </div>
                    `;
                    return;
                }
            }

            // Render the chapter
            renderBibleChapter(bookName, chapterNumber);
        };

        // Close Bible reader modal
        window.closeBibleReader = () => {
            const modal = document.getElementById('bible-reader-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';  // Restore scrolling
            currentReaderBook = null;
            currentReaderChapter = null;
        };

        // Navigate to previous/next chapter
        window.navigateBibleChapter = (direction) => {
            if (!currentReaderBook || !currentReaderChapter) return;

            const bookIndex = bible.findIndex(b => b.name === currentReaderBook);
            if (bookIndex === -1) return;

            const book = bible[bookIndex];
            const newChapter = currentReaderChapter + direction;

            // Check if we can navigate within this book
            if (newChapter >= 1 && newChapter <= book.ch.length) {
                renderBibleChapter(currentReaderBook, newChapter);
                currentReaderChapter = newChapter;
            } else if (direction === 1 && bookIndex < bible.length - 1) {
                // Move to next book, first chapter
                const nextBook = bible[bookIndex + 1];
                renderBibleChapter(nextBook.name, 1);
                currentReaderBook = nextBook.name;
                currentReaderChapter = 1;
            } else if (direction === -1 && bookIndex > 0) {
                // Move to previous book, last chapter
                const prevBook = bible[bookIndex - 1];
                const lastChapter = prevBook.ch.length;
                renderBibleChapter(prevBook.name, lastChapter);
                currentReaderBook = prevBook.name;
                currentReaderChapter = lastChapter;
            }
        };

        // Mark current chapter as read
        window.markCurrentChapterAsRead = () => {
            if (!currentReaderBook || !currentReaderChapter) return;

            const chapterId = `${currentReaderBook}-${currentReaderChapter}`;
            window.toggleChapter(chapterId);

            // Update the button state
            updateMarkReadButton();
        };

        // Render a Bible chapter in the reader
        function renderBibleChapter(bookName, chapterNumber) {
            if (!kjvBibleData) {
                console.error('Bible data not loaded');
                document.getElementById('bible-reader-verses').innerHTML = `
                    <div class="flex flex-col items-center justify-center py-12 px-6 text-center">
                        <svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <h3 class="text-xl font-bold text-slate-800 mb-2">Bible Data Not Loaded</h3>
                        <p class="text-sm text-slate-600 mb-6 max-w-md">
                            The Bible text data is not available. Please refresh the page and try again.
                        </p>
                    </div>
                `;
                return;
            }

            // Update current position
            currentReaderBook = bookName;
            currentReaderChapter = chapterNumber;

            // Find the book and chapter in the JSON
            const bookData = kjvBibleData.find(b => b.book === bookName);
            if (!bookData) {
                console.error(`Book not found: ${bookName}`);
                document.getElementById('bible-reader-verses').innerHTML = `
                    <div class="flex flex-col items-center justify-center py-12 px-6 text-center">
                        <svg class="w-16 h-16 text-amber-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-xl font-bold text-slate-800 mb-2">Book Not Found</h3>
                        <p class="text-sm text-slate-600 mb-6 max-w-md">
                            We couldn't find "${bookName}" in the Bible data.
                        </p>
                    </div>
                `;
                return;
            }

            const chapterData = bookData.chapters.find(c => c.chapter === chapterNumber);
            if (!chapterData) {
                console.error(`Chapter not found: ${bookName} ${chapterNumber}`);
                document.getElementById('bible-reader-verses').innerHTML = `
                    <div class="flex flex-col items-center justify-center py-12 px-6 text-center">
                        <svg class="w-16 h-16 text-amber-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-xl font-bold text-slate-800 mb-2">Chapter Not Found</h3>
                        <p class="text-sm text-slate-600 mb-6 max-w-md">
                            We couldn't find ${bookName} chapter ${chapterNumber} in the Bible data.
                        </p>
                    </div>
                `;
                return;
            }

            // Update title
            document.getElementById('bible-reader-title').textContent = `${bookName} ${chapterNumber}`;

            // Get word count for this chapter
            const bookIndex = bible.findIndex(b => b.name === bookName);
            const wordCount = bible[bookIndex].ch[chapterNumber - 1];
            const readingTime = calculateReadingTime(wordCount);
            document.getElementById('bible-reader-subtitle').textContent = `King James Version ‚Ä¢ ${wordCount} words ‚Ä¢ ${readingTime}`;

            // Render verses
            let html = '<div class="space-y-3">';
            const memorizedForProfile = (appData.memorizedVerses && appData.memorizedVerses[appData.activeProfileId]) || [];
            chapterData.verses.forEach(verseData => {
                const verseId = `${bookName}-${chapterNumber}:${verseData.verse}`;
                const isMemorized = memorizedForProfile.some(v => v.id === verseId);
                const memorizedClass = isMemorized ? 'bg-amber-50 border-l-4 border-amber-400' : '';
                const memorizedIcon = isMemorized ? '<span class="text-amber-500 text-sm" title="Memorized">‚≠ê</span>' : '';
                html += `
                    <div class="bible-verse flex gap-3 p-2 rounded-lg ${memorizedClass} cursor-pointer hover:bg-indigo-50 transition-colors group"
                         onclick="window.toggleVerseSelection('${verseId}', this)"
                         data-verse-id="${verseId}"
                         data-verse-text="${escapeHtml(verseData.text)}"
                         data-verse-ref="${bookName} ${chapterNumber}:${verseData.verse}">
                        <span class="verse-number text-sm font-bold text-indigo-600 flex items-center gap-1">
                            ${verseData.verse}
                            ${memorizedIcon}
                        </span>
                        <p class="flex-1 text-slate-800 leading-relaxed">${addPronunciationIndicators(verseData.text)}</p>
                        <button onclick="event.stopPropagation(); window.toggleMemorizeVerse('${verseId}', '${bookName} ${chapterNumber}:${verseData.verse}', \`${verseData.text.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)"
                                class="opacity-0 group-hover:opacity-100 transition-opacity p-1.5 rounded-lg ${isMemorized ? 'text-amber-500 hover:bg-amber-100' : 'text-slate-400 hover:bg-slate-100'}"
                                title="${isMemorized ? 'Remove from memorization' : 'Add to memorization'}">
                            ${isMemorized ? '‚≠ê' : '‚òÜ'}
                        </button>
                    </div>
                `;
            });
            html += '</div>';

            document.getElementById('bible-reader-verses').innerHTML = html;

            // Scroll to top
            document.getElementById('bible-reader-verses').scrollTop = 0;

            // Update navigation buttons
            updateNavigationButtons();

            // Update mark as read button
            updateMarkReadButton();
        }

        // Update navigation button states
        function updateNavigationButtons() {
            const bookIndex = bible.findIndex(b => b.name === currentReaderBook);
            const book = bible[bookIndex];

            const prevBtn = document.getElementById('bible-reader-prev');
            const nextBtn = document.getElementById('bible-reader-next');

            // Disable previous if at Genesis 1
            if (bookIndex === 0 && currentReaderChapter === 1) {
                prevBtn.disabled = true;
                prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                prevBtn.disabled = false;
                prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }

            // Disable next if at Revelation 22
            if (bookIndex === bible.length - 1 && currentReaderChapter === book.ch.length) {
                nextBtn.disabled = true;
                nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                nextBtn.disabled = false;
                nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Update mark as read button state
        function updateMarkReadButton() {
            const chapterId = `${currentReaderBook}-${currentReaderChapter}`;
            const currentProg = getProgress();
            const isRead = currentProg[chapterId];

            const btn = document.getElementById('bible-reader-mark-read');
            if (isRead) {
                btn.innerHTML = `
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    Marked as Read
                `;
                btn.classList.remove('bg-emerald-500', 'hover:bg-emerald-600');
                btn.classList.add('bg-slate-300', 'cursor-default');
            } else {
                btn.innerHTML = `
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    Mark as Read
                `;
                btn.classList.remove('bg-slate-300', 'cursor-default');
                btn.classList.add('bg-emerald-500', 'hover:bg-emerald-600');
            }
        }

        // Add keyboard navigation for Bible reader
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('bible-reader-modal');
            if (modal.classList.contains('hidden')) return;

            if (e.key === 'Escape') {
                window.closeBibleReader();
            } else if (e.key === 'ArrowLeft') {
                window.navigateBibleChapter(-1);
            } else if (e.key === 'ArrowRight') {
                window.navigateBibleChapter(1);
            }
        });

        // Pre-load Bible text on page load (for offline use)
        window.addEventListener('load', () => {
            loadBibleText();
        });

        // Verse memorization functions
        window.toggleMemorizeVerse = (verseId, verseRef, verseText) => {
            if(!appData.memorizedVerses) {
                appData.memorizedVerses = {};
            }
            if(!appData.memorizedVerses[appData.activeProfileId]) {
                appData.memorizedVerses[appData.activeProfileId] = [];
            }

            const memorizedList = appData.memorizedVerses[appData.activeProfileId];
            const existingIndex = memorizedList.findIndex(v => v.id === verseId);

            if(existingIndex >= 0) {
                // Remove from memorization
                memorizedList.splice(existingIndex, 1);
            } else {
                // Add to memorization
                memorizedList.push({
                    id: verseId,
                    ref: verseRef,
                    text: verseText,
                    addedDate: Date.now()
                });
            }

            window.saveProgress();
            // Re-render the chapter to update the UI
            if(currentReaderBook && currentReaderChapter) {
                renderBibleChapter(currentReaderBook, currentReaderChapter);
            }
        };

        window.toggleVerseSelection = (verseId, element) => {
            // Toggle selection styling
            element.classList.toggle('selected-verse');
            if(element.classList.contains('selected-verse')) {
                element.style.backgroundColor = '#dbeafe';
                element.style.borderLeft = '4px solid #3b82f6';
            } else {
                element.style.backgroundColor = '';
                element.style.borderLeft = '';
            }
        };

        window.showMemorizedVerses = () => {
            const memorizedList = (appData.memorizedVerses && appData.memorizedVerses[appData.activeProfileId]) || [];

            if(memorizedList.length === 0) {
                alert('üìù No verses memorized yet!\n\nOpen the Bible reader and click the ‚òÜ icon next to any verse to add it to your memorization list.');
                return;
            }

            // Create a modal to show memorized verses
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-[100] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-[2rem] w-full max-w-3xl shadow-2xl modal-in border border-white/50 flex flex-col" style="max-height: 85vh;">
                    <div class="flex justify-between items-center p-6 border-b border-slate-200">
                        <div>
                            <h2 class="text-2xl font-black text-slate-900 tracking-tight">Memorized Verses ‚≠ê</h2>
                            <p class="text-sm text-slate-500 mt-1">${memorizedList.length} verse${memorizedList.length !== 1 ? 's' : ''}</p>
                        </div>
                        <button onclick="this.closest('.fixed').remove()" class="p-2 bg-slate-50 hover:bg-slate-100 rounded-full transition-colors text-slate-400 hover:text-slate-600" aria-label="Close">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6">
                        <div class="space-y-4">
                            ${memorizedList.map(verse => `
                                <div class="bg-amber-50 border-l-4 border-amber-400 rounded-lg p-4 hover:shadow-md transition-shadow">
                                    <div class="flex justify-between items-start mb-2">
                                        <h3 class="font-bold text-indigo-900">${verse.ref}</h3>
                                        <button onclick="window.toggleMemorizeVerse('${verse.id}', '${verse.ref}', \`${verse.text.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`); this.closest('.fixed').remove(); window.showMemorizedVerses();"
                                                class="text-amber-500 hover:text-amber-700 transition-colors"
                                                title="Remove from memorization">
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        </button>
                                    </div>
                                    <p class="text-slate-700 leading-relaxed">${verse.text}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };

        const OT_CATS = [
            { name: "Pentateuch", count: 5, style: "bg-green-100 border-green-200 text-green-900", chartColor: "#16a34a" },
            { name: "History (OT)", count: 12, style: "bg-orange-100 border-orange-200 text-orange-900", chartColor: "#ea580c" },
            { name: "Wisdom", count: 5, style: "bg-indigo-100 border-indigo-200 text-indigo-900", chartColor: "#4f46e5" },
            { name: "Major Prophets", count: 5, style: "bg-red-100 border-red-200 text-red-900", chartColor: "#dc2626" },
            { name: "Minor Prophets", count: 12, style: "bg-cyan-100 border-cyan-200 text-cyan-900", chartColor: "#0891b2" }
        ];

        const NT_CATS = [
            { name: "Gospels", count: 4, style: "bg-emerald-100 border-emerald-200 text-emerald-900", chartColor: "#059669" },
            { name: "History (NT)", count: 1, style: "bg-amber-100 border-amber-200 text-amber-900", chartColor: "#d97706" },
            { name: "Pauline Epistles", count: 13, style: "bg-blue-100 border-blue-200 text-blue-900", chartColor: "#2563eb" },
            { name: "General Epistles", count: 8, style: "bg-teal-100 border-teal-200 text-teal-900", chartColor: "#0d9488" },
            { name: "Prophecy", count: 1, style: "bg-purple-100 border-purple-200 text-purple-900", chartColor: "#a855f7" }
        ];

        function assignCategories() {
            let i = 0;
            OT_CATS.forEach(cat => { for(let j=0; j<cat.count; j++) { if(bible[i]) { bible[i].cat = cat.name; bible[i].style = cat.style; bible[i].chartColor = cat.chartColor; i++; } } });
            NT_CATS.forEach(cat => { for(let j=0; j<cat.count; j++) { if(bible[i]) { bible[i].cat = cat.name; bible[i].style = cat.style; bible[i].chartColor = cat.chartColor; i++; } } });
        }

        function getCategoryLabelStyle(categoryName) {
            const allCats = [...OT_CATS, ...NT_CATS];
            const cat = allCats.find(c => c.name === categoryName);
            if (!cat) return "bg-indigo-100 text-indigo-700";
            // Extract just bg and text color from the style string
            const match = cat.style.match(/(bg-\w+-\d+).*(text-\w+-\d+)/);
            return match ? `${match[1]} ${match[2]}` : "bg-indigo-100 text-indigo-700";
        }

        // --- GLOBAL EXPORTS ---
        window.setTab = (t) => {
            activeTab = t;
            window.activeTab = t;
            ['ALL', 'OT', 'NT', 'PLAN', 'STATS', 'TOOLS', 'ABOUT', 'SETTINGS'].forEach(tab => {
                const el = document.getElementById(`tab-${tab.toLowerCase()}`);
                if(el) el.className = (tab === t) ? "px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all tab-active whitespace-nowrap" : "px-5 py-2.5 rounded-xl text-sm font-bold uppercase tracking-wide transition-all text-slate-500 hover:text-indigo-600 whitespace-nowrap";
            });

            // Remove slide-in class from all views first, then hide them
            ['view-books', 'view-stats', 'view-plan', 'view-chapters', 'view-tools', 'view-about', 'view-settings'].forEach(v => {
                const view = document.getElementById(v);
                view.classList.remove('slide-in-right');
                view.classList.add('hidden');
            });

            // Show the selected view with slide-in animation
            if (t === 'STATS') {
                const view = document.getElementById('view-stats');
                view.classList.remove('hidden');
                setTimeout(() => view.classList.add('slide-in-right'), 10);
                window.renderStatsPage();
            }
            else if (t === 'PLAN') {
                const view = document.getElementById('view-plan');
                view.classList.remove('hidden');
                setTimeout(() => view.classList.add('slide-in-right'), 10);
                window.renderDailyPlan();
            }
            else if (t === 'TOOLS') {
                const view = document.getElementById('view-tools');
                view.classList.remove('hidden');
                setTimeout(() => view.classList.add('slide-in-right'), 10);
            }
            else if (t === 'ABOUT') {
                const view = document.getElementById('view-about');
                view.classList.remove('hidden');
                setTimeout(() => view.classList.add('slide-in-right'), 10);
            }
            else if (t === 'SETTINGS') {
                const view = document.getElementById('view-settings');
                view.classList.remove('hidden');
                setTimeout(() => view.classList.add('slide-in-right'), 10);
                window.renderProfileSyncSettings();
                updateDefaultTabSelector();
            }
            else {
                const view = document.getElementById('view-books');
                view.classList.remove('hidden');
                setTimeout(() => view.classList.add('slide-in-right'), 10);
                window.renderBookGrid();
                window.renderSubdivisionStats();
            }
        };

        // Debounce utility function
        const debounce = (func, delay) => {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        };

        window.handleSearch = () => {
            searchQuery = document.getElementById('book-search').value.toLowerCase();

            // Calculate and display search results count
            const resultsCountEl = document.getElementById('search-results-count');
            if (searchQuery) {
                const matchingBooks = bible.filter(b =>
                    (activeTab === 'ALL' || b.testament === activeTab) &&
                    b.name.toLowerCase().includes(searchQuery)
                );
                const count = matchingBooks.length;
                const bookText = count === 1 ? 'book' : 'books';
                resultsCountEl.textContent = `${count} ${bookText} found`;
                resultsCountEl.classList.remove('hidden');
            } else {
                resultsCountEl.classList.add('hidden');
            }

            window.renderBookGrid();
        };

        // Debounced version of handleSearch (300ms delay)
        window.debouncedHandleSearch = debounce(window.handleSearch, 300);

        window.openBook = (idx) => {
            activeBookIdx = idx;
            const book = bible[idx];
            ['view-books', 'view-stats', 'view-plan', 'view-tools', 'view-about', 'view-settings'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('view-chapters').classList.remove('hidden');
            document.getElementById('active-book-title').innerText = book.name;
            const bookLabel = document.getElementById('book-label');
            bookLabel.innerText = book.cat;
            bookLabel.className = `${getCategoryLabelStyle(book.cat)} text-xs font-black px-4 py-2 rounded-full uppercase tracking-widest shadow-sm`;
            window.renderChapterGrid();
            window.scrollTo(0,0);
        };

        window.showBooks = () => window.setTab(activeTab === 'STATS' || activeTab === 'PLAN' || activeTab === 'TOOLS' || activeTab === 'ABOUT' || activeTab === 'SETTINGS' ? 'ALL' : activeTab);

        // Helper function to create celebration confetti
        window.createConfetti = (event) => {
            const button = event.target.closest('button');
            if (!button) return;

            const rect = button.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            // Create 8 confetti particles
            const colors = ['#4f46e5', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'confetti-particle';
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];

                // Random direction
                const angle = (i * 45) + Math.random() * 45;
                const distance = 60 + Math.random() * 40;
                const radians = angle * Math.PI / 180;
                particle.style.setProperty('--tx', Math.cos(radians) * distance + 'px');
                particle.style.setProperty('--ty', Math.sin(radians) * distance - 80 + 'px');

                document.body.appendChild(particle);

                // Remove particle after animation
                setTimeout(() => particle.remove(), 1000);
            }

            // Add celebration class to button
            button.classList.add('checkbox-celebrate');
            setTimeout(() => button.classList.remove('checkbox-celebrate'), 500);
        };

        window.toggleChapter = (id, event) => {
            const prog = getProgress();
            // Store timestamp when marking as read, false when unmarking
            const timestamp = prog[id] ? false : Date.now();
            prog[id] = timestamp;
            setProgress(prog);

            // Show celebration animation when marking as read
            if (timestamp && event) {
                window.createConfetti(event);
            }

            // Apply cross-profile sync if rule exists and chapter is being marked as read
            if(timestamp && appData.profileSyncRules && appData.profileSyncRules[appData.activeProfileId]) {
                const targetProfile = appData.profileSyncRules[appData.activeProfileId];
                if(appData.profiles[targetProfile]) {
                    // Mark the same chapter in the target profile with the same timestamp
                    appData.profiles[targetProfile][id] = timestamp;
                }
            }

            // If using Horner plan and marking as read, track daily completion
            if(timestamp && activePlan === 'HORNER') {
                const listIndex = getHornerListForChapter(id);
                if(listIndex >= 0) {
                    markHornerListComplete(listIndex);
                }
            }

            window.saveProgress();
            window.renderChapterGrid();
        };

        // Mark multiple chapters as read (for daily plans with chapter ranges)
        window.markChaptersAsRead = (bookName, chapters, event) => {
            const prog = getProgress();
            const timestamp = Date.now();

            // Mark all chapters in the range
            chapters.forEach(chapterNum => {
                const chapterId = `${bookName}-${chapterNum}`;
                prog[chapterId] = timestamp;

                // Apply cross-profile sync if rule exists
                if(appData.profileSyncRules && appData.profileSyncRules[appData.activeProfileId]) {
                    const targetProfile = appData.profileSyncRules[appData.activeProfileId];
                    if(appData.profiles[targetProfile]) {
                        appData.profiles[targetProfile][chapterId] = timestamp;
                    }
                }

                // If using Horner plan, track daily completion
                if(activePlan === 'HORNER') {
                    const listIndex = getHornerListForChapter(chapterId);
                    if(listIndex >= 0) {
                        markHornerListComplete(listIndex);
                    }
                }
            });

            setProgress(prog);

            // Show celebration animation
            if (event) {
                window.createConfetti(event);
            }

            window.saveProgress();
            window.renderChapterGrid();
        };

        window.toggleAllInBook = (val) => {
            const book = bible[activeBookIdx];

            // Add confirmation for resetting book progress
            if (!val) {
                const readChapters = book.ch.filter((_, i) => getProgress()[`${book.name}-${i+1}`]).length;
                if (readChapters > 0) {
                    const confirmReset = confirm(
                        `‚ö†Ô∏è RESET ${book.name.toUpperCase()}?\n\n` +
                        `This will unmark ${readChapters} chapter${readChapters !== 1 ? 's' : ''} as unread.\n\n` +
                        `This action cannot be undone.\n\n` +
                        `Are you sure?`
                    );
                    if (!confirmReset) return;
                }
            }

            const prog = getProgress();
            // Store timestamp when marking as read (val=true), false when clearing (val=false)
            const timestamp = val ? Date.now() : false;
            book.ch.forEach((_, i) => {
                const chapterId = `${book.name}-${i+1}`;
                prog[chapterId] = timestamp;

                // Apply cross-profile sync if rule exists and chapters are being marked as read
                if(timestamp && appData.profileSyncRules && appData.profileSyncRules[appData.activeProfileId]) {
                    const targetProfile = appData.profileSyncRules[appData.activeProfileId];
                    if(appData.profiles[targetProfile]) {
                        appData.profiles[targetProfile][chapterId] = timestamp;
                    }
                }
            });
            setProgress(prog);
            window.saveProgress();
            window.renderChapterGrid();
        };

        window.backupData = () => {
            const dataStr = JSON.stringify(appData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);

            // Add timestamp to filename
            const timestamp = new Date().toISOString().split('T')[0];
            linkElement.setAttribute('download', `bibleprogress_backup_${timestamp}.json`);
            linkElement.click();

            // Log backup details for debugging
            const profileCount = Object.keys(appData.profiles).length;
            console.log(`‚úÖ Backed up ${profileCount} profile(s):`, Object.keys(appData.profiles).join(', '));
        };

        window.restoreData = (input) => {
            const file = input.files[0];
            if (!file) return;

            // Security: Validate file type
            if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                alert("Invalid file type. Please upload a .json file.");
                input.value = ''; // Clear the input
                return;
            }

            // Security: Validate file size (max 5MB)
            const maxSize = 5 * 1024 * 1024; // 5MB in bytes
            if (file.size > maxSize) {
                alert("File too large. Maximum size is 5MB.");
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (typeof data === 'object' && data !== null) {
                        if(data.profiles && validateAppData(data)) {
                            appData = data;

                            // Ensure profilePlans exists for all profiles
                            if(!appData.profilePlans) {
                                appData.profilePlans = {};
                            }
                            Object.keys(appData.profiles).forEach(profileName => {
                                if(!appData.profilePlans[profileName]) {
                                    appData.profilePlans[profileName] = 'SEQUENTIAL';
                                }
                            });

                            // Ensure profileSyncRules exists (migration for existing backups)
                            if(!appData.profileSyncRules) {
                                appData.profileSyncRules = {};
                            }

                            // Ensure reading time settings exist (migration for existing backups)
                            if(appData.showReadingTime === undefined) {
                                appData.showReadingTime = false;
                            }
                            if(!appData.wordsPerMinute) {
                                appData.wordsPerMinute = 250;
                            }

                            // Ensure defaultProfileId exists and is valid
                            if(!appData.defaultProfileId || !appData.profiles[appData.defaultProfileId]) {
                                appData.defaultProfileId = appData.activeProfileId || Object.keys(appData.profiles)[0];
                            }

                            // Ensure activeProfileId is valid
                            if(!appData.profiles[appData.activeProfileId]) {
                                appData.activeProfileId = Object.keys(appData.profiles)[0];
                            }

                            // Log restore details for debugging
                            const profileCount = Object.keys(appData.profiles).length;
                            console.log(`‚úÖ Restored ${profileCount} profile(s):`, Object.keys(appData.profiles).join(', '));
                        } else if (typeof data === 'object') {
                            // Legacy format: single profile data
                            appData.profiles[appData.activeProfileId] = data;
                            console.log(`‚úÖ Restored legacy single profile data to "${appData.activeProfileId}"`);
                        } else {
                            throw new Error("Invalid data structure");
                        }
                        window.saveProgress();

                        // Show success message in settings view if present
                        const msgSettings = document.getElementById('restore-msg-settings');
                        if(msgSettings) {
                            const profileCount = Object.keys(appData.profiles).length;
                            const profileWord = profileCount === 1 ? 'profile' : 'profiles';
                            msgSettings.innerText = `Success! Restored ${profileCount} ${profileWord}.`;
                            msgSettings.classList.remove('hidden');
                            setTimeout(() => msgSettings.classList.add('hidden'), 3000);
                        }

                        window.updateStats();
                        window.location.reload();
                    } else {
                        throw new Error("Invalid JSON structure");
                    }
                } catch(err) {
                    console.error("Restore error:", err);
                    alert("Invalid backup file. Please check the file format.");
                }
                input.value = ''; // Clear input after processing
            };
            reader.readAsText(file);
        };

        // --- RENDER FUNCTIONS ---
        function normalizeBookName(name) {
            let base = name.split(':')[0];
            const parts = base.split(' ');
            const last = parts[parts.length-1];
            let chapterStr = null;
            if (!isNaN(last) && !last.includes('-')) {
                chapterStr = parts.pop();
            } else if (last.includes('-')) {
                chapterStr = parts.pop();
            }
            let bookName = parts.join(' ');
            if(bookName === "SongOfSongs") bookName = "Song of Solomon";
            if(bookName === "Psalm") bookName = "Psalms";
            bookName = bookName.replace(/(\d)([A-Za-z])/g, '$1 $2');
            return { bookName, chapterStr };
        }

        function getChaptersFromStr(str) {
            if(!str) return [];
            if(str.includes('-')) {
                const [start, end] = str.split('-').map(Number);
                const arr = [];
                for(let i=start; i<=end; i++) arr.push(i);
                return arr;
            }
            return [parseInt(str)];
        }

        window.renderDailyPlan = () => {
            const list = document.getElementById('daily-plan-list');
            const footerMsg = document.getElementById('plan-footer-msg');
            const descBox = document.getElementById('plan-description-box');
            const currentProg = getProgress();
            
            list.innerHTML = '';
            footerMsg.innerText = '';
            
            let nextChapters = [];
            let descText = "";

            if (activePlan === 'SEQUENTIAL') {
                descText = "<strong>Canonical:</strong> Genesis to Revelation. Next 3 unread chapters.";
                let found = 0; const target = 3;
                for (let b = 0; b < bible.length; b++) {
                    const book = bible[b];
                    for (let c = 0; c < book.ch.length; c++) {
                        if (!currentProg[`${book.name}-${c+1}`]) {
                            nextChapters.push({ book: book.name, chapter: c + 1, chapters: [c + 1], words: book.ch[c], label: `${book.name} ${c+1}` });
                            found++;
                            if (found >= target) break;
                        }
                    }
                    if (found >= target) break;
                }
                if (nextChapters.length === 0) { list.innerHTML = `<div class="text-center p-8 bg-white/10 rounded-2xl font-bold text-lg">üéâ You have finished the entire Bible!</div>`; return; }
            }

            else if (activePlan === 'ONE_YEAR') {
                descText = "<strong>One Year:</strong> 3 OT + 1 NT chapters daily.";

                // Find next 3 unread OT chapters
                let otFound = 0;
                for (let b = 0; b < bible.length; b++) {
                    const book = bible[b];
                    if (book.testament !== 'OT') continue;
                    for (let c = 0; c < book.ch.length; c++) {
                        if (!currentProg[`${book.name}-${c+1}`]) {
                            nextChapters.push({
                                book: book.name,
                                chapter: c + 1,
                                chapters: [c + 1],
                                words: book.ch[c],
                                label: `${book.name} ${c+1}`,
                                badge: "Old Testament"
                            });
                            otFound++;
                            if (otFound >= 3) break;
                        }
                    }
                    if (otFound >= 3) break;
                }

                // Find next 1 unread NT chapter
                let ntFound = 0;
                for (let b = 0; b < bible.length; b++) {
                    const book = bible[b];
                    if (book.testament !== 'NT') continue;
                    for (let c = 0; c < book.ch.length; c++) {
                        if (!currentProg[`${book.name}-${c+1}`]) {
                            nextChapters.push({
                                book: book.name,
                                chapter: c + 1,
                                chapters: [c + 1],
                                words: book.ch[c],
                                label: `${book.name} ${c+1}`,
                                badge: "New Testament"
                            });
                            ntFound++;
                            if (ntFound >= 1) break;
                        }
                    }
                    if (ntFound >= 1) break;
                }

                if (nextChapters.length === 0) {
                    list.innerHTML = `<div class="text-center p-8 bg-white/10 rounded-2xl font-bold text-lg">üéâ You have finished the entire Bible!</div>`;
                    return;
                }

                const totalChaptersRead = Object.keys(currentProg).filter(k => currentProg[k]).length;
                const totalChapters = bible.reduce((sum, b) => sum + b.ch.length, 0);
                const daysElapsed = Math.ceil(totalChaptersRead / 4); // Approximate days (4 chapters/day)
                footerMsg.innerText = `Approximately Day ${daysElapsed} of 365 ‚Ä¢ ${totalChapters - totalChaptersRead} chapters remaining`;
            }

            else if (activePlan === 'MCHEYNE') {
                descText = "<strong>M'Cheyne:</strong> 4 chapters daily. NT twice, OT once per year.";
                let currentDay = null;
                
                for(let i=0; i<PLAN_MCHEYNE.length; i++) {
                    const day = PLAN_MCHEYNE[i];
                    let allRead = true;
                    for(let r of day.r) {
                        const { bookName, chapterStr } = normalizeBookName(r);
                        const appBook = bible.find(b => b.name === bookName);
                        if(!appBook) continue;
                        const chs = getChaptersFromStr(chapterStr);
                        for(let c of chs) {
                            if(!currentProg[`${appBook.name}-${c}`]) {
                                allRead = false;
                                break;
                            }
                        }
                        if(!allRead) break;
                    }
                    if(!allRead) {
                        currentDay = day;
                        break;
                    }
                }

                if(!currentDay) { list.innerHTML = `<div class="text-center p-8 bg-white/10 rounded-2xl font-bold text-lg">üéâ M'Cheyne Plan Completed!</div>`; return; }
                
                footerMsg.innerText = `M'Cheyne Day ${currentDay.d} of 365`;
                
                currentDay.r.forEach((refStr, idx) => {
                     const { bookName, chapterStr } = normalizeBookName(refStr);
                     const appBook = bible.find(b => b.name === bookName);
                     if(appBook) {
                         const chs = getChaptersFromStr(chapterStr);
                         const firstCh = chs[0];
                         let isRead = true;
                         chs.forEach(c => { if(!currentProg[`${appBook.name}-${c}`]) isRead = false; });
                         
                         const type = idx < 2 ? "Family" : "Secret";
                         
                         nextChapters.push({
                             book: appBook.name,
                             chapter: firstCh,
                             chapters: chs,
                             words: appBook.ch[firstCh-1] * chs.length,
                             label: refStr,
                             badge: type,
                             isComplete: isRead
                         });
                     }
                });
            }

            else if (activePlan === 'HORNER') {
                descText = "<strong>Horner:</strong> 1 chapter from each of 10 rotating lists. <a href='horner.html' target='_blank' class='inline-flex items-center gap-1 ml-2 px-2.5 py-1 text-xs font-semibold text-indigo-600 hover:text-indigo-700 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-all duration-200 border border-indigo-200' style='text-decoration: none;'><svg class='w-3 h-3' fill='currentColor' viewBox='0 0 20 20'><path d='M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z'/></svg>Analytics</a>";
                resetHornerDailyProgressIfNeeded();
                const todayStr = getTodaysDate();

                PLAN_HORNER.forEach((listBooks, listIdx) => {
                    const isListCompleteToday = appData.hornerDailyProgress[appData.activeProfileId].completedLists.includes(listIdx);

                    let foundForList = false;

                    if(isListCompleteToday) {
                        // List is complete today - find the chapter that was read TODAY
                        for(let bName of listBooks) {
                            const appBook = bible.find(b => b.name === bName);
                            if(!appBook) continue;
                            for(let c=0; c<appBook.ch.length; c++) {
                                const chapterId = `${appBook.name}-${c+1}`;
                                const timestamp = currentProg[chapterId];

                                // Check if this chapter was read today
                                if(timestamp && getLocalDateString(timestamp) === todayStr) {
                                    nextChapters.push({
                                        book: appBook.name,
                                        chapter: c+1,
                                        chapters: [c+1],
                                        words: appBook.ch[c],
                                        label: `${appBook.name} ${c+1}`,
                                        badge: `List ${listIdx+1}`,
                                        isComplete: true  // This chapter was read today, show as complete
                                    });
                                    foundForList = true;
                                    break;
                                }
                            }
                            if(foundForList) break;
                        }
                    } else {
                        // List is NOT complete today - find the next unread chapter
                        for(let bName of listBooks) {
                            const appBook = bible.find(b => b.name === bName);
                            if(!appBook) continue;
                            for(let c=0; c<appBook.ch.length; c++) {
                                if(!currentProg[`${appBook.name}-${c+1}`]) {
                                    const chapterId = `${appBook.name}-${c+1}`;
                                    nextChapters.push({
                                        book: appBook.name,
                                        chapter: c+1,
                                        chapters: [c+1],
                                        words: appBook.ch[c],
                                        label: `${appBook.name} ${c+1}`,
                                        badge: `List ${listIdx+1}`,
                                        isComplete: false  // This is an unread chapter, show normally
                                    });
                                    foundForList = true;
                                    break;
                                }
                            }
                            if(foundForList) break;
                        }
                    }
                });
                const completedCount = appData.hornerDailyProgress[appData.activeProfileId].completedLists.length;
                footerMsg.innerText = `Professor Horner's System (${completedCount}/10 lists completed today)`;
            }

            else if (activePlan === 'FIVE_DAY') {
                descText = "<strong>Five-Day Plan:</strong> Read the entire Bible in one year, 5 days a week (weekends off!). <span class='inline-flex items-center gap-1 px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs font-semibold ml-2'>‚ú® Sustainable Pace</span><br><span class='text-xs opacity-90 mt-1 block'>Old Testament in chronological order ‚Ä¢ New Testament spread throughout the year</span>";

                // Calculate current week number based on total chapters read
                const totalChaptersRead = Object.keys(currentProg).filter(k => currentProg[k]).length;
                const estimatedWeek = Math.min(Math.floor(totalChaptersRead / 5) + 1, 52); // 5 chapters per week average

                // Find the current reading position
                let currentWeek = null;
                for(let week of PLAN_FIVE_DAY.schedule) {
                    let allRead = true;
                    for(let reading of week.readings) {
                        for(let scriptureRef of reading.scriptures) {
                            const { bookName, chapterStr } = normalizeBookName(scriptureRef);
                            const appBook = bible.find(b => b.name === bookName);
                            if(!appBook) continue;
                            const chs = getChaptersFromStr(chapterStr);
                            for(let c of chs) {
                                if(!currentProg[`${appBook.name}-${c}`]) {
                                    allRead = false;
                                    break;
                                }
                            }
                            if(!allRead) break;
                        }
                        if(!allRead) break;
                    }
                    if(!allRead) {
                        currentWeek = week;
                        break;
                    }
                }

                if(!currentWeek) {
                    list.innerHTML = `<div class="text-center p-8 bg-white/10 rounded-2xl font-bold text-lg">üéâ Five-Day Plan Completed!</div>`;
                    return;
                }

                footerMsg.innerText = `Week ${currentWeek.week_number} of 52 (${currentWeek.date_range})`;

                // Show this week's readings
                currentWeek.readings.forEach((reading, idx) => {
                    reading.scriptures.forEach((scriptureRef) => {
                        const { bookName, chapterStr } = normalizeBookName(scriptureRef);
                        const appBook = bible.find(b => b.name === bookName);
                        if(appBook) {
                            const chs = getChaptersFromStr(chapterStr);
                            const firstCh = chs[0];
                            let isRead = true;
                            chs.forEach(c => { if(!currentProg[`${appBook.name}-${c}`]) isRead = false; });

                            // Calculate total words for this reading
                            let totalWordsForReading = 0;
                            chs.forEach(c => {
                                if(appBook.ch[c-1]) {
                                    totalWordsForReading += appBook.ch[c-1];
                                }
                            });

                            nextChapters.push({
                                book: appBook.name,
                                chapter: firstCh,
                                chapters: chs,
                                words: totalWordsForReading,
                                label: scriptureRef,
                                badge: `Day ${reading.day}`,
                                isComplete: isRead
                            });
                        }
                    });
                });
            }

            if(descBox) {
                descBox.innerHTML = descText;
                descBox.classList.remove('hidden');
            }

            // Calculate remaining reading time if enabled (only unread chapters)
            let totalWords = 0;
            if(appData.showReadingTime) {
                totalWords = nextChapters.reduce((sum, item) => sum + (item.isComplete ? 0 : (item.words || 0)), 0);
                const totalTime = calculateReadingTime(totalWords);
                // Add remaining reading time to footer message
                if(totalWords > 0) {
                    if(footerMsg.innerText) {
                        footerMsg.innerText += ` ‚Ä¢ ${totalTime} left`;
                    } else {
                        footerMsg.innerText = `${totalTime} left`;
                    }
                }
            }

            list.innerHTML = nextChapters.map(item => {
                const badgeHtml = item.badge ? `<span class="bg-indigo-500 text-white text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wider ml-2 opacity-90">${item.badge}</span>` : '';
                const chapterId = `${item.book}-${item.chapter}`;

                const opacityClass = item.isComplete ? "opacity-60 grayscale" : "";
                const strikeClass = item.isComplete ? "line-through text-slate-400 decoration-slate-300" : "text-slate-800";
                const checkMark = item.isComplete ? `<span class="text-emerald-500 mr-2 font-black">‚úì</span>` : '';
                const bgClass = item.isComplete ? "bg-slate-50" : "bg-white hover:bg-indigo-50 hover:border-indigo-200 hover:scale-[1.01] hover:shadow-md";

                // Calculate reading time and word count metadata for this chapter
                const metadataHtml = appData.showReadingTime ?
                    `<div class="text-[10px] font-bold text-slate-500 tracking-wide mt-1.5 flex items-center gap-2">
                        <span class="text-slate-400">~${item.words} words</span>
                        <span class="text-slate-300">‚Ä¢</span>
                        <span class="text-indigo-600">üìñ ${calculateReadingTime(item.words)}</span>
                    </div>` :
                    `<div class="text-[10px] font-bold text-slate-400 tracking-wide mt-1.5">~${item.words} words</div>`;

                // Get chapter summary - normalize book name and chapter to match JSON format
                const summaryKey = `${item.book.toLowerCase().replace(/ /g, '-')}-${item.chapter}`;
                const summary = chapterSummaries[summaryKey];
                const summaryHtml = summary ?
                    `<div class="hidden sm:block mt-3 pt-3 border-t border-slate-200">
                        <div class="text-xs text-slate-600 leading-relaxed italic">"${summary}"</div>
                    </div>` : '';

                return `<button onclick="window.openBibleReader('${item.book}', ${item.chapter})" class="block ${bgClass} text-slate-800 p-5 rounded-2xl flex items-center justify-between transition-all duration-200 border border-slate-100 shadow-sm ${opacityClass} relative group w-full text-left cursor-pointer" aria-label="Read ${item.label}${item.isComplete ? ', completed' : ''}">
                    <div class="flex-1">
                        <div class="text-[10px] font-black text-indigo-500 uppercase tracking-widest mb-1">Read Now${badgeHtml}</div>
                        <div class="font-bold text-xl leading-tight ${strikeClass}">${checkMark}${item.label}</div>
                        ${metadataHtml}
                        ${summaryHtml}
                    </div>
                    ${!item.isComplete ? `
                    <button onclick="event.preventDefault(); event.stopPropagation(); window.markChaptersAsRead('${item.book}', ${JSON.stringify(item.chapters)}, event); window.renderDailyPlan();"
                        class="absolute top-2 right-2 bg-emerald-500/80 hover:bg-emerald-600 text-white p-2 sm:px-3 sm:py-2 rounded-lg text-xs shadow-sm hover:shadow-md transition-all duration-200 flex items-center gap-1.5 z-10 opacity-0 group-hover:opacity-100"
                        title="Mark as Read" aria-label="Mark ${item.label} as read">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="hidden sm:inline">Mark Read</span>
                    </button>
                    ` : ''}
                    <div class="text-right flex items-center ${!item.isComplete ? 'opacity-0 group-hover:opacity-100' : ''}">
                        <div class="flex items-center gap-1">
                            <span class="text-xs font-bold text-indigo-500">Read</span>
                            <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                        </div>
                    </div>
                </button>`;
            }).join('');
        }

        window.renderBookGrid = () => {
            const grid = document.getElementById('book-grid');
            const currentProg = getProgress();
            const books = bible.filter(b => (activeTab === 'ALL' || b.testament === activeTab) && b.name.toLowerCase().includes(searchQuery));
            if (books.length === 0) { grid.innerHTML = `<div class="col-span-full text-center text-slate-400 font-bold py-12 bg-white/50 rounded-3xl border border-dashed border-slate-300">No books found.</div>`; return; }

            // Helper function to render a book card
            const renderBookCard = (book) => {
                const bookIdx = bible.indexOf(book);
                const readChapters = book.ch.filter((_, cIdx) => currentProg[`${book.name}-${cIdx + 1}`]).length;
                const readWords = book.ch.reduce((sum, words, cIdx) => {
                    return sum + (currentProg[`${book.name}-${cIdx + 1}`] ? words : 0);
                }, 0);
                const totalWords = book.ch.reduce((sum, words) => sum + words, 0);
                const progressPercent = (readWords / totalWords) * 100;
                const isComplete = readChapters === book.ch.length;
                const ringColor = isComplete ? 'ring-2 ring-emerald-400' : 'ring-1 ring-slate-100 hover:ring-indigo-300';
                return `<div onclick="window.openBook(${bookIdx})" class="book-card ${book.style} p-6 rounded-[1.5rem] cursor-pointer ${ringColor} bg-opacity-60 backdrop-blur-sm relative overflow-hidden" role="button" aria-label="Open ${book.name}, ${readChapters} of ${book.ch.length} chapters read" tabindex="0" onkeypress="if(event.key==='Enter'||event.key===' ')window.openBook(${bookIdx})">
                    <div class="flex justify-between items-start mb-4 relative z-10">
                        <h3 class="font-black text-sm uppercase tracking-tight leading-tight">${book.name}</h3>
                        ${isComplete ? '<span class="text-sm bg-white/80 rounded-full px-1.5 py-0.5 shadow-sm" aria-label="Book completed">‚úÖ</span>' : ''}
                    </div>
                    <div class="flex flex-col gap-2 relative z-10">
                         <span class="text-[10px] font-black opacity-60 uppercase tracking-wider">${readChapters} / ${book.ch.length} Ch</span>
                        <div class="w-full bg-white/60 h-2 rounded-full overflow-hidden" role="progressbar" aria-valuenow="${Math.round(progressPercent)}" aria-valuemin="0" aria-valuemax="100" aria-label="Book progress">
                            <div class="h-full transition-all duration-700 ${isComplete ? 'bg-emerald-500' : 'bg-current opacity-60'}" style="width: ${progressPercent}%"></div>
                        </div>
                    </div>
                </div>`;
            };

            // If showing ALL books, render with testament dividers
            if (activeTab === 'ALL' && searchQuery === '') {
                const otBooks = books.filter(b => b.testament === 'OT');
                const ntBooks = books.filter(b => b.testament === 'NT');

                let html = '';

                if (otBooks.length > 0) {
                    html += `<div class="col-span-full mb-2">
                        <div class="flex items-center gap-3 sm:gap-4">
                            <div class="h-0.5 flex-1 bg-gradient-to-r from-transparent via-amber-400/40 to-amber-400/60 rounded-full"></div>
                            <h2 class="text-sm sm:text-base font-black uppercase tracking-wider text-amber-800 bg-gradient-to-br from-amber-50 to-amber-100/80 px-4 sm:px-6 py-1.5 sm:py-2 rounded-full border border-amber-300/50 shadow-sm backdrop-blur-sm">
                                <span class="hidden sm:inline">üìú </span>Old Testament
                            </h2>
                            <div class="h-0.5 flex-1 bg-gradient-to-l from-transparent via-amber-400/40 to-amber-400/60 rounded-full"></div>
                        </div>
                    </div>`;
                    html += otBooks.map(renderBookCard).join('');
                }

                if (ntBooks.length > 0) {
                    html += `<div class="col-span-full mb-2 mt-8 sm:mt-10">
                        <div class="flex items-center gap-3 sm:gap-4">
                            <div class="h-0.5 flex-1 bg-gradient-to-r from-transparent via-sky-400/40 to-sky-400/60 rounded-full"></div>
                            <h2 class="text-sm sm:text-base font-black uppercase tracking-wider text-sky-800 bg-gradient-to-br from-sky-50 to-sky-100/80 px-4 sm:px-6 py-1.5 sm:py-2 rounded-full border border-sky-300/50 shadow-sm backdrop-blur-sm">
                                <span class="hidden sm:inline">‚ú® </span>New Testament
                            </h2>
                            <div class="h-0.5 flex-1 bg-gradient-to-l from-transparent via-sky-400/40 to-sky-400/60 rounded-full"></div>
                        </div>
                    </div>`;
                    html += ntBooks.map(renderBookCard).join('');
                }

                grid.innerHTML = html;
            } else {
                // Original behavior for OT/NT specific tabs or when searching
                grid.innerHTML = books.map(renderBookCard).join('');
            }
        }

        window.renderChapterGrid = () => {
            const book = bible[activeBookIdx];
            const grid = document.getElementById('chapter-grid');
            const currentProg = getProgress();
            let readInBook = 0;
            let readWordsInBook = 0;
            grid.innerHTML = book.ch.map((words, cIdx) => {
                const id = `${book.name}-${cIdx + 1}`;
                const isRead = currentProg[id];
                if (isRead) {
                    readInBook++;
                    readWordsInBook += words;
                }
                return `<div class="relative group">
                    <button onclick="window.toggleChapter('${id}', event)" class="h-20 w-full rounded-2xl border-2 transition-all flex flex-col items-center justify-center gap-1 ${isRead ? 'bg-indigo-600 text-white border-indigo-600 shadow-md shadow-indigo-200 scale-95' : 'bg-white text-slate-300 border-slate-100 hover:border-indigo-300 hover:text-indigo-600 hover:shadow-lg hover:-translate-y-1'}" aria-label="Chapter ${cIdx + 1}, ${words} words, ${isRead ? 'read' : 'not read'}" aria-pressed="${isRead}">
                        <span class="text-xl sm:text-2xl font-black ${isRead ? 'text-white' : 'text-slate-700 group-hover:text-indigo-600'}">${cIdx + 1}</span>
                        <span class="text-[9px] font-bold uppercase tracking-wider ${isRead ? 'text-indigo-200' : 'text-slate-400'}">${words}w</span>
                    </button>
                    <button onclick="event.stopPropagation(); window.openBibleReader('${book.name}', ${cIdx + 1})" title="Read chapter" class="absolute top-2 right-2 p-1.5 rounded-full bg-white/80 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all shadow-sm md:opacity-0 md:group-hover:opacity-100 z-10" aria-label="Read ${book.name} chapter ${cIdx + 1}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                    </button>
                </div>`;
            }).join('');
            const totalWordsInBook = book.ch.reduce((sum, words) => sum + words, 0);
            const unreadWordsInBook = totalWordsInBook - readWordsInBook;
            document.getElementById('book-inner-bar').style.width = (readWordsInBook / totalWordsInBook) * 100 + '%';

            // Calculate and display reading time estimate for remaining chapters
            const avgWordsPerMinute = appData.wordsPerMinute || 250;
            const minutesRemaining = Math.ceil(unreadWordsInBook / avgWordsPerMinute);
            let timeEstimate = '';
            let chaptersText = `${readInBook}/${book.ch.length} chapters`;

            if (unreadWordsInBook === 0) {
                timeEstimate = '‚úÖ Complete!';
            } else if (minutesRemaining < 60) {
                timeEstimate = `‚è±Ô∏è ~${minutesRemaining} min left`;
            } else {
                const hours = Math.floor(minutesRemaining / 60);
                const mins = minutesRemaining % 60;
                if (mins === 0) {
                    timeEstimate = `‚è±Ô∏è ~${hours} hr left`;
                } else {
                    timeEstimate = `‚è±Ô∏è ~${hours}h ${mins}m left`;
                }
            }

            document.getElementById('book-chapters-read').innerText = chaptersText;
            document.getElementById('book-time-left').innerText = timeEstimate;
            window.updateStats();
        }

        window.updateStats = () => {
            let totalRead = 0; let otRead = 0; let ntRead = 0; let finishedBooks = 0;
            const currentProg = getProgress();
            bible.forEach(book => {
                let bookChaptersRead = 0;
                book.ch.forEach((words, cIdx) => {
                    if (currentProg[`${book.name}-${cIdx+1}`]) {
                        totalRead += words;
                        if(book.testament === 'OT') otRead += words; else ntRead += words;
                        bookChaptersRead++;
                    }
                });
                if (bookChaptersRead === book.ch.length) finishedBooks++;
            });
            const getPerc = (val, max) => ((val / max) * 100).toFixed(2);
            document.getElementById('total-progress-bar').style.width = (totalRead / WORD_TOTALS.GLOBAL * 100) + '%';
            document.getElementById('total-percent').innerText = getPerc(totalRead, WORD_TOTALS.GLOBAL) + '%';
            document.getElementById('ot-percent').innerText = getPerc(otRead, WORD_TOTALS.OT) + '%';
            document.getElementById('ot-progress-bar').style.width = (otRead / WORD_TOTALS.OT * 100) + '%';
            document.getElementById('nt-percent').innerText = getPerc(ntRead, WORD_TOTALS.NT) + '%';
            document.getElementById('nt-progress-bar').style.width = (ntRead / WORD_TOTALS.NT * 100) + '%';
            document.getElementById('books-completed-stat').innerText = `${finishedBooks} OF 66 BOOKS READ`;

            // Update header streak badge
            updateHeaderStreakBadge();
        }

        window.toggleProgressView = () => {
            const totalSection = document.getElementById('total-progress-section');
            const testamentSection = document.getElementById('testament-progress-section');

            if (testamentSection.classList.contains('hidden')) {
                // Show testament view, hide total
                totalSection.classList.add('hidden');
                testamentSection.classList.remove('hidden');
            } else {
                // Show total view, hide testament
                totalSection.classList.remove('hidden');
                testamentSection.classList.add('hidden');
            }
        }

        window.goToStreakSection = () => {
            // Switch to STATS tab
            window.setTab('STATS');

            // Scroll to streak section after a brief delay to allow tab rendering
            setTimeout(() => {
                const streakElement = document.getElementById('current-streak');
                if (streakElement) {
                    streakElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }

        window.renderSubdivisionStats = () => {
            const cats = activeTab === 'ALL' ? [...OT_CATS, ...NT_CATS] : (activeTab === 'OT' ? OT_CATS : NT_CATS);
            const container = document.getElementById('subdivision-bar');
            const currentProg = getProgress();
            let catStats = cats.map(c => {
                let totalW = 0, readW = 0;
                bible.filter(b => b.cat === c.name).forEach(b => {
                    b.ch.forEach((w, idx) => { totalW += w; if(currentProg[`${b.name}-${idx+1}`]) readW += w; });
                });
                return { ...c, percent: (readW/totalW*100).toFixed(1) };
            });
            container.innerHTML = catStats.map(c => `<div class="flex-shrink-0 flex items-center gap-2 px-4 py-2 rounded-full border text-xs font-bold uppercase tracking-wide ${c.style}"><span class="opacity-70">${c.name}</span><span>${c.percent}%</span></div>`).join('');
        }

        // --- HEATMAP & STREAK FUNCTIONS ---

        function updateHeaderStreakBadge() {
            const badge = document.getElementById('header-streak-badge');
            const countEl = document.getElementById('header-streak-count');
            const emojiEl = document.getElementById('header-streak-emoji');

            if(!badge || !countEl || !emojiEl) return;

            const streaks = calculateStreaks();
            const currentStreak = streaks.current;

            if(currentStreak > 0) {
                // Show badge
                badge.classList.remove('hidden');
                countEl.innerText = currentStreak;

                // Update emoji based on streak level
                if(currentStreak >= 365) emojiEl.innerText = 'üëë';
                else if(currentStreak >= 100) emojiEl.innerText = 'üíé';
                else if(currentStreak >= 30) emojiEl.innerText = 'üî•';
                else if(currentStreak >= 7) emojiEl.innerText = '‚ö°';
                else emojiEl.innerText = 'üî•';
            } else {
                // Hide badge when no streak
                badge.classList.add('hidden');
            }
        }

        function getReadingActivity() {
            // Returns a map of date string (YYYY-MM-DD) to chapter count
            const currentProg = getProgress();
            const activityMap = {};

            Object.keys(currentProg).forEach(chapterKey => {
                const timestamp = currentProg[chapterKey];
                if(timestamp && typeof timestamp === 'number') {
                    const dateStr = getLocalDateString(timestamp);
                    activityMap[dateStr] = (activityMap[dateStr] || 0) + 1;
                }
            });

            return activityMap;
        }

        function calculateStreaks() {
            const activityMap = getReadingActivity();
            const dates = Object.keys(activityMap).sort();

            if(dates.length === 0) {
                return { current: 0, longest: 0 };
            }

            let currentStreak = 0;
            let longestStreak = 0;
            let tempStreak = 0;

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Check if there's activity today or yesterday (using local timezone)
            const todayStr = getLocalDateString(today.getTime());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = getLocalDateString(yesterday.getTime());

            const hasRecentActivity = activityMap[todayStr] || activityMap[yesterdayStr];

            // Calculate longest streak and current streak
            for(let i = 0; i < dates.length; i++) {
                if(i === 0) {
                    tempStreak = 1;
                } else {
                    const prevDate = new Date(dates[i-1]);
                    const currDate = new Date(dates[i]);
                    const diffDays = Math.floor((currDate - prevDate) / (1000 * 60 * 60 * 24));

                    if(diffDays === 1) {
                        tempStreak++;
                    } else {
                        tempStreak = 1;
                    }
                }

                longestStreak = Math.max(longestStreak, tempStreak);
            }

            // Calculate current streak (only if recent activity)
            if(hasRecentActivity) {
                let checkDate = new Date(today);
                currentStreak = 0;

                for(let i = 0; i < 365; i++) {
                    const checkStr = getLocalDateString(checkDate.getTime());
                    if(activityMap[checkStr]) {
                        currentStreak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else if(i > 0) {
                        // Allow one day grace (yesterday), but break if older
                        break;
                    } else {
                        // No activity today, check yesterday
                        checkDate.setDate(checkDate.getDate() - 1);
                    }
                }
            }

            return { current: currentStreak, longest: longestStreak };
        }

        function renderHeatmap() {
            const activityMap = getReadingActivity();
            const container = document.getElementById('heatmap-container');

            if(!container) return;

            // Find the earliest reading date
            const activityDates = Object.keys(activityMap);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let daysToShow = 365; // Default to 365 days

            if(activityDates.length > 0) {
                // Find earliest date
                const earliestDate = new Date(Math.min(...activityDates.map(d => new Date(d))));
                earliestDate.setHours(0, 0, 0, 0);

                // Calculate days between earliest and today
                const daysSinceFirst = Math.floor((today - earliestDate) / (1000 * 60 * 60 * 24)) + 1;

                // Use adaptive range: minimum 30 days, maximum 365 days
                daysToShow = Math.min(Math.max(daysSinceFirst, 30), 365);
            } else {
                // No reading activity yet, show last 30 days
                daysToShow = 30;
            }

            // Generate days based on adaptive range
            const days = [];
            for(let i = daysToShow - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = getLocalDateString(date.getTime());
                const count = activityMap[dateStr] || 0;
                days.push({ date: dateStr, count, dayOfWeek: date.getDay() });
            }

            // Group by week
            const weeks = [];
            let currentWeek = [];

            // Pad start to align with Sunday
            const firstDayOfWeek = days[0].dayOfWeek;
            for(let i = 0; i < firstDayOfWeek; i++) {
                currentWeek.push({ empty: true });
            }

            days.forEach((day, idx) => {
                currentWeek.push(day);
                if(currentWeek.length === 7 || idx === days.length - 1) {
                    // Pad end of last week
                    while(currentWeek.length < 7) {
                        currentWeek.push({ empty: true });
                    }
                    weeks.push(currentWeek);
                    currentWeek = [];
                }
            });

            // Determine max count for statistics
            const maxCount = Math.max(...days.map(d => d.count), 1);

            // Generate HTML with improved color scale based on meaningful thresholds
            const getColor = (count) => {
                if(count === 0) return '#f1f5f9'; // slate-100 (no reading)
                if(count <= 2) return '#bfdbfe'; // blue-200 (light day: 1-2 chapters)
                if(count <= 5) return '#60a5fa'; // blue-400 (standard day: 3-5 chapters, M'Cheyne plan)
                if(count <= 10) return '#3b82f6'; // blue-500 (intensive day: 6-10 chapters)
                return '#1e40af'; // blue-800 (very intensive: 11+ chapters)
            };

            const monthLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            let html = '<div class="flex gap-1">';

            // Day labels (S M T W T F S)
            html += '<div class="flex flex-col gap-1 text-[10px] text-slate-400 font-medium pr-1 justify-around" style="height: 105px;">';
            ['S', 'M', 'T', 'W', 'T', 'F', 'S'].forEach(day => {
                html += `<div style="height: 11px; line-height: 11px;">${day}</div>`;
            });
            html += '</div>';

            // Weeks
            html += '<div class="flex-1 relative"><div class="flex gap-1">';

            weeks.forEach((week, weekIdx) => {
                html += '<div class="flex flex-col gap-1">';
                week.forEach(day => {
                    if(day.empty) {
                        html += '<div style="width: 11px; height: 11px;"></div>';
                    } else {
                        const color = getColor(day.count);
                        const title = `${day.date}: ${day.count} chapter${day.count !== 1 ? 's' : ''}`;
                        html += `<div style="width: 11px; height: 11px; background-color: ${color}; border-radius: 2px;" title="${title}" class="cursor-pointer hover:ring-2 hover:ring-indigo-400 transition-all"></div>`;
                    }
                });
                html += '</div>';
            });

            html += '</div></div></div>';

            // Legend with meaningful labels
            html += '<div class="mt-4 flex flex-wrap items-center justify-center gap-3 text-xs text-slate-500">';
            [
                { count: 0, label: 'None' },
                { count: 1, label: '1-2' },
                { count: 3, label: '3-5' },
                { count: 6, label: '6-10' },
                { count: 11, label: '11+' }
            ].forEach(({ count, label }) => {
                const color = getColor(count);
                html += `<div class="flex items-center gap-1.5">`;
                html += `<div style="width: 11px; height: 11px; background-color: ${color}; border-radius: 2px;" class="border border-slate-200"></div>`;
                html += `<span class="text-[10px] font-medium">${label}</span>`;
                html += `</div>`;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        // --- STREAK ENHANCEMENT FUNCTIONS ---

        function updateStreakMilestone(currentStreak) {
            const milestones = [7, 14, 30, 50, 100, 180, 365];
            const progressEl = document.getElementById('streak-milestone-progress');
            const emojiEl = document.getElementById('streak-emoji');

            if(!progressEl || !emojiEl) return;

            if(currentStreak === 0) {
                progressEl.innerText = '';
                emojiEl.innerText = 'üí§';
                return;
            }

            // Find next milestone
            let nextMilestone = milestones.find(m => m > currentStreak);

            if(!nextMilestone) {
                // Past all milestones!
                progressEl.innerText = 'LEGENDARY! üèÜ';
                emojiEl.innerText = 'üëë';
                return;
            }

            const daysToGo = nextMilestone - currentStreak;
            progressEl.innerText = `${daysToGo} to ${nextMilestone}-day`;

            // Update emoji based on streak level
            if(currentStreak >= 365) emojiEl.innerText = 'üëë';
            else if(currentStreak >= 100) emojiEl.innerText = 'üíé';
            else if(currentStreak >= 30) emojiEl.innerText = 'üî•';
            else if(currentStreak >= 7) emojiEl.innerText = '‚ö°';
            else emojiEl.innerText = 'üî•';
        }

        function updateStreakStatus(currentStreak, activityMap) {
            const banner = document.getElementById('streak-status-banner');
            if(!banner) return;

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayStr = getLocalDateString(today.getTime());
            const hasReadToday = activityMap[todayStr];

            // Determine status and message
            let html = '';

            if(currentStreak === 0) {
                // No active streak
                html = `
                    <div class="bg-gradient-to-r from-slate-50 to-slate-100/50 px-6 py-4 rounded-2xl border border-slate-200">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">üìñ</span>
                            <div class="flex-1">
                                <div class="text-sm font-bold text-slate-700">Start your reading streak today!</div>
                                <div class="text-xs text-slate-500">"This book of the law shall not depart out of thy mouth" - Joshua 1:8</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if(!hasReadToday && currentStreak > 0) {
                // At risk - haven't read today
                html = `
                    <div class="bg-gradient-to-r from-orange-50 to-amber-100/50 px-6 py-4 rounded-2xl border border-orange-200 animate-pulse">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">‚ö†Ô∏è</span>
                            <div class="flex-1">
                                <div class="text-sm font-bold text-orange-800">Don't lose your ${currentStreak}-day streak!</div>
                                <div class="text-xs text-orange-600">Read at least one chapter today to keep it alive</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if(hasReadToday && currentStreak >= 7) {
                // On fire!
                const messages = [
                    { min: 365, msg: "You're a Bible reading champion!", emoji: "üëë", verse: "Blessed is he that readeth" },
                    { min: 100, msg: "Your dedication is incredible!", emoji: "üíé", verse: "Continue thou in the things which thou hast learned" },
                    { min: 50, msg: "You're on fire!", emoji: "üî•", verse: "Study to shew thyself approved" },
                    { min: 30, msg: "You're building a powerful habit!", emoji: "‚ö°", verse: "Meditate therein day and night" },
                    { min: 14, msg: "Two weeks strong!", emoji: "üí™", verse: "Thy word have I hid in mine heart" },
                    { min: 7, msg: "One week streak!", emoji: "üéØ", verse: "Desire the sincere milk of the word" }
                ];

                const status = messages.find(m => currentStreak >= m.min) || messages[messages.length - 1];

                html = `
                    <div class="bg-gradient-to-r from-indigo-50 to-purple-100/50 px-6 py-4 rounded-2xl border border-indigo-200">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${status.emoji}</span>
                            <div class="flex-1">
                                <div class="text-sm font-bold text-indigo-900">${status.msg}</div>
                                <div class="text-xs text-indigo-600">${status.verse}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            if(html) {
                banner.innerHTML = html;
                banner.classList.remove('hidden');
            } else {
                banner.classList.add('hidden');
            }
        }

        function checkStreakMilestones(currentStreak) {
            // Check if just hit a milestone (need to track last checked streak)
            const lastStreak = parseInt(localStorage.getItem(`lastStreakCheck_${appData.activeProfileId}`)) || 0;
            localStorage.setItem(`lastStreakCheck_${appData.activeProfileId}`, currentStreak);

            const milestones = [
                { days: 7, title: "Week Warrior", emoji: "‚ö°", message: "Seven days of faithful reading!", verse: "Proverbs 2:4-5" },
                { days: 14, title: "Two Week Champion", emoji: "üí™", message: "Two weeks of consistent devotion!", verse: "Psalm 1:2" },
                { days: 30, title: "Monthly Master", emoji: "üî•", message: "30 days! You've built a lasting habit!", verse: "Joshua 1:8" },
                { days: 50, title: "Persistent Reader", emoji: "üìö", message: "50 days of dedication!", verse: "2 Timothy 2:15" },
                { days: 100, title: "Century Scholar", emoji: "üíé", message: "100 days! Incredible commitment!", verse: "Psalm 119:97" },
                { days: 180, title: "Half-Year Hero", emoji: "üåü", message: "180 days! Over half a year!", verse: "Colossians 3:16" },
                { days: 365, title: "YEAR LEGEND", emoji: "üëë", message: "365 DAYS! A full year of Bible reading!", verse: "Revelation 1:3" }
            ];

            // Find if we just crossed a milestone
            const justHit = milestones.find(m => currentStreak >= m.days && lastStreak < m.days);

            if(justHit && !localStorage.getItem(`streakMilestone_${appData.activeProfileId}_${justHit.days}`)) {
                // Mark as celebrated
                localStorage.setItem(`streakMilestone_${appData.activeProfileId}_${justHit.days}`, 'true');

                // Show celebration
                setTimeout(() => celebrateStreakMilestone(justHit), 500);
            }
        }

        function celebrateStreakMilestone(milestone) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-[200] bg-gradient-to-br from-indigo-900/95 to-purple-900/95 flex items-center justify-center p-4 animate-in';
            modal.innerHTML = `
                <div class="bg-white rounded-3xl p-8 max-w-md text-center shadow-2xl">
                    <div class="text-6xl mb-4">${milestone.emoji}</div>
                    <h2 class="text-2xl font-black text-indigo-900 mb-2">${milestone.title.toUpperCase()}!</h2>
                    <p class="text-lg font-bold text-indigo-700 mb-3">${milestone.message}</p>
                    <div class="bg-indigo-50 rounded-2xl p-4 mb-4">
                        <p class="text-sm text-indigo-800 font-medium italic">"${milestone.verse}"</p>
                    </div>
                    <div class="text-4xl font-black text-indigo-600 mb-4">${milestone.days} DAYS</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="px-8 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 shadow-lg">Glory to God! üôè</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.renderStatsPage = () => {
            const allCats = [...OT_CATS, ...NT_CATS];
            const dataset = []; const labels = []; const colors = []; let chartTotalRead = 0;
            const currentProg = getProgress();
            allCats.forEach(cat => {
                let catRead = 0; let catTotal = 0;
                bible.filter(b => b.cat === cat.name).forEach(b => {
                    b.ch.forEach((w, idx) => { catTotal += w; if (currentProg[`${b.name}-${idx+1}`]) catRead += w; });
                });
                dataset.push(catRead); labels.push(cat.name); colors.push(cat.chartColor); chartTotalRead += catRead;
                cat.stats = { read: catRead, total: catTotal, pct: (catTotal > 0 ? (catRead/catTotal*100).toFixed(1) : 0) };
            });
            const unreadWords = WORD_TOTALS.GLOBAL - chartTotalRead;
            dataset.push(unreadWords); labels.push("Unread"); colors.push("#cbd5e1");

            // Calculate chapter counts
            let totalChapters = 0;
            let chaptersRead = 0;
            bible.forEach(b => {
                totalChapters += b.ch.length;
                b.ch.forEach((w, idx) => {
                    if (currentProg[`${b.name}-${idx+1}`]) chaptersRead++;
                });
            });

            // Update or create main chart
            const ctx = document.getElementById('mainDonutChart').getContext('2d');
            if (mainChart) {
                // Update existing chart data
                mainChart.data.labels = labels;
                mainChart.data.datasets[0].data = dataset;
                mainChart.data.datasets[0].backgroundColor = colors;
                mainChart.update('none'); // 'none' mode = no animation for faster updates
            } else {
                // Create new chart only if it doesn't exist
                mainChart = new Chart(ctx, { type: 'doughnut', data: { labels: labels, datasets: [{ data: dataset, backgroundColor: colors, borderWidth: 0, hoverOffset: 4 }] }, options: { cutout: '75%', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
            }
            document.getElementById('stats-page-total-percent').innerText = ((chartTotalRead / WORD_TOTALS.GLOBAL) * 100).toFixed(2) + '%';
            document.getElementById('stats-words-count').innerText = chartTotalRead.toLocaleString() + ' / ' + WORD_TOTALS.GLOBAL.toLocaleString() + ' words';
            document.getElementById('stats-chapters-count').innerText = chaptersRead + ' / ' + totalChapters + ' chapters';
            document.getElementById('legend-grid').innerHTML = allCats.map(cat => `<div class="flex items-center gap-3 text-sm p-2 bg-slate-50 rounded-lg"><div class="w-4 h-4 rounded-full flex-shrink-0 shadow-sm" style="background-color: ${cat.chartColor}"></div><span class="text-slate-700 font-bold truncate">${cat.name}</span></div>`).join('');

            // Only rebuild mini chart HTML if number of categories changed
            const currentHTML = document.getElementById('category-stats-grid').innerHTML;
            const needsRebuild = miniCharts.length !== allCats.length;
            if (needsRebuild) {
                // Destroy old mini charts before rebuilding DOM
                miniCharts.forEach(c => c.destroy());
                miniCharts = [];
                document.getElementById('category-stats-grid').innerHTML = allCats.map((cat, i) => `<div class="bg-white p-5 rounded-3xl border border-slate-100 flex flex-col items-center justify-center relative shadow-sm"><div class="h-24 w-24 relative mb-3"><canvas id="miniChart-${i}"></canvas><div class="absolute inset-0 flex items-center justify-center text-xs font-black text-slate-400">${cat.stats.pct}%</div></div><span class="text-[10px] font-black uppercase text-center ${cat.style.split(' ')[2]}">${cat.name}</span></div>`).join('');
            }

            allCats.forEach((cat, i) => {
                // Update percentage text
                const percentDiv = document.querySelector(`#miniChart-${i}`).parentElement.querySelector('.text-xs');
                if (percentDiv) percentDiv.innerText = `${cat.stats.pct}%`;

                if (miniCharts[i]) {
                    // Update existing mini chart
                    miniCharts[i].data.datasets[0].data = [cat.stats.read, cat.stats.total - cat.stats.read];
                    miniCharts[i].update('none');
                } else {
                    // Create new mini chart
                    const miniCtx = document.getElementById(`miniChart-${i}`).getContext('2d');
                    miniCharts[i] = new Chart(miniCtx, { type: 'doughnut', data: { labels: ["Read", "Remaining"], datasets: [{ data: [cat.stats.read, cat.stats.total - cat.stats.read], backgroundColor: [cat.chartColor, "#cbd5e1"], borderWidth: 0 }] }, options: { cutout: '70%', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { enabled: false } }, events: [] } });
                }
            });

            // Render heatmap and streak stats
            const streaks = calculateStreaks();
            const activityMap = getReadingActivity();

            // Update streak display
            document.getElementById('current-streak').innerText = `${streaks.current} day${streaks.current !== 1 ? 's' : ''}`;
            document.getElementById('longest-streak').innerText = `${streaks.longest} day${streaks.longest !== 1 ? 's' : ''}`;

            // Calculate additional statistics
            const yearStart = new Date(new Date().getFullYear(), 0, 1);
            let yearChapters = 0;
            let bestDayChapters = 0;
            let totalReadingDays = Object.keys(activityMap).length;
            let totalChaptersRead = 0;

            Object.keys(activityMap).forEach(dateStr => {
                const date = new Date(dateStr);
                if(date >= yearStart) {
                    yearChapters += activityMap[dateStr];
                }
                totalChaptersRead += activityMap[dateStr];
                bestDayChapters = Math.max(bestDayChapters, activityMap[dateStr]);
            });

            // Calculate averages
            const avgChaptersPerDay = totalReadingDays > 0 ? (totalChaptersRead / totalReadingDays).toFixed(1) : 0;

            // Update all stat cards
            document.getElementById('total-reading-days').innerText = totalReadingDays;
            document.getElementById('avg-chapters-day').innerText = `${avgChaptersPerDay} avg/day`;
            document.getElementById('best-day').innerText = `${bestDayChapters} ch`;
            document.getElementById('year-chapters').innerText = `${yearChapters} this year`;

            // Calculate and display time remaining statistics
            const wpm = appData.wordsPerMinute || 250;
            const unreadMinutes = Math.ceil(unreadWords / wpm);
            const unreadHours = (unreadMinutes / 60).toFixed(1);
            const unreadDays = Math.ceil(unreadMinutes / (60 * 2)); // Assuming 2 hours reading per day

            // Update time remaining displays if elements exist
            const timeRemainingEl = document.getElementById('time-remaining-stat');
            if (timeRemainingEl) {
                if (unreadWords === 0) {
                    timeRemainingEl.innerHTML = 'üéâ <span class="text-emerald-600 font-black">Complete!</span>';
                } else if (unreadHours < 1) {
                    timeRemainingEl.innerHTML = `‚è±Ô∏è ~${unreadMinutes} min left`;
                } else if (unreadHours < 24) {
                    timeRemainingEl.innerHTML = `‚è±Ô∏è ~${unreadHours} hrs left`;
                } else {
                    timeRemainingEl.innerHTML = `‚è±Ô∏è ~${Math.ceil(parseFloat(unreadHours) / 24)} days left`;
                }
            }

            // Generate playful guilt-trip comparisons
            const comparisonEl = document.getElementById('reading-comparison');
            if (comparisonEl && unreadWords > 0) {
                const comparisons = [
                    { activity: 'scrolling social media', emoji: 'üì±', avgMinPerDay: 145 },
                    { activity: 'watching Netflix', emoji: 'üì∫', avgMinPerDay: 120 },
                    { activity: 'playing mobile games', emoji: 'üéÆ', avgMinPerDay: 60 },
                    { activity: 'watching YouTube', emoji: 'üé¨', avgMinPerDay: 90 },
                    { activity: 'browsing the internet', emoji: 'üåê', avgMinPerDay: 100 }
                ];

                const randomComparison = comparisons[Math.floor(Math.random() * comparisons.length)];
                const daysOfActivity = (unreadMinutes / randomComparison.avgMinPerDay).toFixed(1);

                let message = '';
                if (unreadMinutes < randomComparison.avgMinPerDay) {
                    message = `${randomComparison.emoji} You could finish in less time than you spend ${randomComparison.activity} today!`;
                } else if (daysOfActivity < 7) {
                    message = `${randomComparison.emoji} Finish in the time you'd spend ${randomComparison.activity} this week`;
                } else if (daysOfActivity < 30) {
                    message = `${randomComparison.emoji} That's ${daysOfActivity} days of ${randomComparison.activity}`;
                } else {
                    message = `${randomComparison.emoji} Trade ${Math.ceil(parseFloat(daysOfActivity) / 30)} month${Math.ceil(parseFloat(daysOfActivity) / 30) > 1 ? 's' : ''} of ${randomComparison.activity} for eternal wisdom`;
                }

                comparisonEl.innerHTML = `
                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-200 rounded-2xl p-4 text-center">
                        <div class="text-sm font-bold text-indigo-900">üí° Perspective Check</div>
                        <div class="text-xs text-indigo-500 mb-2 italic">Screen time vs Bible reading time</div>
                        <div class="text-xs text-indigo-700">${message}</div>
                    </div>
                `;
            }

            // Update streak milestone progress
            updateStreakMilestone(streaks.current);

            // Update streak status banner
            updateStreakStatus(streaks.current, activityMap);

            // Check for streak milestones and celebrate if just hit
            checkStreakMilestones(streaks.current);

            renderHeatmap();
        }

        // --- VERSE OF THE DAY ---
        // Local verse list - no API needed, works offline
        const LOCAL_VERSES = [
            {
                "reference": "Psalm 119:105",
                "text": "Thy word is a lamp unto my feet, and a light unto my path.",
                "theme": "Guidance"
            },
            {
                "reference": "Proverbs 3:5",
                "text": "Trust in the LORD with all thine heart; and lean not unto thine own understanding.",
                "theme": "Trust"
            },
            {
                "reference": "Psalm 119:11",
                "text": "Thy word have I hid in mine heart, that I might not sin against thee.",
                "theme": "Devotion"
            },
            {
                "reference": "Psalm 19:7",
                "text": "The law of the LORD is perfect, converting the soul: the testimony of the LORD is sure, making wise the simple.",
                "theme": "Wisdom"
            },
            {
                "reference": "Psalm 23:1",
                "text": "The LORD is my shepherd; I shall not want.",
                "theme": "Trust"
            },
            {
                "reference": "Matthew 4:4",
                "text": "Man shall not live by bread alone, but by every word that proceedeth out of the mouth of God.",
                "theme": "Scripture Necessity"
            },
            {
                "reference": "Colossians 3:16",
                "text": "Let the word of Christ dwell in you richly in all wisdom; teaching and admonishing one another in psalms and hymns and spiritual songs, singing with grace in your hearts to the Lord.",
                "theme": "Indwelling Word"
            },
            {
                "reference": "James 1:22",
                "text": "But be ye doers of the word, and not hearers only, deceiving your own selves.",
                "theme": "Application"
            },
            {
                "reference": "Psalm 46:1",
                "text": "God is our refuge and strength, a very present help in trouble.",
                "theme": "Trust"
            },
            {
                "reference": "Proverbs 4:7",
                "text": "Wisdom is the principal thing; therefore get wisdom: and with all thy getting get understanding.",
                "theme": "Wisdom"
            },
            {
                "reference": "Acts 17:11",
                "text": "These were more noble than those in Thessalonica, in that they received the word with all readiness of mind, and searched the scriptures daily, whether those things were so.",
                "theme": "Study"
            },
            {
                "reference": "John 5:39",
                "text": "Search the scriptures; for in them ye think ye have eternal life: and they are they which testify of me.",
                "theme": "Christ in Scripture"
            },
            {
                "reference": "Isaiah 40:8",
                "text": "The grass withereth, the flower fadeth: but the word of our God shall stand for ever.",
                "theme": "Eternal Word"
            },
            {
                "reference": "Romans 10:17",
                "text": "So then faith cometh by hearing, and hearing by the word of God.",
                "theme": "Faith"
            },
            {
                "reference": "1 Peter 2:2",
                "text": "As newborn babes, desire the sincere milk of the word, that ye may grow thereby.",
                "theme": "Desire for the Word"
            }
        ];

        async function loadVerseOfDay() {
            const verseContent = document.getElementById('verse-content');

            try {
                // Pick a random verse from local list (no API needed - works offline!)
                const randomVerse = LOCAL_VERSES[Math.floor(Math.random() * LOCAL_VERSES.length)];

                // Display the verse directly from local data
                displayVerse(randomVerse.text, randomVerse.reference);

                /* COMMENTED OUT - OLD API CODE (kept for reference)
                // Pick a random popular verse
                const randomVerse = POPULAR_VERSES[Math.floor(Math.random() * POPULAR_VERSES.length)];

                // Fetch from bible-api.com (KJV version)
                const response = await fetch(`https://bible-api.com/${encodeURIComponent(randomVerse)}?translation=kjv`);

                if (!response.ok) {
                    throw new Error('Failed to fetch verse');
                }

                const data = await response.json();

                // Display the verse
                displayVerse(data.text, data.reference);
                */
            } catch (error) {
                console.error('Error loading verse of the day:', error);
                displayFallbackVerse();
            }
        }

        function displayVerse(text, reference) {
            const verseContent = document.getElementById('verse-content');

            // Clean up the verse text (remove extra whitespace and newlines)
            const cleanText = text.trim().replace(/\s+/g, ' ');

            // Fade out the old verse first
            verseContent.classList.remove('verse-fade-in');
            verseContent.classList.add('verse-fade-out');

            // After fade out completes, update content and fade in
            setTimeout(() => {
                verseContent.innerHTML = `
                    <div class="text-xs text-slate-400 italic leading-relaxed text-center">
                        "${cleanText}" <span class="text-slate-300 font-semibold">‚Äî ${reference}</span>
                    </div>
                `;

                verseContent.classList.remove('verse-fade-out');
                verseContent.classList.add('verse-fade-in');
            }, 2000);
        }

        function displayFallbackVerse() {
            displayVerse(
                'For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life.',
                'John 3:16'
            );
        }

        window.refreshVerseOfDay = function() {
            loadVerseOfDay();
        };

        // Auto-rotate verses every 15 seconds
        setInterval(() => {
            loadVerseOfDay();
        }, 15000);

        assignCategories();
        window.setTab(appData.defaultTab || 'PLAN');
        window.updateStats();
        updateProfileColor();
        checkFirstVisit();
        loadVerseOfDay();
        updateReadingTimeToggleUI();

        // --- DARK MODE UI HELPER ---
        // Updates the settings page toggle button to reflect current dark mode state
        function updateDarkModeToggleUI(isDark) {
            const toggle = document.getElementById('dark-mode-toggle');
            const circle = document.getElementById('dark-mode-toggle-circle');

            if(toggle && circle) {
                if(isDark) {
                    toggle.classList.remove('bg-slate-300');
                    toggle.classList.add('bg-indigo-600');
                    circle.classList.remove('translate-x-1');
                    circle.classList.add('translate-x-7');
                } else {
                    toggle.classList.remove('bg-indigo-600');
                    toggle.classList.add('bg-slate-300');
                    circle.classList.remove('translate-x-7');
                    circle.classList.add('translate-x-1');
                }
            }
        }

        // --- INITIALIZE DARK MODE FROM LOCALSTORAGE ---
        // Restore user's dark mode preference on page load
        const darkModePreference = localStorage.getItem('darkMode');
        if (darkModePreference === 'enabled') {
            document.body.classList.add('dark-mode');
            updateDarkModeToggleUI(true);

            // Add dark mode styles if not already present
            if(!document.getElementById('dark-mode-style')) {
                const style = document.createElement('style');
                style.id = 'dark-mode-style';
                style.textContent = `
                    .dark-mode {
                        filter: invert(0.9) hue-rotate(180deg);
                        background: #1a1a1a !important;
                    }
                    .dark-mode img { filter: invert(1) hue-rotate(180deg); }
                `;
                document.head.appendChild(style);
            }
        }

        // --- TAB SCROLL INDICATOR ---
        function updateTabScrollIndicator() {
            const container = document.getElementById('tab-scroll-container');
            const indicator = document.getElementById('tab-scroll-indicator');

            if (!container || !indicator) return;

            const isScrollable = container.scrollWidth > container.clientWidth;
            const isScrolledToEnd = container.scrollLeft + container.clientWidth >= container.scrollWidth - 5;

            if (isScrollable && !isScrolledToEnd) {
                indicator.classList.remove('hidden');
            } else {
                indicator.classList.add('hidden');
            }
        }

        // Update indicator on scroll
        const tabScrollContainer = document.getElementById('tab-scroll-container');
        if (tabScrollContainer) {
            tabScrollContainer.addEventListener('scroll', updateTabScrollIndicator);
        }

        // Update on load and resize
        updateTabScrollIndicator();
        window.addEventListener('resize', updateTabScrollIndicator);

		// ============================================
		// ü•ö EASTER EGGS - Add fun secrets to discover!
		// ============================================

		// --- EASTER EGG 1: Konami Code Achievement ---
		let konamiCode = [];
		const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];

		document.addEventListener('keydown', (e) => {
			konamiCode.push(e.key);
			konamiCode = konamiCode.slice(-10);
			
			if(JSON.stringify(konamiCode) === JSON.stringify(konamiSequence)) {
				unlockSecretAchievement();
			}
		});

		function unlockSecretAchievement() {
			const modal = document.createElement('div');
			modal.className = 'fixed inset-0 z-[200] bg-gradient-to-br from-purple-900/95 to-indigo-900/95 flex items-center justify-center p-4 animate-in';
			modal.innerHTML = `
				<div class="bg-white rounded-3xl p-8 max-w-md text-center shadow-2xl">
					<div class="text-6xl mb-4">üèÜ</div>
					<h2 class="text-2xl font-black text-indigo-900 mb-2">SECRET UNLOCKED!</h2>
					<p class="text-slate-600 mb-4">"For nothing is secret, that shall not be made manifest" - Luke 8:17</p>
					<p class="text-sm text-indigo-600 font-bold">You've discovered the Konami Code blessing!</p>
					<button onclick="this.parentElement.parentElement.remove()" class="mt-6 px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700">Amen! ‚ú®</button>
				</div>
			`;
			document.body.appendChild(modal);
		}

		// --- EASTER EGG 2: Rainbow Mode (Click profile dot 7 times) ---
		let profileDotClicks = 0;
		let clickTimeout;

		if(currentProfileDot) {
			currentProfileDot.addEventListener('click', (e) => {
				e.stopPropagation();
				profileDotClicks++;
				
				clearTimeout(clickTimeout);
				clickTimeout = setTimeout(() => profileDotClicks = 0, 2000);
				
				if(profileDotClicks === 7) {
					activateRainbowMode();
					profileDotClicks = 0;
				}
			});
		}

		function activateRainbowMode() {
			document.body.style.animation = 'rainbow 10s linear infinite';
			const style = document.createElement('style');
			style.textContent = `
				@keyframes rainbow {
					0% { filter: hue-rotate(0deg); }
					100% { filter: hue-rotate(360deg); }
				}
			`;
			document.head.appendChild(style);
			
			const modal = document.createElement('div');
			modal.className = 'fixed top-4 right-4 z-[200] bg-white rounded-2xl p-4 shadow-2xl border-2 border-indigo-400 animate-in';
			modal.innerHTML = `
				<div class="text-center">
					<div class="text-4xl mb-2">üåà</div>
					<p class="text-sm font-bold text-indigo-900">Rainbow Mode Activated!</p>
					<p class="text-xs text-slate-600 mt-1">"I do set my bow in the cloud" - Genesis 9:13</p>
				</div>
			`;
			document.body.appendChild(modal);
			
			setTimeout(() => {
				document.body.style.animation = '';
				style.remove();
				modal.remove();
			}, 10000);
		}

		// --- EASTER EGG 3: Psalm 119 Achievement ---
		const originalToggleChapter = window.toggleChapter;
		window.toggleChapter = (id, event) => {
			const prog = getProgress();
			const wasRead = prog[id];

			originalToggleChapter(id, event);
			
			// Check if just completed Psalm 119
			if(id === 'Psalms-119' && !wasRead && getProgress()[id]) {
				setTimeout(() => showPsalm119Achievement(), 500);
			}
		};

		function showPsalm119Achievement() {
			const modal = document.createElement('div');
			modal.className = 'fixed inset-0 z-[200] bg-black/80 flex items-center justify-center p-4';
			modal.innerHTML = `
				<div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-3xl p-8 max-w-lg text-center shadow-2xl border-4 border-amber-400 modal-in">
					<div class="text-7xl mb-4">üìú</div>
					<h2 class="text-3xl font-black text-amber-900 mb-3">MIGHTY ACHIEVEMENT!</h2>
					<p class="text-lg font-bold text-amber-800 mb-4">You've conquered Psalm 119!</p>
					<p class="text-sm text-slate-600 leading-relaxed mb-2">The longest chapter in the Bible with 2,423 words across 176 verses.</p>
					<p class="text-xs text-amber-600 italic">"Thy word is a lamp unto my feet, and a light unto my path" - Psalm 119:105</p>
					<button onclick="this.parentElement.parentElement.remove()" class="mt-6 px-8 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 shadow-lg">Glory to God! üôè</button>
				</div>
			`;
			document.body.appendChild(modal);
		}

		// --- EASTER EGG 4: Bible Completion Celebration ---
		const originalUpdateStats = window.updateStats;
		window.updateStats = () => {
			originalUpdateStats();
			
			// Check for Bible completion
			const currentProg = getProgress();
			let finishedBooks = 0;
			bible.forEach(book => {
				let bookChaptersRead = 0;
				book.ch.forEach((words, cIdx) => {
					if (currentProg[`${book.name}-${cIdx+1}`]) bookChaptersRead++;
				});
				if (bookChaptersRead === book.ch.length) finishedBooks++;
			});
			
			if(finishedBooks === 66 && !localStorage.getItem(`bibleCompleted_${appData.activeProfileId}`)) {
				localStorage.setItem(`bibleCompleted_${appData.activeProfileId}`, 'true');
				setTimeout(() => celebrateBibleCompletion(), 1000);
			}
		};

		function celebrateBibleCompletion() {
			// Confetti effect
			const confetti = document.createElement('div');
			confetti.className = 'fixed inset-0 z-[300] pointer-events-none';
			let confettiHTML = '';
			for(let i = 0; i < 50; i++) {
				const emoji = ['üéâ','‚ú®','üìñ','‚úùÔ∏è','üôè'][Math.floor(Math.random()*5)];
				confettiHTML += `<div style="position:absolute;left:${Math.random()*100}%;top:-50px;font-size:${20+Math.random()*30}px;animation:fall ${3+Math.random()*2}s linear forwards;animation-delay:${Math.random()}s">${emoji}</div>`;
			}
			confetti.innerHTML = confettiHTML;
			
			const style = document.createElement('style');
			style.textContent = `@keyframes fall { to { top: 110vh; transform: rotate(${Math.random()*360}deg); } }`;
			document.head.appendChild(style);
			document.body.appendChild(confetti);
			
			setTimeout(() => {
				const modal = document.createElement('div');
				modal.className = 'fixed inset-0 z-[400] bg-gradient-to-br from-indigo-900/98 to-purple-900/98 flex items-center justify-center p-4';
				modal.innerHTML = `
					<div class="bg-white rounded-[3rem] p-12 max-w-2xl text-center shadow-2xl modal-in">
						<div class="text-8xl mb-6">‚ú®üìñ‚ú®</div>
						<h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-4">BIBLE COMPLETE!</h1>
						<p class="text-2xl font-bold text-slate-700 mb-6">All 66 books. 789,634 words. One amazing accomplishment!</p>
						<p class="text-lg text-slate-600 mb-4">"Study to shew thyself approved unto God, a workman that needeth not to be ashamed, rightly dividing the word of truth."</p>
						<p class="text-sm font-bold text-indigo-600 mb-8">- 2 Timothy 2:15</p>
						<button onclick="this.parentElement.parentElement.remove()" class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-bold hover:shadow-lg text-lg">Continue in the Word üìñ</button>
					</div>
				`;
				document.body.appendChild(modal);
			}, 500);
			
			setTimeout(() => confetti.remove(), 6000);
		}

		// --- EASTER EGG 5: Type a creator name for Creator Message ---
		const creator_profiles = {
		  SHANE: {
			headline: 'Hey there!',
			body: 'Thanks for using Bible Progress!',
			verse: '"Thy word have I hid in mine heart, that I might not sin against thee." - Psalm 119:11',
			signoff: '- Shane',
			button: 'God bless! ‚ú®'
		  },
		  MEGAN: {
			headline: 'Hey Megan!',
			body: 'Thanks for using Bible Progress! Keep going ‚Äî one chapter at a time adds up fast.',
			verse: '"Trust in the LORD with all thine heart; and lean not unto thine own understanding." - Proverbs 3:5',
			signoff: '- Shane',
			button: 'I love you! üíû'
		  },
		  DOM: {
			headline: 'Hey Dom!',
			body: 'This Bible stuff is actually pretty important...',
			verse: '"Iron sharpeneth iron; so a man sharpeneth the countenance of his friend." - Proverbs 27:17',
			signoff: '- Shane',
			button: '0/Time! ‚åõ'
		  },
		  DAVID: {
			headline: 'Hey David!',
			body: 'My favorite uncle!',
			verse: '"Delight thyself also in the LORD; and he shall give thee the desires of thine heart." - Psalm 37:4',
			signoff: '- Shane',
			button: 'God bless! ‚ú®'
		  },
		  MOM: {
			headline: 'Hey Mom!',
			body: 'I love you mom!',
			verse: '"Her children arise up, and call her blessed; her husband also, and he praiseth her." - Proverbs 31:28',
			signoff: '- Shane',
			button: 'Love you! ‚ù§Ô∏è'
		  },
		  DAD: {
			headline: 'Hey Dad!',
			body: 'I love you dad!',
			verse: '"The just man walketh in his integrity: his children are blessed after him." - Proverbs 20:7',
			signoff: '- Shane',
			button: 'Love you! üíô'
		  },
		  SETH: {
			headline: 'Hey Seth!',
			body: 'You are my brother.',
			verse: '"A friend loveth at all times, and a brother is born for adversity." - Proverbs 17:17',
			signoff: '- Shane',
			button: 'Love you bro! ü§úü§õ'
		  }
		};

		const creator_triggers = Object.keys(creator_profiles);
		const max_trigger_len = Math.max(...creator_triggers.map((s) => s.length));

		let typed_sequence = '';

		document.addEventListener('keydown', (e) => {
		  const tag = e.target?.tagName;
		  if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

		  const key = String(e.key || '').toUpperCase();

		  // Ignore non-letters so Shift/Arrow/etc don't pollute the sequence
		  if (!/^[A-Z]$/.test(key)) return;

		  typed_sequence += key;
		  typed_sequence = typed_sequence.slice(-max_trigger_len);

		  for (const name of creator_triggers) {
			if (typed_sequence.endsWith(name)) {
			  showCreatorMessage(name);
			  typed_sequence = '';
			  break;
			}
		  }
		});

		function showCreatorMessage(name) {
		  const p = creator_profiles[name] ?? {
			headline: `Hey ${name}!`,
			body: 'Thanks for using Bible Progress!',
			verse: '"Thy word is a lamp unto my feet, and a light unto my path." - Psalm 119:105',
			signoff: `- ${name}`,
			button: 'God bless! ‚ú®'
		  };

		  const modal = document.createElement('div');
		  modal.className = 'fixed inset-0 z-[200] bg-slate-900/90 flex items-center justify-center p-4';

		  modal.innerHTML = `
			<div class="bg-white rounded-3xl p-8 max-w-md text-center shadow-2xl modal-in">
			  <div class="text-6xl mb-4">üëã</div>
			  <h2 class="text-2xl font-black text-indigo-900 mb-3">${escapeHtml(p.headline)}</h2>
			  <p class="text-slate-600 mb-4">${escapeHtml(p.body)}</p>
			  <p class="text-sm text-slate-500 italic mb-6">${escapeHtml(p.verse)}</p>
			  <p class="text-xs text-slate-400 mb-6">${escapeHtml(p.signoff)}</p>
			  <button class="creator-close px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700">${escapeHtml(p.button)}</button>
			</div>
		  `;

		  // Close on button click or backdrop click
		  modal.querySelector('.creator-close')?.addEventListener('click', () => modal.remove());
		  modal.addEventListener('click', (ev) => {
			if (ev.target === modal) modal.remove();
		  });

		  document.body.appendChild(modal);
		}

		function escapeHtml(s) {
		  return String(s).replace(/[&<>"']/g, (c) => ({
			'&': '&amp;',
			'<': '&lt;',
			'>': '&gt;',
			'"': '&quot;',
			"'": '&#39;'
		  }[c]));
		}


		// --- EASTER EGG 6: Christmas/Easter Greetings ---
		const originalSetTab = window.setTab;
		window.setTab = (t) => {
			// Check for holidays BEFORE calling original
			const today = new Date();
			const month = today.getMonth() + 1;
			const day = today.getDate();
			const shouldShowChristmas = (t === 'ABOUT' && month === 12 && day === 25 && !sessionStorage.getItem('christmasShown'));
			const shouldShowEaster = (t === 'ABOUT' && isEaster(today) && !sessionStorage.getItem('easterShown'));
			
			// Call original setTab
			originalSetTab(t);
			
			// Show holiday messages AFTER tab is set
			if(shouldShowChristmas) {
				sessionStorage.setItem('christmasShown', 'true');
				setTimeout(() => showChristmasMessage(), 500);
			} else if(shouldShowEaster) {
				sessionStorage.setItem('easterShown', 'true');
				setTimeout(() => showEasterMessage(), 500);
			}
		};

		function isEaster(date) {
			const easterDates = {
				2025: '04-20',
				2026: '04-05',
				2027: '03-28',
				2028: '04-16',
				2029: '04-01',
				2030: '04-21'
			};
			const year = date.getFullYear();
			const monthDay = `${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
			return easterDates[year] === monthDay;
		}

		function showChristmasMessage() {
			const modal = document.createElement('div');
			modal.className = 'fixed top-4 right-4 z-[200] bg-gradient-to-br from-red-50 to-green-50 rounded-2xl p-6 shadow-2xl border-2 border-red-400 animate-in max-w-sm';
			modal.innerHTML = `
				<div class="text-center">
					<div class="text-5xl mb-3">üéÑ</div>
					<p class="text-lg font-black text-red-900 mb-2">Merry Christmas!</p>
					<p class="text-sm text-slate-700 italic">"For unto you is born this day in the city of David a Saviour, which is Christ the Lord."</p>
					<p class="text-xs text-slate-500 mt-2">- Luke 2:11</p>
					<button onclick="this.parentElement.parentElement.remove()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-xl text-sm font-bold hover:bg-red-700">Amen! üéÖ</button>
				</div>
			`;
			document.body.appendChild(modal);
			setTimeout(() => modal.remove(), 10000);
		}

		function showEasterMessage() {
			const modal = document.createElement('div');
			modal.className = 'fixed top-4 right-4 z-[200] bg-gradient-to-br from-purple-50 to-yellow-50 rounded-2xl p-6 shadow-2xl border-2 border-purple-400 animate-in max-w-sm';
			modal.innerHTML = `
				<div class="text-center">
					<div class="text-5xl mb-3">‚úùÔ∏è</div>
					<p class="text-lg font-black text-purple-900 mb-2">He is Risen!</p>
					<p class="text-sm text-slate-700 italic">"Why seek ye the living among the dead? He is not here, but is risen!"</p>
					<p class="text-xs text-slate-500 mt-2">- Luke 24:5-6</p>
					<button onclick="this.parentElement.parentElement.remove()" class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-xl text-sm font-bold hover:bg-purple-700">Hallelujah! üôè</button>
				</div>
			`;
			document.body.appendChild(modal);
			setTimeout(() => modal.remove(), 10000);
		}

		// --- DARK MODE FEATURE ---
		// Dark mode is accessible via:
		// 1. Settings page toggle (primary, user-friendly method)
		// 2. EASTER EGG: Triple-click logo (fun alternative with notification)
		// Both methods use the same toggleDarkMode() function but with different notification behaviors

		// Easter egg: Triple-click logo for dark mode with celebration notification
		let logoClicks = 0;
		let logoClickTimeout;
		const logo = document.querySelector('h1');

		if(logo) {
			logo.style.cursor = 'pointer';
			logo.addEventListener('click', () => {
				logoClicks++;
				clearTimeout(logoClickTimeout);
				logoClickTimeout = setTimeout(() => logoClicks = 0, 1000);

				if(logoClicks === 3) {
					toggleDarkMode(true); // Show celebration notification for easter egg
					logoClicks = 0;
				}
			});
		}

		// Core dark mode toggle function
		// @param {boolean} showNotification - If true, shows a celebration notification (for easter egg)
		function toggleDarkMode(showNotification = true) {
			document.body.classList.toggle('dark-mode');
			const isDark = document.body.classList.contains('dark-mode');

			// Save preference to localStorage for persistence across sessions
			localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');

			// Update settings toggle UI to reflect current state
			updateDarkModeToggleUI(isDark);

			// Inject dark mode styles if not already present
			if(!document.getElementById('dark-mode-style')) {
				const style = document.createElement('style');
				style.id = 'dark-mode-style';
				style.textContent = `
					.dark-mode {
						filter: invert(0.9) hue-rotate(180deg);
						background: #1a1a1a !important;
					}
					.dark-mode img { filter: invert(1) hue-rotate(180deg); }
				`;
				document.head.appendChild(style);
			}

			// Show celebration notification for easter egg activation
			if(showNotification) {
				const notification = document.createElement('div');
				notification.className = 'fixed top-4 left-1/2 -translate-x-1/2 z-[200] bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl font-bold text-sm animate-in';
				notification.textContent = isDark ? 'üåô Dark Mode Enabled' : '‚òÄÔ∏è Light Mode Enabled';
				document.body.appendChild(notification);
				setTimeout(() => notification.remove(), 2000);
			}
		}

		// Settings page dark mode toggle (silent toggle without notification)
		window.toggleDarkModeSetting = () => {
			toggleDarkMode(false); // No notification for regular settings toggle
		};

		// Reading time estimate functions
		window.toggleReadingTime = () => {
			appData.showReadingTime = !appData.showReadingTime;
			updateReadingTimeToggleUI();
			window.saveProgress();
			// Re-render daily plan if currently viewing it
			if(window.activeTab === 'PLAN') {
				window.renderDailyPlan();
			}
		};

		window.updateWPM = (value) => {
			const wpm = parseInt(value);
			if(wpm >= 100 && wpm <= 500) {
				appData.wordsPerMinute = wpm;
				window.saveProgress();
				// Re-render daily plan if currently viewing it
				if(window.activeTab === 'PLAN') {
					window.renderDailyPlan();
				}
			}
		};

		// Default tab setting
		window.setDefaultTab = (tab) => {
			appData.defaultTab = tab;
			window.saveProgress();
		};

		// Update default tab selector in settings
		function updateDefaultTabSelector() {
			const selector = document.getElementById('default-tab-selector');
			if(selector && appData.defaultTab) {
				selector.value = appData.defaultTab;
			}
		}

		function updateReadingTimeToggleUI() {
			const toggle = document.getElementById('reading-time-toggle');
			const circle = document.getElementById('reading-time-toggle-circle');
			const wpmContainer = document.getElementById('wpm-setting-container');
			const wpmInput = document.getElementById('wpm-input');

			if(appData.showReadingTime) {
				toggle.classList.remove('bg-slate-300');
				toggle.classList.add('bg-indigo-500');
				circle.classList.remove('translate-x-1');
				circle.classList.add('translate-x-7');
				if(wpmContainer) wpmContainer.style.display = 'block';
			} else {
				toggle.classList.remove('bg-indigo-500');
				toggle.classList.add('bg-slate-300');
				circle.classList.remove('translate-x-7');
				circle.classList.add('translate-x-1');
				if(wpmContainer) wpmContainer.style.display = 'none';
			}

			// Update WPM input value
			if(wpmInput) {
				wpmInput.value = appData.wordsPerMinute || 250;
			}
		}

		// Calculate reading time from word count
		function calculateReadingTime(wordCount) {
			const wpm = appData.wordsPerMinute || 250;
			const minutes = Math.ceil(wordCount / wpm);
			if(minutes < 1) return '<1 min';
			if(minutes === 1) return '1 min';
			return `${minutes} min`;
		}

		console.log('ü•ö Easter eggs loaded! Try: Konami Code, click profile dot 7x, complete Psalm 119, finish the Bible, type SHANE/MOM/DAD/SETH, triple-click logo, or visit on Christmas/Easter!');

		// --- COOKIE CONSENT FUNCTIONS (Temporarily Disabled) ---
		/*
		window.showCookieConsent = () => {
			const cookieConsentDismissed = localStorage.getItem('cookieConsentDismissed');
			if (!cookieConsentDismissed) {
				const banner = document.getElementById('cookie-consent-banner');
				if (banner) {
					setTimeout(() => {
						banner.classList.remove('hidden');
					}, 2000); // Show after 2 seconds
				}
			}
		};

		window.dismissCookieConsent = () => {
			const banner = document.getElementById('cookie-consent-banner');
			if (banner) {
				banner.classList.add('hidden');
				localStorage.setItem('cookieConsentDismissed', 'true');
			}
		};

		// Show cookie consent banner on page load
		window.showCookieConsent();
		*/

		// --- SERVICE WORKER REGISTRATION FOR PWA ---
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', () => {
				navigator.serviceWorker.register('./service-worker.js')
					.then(registration => {
						console.log('‚úÖ Service Worker registered successfully:', registration.scope);
					})
					.catch(error => {
						console.log('‚ùå Service Worker registration failed:', error);
					});
			});
		}

    </script>
</body>

</html>


